    
    

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    Laboratorul 1    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-10-05T12:46:07+0300"/>
<meta name="keywords" content="isrm,laboratoare,01"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../feed.php%3Fmode=list&amp;ns=isrm:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/isrm/laboratoare/01.html"/>
<link rel="canonical" href="01.html"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='isrm:laboratoare';var JSINFO = {"id":"isrm:laboratoare:01","namespace":"isrm:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="../../lib/tpl/arctic/images/favicon.ico" />

  
</head>
<body>
<div id="wrapper" class='show'>
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="../index.html"><img height="70" src="../../res/sigla_isrm.png"/> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="../../systems/index.html"/><img height="70" src="../../res/systems.png" name="dokuwiki__top"/></a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="01%3Fdo=recent.html"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="01%3Fdo=login&amp;sectok=f62420cf5b01253da4b50505d148181b.html"  class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h3 class="sectionedit1" id="laboratorul_1">Laboratorul 1</h3>
<div class="level3">

<p>
Citim tutoriale și rulăm exemple. Textul de mai jos  este bazat pe ghidul <a href="http://nile.wpi.edu/NS/" class="urlextern" title="http://nile.wpi.edu/NS/"  rel="nofollow"> NS by example </a> de J. Chung și M. Claypool. 
</p>

</div>

<h5 id="introducere_in_ns2">Introducere în ns2</h5>
<div class="level5">

<p>
NS-2 este un simulator bazat pe evenimente dezvoltat la UC Berkely scris in C++ si OTcl. NS-2 este în primul rând util pentru simularea rețelelor <abbr title="Local Area Network">LAN</abbr> și WAN, dar și pentru rețele wireless, adhoc, de senzori. Cu toate ca NS este destul de ușor de utilizat pentru avansați, poate părea dificil la prima utilizare, deoarece există puține manuale user-friendly. Chiar dacă există o mulțime de documente scrise de către dezvoltatori, care conțin  explicații aprofundate ale simulatorului, acestea sunt scrise pentru utilizatorii NS-2 avansați. Această secțiune oferă o idee de bază a modului în care funcționează simulatorul, cum se pregătește o simulare, unde se găsesc componentele interne, cum se configurează componentele de rețea, etc. În principal se prezintă exemple simple și explicații bazate pe experimente simple, familiare unui student care a luat un curs introductiv de rețele. 
</p>

</div>

<h5 id="limbajul_otcl">Limbajul OTcl</h5>
<div class="level5">

<p>
NS-2 este în esență un interpretor de OTcl cu biblioteci de obiecte C++ specializate în simularea rețelelor. Este necesar să se cunoască  sumar programarea în OTcl pentru a utiliza NS-2. Această secțiune prezintă un exemplu OTcl care ilustrează ideea de bază a programării în OTcl, exemplu importat din manualul oficial NS-2. Această secțiune, ca și secțiunile următoare presupun că cititorul a instalat NS-2, și este familiarizat cu shell și cu C++.
</p>

<p>
Primul exemplu  este un script general OTcl, care arată modul de declarare o procedură și a o apela, modul de a atribui valori variabilelor, și modul de a implementa o buclă. OTcl este de fapt extensia orientată obiect a Tcl(pronunțat “tickle”), relația dintre Tcl și Otcl este la fel ca și cea dintre C și C++, dar în acest laborator rareori sunt folosite obiectele în OTcl. Pentru a rula acest script rulați “ns ex-tcl.tcl” la promptul shell - comanda “ns” execută NS-2 (interpretorul OTcl). Veți obține aceleași rezultate dacă tastați “tclsh ex-tcl.tcl”, în cazul în care tcl8.0 este instalat pe mașina dumneavoastră.
</p>
<dl class="file">
<dt><a href="../../_export/code/isrm/laboratoare/01%3Fcodeblock=0" title="Download Snippet" class="mediafile mf_tcl">ex-tcl.tcl</a></dt>
<dd><pre class="code file tcl"><span class="co1"># Writing a procedure called &quot;test&quot;</span>
<span class="kw1">proc</span> test <span class="br0">&#123;</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>
    <span class="kw1">set</span> a <span class="nu0">43</span>
    <span class="kw1">set</span> b <span class="nu0">27</span>
    <span class="kw1">set</span> c <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="re0">$a</span> + <span class="re0">$b</span><span class="br0">&#93;</span>
    <span class="kw1">set</span> d <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="re0">$a</span> - <span class="re0">$b</span><span class="br0">&#93;</span> <span class="sy0">*</span> <span class="re0">$c</span><span class="br0">&#93;</span>
    <span class="kw1">for</span> <span class="br0">&#123;</span><span class="kw1">set</span> k <span class="nu0">0</span><span class="br0">&#125;</span> <span class="br0">&#123;</span><span class="re0">$k</span> <span class="sy0">&lt;</span> <span class="nu0">10</span><span class="br0">&#125;</span> <span class="br0">&#123;</span><span class="kw2">incr</span> k<span class="br0">&#125;</span> <span class="br0">&#123;</span>
	<span class="kw1">if</span> <span class="br0">&#123;</span><span class="re0">$k</span> <span class="sy0">&lt;</span> <span class="nu0">5</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>
	    <span class="kw2">puts</span> <span class="st0">&quot;k &lt; 5, pow = [expr pow($d, $k)]&quot;</span>
	<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
	    <span class="kw2">puts</span> <span class="st0">&quot;k &gt;= 5, mod = [expr $d % $k]&quot;</span>
	<span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co1"># Calling the &quot;test&quot; procedure created above</span>
test</pre>
</dd></dl>

<p>
În Tcl, cuvântul cheie <code>proc</code>  este folosit pentru a defini o procedură, urmat de un nume de procedură și argumentele în acolade. Cuvântul cheie <code>set</code> este folosit pentru a atribui o valoare unei variabile. <code>[Expr …]</code> este pentru a calcula valoarea expresiei între paranteze drepte, după cuvântul cheie. Un lucru de remarcat este faptul că pentru a obține valoarea atribuită unei variabile, <code>$</code> este utilizat cu numele variabilei (ca în shell). Cuvântul cheie <code>puts</code> imprimă șirul de caractere la consolă. Rulând exemplul de mai sus, se obține: 
</p>
<pre class="code">k &lt; 5, pow = 1.0
k &lt; 5, pow = 1120.0
k &lt; 5, pow = 1254400.0
k &lt; 5, pow = 1404928000.0
k &lt; 5, pow = 1573519360000.0
k &gt;= 5, mod = 0
k &gt;= 5, mod = 4
k &gt;= 5, mod = 0
k &gt;= 5, mod = 0
k &gt;= 5, mod = 4</pre>

</div>

<h5 id="primul_exemplu_de_simulare">Primul exemplu de simulare</h5>
<div class="level5">

<p>
Această secțiune prezintă un script simplu NS-2 si explica ce face fiecare linie. Exemplul este un script OTcl care creează o configurație de rețea simplă și rulează scenariul de simulare din figura de mai jos. Pentru a rula această simulare, descărcați “ns-simple.tcl” și rulați “ns ns-simple.tcl” în shell. 
<img src="../../_media/isrm/laboratoare/01/lab1_ns_simple.png" class="mediaright" alt="" />
</p>

<p>
Această rețea este formată din 4 noduri (n0, n1, n2, n3), așa cum se arată în figura de mai sus. Link-urile duplex între n0 și n2, și n1 și n2 au capacitatea 2Mbps[Megabit/s]  și 10ms de întârziere. Link-ul duplex între n2-n3 are  capacitatea de 1.7Mbps și 20ms de întârziere. Fiecare nod folosește la ieșire o coadă DropTail, a cărei mărime  este de 10 pachete. Un agent “TCP” este atașat la n0, și este stabilită o conexiune la un sink TCP atașat la n3. În mod implicit, dimensiunea maximă a unui pachet pe care un agent de TCP poate genera este 1KByte. Un sink TCP  generează și trimite pachete ACK către expeditor (agent TCP) și livrează la aplicație pachetele primite. Un agent UDP, care este atașat la n1 este conectat la un agent sink (LossMonitor) atașat la n3. Un agent LossMonitor doar contorizează pachetele primite. Aplicații de tio  <abbr title="File Transfer Protocol">FTP</abbr> și generator de trafic CBR sunt atașate la agenții TCP șiUDP respectivi, iar CBR este configurat pentru a genera pachete de 1000 bytes la rata de 1Mbps. Aplicația CBR este setată să pornească de la 0.1s, și să se oprească la 14,5 sec, iar <abbr title="File Transfer Protocol">FTP</abbr> pornește de la 1.0s și se oprește la 14.0s.
</p>
<dl class="file">
<dt><a href="../../_export/code/isrm/laboratoare/01%3Fcodeblock=2" title="Download Snippet" class="mediafile mf_tcl">ns-simple.tcl</a></dt>
<dd><pre class="code file tcl"><span class="co1">#Create a simulator object</span>
<span class="kw1">set</span> ns <span class="br0">&#91;</span>new Simulator<span class="br0">&#93;</span>
&nbsp;
<span class="co1">#Define different colors for data flows (for NAM)</span>
<span class="re0">$ns</span> color <span class="nu0">1</span> Blue
<span class="re0">$ns</span> color <span class="nu0">2</span> Red
&nbsp;
<span class="co1">#Open the NAM trace file</span>
<span class="kw1">set</span> nf <span class="br0">&#91;</span><span class="kw2">open</span> out.nam w<span class="br0">&#93;</span>
<span class="re0">$ns</span> namtrace-all <span class="re0">$nf</span>
&nbsp;
<span class="co1">#ns trace file</span>
<span class="kw1">set</span> tracefd        <span class="br0">&#91;</span><span class="kw2">open</span> simple.tr w<span class="br0">&#93;</span>
<span class="re0">$ns</span> use-newtrace
<span class="re0">$ns</span> trace-all <span class="re0">$tracefd</span>
&nbsp;
&nbsp;
<span class="co1">#Create four nodes</span>
<span class="kw1">set</span> n0 <span class="br0">&#91;</span><span class="re0">$ns</span> node<span class="br0">&#93;</span>
<span class="kw1">set</span> n1 <span class="br0">&#91;</span><span class="re0">$ns</span> node<span class="br0">&#93;</span>
<span class="kw1">set</span> n2 <span class="br0">&#91;</span><span class="re0">$ns</span> node<span class="br0">&#93;</span>
<span class="kw1">set</span> n3 <span class="br0">&#91;</span><span class="re0">$ns</span> node<span class="br0">&#93;</span>
&nbsp;
<span class="co1">#Create links between the nodes</span>
<span class="re0">$ns</span> duplex-link <span class="re0">$n0</span> <span class="re0">$n2</span> 2Mb 10ms DropTail
<span class="re0">$ns</span> duplex-link <span class="re0">$n1</span> <span class="re0">$n2</span> 2Mb 10ms DropTail
<span class="re0">$ns</span> duplex-link <span class="re0">$n2</span> <span class="re0">$n3</span> 1.7Mb 20ms DropTail
&nbsp;
<span class="co1">#Set Queue Size of link (n2-n3) to 5</span>
<span class="re0">$ns</span> queue-limit <span class="re0">$n2</span> <span class="re0">$n3</span> <span class="nu0">5</span>
&nbsp;
<span class="co1">#Give node position (for NAM)</span>
<span class="re0">$ns</span> duplex-link-op <span class="re0">$n0</span> <span class="re0">$n2</span> orient right-down
<span class="re0">$ns</span> duplex-link-op <span class="re0">$n1</span> <span class="re0">$n2</span> orient right-up
<span class="re0">$ns</span> duplex-link-op <span class="re0">$n2</span> <span class="re0">$n3</span> orient right
&nbsp;
<span class="co1">#Monitor the queue for link n2-n3 (for NAM)</span>
<span class="re0">$ns</span> duplex-link-op <span class="re0">$n2</span> <span class="re0">$n3</span> queuePos <span class="nu0">0.5</span>
&nbsp;
<span class="co1">#Setup a TCP connection</span>
<span class="kw1">set</span> tcp <span class="br0">&#91;</span>new Agent/TCP<span class="br0">&#93;</span>
<span class="re0">$tcp</span> <span class="kw1">set</span> class_ <span class="nu0">2</span>
<span class="re0">$ns</span> attach-agent <span class="re0">$n0</span> <span class="re0">$tcp</span>
<span class="kw1">set</span> sinkt <span class="br0">&#91;</span>new Agent/TCPSink<span class="br0">&#93;</span>
<span class="re0">$ns</span> attach-agent <span class="re0">$n3</span> <span class="re0">$sinkt</span>
<span class="re0">$ns</span> connect <span class="re0">$tcp</span> <span class="re0">$sinkt</span>
<span class="re0">$tcp</span> <span class="kw1">set</span> fid_ <span class="nu0">1</span>
&nbsp;
<span class="co1">#Setup a FTP over TCP connection</span>
<span class="kw1">set</span> ftp <span class="br0">&#91;</span>new Application/FTP<span class="br0">&#93;</span>
<span class="re0">$ftp</span> attach-agent <span class="re0">$tcp</span>
<span class="re0">$ftp</span> <span class="kw1">set</span> type_ FTP
&nbsp;
<span class="co1">#Setup a UDP connection</span>
<span class="kw1">set</span> udp <span class="br0">&#91;</span>new Agent/UDP<span class="br0">&#93;</span>
<span class="re0">$ns</span> attach-agent <span class="re0">$n1</span> <span class="re0">$udp</span>
<span class="kw1">set</span> usink <span class="br0">&#91;</span>new Agent/LossMonitor<span class="br0">&#93;</span>
<span class="re0">$ns</span> attach-agent <span class="re0">$n3</span> <span class="re0">$usink</span>
<span class="re0">$ns</span> connect <span class="re0">$udp</span> <span class="re0">$usink</span>
<span class="re0">$udp</span> <span class="kw1">set</span> fid_ <span class="nu0">2</span>
&nbsp;
<span class="co1">#Setup a CBR over UDP connection</span>
<span class="kw1">set</span> cbr <span class="br0">&#91;</span>new Application/Traffic/CBR<span class="br0">&#93;</span>
<span class="re0">$cbr</span> attach-agent <span class="re0">$udp</span>
<span class="re0">$cbr</span> <span class="kw1">set</span> type_ CBR
<span class="re0">$cbr</span> <span class="kw1">set</span> packet_size_ <span class="nu0">1000</span>
<span class="re0">$cbr</span> <span class="kw1">set</span> rate_ 1mb
<span class="re0">$cbr</span> <span class="kw1">set</span> random_ false
&nbsp;
<span class="co1">#Define a 'finish' procedure</span>
<span class="kw1">proc</span> finish <span class="br0">&#123;</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>
    <span class="kw1">global</span> ns nf fout
    <span class="re0">$ns</span> flush-trace
    <span class="co1">#Close the NAM trace file</span>
    <span class="kw2">close</span> <span class="re0">$nf</span>
    <span class="co1">#Execute NAM on the trace file</span>
    <span class="kw2">exec</span> nam out.nam <span class="sy0">&amp;</span>
    <span class="kw1">exit</span> <span class="nu0">0</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="co1">#Schedule events for the CBR and FTP agents</span>
<span class="re0">$ns</span> at <span class="nu0">0.1</span> <span class="st0">&quot;$cbr start&quot;</span>
<span class="re0">$ns</span> at <span class="nu0">1.0</span> <span class="st0">&quot;$ftp start&quot;</span>
<span class="re0">$ns</span> at <span class="nu0">14.0</span> <span class="st0">&quot;$ftp stop&quot;</span>
<span class="re0">$ns</span> at <span class="nu0">14.5</span> <span class="st0">&quot;$cbr stop&quot;</span>
&nbsp;
<span class="co1">#Call the finish procedure after 15 seconds of simulation time</span>
<span class="re0">$ns</span> at <span class="nu0">15.0</span> <span class="st0">&quot;finish&quot;</span>
&nbsp;
<span class="co1">#Print CBR packet size and interval</span>
<span class="kw2">puts</span> <span class="st0">&quot;CBR packet size = [$cbr set packet_size_]&quot;</span>
<span class="kw2">puts</span> <span class="st0">&quot;CBR interval = [$cbr set interval_]&quot;</span>
&nbsp;
<span class="co1">#Run the simulation</span>
<span class="re0">$ns</span> run</pre>
</dd></dl>

</div>

<h5 id="descrierea_script-ului">Descrierea script-ului</h5>
<div class="level5">

<p>
În general, un script NS-2 începe cu o instanță a obiectului simulator:
</p>
<ul>
<li class="level1"><div class="li"> <code>set ns [new Simulator]</code> generează un obiect de tip simulator și îl atribuie variabilei <em>ns</em> (caracterele cursive sunt folosite pentru variabile și valori). Această linie:</div>
<ul>
<li class="level2"><div class="li"> inițializează formatul pachetelor (ignorați acest lucru deocamdată)</div>
</li>
<li class="level2"><div class="li"> crează un planificator </div>
</li>
<li class="level2"><div class="li"> selectează formatul adreselor (ignorați acest lucru deocamdată)</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Obiectul “simulator” are funcții de membru care:</div>
<ul>
<li class="level2"><div class="li"> crează obiecte compuse, cum ar fi nodurile și legăturile (descrise mai târziu)</div>
</li>
<li class="level2"><div class="li"> conectează componentele de rețea create (de ex., <code>attach-agent</code>)</div>
</li>
<li class="level2"><div class="li"> setează parametrii componentelor de rețea (mai ales pentru obiectele compuse)</div>
</li>
<li class="level2"><div class="li"> crează conexiuni între agenți (de ex., Face legătura între un TCP și sink)</div>
</li>
<li class="level2"><div class="li"> specifică opțiunile NAM (network animator)</div>
</li>
</ul>
</li>
</ul>

<p>
Cele mai multe dintre funcții  sunt pentru configurarea simularii  și pentru planificare, iar unele dintre ele sunt pentru animatorulul NAM. Multe alte setări ale simulatorului pot fi consultate în fișierul <code>ns-2 / TCL / lib / ns-lib.tcl</code>.
</p>
<ul>
<li class="level1"><div class="li"> <code>$ns color fid color</code> stabilește culoarea pachetelor pentru un flux specificat de id-ul fluxului (fid). Acest membru al obiectului “simulator” este pentru afișajul NAM, și nu are nici un efect asupra simulării propriuzise.</div>
</li>
<li class="level1"><div class="li"> <code>$ns namtrace-all file-descriptor</code> Acest membru specifică un fișier trace de simulare în format specific NAM. Acesta oferă numele de fișier pe care informațiile de trace vor fi scrise mai târziu de comandă <code>$ns flush-trace</code>. În mod similar, <code>trace-all</code> este pentru înregistrarea trace-urilor de simulare într-un format general.</div>
</li>
<li class="level1"><div class="li"> <code>proc finish {}</code> este rulată la sfârșitul simulării când se interpretează comanda <code>$ns at 15.0 “finish”</code>. În această funcție, sunt specificate diverse procesări post-simulare.</div>
</li>
<li class="level1"><div class="li"> <code>set n0 [$ns node]</code> Funcția membru <code>node</code> creează un nod nou. Un nod în NS-2 este un obiect compus din adresa si port clasificator. Utilizatorii pot crea un nod prin crearea separată a adresei și a unui port  clasificator, și conectarea lor ulterioară. Pentru a vedea modul în care se creează un nod, se pot consulta fișierele: <code>ns-2 / tcl / libs / ns-lib.tcl</code> și <code>ns-2 / tcl / libs / ns-node.tcl</code>.</div>
</li>
<li class="level1"><div class="li"> <code>$ns duplex-link node1 node2 bandwidth delay queue-type</code> creează <strong>două</strong> legături simplex de bandă  și întârziere specificate, pentru a conecta cele două noduri. În NS-2, coada de ieșire a unui nod este implementată ca parte a unei legături, prin urmare, utilizatorii ar trebui să specifice tipul de coadă atunci când crează legături. În script-ul de mai sus, este utilizată coadă  de tip DropTail. În cazul în care se dorește  o coadă RED, pur și simplu se înlocuiește DropTail cu RED. Implementarea NS-2 a unei legături este prezentată într-o secțiune ulterioară. Ca și nodurile, link-urile sunt obiect compuse, deci se pot crea sub-obiecte ce pot fi conectate. Codul sursă pentru legături poate fi găsit în “ns-2 / tcl / libs / ns-lib.tcl” și  “ns-2 / tcl / libs / ns-link.tcl”. Se remarcă faptul că se pot insera modulele de eroare într-o legătură pentru a simula o legătură cu pierderi (de fapt, utilizatorii pot crea și insera orice obiect de rețea). Consultați documentația pentru NS pentru detalii. </div>
</li>
<li class="level1"><div class="li"> <code>$ns queue-limit node1 node2 number</code> Această linie stabilește dimensiunea cozii de așteptare a celor două legături simplex care conectează node1 și node2. Aruncați o privire la “ns-2 / tcl / libs / ns-lib.tcl” și “ns-2 / tcl / libs / ns-link.tcl”, sau documentația NS-2 pentru mai multe informații.</div>
</li>
<li class="level1"><div class="li"> <code>$ns duplex-link-op node1 node2 …</code> Urmatoarea linie este folosită pentru afișajul NAM. Pentru a vedea efectele ei, utilizatorii pot comenta și rerula simularea.</div>
</li>
</ul>

<p>
Odată configurată rețeaua de bază, trebuie configurați agenții de generare/consum trafic, cum ar fi TCP și UDP, aplicațiile de generare/consum trafic, cum ar fi <abbr title="File Transfer Protocol">FTP</abbr> și CBR. Acestea trebuie atașate nodurilor și agenților într-un mod similar cu rularea aplicațiilor peste anumite protocoale în nodurile reale. 
</p>
<ul>
<li class="level1"><div class="li"> <code>set tcp [new Agent/TCP]</code> Această linie crează un agent TCP. Agenții și sursele de trafic sunt obiecte de  bază în cea mai mare parte implementate în C++ și “legate” în OTcl. Prin urmare, nu există funcții specifice ale obiectului simulator care creează aceste instanțe. Pentru a crea agenți sau surse de trafic, trebuie să se cunoască numele clasei  (<code>Agent/TCP</code>, <code>Agent/TCPSink</code>, <code>Application/<abbr title="File Transfer Protocol">FTP</abbr></code>, etc). Aceste informații pot fi găsite rapid  în fișierul “ns-2/tcl/libs/ns-default.tcl”. Acest fișier conține configurări implicite pentru diverse obiecte. Sursele sunt un bun indicator pentru obiectele disponibile în NS-2 și ce parametrii lor. </div>
</li>
<li class="level1"><div class="li"> <code>$ns attach-agent node agent</code> Funcția <code>atttach-agent</code> conectează un obiect agent la un nod. </div>
</li>
<li class="level1"><div class="li"> <code>$ns connect agent1 agent2</code> După ce s-au creat doi agenți care se vor comunicatrebuie stabilită o conexiune  logică între ei. Această linie stabilește o conexiunea prin setarea reciprocă a adreselor și a porturilor.</div>
</li>
</ul>

<p>
Odată configurația rețelei specificată, următorul lucru este implementarea unui scenariu de simulare. Obiectul Simulator are funcția <code>at</code>:
</p>
<ul>
<li class="level1"><div class="li"> <code>$ns at time “string”</code> Această funcție programează executarea șirului specificat la un moment de simulare. De exemplu, <code>$ns at 0.1 “$CBR start”</code> va face scheduler-ul să apeleze o funcție membru de start al obiectului <code>$CBR</code> la momentul <code>0.1s</code>. În NS-2, o sursă de trafic nu transmite date reale, ci notifică agentul care de la baza o anumită cantitate de date, iar agentul, creează pachete și le trimite în mod fidel implementărilor din kernel, <strong>considerând un CPU cu viteză infinită</strong>.</div>
</li>
</ul>

<p>
După ce s-au efectuat toate specificațiile de configurare a rețelei, specificat procedura post-simulare, singurul lucru rămas este rularea propriu-zisă. Acest lucru se face cu funcția <code>$ns run</code>.
</p>
<ul>
<li class="level1"><div class="li"> La rularea din shell <code>ns ./ns-simple.tcl</code>, se execută simularea și se generează “filmul simulării” out.nam, apoi se lansează animatorul <code>nam</code>. Rulați slide-ul în animator pentru a accelera filmul, observând transferul pachetelor și comportarea cozii din nodul 2.  </div>
</li>
</ul>

</div>

<h5 id="trasarea_unui_grafic">Trasarea unui grafic</h5>
<div class="level5">

<p>
ns2 permite implementarea cu ușurință a procedurilor specializate de generare de loguri. Aceste proceduri sunt apelate periodic în timpul simulării și permit adresarea tuturor datelor specifice nodurilor, fluxurilor, cozilor, și ale celorlalte entități din rețea.  
În partea de final a scriptului de mai sus, inserați patch-ul următor. Apelată periodic, această procedură contorizează numărul de octe ți primiți de destinația UDP, și numărul de octeți confirmați la sursa TCP. În acest mod, se poate calcula debitul obținut de cele două fluxuri pe intervale fixe de timp. Cele două valori sunt stocate periodic într-un fișier text <code>out.tr</code>.   
</p>
<pre class="code file tcl"><span class="co1">#Open a trace file </span>
<span class="kw1">set</span> fout <span class="br0">&#91;</span><span class="kw2">open</span> out.tr w<span class="br0">&#93;</span>
&nbsp;
<span class="co1">#save running byte counters </span>
<span class="kw1">set</span> tbytes <span class="nu0">0</span>
<span class="kw1">set</span> ubytes <span class="nu0">0</span>
&nbsp;
<span class="kw1">proc</span> record <span class="br0">&#123;</span><span class="br0">&#125;</span> <span class="br0">&#123;</span>
    <span class="kw1">global</span> tcp usink fout ubytes tbytes
&nbsp;
    <span class="kw1">set</span> ns <span class="br0">&#91;</span>Simulator instance<span class="br0">&#93;</span>
    <span class="co1">#Set the time after which the procedure should be called again</span>
    <span class="kw1">set</span> <span class="kw2">time</span> <span class="nu0">0.25</span>
    <span class="co1">#How many bytes have been received/acked?</span>
    <span class="kw1">set</span> tbytes1 <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="br0">&#91;</span><span class="re0">$tcp</span> <span class="kw1">set</span> ack_<span class="br0">&#93;</span><span class="sy0">*</span><span class="br0">&#91;</span><span class="re0">$tcp</span> <span class="kw1">set</span> packetSize_<span class="br0">&#93;</span><span class="br0">&#93;</span>
    <span class="kw1">set</span> ubytes1 <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="br0">&#91;</span><span class="re0">$usink</span> <span class="kw1">set</span> bytes_<span class="br0">&#93;</span><span class="br0">&#93;</span>
    <span class="kw1">set</span> now <span class="br0">&#91;</span><span class="re0">$ns</span> now<span class="br0">&#93;</span>
    <span class="co1">#Calculate the bandwidth (in MBit/s) and write it to the log</span>
    <span class="kw2">puts</span> <span class="re0">$fout</span> <span class="st0">&quot;$now [expr ($tbytes1 - $tbytes)/$time*8/1000000] <span class="es0">\</span>
                     [expr ($ubytes1 - $ubytes)/$time*8/1000000]&quot;</span>
    <span class="co1">#Reset the bytes_ values on the traffic sinks</span>
    <span class="kw1">set</span> tbytes <span class="re0">$tbytes1</span>
    <span class="kw1">set</span> ubytes <span class="re0">$ubytes1</span>
    <span class="co1">#Re-schedule the procedure</span>
    <span class="re0">$ns</span> at <span class="br0">&#91;</span><span class="kw1">expr</span> <span class="re0">$now</span>+<span class="re0">$time</span><span class="br0">&#93;</span> <span class="st0">&quot;record&quot;</span>
<span class="br0">&#125;</span></pre>

<p>
Procedura <code>finish</code> trebuie actualizată pentru a include închiderea fișierului de trace, și pentru a plota conținutul său:  
</p>
<pre class="code file tcl">  <span class="co1">#Close the trace file</span>
    <span class="kw2">close</span> <span class="re0">$fout</span>
    <span class="co1">#Call gnuplot to display the results</span>
    <span class="kw2">exec</span> echo  <span class="st0">&quot;plot 'out.tr' using 1:2 t 'TCP' w l, '' using 1:3 t 'UDP' w l&quot;</span> | gnuplot -persist</pre>

<p>
În plus, înainte de a demara simularea, trebuie să armăm procedura record cu <code>$ns at 0.0 “record”</code>. 
După execuția scriptului, se vor lansa automat atât fereastra animatorului, cât și o fereastră gnuplot care afișează conținutul fișierului trace <code>out.tr</code>. <img src="../../_media/isrm/laboratoare/01/lab1-gnuplot.png%3Fw=300&amp;tok=4a2a58" class="mediacenter" alt="" width="300" />
</p>

</div>

<h5 id="task-uri">Task-uri</h5>
<div class="level5">
<ol>
<li class="level1"><div class="li"> examinați cu editorul de text conținutul fișierelor <code>out.nam</code> și <code>out.tr</code></div>
</li>
<li class="level1"><div class="li"> Ce reprezintă axele x, y? Explicați comportarea graficelor. </div>
</li>
<li class="level1"><div class="li"> Măriți coada de la link-ul bottleneck la 100. Cum explicați noua comportare? </div>
</li>
<li class="level1"><div class="li"> Coada aruncă pachete TCP în mod disproporționat. De ce? Folosiți o coadă SFQ pentru a remedia situația. </div>
</li>
<li class="level1"><div class="li"> În prezent se măsoară debitul la fiecare 250ms. Experimentați cu diverse rezoluții de măsurare în funcția “record”. </div>
</li>
<li class="level1"><div class="li"> <strong>Facultativ</strong>: monitorizarea cozii (<a href="http://www.mathcs.emory.edu/~cheung/Courses/558-old/Syllabus/90-NS/trace.html#QMon" class="urlextern" title="http://www.mathcs.emory.edu/~cheung/Courses/558-old/Syllabus/90-NS/trace.html#QMon"  rel="nofollow"> formatul </a> trace-ului queue)</div>
</li>
</ol>
<pre class="code tcl"><span class="kw1">set</span> qfile <span class="br0">&#91;</span><span class="re0">$ns</span> monitor-queue <span class="re0">$n2</span> <span class="re0">$n3</span>  <span class="br0">&#91;</span><span class="kw2">open</span> queue.tr w<span class="br0">&#93;</span> <span class="nu0">0.1</span><span class="br0">&#93;</span>
<span class="br0">&#91;</span><span class="re0">$ns</span> link <span class="re0">$n2</span> <span class="re0">$n3</span><span class="br0">&#93;</span> queue-sample-timeout </pre>

</div>

<h5 id="ne_jucam">Ne jucăm!</h5>
<div class="level5">

<p>
 <a href="http://www.cisco.com/E-Learning/prod/curriculum/cco_tdo_ldd/demos/DandEguideSPN/SpaceGame/remote.html" class="urlextern" title="http://www.cisco.com/E-Learning/prod/curriculum/cco_tdo_ldd/demos/DandEguideSPN/SpaceGame/remote.html"  rel="nofollow"> Wireless Explorer </a> câteva nivele <img src="../../lib/images/smileys/icon_lol.gif" class="icon" alt="LOL" />. 
</p>

</div>

<h5 id="links">Links</h5>
<div class="level5">
<ul>
<li class="level1"><div class="li"> Alte tutoriale: <a href="http://www.isi.edu/nsnam/ns/tutorial/" class="urlextern" title="http://www.isi.edu/nsnam/ns/tutorial/"  rel="nofollow"> Marc Greis </a>, <a href="http://nile.wpi.edu/NS/" class="urlextern" title="http://nile.wpi.edu/NS/"  rel="nofollow"> NS by example </a> </div>
</li>
<li class="level1"><div class="li"> Manual ns2 <a href="http://www.isi.edu/nsnam/ns/doc/node1.html" class="urlextern" title="http://www.isi.edu/nsnam/ns/doc/node1.html"  rel="nofollow"> html </a> </div>
</li>
<li class="level1"><div class="li"> TCL <a href="http://www.pkturner.org/programming/Tcl_cheat_sheet.html" class="urlextern" title="http://www.pkturner.org/programming/Tcl_cheat_sheet.html"  rel="nofollow"> cheat sheet </a></div>
</li>
</ul>

</div>

        </div>
        <div class="right_sidebar">
          <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">

<h1 class="sectionedit1" id="laboratoare">Laboratoare</h1>
<div class="level1">

<div><div id="nojs_indexmenu_122640011058355b85c133c" data-jsajax="" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><span class="curid"><a href="01.html" class="wikilink1" title="isrm:laboratoare:01">Laboratorul 1</a></span></div></li>
<li class="level1"><div class="li"><a href="02.html" class="wikilink1" title="isrm:laboratoare:02">Laboratorul 2</a></div></li>
<li class="level1"><div class="li"><a href="03.html" class="wikilink1" title="isrm:laboratoare:03">Laboratorul 3</a></div></li>
<li class="level1"><div class="li"><a href="04.html" class="wikilink1" title="isrm:laboratoare:04">Laboratorul 4</a></div></li>
<li class="level1"><div class="li"><a href="05.html" class="wikilink1" title="isrm:laboratoare:05">Laboratorul 5</a></div></li>
<li class="level1"><div class="li"><a href="06.html" class="wikilink1" title="isrm:laboratoare:06">Laboratoarele 6 și 7</a></div></li>
<li class="level1"><div class="li"><a href="08.html" class="wikilink1" title="isrm:laboratoare:08">Laboratorul 8</a></div></li>
<li class="level1"><div class="li"><a href="09.html" class="wikilink1" title="isrm:laboratoare:09">Laboratorul 9</a></div></li>
<li class="level1"><div class="li"><a href="10.html" class="wikilink1" title="isrm:laboratoare:10">Laboratorul 10</a></div></li>
<li class="level1"><div class="li"><a href="11.html" class="wikilink1" title="isrm:laboratoare:11">Laboratorul 11</a></div></li>
<li class="level1"><div class="li"><a href="12.html" class="wikilink1" title="isrm:laboratoare:12">Laboratorul 12 (TODO)</a></div></li>
<li class="level1"><div class="li"><a href="14.html" class="wikilink1" title="isrm:laboratoare:14">Colocviu</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT1 SECTION "Laboratoare" [1-62] -->
<h1 class="sectionedit2" id="cursuri">Cursuri</h1>
<div class="level1">

<div><div id="nojs_indexmenu_108885730358355b85c3275" data-jsajax="" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="../cursuri/01.html" class="wikilink1" title="isrm:cursuri:01">Cursul 1</a></div></li>
<li class="level1"><div class="li"><a href="../cursuri/02.html" class="wikilink1" title="isrm:cursuri:02">Cursuri 2-7</a></div></li>
</ul>
</div></div>
<ul>
<li class="level1"><div class="li"> <a href="http://wi-fi.cs.pub.ro/isrm/index.php" class="urlextern" title="http://wi-fi.cs.pub.ro/isrm/index.php"  rel="nofollow"> chestionare</a></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Cursuri" [63-176] -->
<h1 class="sectionedit3" id="resurse">Resurse</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../planificare.html" class="wikilink1" title="isrm:planificare">planificare + articole</a></div>
</li>
<li class="level1"><div class="li"> <a href="../documentatie.html" class="wikilink1" title="isrm:documentatie">documentație</a></div>
</li>
<li class="level1"><div class="li"> <a href="../instalare-ns2.html" class="wikilink1" title="isrm:instalare-ns2">instalare NS2</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://docs.google.com/spreadsheets/d/1GlBSHv4LsrdK_pD0Pl2eqERxAEBdtguPOoWROWhdhwQ/edit?usp=sharing" class="urlextern" title="https://docs.google.com/spreadsheets/d/1GlBSHv4LsrdK_pD0Pl2eqERxAEBdtguPOoWROWhdhwQ/edit?usp=sharing"  rel="nofollow"> catalog</a></div>
</li>
<li class="level1"><div class="li"> <a href="../news.html" class="wikilink1" title="isrm:news">diverse</a> </div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Resurse" [177-] -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          isrm/laboratoare/01.txt · Last modified: 2016/10/05 12:46 by dragos.niculescu          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
              </div>
      <div class="bar-right">
        <a href="01%3Fdo=media&amp;ns=isrm%253Alaboratoare.html"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="01.html#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div align="center" class="footerinc">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported" /></a></div>
  <a target="_blank" href="http://www.chimeric.de" title="www.chimeric.de"><img src="../../lib/tpl/arctic/images/button-chimeric-de.png" width="80" height="15" alt="www.chimeric.de" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="../../lib/tpl/arctic/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="../../lib/tpl/arctic/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>

  <a target="_blank" href="http://www.firefox-browser.de" title="do yourself a favour and use a real browser - get firefox"><img src="../../lib/tpl/arctic/images/button-firefox.png" width="80" height="15" alt="do yourself a favour and use a real browser - get firefox!!" border="0" /></a>
  
  <a target="_blank" href="../../feed.php" title="Recent changes RSS feed"><img src="../../lib/tpl/arctic/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="../../lib/tpl/arctic/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>
</div>

  </div>
</div>

<div class="no"><img src="../../lib/exe/indexer.php%3Fid=isrm%253Alaboratoare%253A01&amp;1479891845" width="2" height="1" alt="" /></div>
</body>
</html>
