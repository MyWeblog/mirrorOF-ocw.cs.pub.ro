    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>sred:labs:asa:08</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2015-06-01T20:53:18+0300"/>
<meta name="keywords" content="sred,labs,asa,08"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../../feed.php%3Fmode=list&amp;ns=sred:labs:asa"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="08.html"/>
<link rel="canonical" href="../../../../../sred/labs/asa/08.html"/>
<link rel="stylesheet" type="text/css" href="../../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='sred:labs:asa';var JSINFO = {"id":"sred:labs:asa:08","namespace":"sred:labs:asa","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="08.html#a08_-_ipsec_remote_access">A08 - IPSec Remote Access</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="08.html#topology">Topology</a></div></li>
<li class="level2"><div class="li"><a href="08.html#tasks">Tasks</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="08.html#basic_setup">1. Basic Setup</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="08.html#a_asa_setup">A. ASA Setup</a></div></li>
<li class="level4"><div class="li"><a href="08.html#b_router_setup">B. Router Setup</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="08.html#ipsec_remote-access">2. IPSec Remote-Access</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="08.html#a_isakmp">A. ISAKMP</a></div></li>
<li class="level4"><div class="li"><a href="08.html#b_tunnel-group">B. Tunnel-group</a></div></li>
<li class="level4"><div class="li"><a href="08.html#c_enable_nem">C. Enable NEM</a></div></li>
<li class="level4"><div class="li"><a href="08.html#d_transform_set">D. Transform set</a></div></li>
<li class="level4"><div class="li"><a href="08.html#e_dynamic_crypto-map">E. Dynamic crypto-map</a></div></li>
<li class="level4"><div class="li"><a href="08.html#f_static_crypto-map">F. Static crypto-map</a></div></li>
<li class="level4"><div class="li"><a href="08.html#g_user_accounts">G. User accounts</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="08.html#ipsec_ra_client">3. IPSec RA Client</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="08.html#a_ezvpn_client_setup">A. EZVPN Client setup</a></div></li>
<li class="level4"><div class="li"><a href="08.html#b_inside_network_setup">B. Inside network setup</a></div></li>
<li class="level4"><div class="li"><a href="08.html#c_client_insideoutside_networks">C. Client inside/outside networks</a></div></li>
<li class="level4"><div class="li"><a href="08.html#d_xauth">D. xauth</a></div></li>
<li class="level4"><div class="li"><a href="08.html#e_test">E. Test</a></div></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="a08_-_ipsec_remote_access">A08 - IPSec Remote Access</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "A08 - IPSec Remote Access" [19-59] -->
<h2 class="sectionedit2" id="topology">Topology</h2>
<div class="level2">

<p>
<a href="../../../../../_detail/sred/labs/asa/asa_topology_08.png%3Fid=sred%253Alabs%253Aasa%253A08.html" class="media" title="sred:labs:asa:asa_topology_08.png"><img src="../../../../../_media/sred/labs/asa/asa_topology_08.png" class="mediacenter" title=" " alt=" " /></a>
</p>

</div>
<!-- EDIT2 SECTION "Topology" [60-124] -->
<h2 class="sectionedit3" id="tasks">Tasks</h2>
<div class="level2">

</div>
<!-- EDIT3 SECTION "Tasks" [125-143] -->
<h3 class="sectionedit4" id="basic_setup">1. Basic Setup</h3>
<div class="level3">

<p>
In this task you will configure basic connectivity to prepare the topology for IPSec Remote-Access configuration.
</p>

</div>

<h4 id="a_asa_setup">A. ASA Setup</h4>
<div class="level4">

<p>
Configure the ASA with the following parameters:
</p>
<ul>
<li class="level1"><div class="li"> Interface Gi2 as inside with the IP address 192.168.1.1/24</div>
</li>
</ul>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# interface gigabit 2
Atlas(config-if)# ip address 192.168.1.1 255.255.255.0
Atlas(config-if)# nameif inside
INFO: Security level for &quot;inside&quot; set to 100 by default.
Atlas(config-if)# no shutdown</pre>


</div></div>

</div>

<h4 id="b_router_setup">B. Router Setup</h4>
<div class="level4">

<p>
Configure router <strong>R3</strong> with the following parameters:
</p>
<ul>
<li class="level1"><div class="li"> IP address: 192.168.1.100/24</div>
</li>
</ul>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">R3(config)#int fastethernet 0/0
R3(config-if)#ip address 192.168.1.100 255.255.255.0
R3(config-if)#no shutdown</pre>


</div></div>
<ul>
<li class="level1"><div class="li"> Default route with next-hop 192.168.1.1 </div>
</li>
</ul>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">R3(config)#ip route 0.0.0.0 0.0.0.0 192.168.1.1</pre>


</div></div>

</div>
<!-- EDIT4 SECTION "1. Basic Setup" [144-1059] -->
<h3 class="sectionedit5" id="ipsec_remote-access">2. IPSec Remote-Access</h3>
<div class="level3">

<p>
In this task you will configure Remote-Access VPN between the <strong>ASA</strong> and <strong>R3</strong>.
</p>

</div>

<h4 id="a_isakmp">A. ISAKMP</h4>
<div class="level4">

<p>
Activate ISAKMP on the ASA interface.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# crypto ikev1 enable inside</pre>


</div></div>

<p>
Define an ISAKMP policy with the following parameters:
</p>
<ul>
<li class="level1"><div class="li"> Encryption: 3DES</div>
</li>
<li class="level1"><div class="li"> Hashing: SHA</div>
</li>
<li class="level1"><div class="li"> Authentication: PSK</div>
</li>
<li class="level1"><div class="li"> Diffie-Hellman: Group 2</div>
</li>
</ul>

<p>
<p><div class="notewarning"> Remember to use ASA8.4 <code>crypto ikev1</code> commands instead of the older <code>isakmp</code> 
</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# crypto ikev1 policy 10
Atlas(config-isakmp-policy)# encryption 3des
Atlas(config-isakmp-policy)# hash sha
Atlas(config-isakmp-policy)# authentication pre-share
Atlas(config-isakmp-policy)# group 2</pre>


</div></div>

</div>

<h4 id="b_tunnel-group">B. Tunnel-group</h4>
<div class="level4">

<p>
Define a remote-access tunnel-group. Use <code>cisco123</code> for the PSK.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# tunnel-group MY_TUNNEL type remote-access
Atlas(config)# tunnel-group MY_TUNNEL ipsec-attributes
Atlas(config-tunnel-ipsec)# ikev1 pre-shared-key cisco123</pre>


</div></div>

</div>

<h4 id="c_enable_nem">C. Enable NEM</h4>
<div class="level4">

<p>
Enable NEM (Network Extension Mode) tunnels for the default group policy.
</p>

<p>
<p><div class="noteclassic"> You will need to add the <code>enable nem</code> command to the default group policy. For more information refer to <a href="http://www.cisco.com/en/US/tech/tk583/tk372/technologies_configuration_example09186a0080809222.shtml" class="urlextern" title="http://www.cisco.com/en/US/tech/tk583/tk372/technologies_configuration_example09186a0080809222.shtml"  rel="nofollow"> EasyVPN Example</a> 
</div></p>
<p><div class="noteclassic"> The default group policy <strong>DfltGrpPolicy</strong> is used by default by all tunnel-groups. 
</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# group-policy DfltGrpPolicy attributes 
Atlas(config-group-policy)# nem enable</pre>
</div></div>

</div>

<h4 id="d_transform_set">D. Transform set</h4>
<div class="level4">

<p>
Configure a new transform set. Use <strong>ESP-3DES</strong> for encryption and <strong>MD5-HMAC</strong> for authentication.
</p>

<p>
<p><div class="notewarning"> Remember that in ASA8.4 you will have to specify that the transform-set applies to <strong>ikev1</strong>. 
</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# ipsec ikev1 transform-set MY_TRANSFORM esp-3des esp-md5-hmac</pre>


</div></div>

</div>

<h4 id="e_dynamic_crypto-map">E. Dynamic crypto-map</h4>
<div class="level4">

<p>
Configure a dynamic crypto map that uses the transform set defined above.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# crypto dynamic-map MY_DYNAMIC_MAP 10 set ikev1 transform-set MY_TRANSFORM</pre>


</div></div>

</div>

<h4 id="f_static_crypto-map">F. Static crypto-map</h4>
<div class="level4">

<p>
Configure a static crypto map that uses the dynamic crypto map defined above.
</p>

<p>
Apply the crypto map on the <code>inside</code> interface.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# crypto map MY_MAP 65535 ipsec-isakmp dynamic MY_DYNAMIC_MAP
Atlas(config)# crypto map MY_MAP interface inside</pre>


</div></div>

</div>

<h4 id="g_user_accounts">G. User accounts</h4>
<div class="level4">

<p>
Create a new user called <code>cisco</code> with password <code>sred</code>. This will be later be used by the router during the xauth step.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">Atlas(config)# username cisco password sred</pre>


</div></div>

</div>
<!-- EDIT5 SECTION "2. IPSec Remote-Access" [1060-3841] -->
<h3 class="sectionedit6" id="ipsec_ra_client">3. IPSec RA Client</h3>
<div class="level3">

<p>
In this task you will configure a cisco VPN Client.
</p>

</div>

<h4 id="a_ezvpn_client_setup">A. EZVPN Client setup</h4>
<div class="level4">

<p>
Configure <strong>R3</strong> as a hardware VPN client.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">R3(config)#crypto ipsec client ezvpn EZVPN
R3(config-crypto-ezvpn)#connect auto
R3(config-crypto-ezvpn)#group MY_TUNNEL key cisco123
R3(config-crypto-ezvpn)#mode network-extension
R3(config-crypto-ezvpn)#peer 192.168.1.1

R3(config)#interface fastethernet 0/0
R3(config-if)#crypto ipsec client ezvpn EZVPN outside
</pre>


</div></div>

</div>

<h4 id="b_inside_network_setup">B. Inside network setup</h4>
<div class="level4">

<p>
On <strong>R3</strong>, create the <code>Loopback0</code> interface using IP address 10.0.0.1/24.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"> <pre class="code">R3(config)#interface loopback 0
R3(config-if)#ip address 10.0.0.1 255.255.255.0
R3(config-if)#crypto ipsec client ezvpn EZVPN inside
R3(config-if)#
*Mar  1 00:22:22.015: %CRYPTO-6-ISAKMP_ON_OFF: ISAKMP is ON</pre>


</div></div>

</div>

<h4 id="c_client_insideoutside_networks">C. Client inside/outside networks</h4>
<div class="level4">

<p>
In NEM mode, the EZVPN client needs to know which interface is the inside (the trusted network) and which interface is the outside (the untrusted network). The tunnel will be built over the untrusted network.
</p>

<p>
On <strong>R3</strong>, configure the <code>FastEthernet0/0</code> interface as outside and the <code>Loopback0</code> interface as inside.
</p>

</div>

<h4 id="d_xauth">D. xauth</h4>
<div class="level4">

<p>
Provide xauth credentials using the <code>crypto ipsec client ezvpn xauth EZVPN</code> exec mode command.
</p>

</div>

<h4 id="e_test">E. Test</h4>
<div class="level4">

<p>
Test that the isakmp and ipsec SAs are successfully created on the ASA.
</p>

</div>
<!-- EDIT6 SECTION "3. IPSec RA Client" [3842-] --></div>
</body>
</html>
