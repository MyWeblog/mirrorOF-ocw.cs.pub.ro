    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>sasc:laboratoare:02</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-04-25T13:10:56+0300"/>
<meta name="keywords" content="sasc,laboratoare,02"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=sasc:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="02.html"/>
<link rel="canonical" href="../../../../sasc/laboratoare/02.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='sasc:laboratoare';var JSINFO = {"id":"sasc:laboratoare:02","namespace":"sasc:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="02.html#lab_02_-_otp_and_stream_ciphers">Lab 02 - OTP and Stream Ciphers</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="02.html#exercise_1_4p">Exercise 1 (4p)</a></div></li>
<li class="level3"><div class="li"><a href="02.html#exercise_2_4p">Exercise 2 (4p)</a></div></li>
<li class="level3"><div class="li"><a href="02.html#exercise_3_2p">Exercise 3 (2p)</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h2 class="sectionedit1" id="lab_02_-_otp_and_stream_ciphers">Lab 02 - OTP and Stream Ciphers</h2>
<div class="level2">

<p>
In this lab we&#039;ll do some exercises related to OTP and stream ciphers.
</p>

</div>
<!-- EDIT1 SECTION "Lab 02 - OTP and Stream Ciphers" [1-117] -->
<h3 class="sectionedit2" id="exercise_1_4p">Exercise 1 (4p)</h3>
<div class="level3">

<p>
Charlie manages to capture <a href="../../../../_media/sasc/laboratoare/sasc_msg_lab2.txt" class="media mediafile mf_txt" title="sasc:laboratoare:sasc_msg_lab2.txt (169.9 KB)">a last communication</a> which turns out to be the most important, so it is crucial he decrypts it. However, this time Alice used the Vigenere cipher, with a key that Charlie knows has <strong>7</strong> characters.
</p>

<p>
The ciphertext is in the file attached. Try the method of multiplying probabilities as I explained in class and see if you can decrypt the ciphertext.
</p>

<p>
These are the known frequencies of the plaintext:
</p>
<pre class="code">{&#039;A&#039;: 0.07048643054277828,
&#039;C&#039;: 0.01577161913523459,
&#039;B&#039;: 0.012074517019319227,
&#039;E&#039;: 0.13185372585096597,
&#039;D&#039;: 0.043393514259429625,
&#039;G&#039;: 0.01952621895124195,
&#039;F&#039;: 0.023867295308187673,
&#039;I&#039;: 0.06153403863845446,
&#039;H&#039;: 0.08655128794848206,
&#039;K&#039;: 0.007566697332106716,
&#039;J&#039;: 0.0017594296228150873,
&#039;M&#039;: 0.029657313707451703,
&#039;L&#039;: 0.04609015639374425,
&#039;O&#039;: 0.07679967801287949,
&#039;N&#039;: 0.060217341306347746,
&#039;Q&#039;: 0.0006382244710211592,
&#039;P&#039;: 0.014357175712971482,
&#039;S&#039;: 0.05892939282428703,
&#039;R&#039;: 0.05765294388224471,
&#039;U&#039;: 0.02749540018399264,
&#039;T&#039;: 0.09984475620975161,
&#039;W&#039;: 0.01892824287028519,
&#039;V&#039;: 0.011148804047838086,
&#039;Y&#039;: 0.023045078196872126,
&#039;X&#039;: 0.0005289788408463661,
&#039;Z&#039;: 0.00028173873045078196}</pre>

</div>
<!-- EDIT2 SECTION "Exercise 1 (4p)" [118-1328] -->
<h3 class="sectionedit3" id="exercise_2_4p">Exercise 2 (4p)</h3>
<div class="level3">

<p>
In class we explained that the one time pad is malleable (i.e. we can easily change the encrypted plaintext by simply modifying the ciphertext). We have also discussed how the CRC was a very bad idea in the design of WEP due to its linearity.
</p>

<p>
You are given the following ciphertext in hexadecimal:
</p>
<pre class="code">021e0e061d1694c9</pre>

<p>
which you know it corresponds to the concatenation of the message “floare” with its CRC-16 (in hexa “8E31”) obtained from this website:
<a href="http://www.lammertbies.nl/comm/info/crc-calculation.html" class="urlextern" title="http://www.lammertbies.nl/comm/info/crc-calculation.html"  rel="nofollow">http://www.lammertbies.nl/comm/info/crc-calculation.html</a>
</p>

<p>
If we need to modify the ciphertext so that a correct decryption outputs “albina” instead of “floare” and such that the CRC-16 calculation remains correct, what is the modification we need to perform?
</p>

<p>
Output the new ciphertext after the necessary modifications and show that it correctly leads to the plaintext “albina” and a correct computation of its CRC-16.
</p>

<p>
You might find this starting script useful:
</p>
<dl class="code">
<dt><a href="../../../code/sasc/laboratoare/02%3Fcodeblock=2" title="Download Snippet" class="mediafile mf_py">ex2_draft.py</a></dt>
<dd><pre class="code python"><span class="kw1">import</span> <span class="kw3">sys</span>
<span class="kw1">import</span> <span class="kw3">random</span>
<span class="kw1">import</span> <span class="kw3">string</span>
<span class="kw1">import</span> <span class="kw3">operator</span>
&nbsp;
<span class="kw1">def</span> strxor<span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span>: <span class="co1"># xor two strings (trims the longer input)</span>
  <span class="kw1">return</span> <span class="st0">&quot;&quot;</span>.<span class="me1">join</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw2">chr</span><span class="br0">&#40;</span><span class="kw2">ord</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> ^ <span class="kw2">ord</span><span class="br0">&#40;</span>y<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">for</span> <span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="br0">&#41;</span> <span class="kw1">in</span> <span class="kw2">zip</span><span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">def</span> hexxor<span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span>: <span class="co1"># xor two hex strings (trims the longer input)</span>
  ha <span class="sy0">=</span> a.<span class="me1">decode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  hb <span class="sy0">=</span> b.<span class="me1">decode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  <span class="kw1">return</span> <span class="st0">&quot;&quot;</span>.<span class="me1">join</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw2">chr</span><span class="br0">&#40;</span><span class="kw2">ord</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> ^ <span class="kw2">ord</span><span class="br0">&#40;</span>y<span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span> <span class="kw1">for</span> <span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="br0">&#41;</span> <span class="kw1">in</span> <span class="kw2">zip</span><span class="br0">&#40;</span>ha<span class="sy0">,</span> hb<span class="br0">&#41;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">def</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span>:
&nbsp;
  <span class="co1">#Plaintexts</span>
  s1 <span class="sy0">=</span> <span class="st0">'floare'</span>
  s2 <span class="sy0">=</span> <span class="st0">'albina'</span>
  G <span class="sy0">=</span> <span class="st0">''</span> <span class="co1">#To find</span>
&nbsp;
  <span class="co1">#Obtain crc of s1</span>
  <span class="co1">#See this site:</span>
  <span class="co1">#http://www.lammertbies.nl/comm/info/crc-calculation.html</span>
  x1 <span class="sy0">=</span> s1.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  x2 <span class="sy0">=</span> s2.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  <span class="kw1">print</span> <span class="st0">&quot;x1: &quot;</span> + x1
  crc1 <span class="sy0">=</span> <span class="st0">'8E31'</span> <span class="co1">#CRC-16 of x1</span>
&nbsp;
  <span class="co1">#Compute delta (xor) of x1 and x2:</span>
  xd <span class="sy0">=</span> hexxor<span class="br0">&#40;</span>x1<span class="sy0">,</span> x2<span class="br0">&#41;</span>
  <span class="kw1">print</span> <span class="st0">&quot;xd: &quot;</span> + xd
&nbsp;
&nbsp;
<span class="kw1">if</span> __name__ <span class="sy0">==</span> <span class="st0">&quot;__main__&quot;</span>:
  main<span class="br0">&#40;</span><span class="br0">&#41;</span></pre>
</dd></dl>

<p>
<p><div class="notetip">
Use the property for CRC-16 that CRC(m XOR d) = CRC(m) XOR CRC(d).
</p>

<p>
If d = &#039;floare&#039; XOR &#039;albina&#039; and C = [C1 | C2] = [m XOR G1 | CRC(m) XOR G2], then C1&#039; = C1 XOR d.

</div></p>
</p>

</div>
<!-- EDIT3 SECTION "Exercise 2 (4p)" [1329-3278] -->
<h3 class="sectionedit4" id="exercise_3_2p">Exercise 3 (2p)</h3>
<div class="level3">

<p>
In this exercise we&#039;ll try to break a Linear Congruential Generator, that may be used to generate “poor” random numbers.
We implemented such weak RNG to generate a sequence of bytes and then encrypted a plaintext message.
The resulting ciphertext in hexadecimal is this:
</p>
<pre class="code">a432109f58ff6a0f2e6cb280526708baece6680acc1f5fcdb9523129434ae9f6ae9edc2f224b73a8</pre>

<p>
You know that the LCG uses the following formula to produce each byte:
</p>

<p>
s_next = (a * s_prev + b) mod p
</p>

<p>
where both s_prev and s_next are byte values (between 0 and 255) and p is 257.
Both a and b are values between 0 and 256.
</p>

<p>
You also know that the first 16 letters of the plaintext are “Let all creation” and that the ciphertext was generated by xor-ing a string of consecutive bytes generated by the LCG with the plaintext.
</p>

<p>
Can you break the LCG and predict the RNG stream so that in the end you find the entire plaintext ?
</p>

<p>
You may use this starting code:
</p>
<dl class="code">
<dt><a href="../../../code/sasc/laboratoare/02%3Fcodeblock=4" title="Download Snippet" class="mediafile mf_py_">&#039;ex3_weak_rng.py&#039;</a></dt>
<dd><pre class="code python"><span class="kw1">import</span> <span class="kw3">sys</span>
<span class="kw1">import</span> <span class="kw3">random</span>
<span class="kw1">import</span> <span class="kw3">string</span>
<span class="kw1">import</span> <span class="kw3">operator</span>
&nbsp;
<span class="co1">#Parameters for weak LC RNG</span>
<span class="kw1">class</span> WeakRNG:
    <span class="st0">&quot;Simple class for weak RNG&quot;</span>
    <span class="kw1">def</span> <span class="kw4">__init__</span><span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="kw2">self</span>.<span class="me1">rstate</span> <span class="sy0">=</span> <span class="nu0">0</span>
        <span class="kw2">self</span>.<span class="me1">maxn</span> <span class="sy0">=</span> <span class="nu0">255</span>
        <span class="kw2">self</span>.<span class="me1">a</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="co1">#Set this to correct value</span>
        <span class="kw2">self</span>.<span class="me1">b</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="co1">#Set this to correct value</span>
        <span class="kw2">self</span>.<span class="me1">p</span> <span class="sy0">=</span> <span class="nu0">257</span>
&nbsp;
    <span class="kw1">def</span> init_state<span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="st0">&quot;Initialise rstate&quot;</span>
        <span class="kw2">self</span>.<span class="me1">rstate</span> <span class="sy0">=</span> <span class="nu0">0</span> <span class="co1">#Set this to some value</span>
        <span class="kw2">self</span>.<span class="me1">update_state</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
    <span class="kw1">def</span> update_state<span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="st0">&quot;Update state&quot;</span>
        <span class="kw2">self</span>.<span class="me1">rstate</span> <span class="sy0">=</span> <span class="br0">&#40;</span><span class="kw2">self</span>.<span class="me1">a</span> * <span class="kw2">self</span>.<span class="me1">rstate</span> + <span class="kw2">self</span>.<span class="me1">b</span><span class="br0">&#41;</span> % <span class="kw2">self</span>.<span class="me1">p</span>
&nbsp;
    <span class="kw1">def</span> get_prg_byte<span class="br0">&#40;</span><span class="kw2">self</span><span class="br0">&#41;</span>:
        <span class="st0">&quot;Return a new PRG byte and update PRG state&quot;</span>
        b <span class="sy0">=</span> <span class="kw2">self</span>.<span class="me1">rstate</span> &amp; <span class="nu0">0xFF</span>
        <span class="kw2">self</span>.<span class="me1">update_state</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
        <span class="kw1">return</span> b
&nbsp;
<span class="kw1">def</span> strxor<span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span>: <span class="co1"># xor two strings (trims the longer input)</span>
  <span class="kw1">return</span> <span class="st0">&quot;&quot;</span>.<span class="me1">join</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw2">chr</span><span class="br0">&#40;</span><span class="kw2">ord</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> ^ <span class="kw2">ord</span><span class="br0">&#40;</span>y<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="kw1">for</span> <span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="br0">&#41;</span> <span class="kw1">in</span> <span class="kw2">zip</span><span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">def</span> hexxor<span class="br0">&#40;</span>a<span class="sy0">,</span> b<span class="br0">&#41;</span>: <span class="co1"># xor two hex strings (trims the longer input)</span>
  ha <span class="sy0">=</span> a.<span class="me1">decode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  hb <span class="sy0">=</span> b.<span class="me1">decode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  <span class="kw1">return</span> <span class="st0">&quot;&quot;</span>.<span class="me1">join</span><span class="br0">&#40;</span><span class="br0">&#91;</span><span class="kw2">chr</span><span class="br0">&#40;</span><span class="kw2">ord</span><span class="br0">&#40;</span>x<span class="br0">&#41;</span> ^ <span class="kw2">ord</span><span class="br0">&#40;</span>y<span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span> <span class="kw1">for</span> <span class="br0">&#40;</span>x<span class="sy0">,</span> y<span class="br0">&#41;</span> <span class="kw1">in</span> <span class="kw2">zip</span><span class="br0">&#40;</span>ha<span class="sy0">,</span> hb<span class="br0">&#41;</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw1">def</span> main<span class="br0">&#40;</span><span class="br0">&#41;</span>:
&nbsp;
  <span class="co1">#Initialise weak rng</span>
  wr <span class="sy0">=</span> WeakRNG<span class="br0">&#40;</span><span class="br0">&#41;</span>
  wr.<span class="me1">init_state</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
&nbsp;
  <span class="co1">#Print ciphertext</span>
  CH <span class="sy0">=</span> <span class="st0">'a432109f58ff6a0f2e6cb280526708baece6680acc1f5fcdb9523129434ae9f6ae9edc2f224b73a8'</span>
  <span class="kw1">print</span> <span class="st0">&quot;Full ciphertext in hexa: &quot;</span> + CH
&nbsp;
  <span class="co1">#Print known plaintext</span>
  pknown <span class="sy0">=</span> <span class="st0">'Let all creation'</span>
  nb <span class="sy0">=</span> <span class="kw2">len</span><span class="br0">&#40;</span>pknown<span class="br0">&#41;</span>
  <span class="kw1">print</span> <span class="st0">&quot;Known plaintext: &quot;</span> + pknown
  pkh <span class="sy0">=</span> pknown.<span class="me1">encode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span>
  <span class="kw1">print</span> <span class="st0">&quot;Plaintext in hexa: &quot;</span> + pkh
&nbsp;
  <span class="co1">#Obtain first nb bytes of RNG</span>
  gh <span class="sy0">=</span> hexxor<span class="br0">&#40;</span>pkh<span class="sy0">,</span> CH<span class="br0">&#91;</span><span class="nu0">0</span>:nb*<span class="nu0">2</span><span class="br0">&#93;</span><span class="br0">&#41;</span>
  <span class="kw1">print</span> gh
  gbytes <span class="sy0">=</span> <span class="br0">&#91;</span><span class="br0">&#93;</span>
  <span class="kw1">for</span> i <span class="kw1">in</span> <span class="kw2">range</span><span class="br0">&#40;</span>nb<span class="br0">&#41;</span>:
    gbytes.<span class="me1">append</span><span class="br0">&#40;</span><span class="kw2">ord</span><span class="br0">&#40;</span>gh<span class="br0">&#91;</span><span class="nu0">2</span>*i:<span class="nu0">2</span>*i+<span class="nu0">2</span><span class="br0">&#93;</span>.<span class="me1">decode</span><span class="br0">&#40;</span><span class="st0">'hex'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
  <span class="kw1">print</span> <span class="st0">&quot;Bytes of RNG: &quot;</span>
  <span class="kw1">print</span> gbytes
&nbsp;
  <span class="co1">#Break the LCG here:</span>
  <span class="co1">#1. find a and b</span>
  <span class="co1">#2. predict/generate rest of RNG bytes</span>
  <span class="co1">#3. decrypt plaintext</span>
&nbsp;
  <span class="co1"># Print full plaintext</span>
  p <span class="sy0">=</span> <span class="st0">''</span>
  <span class="kw1">print</span> <span class="st0">&quot;Full plaintext is: &quot;</span> + p
&nbsp;
&nbsp;
<span class="kw1">if</span> __name__ <span class="sy0">==</span> <span class="st0">&quot;__main__&quot;</span>:
  main<span class="br0">&#40;</span><span class="br0">&#41;</span>  </pre>
</dd></dl>

</div>
<!-- EDIT4 SECTION "Exercise 3 (2p)" [3279-] --></div>
</body>
</html>
