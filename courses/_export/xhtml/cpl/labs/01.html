    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>cpl:labs:01</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-10-03T21:56:18+0300"/>
<meta name="keywords" content="cpl,labs,01"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=cpl:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="01.html"/>
<link rel="canonical" href="../../../../cpl/labs/01.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='cpl:labs';var JSINFO = {"id":"cpl:labs:01","namespace":"cpl:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="01.html#introduction_to_flex">01. Introduction to Flex</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="01.html#introducere">Introducere</a></div></li>
<li class="level2"><div class="li"><a href="01.html#nice_to_read">Nice to read</a></div></li>
<li class="level2"><div class="li"><a href="01.html#prezentare_teoretica">Prezentare teoretică</a></div></li>
<li class="level2"><div class="li"><a href="01.html#instalare_flex">Instalare flex</a></div></li>
<li class="level2"><div class="li"><a href="01.html#utilizare_flex">Utilizare flex</a></div></li>
<li class="level2"><div class="li"><a href="01.html#structura_fisierului_de_specificatii">Structura fișierului de specificații</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="01.html#sectiunea_de_definitii">Secțiunea de definiții</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="01.html#optiuni">Opțiuni</a></div></li>
<li class="level4"><div class="li"><a href="01.html#stari_de_start">Stări de start</a></div></li>
<li class="level4"><div class="li"><a href="01.html#secvente_de_cod_c_in_sectiunea_de_definitii">Secvențe de cod C în secțiunea de definiții</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="01.html#sectiunea_de_reguli">Secțiunea de reguli</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="01.html#expresii_regulate">Expresii regulate</a></div></li>
<li class="level4"><div class="li"><a href="01.html#secvente_de_cod_c_in_sectiunea_de_reguli">Secvențe de cod C în secțiunea de reguli</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="01.html#sectiunea_de_cod">Secțiunea de cod</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="01.html#variabile_si_macro-uri_utile">Variabile și macro-uri utile</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"><a href="01.html#functia_yylex">Funcția yylex</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="01.html#exercitii_de_laborator_10p">Exerciții de laborator (10p)</a></div></li>
<li class="level1"><div class="li"><a href="01.html#exercitiul_0">Exercițiul 0</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="01.html#exercitiul_1_-_num_lines_3p">Exercițiul 1 - num lines (3p)</a></div></li>
<li class="level2"><div class="li"><a href="01.html#exercitiul_2_-_num_words_3p">Exercițiul 2 - num words (3p)</a></div></li>
<li class="level2"><div class="li"><a href="01.html#exercitiul_3_-_names_2p">Exercițiul 3 - names (2p)</a></div></li>
<li class="level2"><div class="li"><a href="01.html#exercitiul_4_-_appearances_2p">Exercițiul 4 - appearances (2p)</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="introduction_to_flex">01. Introduction to Flex</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "01. Introduction to Flex" [1-40] -->
<h2 class="sectionedit2" id="introducere">Introducere</h2>
<div class="level2">

<p>
De-a lungul acestui semestru, veți studia în cadrul cursului modul de implementare al unui compilator. La nivel conceptual, compilatorul este un program ce face translatarea dintr-un limbaj în altul. Cel mai adesea, compilatorul face translatarea dintr-un limbaj de nivel înalt (C, C++, Java), ce este scris și înteles de un programator, într-un limbaj low level (bytecode, limbaj asamblare, cod mașina) ce poate fi mai apoi executat de procesor (eventual după aplicarea unei noi translatări).
</p>

<p>
Operația de compilare a unui limbaj se face în general în mai mulți pași. Fiecare pas produce ca output o translatare a datelor de intrare primite, output ce servește ca input pentru pasul următor. Principalii pași ce se disting, în mod conceptual, pentru majoritatea compilatoarelor se pot vedea în figura urmatoare, împreuna cu inputul si outputul aferent, precum și tool-urile pe care le vom folosi în cadrul laboratorului și temelor pentru implementare.
</p>

<p>
<a href="../../../../_detail/cpl/labs/lab1better.png%3Fid=cpl%253Alabs%253A01.html" class="media" title="cpl:labs:lab1better.png"><img src="../../../../_media/cpl/labs/lab1better.png%3Fw=600&amp;tok=a78372" class="mediacenter" alt="" width="600" /></a>
</p>

</div>
<!-- EDIT2 SECTION "Introducere" [41-1078] -->
<h2 class="sectionedit3" id="nice_to_read">Nice to read</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://flex.sourceforge.net/manual/" class="urlextern" title="http://flex.sourceforge.net/manual/"  rel="nofollow">Flex</a> manual</div>
</li>
<li class="level1"><div class="li"> <a href="http://web.iitd.ac.in/~sumeet/flex__bison.pdf" class="urlextern" title="http://web.iitd.ac.in/~sumeet/flex__bison.pdf"  rel="nofollow">flex &amp; bison</a> O&#039;Reilly book</div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Nice to read" [1079-1242] -->
<h2 class="sectionedit4" id="prezentare_teoretica">Prezentare teoretică</h2>
<div class="level2">

<p>
Analiza lexicală este primul pas în înțelegerea de către compilator a fișierelor sursă. Scopul său este de a identifica atomii lexicali (“tokens”). Exemple de atomi lexicali în C sunt constantele întregi (<code>42</code>, <code>-8l</code>, <code>0xff</code>), șirurile de caractere (<code>“ana are mere”</code>) sau identificatorii (<code>my_awesome_function</code>).
</p>

<p>
<code>flex</code> este un generator de analizoare lexicale. Acesta primește la intrare un fișier ce conține o specificație a atomilor pe care urmează să-i recunoască analizorul generat, precum și o serie de acțiuni semantice de executat. Specificațiile vor fi scrise într-un fișier text ce poate avea orice denumire/extensie. De regulă se folosește extensia <code>.lex</code>.
</p>

<p>
Pe baza spcificațiilor, <code>flex</code> generează un program C ce conține tabele de analiză și o funcție de analiză numită <code>yylex</code>. Numele implicit al fișierului astfel generat este <code>lex.yy.c</code>. Acesta urmează să fie compilat (<code>gcc</code> sau un alt compilator) pentru a se obține fișierul executabil. 
</p>

<p>
<a href="../../../../_detail/cpl/labs/flex.png%3Fid=cpl%253Alabs%253A01.html" class="media" title="cpl:labs:flex.png"><img src="../../../../_media/cpl/labs/flex.png%3Fw=300&amp;tok=b4217c" class="mediacenter" alt="" width="300" /></a>
</p>

</div>
<!-- EDIT4 SECTION "Prezentare teoretică" [1243-2325] -->
<h2 class="sectionedit5" id="instalare_flex">Instalare flex</h2>
<div class="level2">

<p>
În cadrul acestui laborator vom folosi pachetul <code>flex</code> standard oferit de distribuție. Pentru mașina virtuală CPL pusă la dispoziție versiunea pachetului <code>flex</code> este <code>2.5.35</code>.
</p>
<pre class="code">sudo apt-get install flex</pre>

</div>
<!-- EDIT5 SECTION "Instalare flex" [2326-2582] -->
<h2 class="sectionedit6" id="utilizare_flex">Utilizare flex</h2>
<div class="level2">
<pre class="code bash"><span class="kw2">flex</span> <span class="br0">&#91;</span>OPTIONS<span class="br0">&#93;</span> <span class="br0">&#91;</span>FILE<span class="br0">&#93;</span> ...</pre>

<p>
Implicit, rulând programul fără nicio opțiune, va aștepta introducerea de specificații de la intrarea standard (stdin).
</p>

<p>
Comanda dispune de o varietate de parametri și opțiuni (<a href="http://www.manpagez.com/man/1/flex/" class="urlextern" title="http://www.manpagez.com/man/1/flex/"  rel="nofollow">man flex</a>) dintre care amintim:
</p>
<ul>
<li class="level1"><div class="li"> <em>-d</em> - activarea modului <strong>debugging</strong>; variabila globală <code>yy_flex_debug</code> trebuie să fie setată pe o valoare nenulă, implicit având valoarea 0</div>
</li>
<li class="level1"><div class="li"> <em>-i</em> - analizorul generat va fi case-insensitive</div>
</li>
<li class="level1"><div class="li"> <em>-o</em> - schimbă numele implicit al fișierului de ieșire <code>lex.yy.c</code></div>
</li>
</ul>

</div>
<!-- EDIT6 SECTION "Utilizare flex" [2583-3201] -->
<h2 class="sectionedit7" id="structura_fisierului_de_specificatii">Structura fișierului de specificații</h2>
<div class="level2">

<p>
Fișierul de specificații conține expresiile regulate ce descriu atomii limbajului sursă, precum și acțiunile pe care analizorul trebuie să le execute la recunoașterea fiecărui atom.
</p>
<pre class="code bash">definitions
<span class="sy0">%%</span>
rules
<span class="sy0">%%</span>
user_code</pre>

<p>
Se pot adăuga <strong> /* comentarii ca în C */ </strong> cât timp sunt precedate de cel puțin un spațiu.
</p>

</div>
<!-- EDIT7 SECTION "Structura fișierului de specificații" [3202-3603] -->
<h3 class="sectionedit8" id="sectiunea_de_definitii">Secțiunea de definiții</h3>
<div class="level3">

<p>
Această secțiune apare înainte de prima secvență de <code>%%</code> și este utilizată pentru a simplifica scanarea expresiilor prin asocierea de nume expresiilor regulate. În această secțiune pot să apară:
</p>
<ul>
<li class="level1"><div class="li"> opțiuni</div>
</li>
<li class="level1"><div class="li"> stări de start</div>
</li>
<li class="level1"><div class="li"> secvențe de cod C</div>
</li>
</ul>

<p>
Asocierea de nume cu expresiile regulate se face prin construcții de forma:
</p>
<pre class="code bash">name definition</pre>

<p>
unde:
</p>
<ul>
<li class="level1"><div class="li"> <em>name</em> - cuvânt compus din litere, cifre, <code>-</code> și/sau <code>_</code>; primul caracter trebuie să fie literă sau <code>_</code>;</div>
</li>
<li class="level1"><div class="li"> <em>definition</em> - expresie regulată (până la sfârșit de rând);</div>
</li>
</ul>

<p>
Numele astfel asociate pot fi folosite în definirea altor expresii regulate folosind construcția <code>{name}</code>. Comportamentul este similar celui obținut cu ajutorul directivei de preprocesor <code>define</code> din C.
</p>

</div>

<h4 id="optiuni">Opțiuni</h4>
<div class="level4">

<p>
Directivele <strong><code>%option</code></strong> permit precizarea unor comportamente specifice legate de analizorul generat. 
</p>

<p>
În continuare o să prezentăm câteva dintre cele mai des întâlnite astfel de opțiuni.
</p>
<ul>
<li class="level1"><div class="li"> <em>%option main</em> - generează o funcție <code>main</code> care doar apelează funcția de analiză <code>yylex</code>;</div>
</li>
<li class="level1"><div class="li"> <em>%option debug</em> - activează modul debugging;</div>
</li>
<li class="level1"><div class="li"> <em>%option case-insensitive</em> - analizatorul va fi case insensitive;</div>
</li>
<li class="level1"><div class="li"> <em>%option yylineno</em> - activează variabila globală <code>yylineno</code> ce va conține numărul liniei corespunzătoare din codul sursă;</div>
</li>
</ul>

</div>

<h4 id="stari_de_start">Stări de start</h4>
<div class="level4">

<p>
<code>flex</code> este capabil să lucreze simultan cu mai multe seturi de reguli diferite. Acest lucru poate fi util spre exemplu dacă se dorește analiza unui fișier sursă în care apar secvențe de cod scrise în limbaje diferite, cărora le corespund seturi de expresii regulate diferite. Astfel, există un mecanism ce permite activarea dinamică a unui anumit set de reguli în funcție de startea de start.
</p>

<p>
Stările de start trebuie declarate în secțiunea de definiții, folosind una dintre următoarele două metode:
</p>
<pre class="code bash"><span class="sy0">%</span>s inclusive_start_state1,inclusive_start_state2,...,inclusive_start_stateN
<span class="sy0">%</span>x exclusive_start_states1,exclusive_start_states2,...,exclusive_start_statesN </pre>

<p>
Numele stărilor de start vor fi atașate anumitor reguli din secțiunea de reguli și vor putea fi folosite ca argumente ale directivelor <code>BEGIN</code>. Prin execuția unei directive <code>BEGIN</code>, analizorul trece în starea de start ce apare ca argument al directivei și va folosi regulile ce corespund condiției respective astfel:
</p>
<ul>
<li class="level1"><div class="li"> condiție inclusivă (declarată cu <code>%s</code>) - regulile acceptate sunt atât cele neetichetate cât și cele etichetate cu numele condiției;</div>
</li>
<li class="level1"><div class="li"> condiție exclusivă (declarată cu <code>%x</code>) - regulile acceptate sunt doar cele etichetate cu numele condiției;</div>
</li>
</ul>

<p>
O regulă poate fi etichetată cu una sau mai multe stări de start, astfel:
</p>
<pre class="code bash"><span class="sy0">&lt;</span>state1,state2,...,stateN<span class="sy0">&gt;</span>rule</pre>

<p>
Un exemplu <a href="http://pastebin.com/uaCe7CxS" class="urlextern" title="http://pastebin.com/uaCe7CxS"  rel="nofollow">aici</a>.
</p>

</div>

<h4 id="secvente_de_cod_c_in_sectiunea_de_definitii">Secvențe de cod C în secțiunea de definiții</h4>
<div class="level4">

<p>
Secțiunea de definiții poate conține secvențe de cod C definite de utilizator. Pentru a introduce astfel de secvențe, ele trebuie să fie incluse între perechile de caractere <code>%{</code>, respectiv <code>%}</code>. Cele două perechi trebuie să apară pe linii separate și neindentate.
</p>

<p>
Codul cuprins între <code>%{</code> și <code>%}</code> va fi copiat în analizorul generat, în spațiul de vizibilitate extern (global) funcției <code>yylex</code>. 
</p>

</div>
<!-- EDIT8 SECTION "Secțiunea de definiții" [3604-6988] -->
<h3 class="sectionedit9" id="sectiunea_de_reguli">Secțiunea de reguli</h3>
<div class="level3">

<p>
Secțiunea de reguli este folosită pentru a asocia acțiuni semantice expresilor regulate folosind construcții de forma:
</p>
<pre class="code bash">template action</pre>

<p>
unde,
</p>
<ul>
<li class="level1"><div class="li"> <em>template</em> - expresie regulată al cărei prim caracter trebuie să se afle pe prima poziție a liniei;</div>
</li>
<li class="level1"><div class="li"> <em>action</em> - secvență formată din una sau mai multe instrucțiuni C; trebuie să înceapă pe aceeași linie cu <em>template</em>; pentru mai multe instrucțiuni se va folosi definirea unui bloc de instrucțiuni (adică linii de cod împrejmuite de acolade); <em>action</em> poate fi inclusiv instrucțiunea vidă;</div>
</li>
</ul>

<p>
Analizorul generat va executa secvența descrisă ca acțiune de fiecare dată când va recunoaște în textul sursă un șir care se potrivește cu <em>template</em>. Dacă o acțiune se termină cu instrucțiunea <code>return</code>, acest lucru va determina ieșirea din funcția <code>yylex</code>, deci va trece automat la căutarea următoarelor potriviri. 
</p>

<p>
Spre exemplu, dacă ne dorim ca analizorul lexical să prelucreze câte un singur atom la fiecare apel, va trebui să prevedem instrucțiuni de return la toate acțiunile care corespund unor atomi valizi (fără comentarii și whitespaces). Pentru compilatoarele care lucrează în mai multe faze (analiza lexicală fiind o fază distinctă), acțiunile se vor termina prin instrucțiuni de scriere (ex: directiva <code>ECHO</code>) a codurilor lexicale într-un fișier de ieșire (<code>yyout</code>) pentru a putea fi prelucrate în fazele ulterioare.
</p>

</div>

<h4 id="expresii_regulate">Expresii regulate</h4>
<div class="level4">
<div class="table sectionedit10"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  Șablon  </th><th class="col1 centeralign">  Descriere  </th>
	</tr>
	<tr class="row1">
		<td class="col0 centeralign">  a  </td><td class="col1"> caracterul <em>a</em> </td>
	</tr>
	<tr class="row2">
		<td class="col0 centeralign">  .  </td><td class="col1"> orice caracter mai puțin sfârșitul de linie </td>
	</tr>
	<tr class="row3">
		<td class="col0 centeralign">  \a  </td><td class="col1"> escapează caracterul <em>a</em> sau definește un caracter special (<em>\n</em>, <em>\b</em>, etc.) </td>
	</tr>
	<tr class="row4">
		<td class="col0 centeralign">  \042  </td><td class="col1"> caracterul cu codul ascii 42 în octal </td>
	</tr>
	<tr class="row5">
		<td class="col0 centeralign">  \x42  </td><td class="col1"> caracterul cu codul ascii 42 în hexa </td>
	</tr>
	<tr class="row6">
		<td class="col0 centeralign">  [abc]  </td><td class="col1"> oricare dintre caracterele <em>a</em>, <em>b</em> sau <em>c</em> </td>
	</tr>
	<tr class="row7">
		<td class="col0 centeralign">  [a-z]  </td><td class="col1"> oricare dintre caracterele din intervalul <em>a-z</em> </td>
	</tr>
	<tr class="row8">
		<td class="col0 centeralign">  [a-zA-Z]  </td><td class="col1"> orice literă </td>
	</tr>
	<tr class="row9">
		<td class="col0 centeralign">  [^a]  </td><td class="col1"> orice în afară de caracterul <em>a</em> </td>
	</tr>
	<tr class="row10">
		<td class="col0 centeralign">  [^a-z]  </td><td class="col1"> orice în afară de litere mici </td>
	</tr>
	<tr class="row11">
		<td class="col0 centeralign">  r*  </td><td class="col1"> zero sau mai multe apariții succesive ale expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row12">
		<td class="col0 centeralign">  r+  </td><td class="col1"> una sau mai multe apariții succesive ale expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row13">
		<td class="col0 centeralign">  r?  </td><td class="col1"> maxim o apariție a expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row14">
		<td class="col0 centeralign">  r{2,5}  </td><td class="col1"> 2, 3, 4 sau 5 apariții succesive ale expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row15">
		<td class="col0 centeralign">  r{2,}  </td><td class="col1"> 2 sau mai multe apariții succesive ale expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row16">
		<td class="col0 centeralign">  r{2}  </td><td class="col1"> 2 apariții succesive ale expresiei regulate <em>r</em> </td>
	</tr>
	<tr class="row17">
		<td class="col0 centeralign">  {xxx}  </td><td class="col1"> se expandează la expresia regulată căreia i s-a asociat numele <em>xxx</em> în secțiunea de definiții </td>
	</tr>
	<tr class="row18">
		<td class="col0 centeralign">  (r)  </td><td class="col1"> expresia regulată <em>r</em>, evaluarea ei având prioritate </td>
	</tr>
	<tr class="row19">
		<td class="col0 centeralign">  rs  </td><td class="col1"> concatenarea expresiilor regulate <em>r</em> și <em>s</em> </td>
	</tr>
	<tr class="row20">
		<td class="col0 centeralign">  r|s  </td><td class="col1"> una dintre expresiile regulate <em>r</em> sau <em>s</em> </td>
	</tr>
	<tr class="row21">
		<td class="col0 centeralign">  r/s  </td><td class="col1"> expresia regulată <em>r</em>, cu condiția ca aceasta să fie urmată de expresia regulată <em>s</em> </td>
	</tr>
	<tr class="row22">
		<td class="col0 centeralign">  ^r  </td><td class="col1"> expresia regulată <em>r</em>, cu condiția ca această să apară la început de linie </td>
	</tr>
	<tr class="row23">
		<td class="col0 centeralign">  r$  </td><td class="col1"> expresia regulată <em>r</em>, cu condiția ca această să apară la sfârșit de linie </td>
	</tr>
	<tr class="row24">
		<td class="col0 centeralign">  &lt;&lt;EOF&gt;&gt;  </td><td class="col1"> marcaj de sfârșit de fișier </td>
	</tr>
	<tr class="row25">
		<td class="col0 centeralign">  &lt;s&gt;r  </td><td class="col1"> expresia regulată <em>r</em>, dar numai în condiția de start <em>s</em> și în condițiile inclusive</td>
	</tr>
</table></div>
<!-- EDIT10 TABLE [8518-10376] -->
</div>

<h4 id="secvente_de_cod_c_in_sectiunea_de_reguli">Secvențe de cod C în secțiunea de reguli</h4>
<div class="level4">

<p>
În secțiunea de reguli, la fel ca în cea de <a href="../../../../cpl/labs/01.html#secvente_de_cod_c_in_sectiunea_de_definitii" class="urlextern" title="http://ocw.cs.pub.ro/courses/cpl/labs/01#secvente_de_cod_c_in_sectiunea_de_definitii"  rel="nofollow">definiții</a>, utilizatorul poate să plaseze secvențe de cod C, altele decât cele care reprezintă acțiuni atașate expresiilor regulate. Sintaxa este aceeași ca în cazul <a href="../../../../cpl/labs/01.html#secvente_de_cod_c_in_sectiunea_de_definitii" class="urlextern" title="http://ocw.cs.pub.ro/courses/cpl/labs/01#secvente_de_cod_c_in_sectiunea_de_definitii"  rel="nofollow">secțiunii de definiții</a>.
</p>

<p>
Codul din secțiunea de reguli va fi copiat în analizorul generat în interiorul funcției <code>yylex</code>. Recomandăm plasarea unor astfel de secvențe înainte de prima regulă; acestea vor conține de obicei declarații locale în raport cu funcția <code>yylex</code>, inițializări etc.
</p>

</div>
<!-- EDIT9 SECTION "Secțiunea de reguli" [6989-11137] -->
<h3 class="sectionedit11" id="sectiunea_de_cod">Secțiunea de cod</h3>
<div class="level3">

<p>
Secțiunea de cod este opțională, iar în cazul în care există are ca efect copierea codului la sfârșitul fișierului <code>lex.yy.c</code>. 
</p>

<p>
În mod normal, în această secțiune poate să apară funcția <code>main</code> care să conțină apeluri către funcția <code>yylex</code> sau alte funcții utile pentru a fi apelate din interiorul funcției <code>yylex</code>.
</p>

</div>

<h4 id="variabile_si_macro-uri_utile">Variabile și macro-uri utile</h4>
<div class="level4">

<p>
În această secțiune vom defini un set de variabile și macro-uri utile oferite de <code>flex</code>. Acestea pot fi folosite în cadrul secțiunii de cod, dar și în momentul inserării de cod în cadrul secțiunii de definiții sau de reguli.
</p>
<ul>
<li class="level1"><div class="li"> <em>char *yytext</em> - adresa zonei în care sunt reținute caracterele ce compun atomul curent;</div>
</li>
<li class="level1"><div class="li"> <em>int yyleng</em> - lungimea atomului curent;</div>
</li>
<li class="level1"><div class="li"> <em>FILE *yyin</em> - pointer către fișierul deschis ce conține textul curent analizat;</div>
</li>
<li class="level1"><div class="li"> <em>FILE *yyout</em> - pointer către fișierul deschis în care se poate scrie cu ajutorul macro-ului <code>ECHO</code>;</div>
</li>
<li class="level1"><div class="li"> <em>ECHO</em> - realizează scrierea conținutului <code>yytext</code> în <code>yyout</code>;</div>
</li>
<li class="level1"><div class="li"> <em>BEGIN(start_state)</em> - comută analizorul în <code>start_state</code>;</div>
</li>
<li class="level1"><div class="li"> <em>REJECT</em> - caută următoarea regulă al cărei șablon se potrivește cu atomul în curs de prelucrare (sau cu un prefix) și execută acțiunea asociată regulii găsite;</div>
</li>
<li class="level1"><div class="li"> <em>YY_START</em> - starea curentă (un număr);</div>
</li>
<li class="level1"><div class="li"> <em>yyterminate()</em> - termină procesul de analiză și întoarce valoarea 0 către apelantul funcției <code>yylex</code>;</div>
</li>
<li class="level1"><div class="li"> <em>yymore()</em> - concatenează următorul atom la atomul existent în <code>yytext</code>;</div>
</li>
<li class="level1"><div class="li"> <em>yyless(int n)</em> - lasă în <code>yytext</code> primele <em>n caractere</em> ale atomului curent, restituind în șirul de intrare caracterele de pe pozițiile n+1 până la sfârșit; actualizează <code>yyleng</code> la n;</div>
</li>
<li class="level1"><div class="li"> <em>unput(char c)</em> - forțează plasarea în șirul de intrare a caracterului <code>c</code>;</div>
</li>
<li class="level1"><div class="li"> <em>input()</em> - citește și returnează următorul caracter din șirul de intrare;</div>
</li>
</ul>

</div>
<!-- EDIT11 SECTION "Secțiunea de cod" [11138-13096] -->
<h2 class="sectionedit12" id="functia_yylex">Funcția yylex</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> se aplică acțiunile corespunzătoare din specificație (secțiunea de reguli) care pot genera text specific în fișierul <code>yyout</code> sau pot întoarce coduri lexicale;</div>
</li>
<li class="level1"><div class="li"> textul din fișierul sursă care nu se potrivește cu niciun șablon este copiat automat în <code>yyout</code>;</div>
</li>
<li class="level1"><div class="li"> dacă pentru un text se potrivesc mai multe șabloane, se alege potrivirea <strong>cea mai lungă</strong>;</div>
</li>
<li class="level1"><div class="li"> dacă pentru un text se potrivesc mai multe șabloane de aceeași lungime, se alege <strong>prima potrivire în ordine textuală</strong> din specificație;</div>
</li>
<li class="level1"><div class="li"> textul corespunzător potrivirii este copiat în <code>yytext</code>, iar lungimea acestuia este reținută în <code>yyleng</code>;</div>
</li>
<li class="level1"><div class="li"> când analizorul întâlnește marcajul <code><abbr title="End of file">EOF</abbr></code>, verifică rezultatul funcției <code>yywrap</code>; dacă rezultatul este fals (zero), înseamnă că analiza trebuie să continue cu noul fișier desemnat de <code>yyin</code>; dacă rezultatul este nenul, analiza se termină și se întoarce valoarea zero spre apelantul funcției <code>yylex</code>;</div>
</li>
</ul>

<p>
Absența funcției <code>yywrap</code> poate fi suplinită de opțiunea <code>%option noyywrap</code> sau prin opțiunea <code>-lfl</code> la linkare. 
</p>

</div>
<!-- EDIT12 SECTION "Funcția yylex" [13097-14226] -->
<h1 class="sectionedit13" id="exercitii_de_laborator_10p">Exerciții de laborator (10p)</h1>
<div class="level1">

<p>
În rezolvarea laboratorului folosiți arhiva de sarcini <a href="../../../../_media/cpl/labs/lab01_num_lines.zip" class="media mediafile mf_zip" title="cpl:labs:lab01_num_lines.zip (70.9 KB)"> lab01_num_lines.zip </a>
</p>

</div>
<!-- EDIT13 SECTION "Exerciții de laborator (10p)" [14227-14387] -->
<h1 class="sectionedit14" id="exercitiul_0">Exercițiul 0</h1>
<div class="level1">

<p>
Înscrieți-vă pe <a href="../../../../cpl/info/lista-discutii.html" class="wikilink1" title="cpl:info:lista-discutii"> Lista de discuții de CPL</a>.
</p>

</div>
<!-- EDIT14 SECTION "Exercițiul 0" [14388-14493] -->
<h2 class="sectionedit15" id="exercitiul_1_-_num_lines_3p">Exercițiul 1 - num lines (3p)</h2>
<div class="level2">

<p>
Intrați în directorul <code>1-num-lines</code>. 
</p>

<p>
Fișierul <code>example.lex</code> este un exemplu de fișier de specificație ce definește o variabilă globală, <code>num_lines</code>, iar de fiecare dată când identifică caracterul <code>\n</code> (newline) incrementează valoarea variabilei globale. Setul de specificații conține și o zonă definită de cod în care utilizatorul a definit funcția main, apelează funcția de parsare <code>yylex</code> și afișează numărul total de linii.
</p>

<p>
Generați cu ajutorul comenzii <code>flex</code> fișierul C <code>lex.yy.c</code>. Compilați și generați fișierul executabil. Folosiți drept fișier de input <code>unabom.txt</code>.
</p>

</div>
<!-- EDIT15 SECTION "Exercițiul 1 - num lines (3p)" [14494-15165] -->
<h2 class="sectionedit16" id="exercitiul_2_-_num_words_3p">Exercițiul 2 - num words (3p)</h2>
<div class="level2">

<p>
Modificați exercițiul anterior pentru a număra câte cuvinte se află într-un fișier dat.
Cuvintele pot conține literali și cratime și sunt separate prin spații albe (enter, spațiu, tab, etc.) sau semne de punctuație.
</p>

</div>
<!-- EDIT16 SECTION "Exercițiul 2 - num words (3p)" [15166-15439] -->
<h2 class="sectionedit17" id="exercitiul_3_-_names_2p">Exercițiul 3 - names (2p)</h2>
<div class="level2">

<p>
Scrieți un fișier de specificație <code>.lex</code> care identifică toate cuvintele care încep cu majusculă.
</p>

</div>
<!-- EDIT17 SECTION "Exercițiul 3 - names (2p)" [15440-15586] -->
<h2 class="sectionedit18" id="exercitiul_4_-_appearances_2p">Exercițiul 4 - appearances (2p)</h2>
<div class="level2">

<p>
Scrieți un fișier de specificație <code>.lex</code> care identifică de câte ori se regăsește un cuvânt dat într-un text.
</p>

</div>
<!-- EDIT18 SECTION "Exercițiul 4 - appearances (2p)" [15587-] --></div>
</body>
</html>
