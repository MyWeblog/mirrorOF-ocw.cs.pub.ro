    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>rl:labs:08</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2015-10-05T23:51:03+0300"/>
<meta name="keywords" content="rl,labs,08"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=rl:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="08.html"/>
<link rel="canonical" href="../../../../rl/labs/08.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='rl:labs';var JSINFO = {"id":"rl:labs:08","namespace":"rl:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">



<h1 class="sectionedit1" id="laborator_8_securizarea_unui_server">Laborator 8. Securizarea unui server</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 8. Securizarea unui server" [12-63] -->
<h2 class="sectionedit2" id="cunostinte_si_abilitati_ce_vor_fi_dobandite">Cunoștințe și abilități ce vor fi dobândite</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Cunoștințe generale legate de securizarea rețelei</div>
</li>
<li class="level1"><div class="li"> Avantajele și dezavantajele formelor de transfer securizat (criptat) și nesecurizat (în clar)</div>
</li>
<li class="level1"><div class="li"> Folosirea utilitarului <code>iptables</code> pentru configurarea unui firewall pe Linux</div>
</li>
<li class="level1"><div class="li"> Folosirea protocolului SSH și a utilitarelor aferente pentru conectarea la distanță și transferul securizat de fișiere</div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Cunoștințe și abilități ce vor fi dobândite" [64-496] -->
<h2 class="sectionedit3" id="pregatire_infrastructura_de_laborator">Pregătire infrastructură de laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Vom rula o masină virtuală în <a href="http://cloud.curs.pub.ro" class="urlextern" title="http://cloud.curs.pub.ro"  rel="nofollow"> cloud-ul facultății</a></div>
</li>
<li class="level1"><div class="li"> Pentru a porni o astfel de masină urmăriți tutorialul de la <a href="https://cloud.curs.pub.ro/about/tutorial-for-students/" class="urlextern" title="https://cloud.curs.pub.ro/about/tutorial-for-students/"  rel="nofollow"> această adresă</a></div>
</li>
<li class="level1"><div class="li"> Pentru a pregăti configurația de laborator, pe mașina virtuală (stația <code>host</code>) folosiți comenzile următoare din contul utilizatorului <code>root</code> de pe stația <code>host</code> (puteți da copy/paste la comenzi în terminal):<pre class="code bash"><span class="co4">root@host:~# </span><span class="kw2">wget</span> https:<span class="sy0">//</span>raw.github.com<span class="sy0">/</span>RL-UPB<span class="sy0">/</span>rl-lab-prepare<span class="sy0">/</span>master<span class="sy0">/</span>rl-lab-08-prepare
<span class="co4">root@host:~# </span><span class="kw2">chmod</span> +x rl-lab-08-prepare
<span class="co4">root@host:~# </span>.<span class="sy0">/</span>rl-lab-08-prepare</pre>

<p>
 Comanda durează circa 20 de secunde. Lasați-o să ruleze complet.
</p>
</div>
</li>
<li class="level1"><div class="li"> Deschideți trei noi tab-uri în terminal (folosiți combinația de taste <code>Ctrl+Shift+t</code>), și conectați-vă, din nou, la mașina virtuală folosind comanda <code>ssh</code> de mai sus.</div>
<ul>
<li class="level2"><div class="li"> De pe cele trei noi tab-uri, conectați-vă la cele trei containere (<code>red</code>, <code>green</code> și <code>blue</code>) folosind comanda<pre class="code bash"><span class="co4">root@host:~# </span>go <span class="sy0">&lt;</span>nume-container<span class="sy0">&gt;</span></pre>

<p>
 și autentificați-vă ca utilizatorul <code>root</code> cu parola <code>student</code>.
</p>
</div>
</li>
</ul>
</li>
</ul>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Detalii rulare masina virtuala VMware local
</p>
</div><div class="hiddenOnVisible">
<p>
Detalii rulare masina virtuala VMware local
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody"><ul>
<li class="level1"><div class="li"> Deschideți VMware și porniți mașina virtuală <code>RL_lab</code>.</div>
</li>
<li class="level1"><div class="li"> Dorim să folosim terminalul sistemului fizic și să lucrăm peste SSH cu mașina virtuală VMware (denumită și <code>host</code>). În acest fel vom putea folosi copy-paste în terminal sau alte facilități. Pentru aceasta urmați pașii de mai jos:</div>
<ul>
<li class="level2"><div class="li"> Autentificați-vă în mașina virtuală folosind contul <code>root</code> cu parola <code>student</code>.</div>
</li>
<li class="level2"><div class="li"> Aflați adresa IP a mașinii virtuale de pe interfața <code>eth0</code>:<pre class="code bash"><span class="co4">root@host:~# </span><span class="kw2">ifconfig</span> eth0</pre>
</div>
</li>
<li class="level2"><div class="li"> De pe sistemul fizic, deschideți un terminal și realizați o sesiune SSH folosind:<pre class="code bash"><span class="co4">student@mjolnir:~$ </span><span class="kw2">ssh</span> root<span class="sy0">@</span><span class="re1">$ADRESA_IP_MV</span></pre>

<p>
unde <code>$ADRESA_IP_MV</code> este adresa IP a mașinii virtuale așa cum ați obținut-o mai sus.
</p>
</div>
</li>
</ul>
</li>
</ul>
</div></div>
<p>
<p><div class="noteclassic">
Pentru a vedea cum accesați stațiile <code>red</code>, <code>green</code> și <code>blue</code> (containere LXC configurate peste mașina virtuală VMware - stația <code>host</code>) urmăriți pașii de <a href="../../../../rl/info/resurse/vm-laborator.html#instructiuni_utilizare" class="wikilink1" title="rl:info:resurse:vm-laborator"> aici</a>.

</div></p>
</p>

<p>
<p><div class="noteclassic">
Conturile de acces la mașina virtuală (stația <code>host</code>) sunt (<code>username:parola</code>):
</p>
<ul>
<li class="level1"><div class="li"> <code>root:student</code></div>
</li>
<li class="level1"><div class="li"> <code>student:student</code></div>
</li>
</ul>

<p>

</div></p>
</p>

</div>
<!-- EDIT3 SECTION "Pregătire infrastructură de laborator" [497-2930] -->
<h2 class="sectionedit4" id="topologie">Topologie</h2>
<div class="level2">

<p>
<a href="../../../../_detail/rl/topologie.png%3Fid=rl%253Alabs%253A08.html" class="media" title="rl:topologie.png"><img src="../../../../_media/rl/topologie.png" class="mediacenter" alt="" /></a>
</p>

</div>
<!-- EDIT4 SECTION "Topologie" [2931-2979] -->
<h2 class="sectionedit5" id="navigare">Navigare</h2>
<div class="level2">

<p>
<strong><span class="curid"><a href="../../../../rl/labs/08.html" class="wikilink1" title="rl:labs:08">Laboratorul 8</a></span></strong>
</p>

</div>
<!-- EDIT6 PLUGIN_INCLUDE_START "rl:labs:08:meta:nav" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:meta:nav">
<div class="level2">

<div><div id="nojs_indexmenu_66895312458356093b0043" data-jsajax="%26skipfile%3D%252B/sidebar/" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/01.html" class="wikilink1" title="rl:labs:08:contents:01">1. [5p] Trafic criptat și necriptat</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/02.html" class="wikilink1" title="rl:labs:08:contents:02">2. [5p] Blocare servicii necriptate</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/03.html" class="wikilink1" title="rl:labs:08:contents:03">3. [5p] Blocare SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/04.html" class="wikilink1" title="rl:labs:08:contents:04">4. [5p] Ștergere regulă FTP</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/05.html" class="wikilink1" title="rl:labs:08:contents:05">5. [5p] Ștergere reguli adăugate</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/06.html" class="wikilink1" title="rl:labs:08:contents:06">6. [5p] Blocare completă a traficului</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/07.html" class="wikilink1" title="rl:labs:08:contents:07">7. [10p] Permitere trafic SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/08.html" class="wikilink1" title="rl:labs:08:contents:08">8. [5p] Ștergere completă de reguli dintr-un lanț</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/09.html" class="wikilink1" title="rl:labs:08:contents:09">9. [5p] Conectare SSH folosind cheie publică</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/10.html" class="wikilink1" title="rl:labs:08:contents:10">10. [10p] Problemă la conectarea SSH folosind chei</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/11.html" class="wikilink1" title="rl:labs:08:contents:11">11. [5p] Copiere cheie publică la distanță pentru autentificare</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/12.html" class="wikilink1" title="rl:labs:08:contents:12">12. [10p] Generare cheie publică și autentificare</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/13.html" class="wikilink1" title="rl:labs:08:contents:13">13. [5p] Copiere fișiere cu diverse protocoale: durată și consum de resurse</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/14.html" class="wikilink1" title="rl:labs:08:contents:14">14. [5p] Download și upload folosind &#039;&#039;scp&#039;&#039;</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/15.html" class="wikilink1" title="rl:labs:08:contents:15">15. [10p] Download și upload de director folosind &#039;&#039;scp&#039;&#039;</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/16.html" class="wikilink1" title="rl:labs:08:contents:16">16. [5p] Alias-uri de conectare SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/17.html" class="wikilink1" title="rl:labs:08:contents:17">17. [BONUS - 10p] Blocare acces din Internet la rețeaua locală</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/18.html" class="wikilink1" title="rl:labs:08:contents:18">18. [BONUS - 10p] Transfer sincronizat de fișiere folosind &#039;&#039;rsync&#039;&#039; peste SSH</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT7 PLUGIN_INCLUDE_END "rl:labs:08:meta:nav" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT5 SECTION "Navigare" [2980-3088] -->
<h2 class="sectionedit8" id="exercitii">Exerciții</h2>
<div class="level2">

</div>
<!-- EDIT9 PLUGIN_INCLUDE_START "rl:labs:08:contents:01" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:01">

<h3 class="sectionedit11" id="p_trafic_criptat_si_necriptat">1. [5p] Trafic criptat și necriptat</h3>
<div class="level3">

<p>
Traficul generat de servicii se clasifică în <strong>trafic criptat</strong> și <strong>trafic în clar</strong>. Traficul <strong>în clar (necriptat)</strong> poate fi interpretat și înțeles dacă este capturat. Traficul criptat nu poate fi interpretat în absența cheii de criptare; doar transmițătorul și receptorul cunosc cheia pentru a putea comunica.
</p>

<p>
Ne propunem să analizăm, din punctul de vedere al criptării traficului, următoarele protocoale/servicii:
</p>
<ul>
<li class="level1"><div class="li"> telnet (port TCP 23)</div>
</li>
<li class="level1"><div class="li"> SSH (port TCP 22)</div>
</li>
<li class="level1"><div class="li"> <abbr title="File Transfer Protocol">FTP</abbr> (port TCP 21)</div>
</li>
</ul>

<p>
Vom folosi <code>dsniff</code>, un utilitar cu ajutorul căruia putem captura în clar pachetele care trec printr-un anumit server, pentru a afișa datele transmise (username, parolă, comenzi). Vom folosi topologia de laborator și ne vom conecta de la stația <code>red</code> la stația <code>green</code> prin intermediul stației <code>host</code>.
</p>

<p>
Pentru a porni procesul de captură, autentificați-vă ca <code>root</code> pe stația <code>host</code> și rulați comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>dsniff <span class="re5">-i</span> veth-green</pre>

<p>
Pentru comunicație prin telnet, rulați pe stația <code>red</code> comanda
</p>
<pre class="code bash"><span class="co4">root@red:~# </span>telnet green</pre>

<p>
În urma rulării comenzii ați realizat o conexiune telnet de la stația <code>red</code> la stația <code>green</code> prin intermediul stației <code>host</code>. La prompt-ul generat de comandă folosiți username-ul <code>student</code> și parola <code>student</code>; după aceea rulați comanda <code>ls</code> și apoi comanda <code>exit</code> pentru a închide conexiunea. Observați pe stația <code>host</code> captura credențialelor (username și parolă) transmise prin telnet între stațiile <code>red</code> și <code>green</code> ⇒ traficul telnet între cele două stații a fost <strong>trafic în clar</strong> și a fost capturat pe stația <code>host</code>.
</p>

<p>
<p><div class="notetip">
<code>dsniff</code> capturează traficul de rețea și afișează credențialele doar la încheierea conexiunilor. Trebuie folosite comenzi de tipul <code>exit</code> pentru a închide conexiunea și pentru ca <code>dsniff</code> să afișeze credențialele.

</div></p>
</p>

<p>
Pentru comunicație prin <abbr title="File Transfer Protocol">FTP</abbr>, rulați pe stația <code>red</code> comanda
</p>
<pre class="code bash"><span class="co4">root@red:~# </span><span class="kw2">ftp</span> green</pre>

<p>
În urma rulării comenzii ați realizat o conexiune <abbr title="File Transfer Protocol">FTP</abbr> de la stația <code>red</code> la stația <code>green</code> prin intermediul stației <code>host</code>. La prompt-ul generat de comandă folosiți username-ul <code>student</code> și parola <code>student</code>; după aceea rulați comanda <code>ls</code> și apoi comanda <code>quit</code> pentru a închide conexiunea. Observați pe stația <code>host</code> captura credențialelor (username și parolă) transmise prin <abbr title="File Transfer Protocol">FTP</abbr> între stațiile <code>red</code> și <code>green</code> ⇒ traficul <abbr title="File Transfer Protocol">FTP</abbr> între cele două stații a fost <strong>trafic în clar</strong> și a fost capturat pe stația <code>host</code>.
</p>

<p>
Pentru comunicație prin SSH, rulați pe stația <code>red</code> comanda
</p>
<pre class="code bash"><span class="co4">root@red:~# </span><span class="kw2">ssh</span> <span class="re5">-l</span> student green</pre>

<p>
În urma rulării comenzii ați realizat o conexiune SSH de la stația <code>red</code> la stația <code>green</code> prin intermediul stației <code>host</code>. În sesiunea de shell deschisă la distanță, rulați comanda <code>ls</code> și apoi comanda <code>exit</code> pentru a închide conexiunea. Observați că pe stația <code>host</code> <code>dsniff</code> nu afișează informații despre credențialele (username și parolă) transmise între stațiile <code>red</code> și <code>green</code> ⇒ traficul SSH între cele două stații a fost <strong>trafic criptat</strong> și <strong>nu</strong> a putut fi capturat pe stația <code>host</code>.
</p>

<p>
Pe stația <code>host</code>, pentru a opri comanda <code>dsniff</code> folosiți combinația de taste <code>Ctrl+c</code>.
</p>

<p>
<p><div class="noteclassic">
Traficul telnet și <abbr title="File Transfer Protocol">FTP</abbr> este trafic necriptat (în clar), în timp ce traficul SSH este trafic criptat.

</div></p>
</p>

</div>
<!-- EDIT11 SECTION "1. [5p] Trafic criptat și necriptat" [1-] --><!-- EDIT10 PLUGIN_INCLUDE_END "rl:labs:08:contents:01" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT12 PLUGIN_INCLUDE_START "rl:labs:08:contents:02" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:02">

<h3 class="sectionedit14" id="p_blocare_servicii_necriptate">2. [5p] Blocare servicii necriptate</h3>
<div class="level3">

<p>
După cum ați observat la punctul anterior, traficul pentru protocoalele telnet și <abbr title="File Transfer Protocol">FTP</abbr> este trafic în clar, necriptat, putându-se afla cu ușurință credențialele unui anumit cont și comenzile rulate.
</p>

<p>
Ne propunem să blocăm accesul de la stația <code>red</code> către stația <code>green</code> pentru aceste servicii, configurând ruterul dintre cele două stații, adică stația <code>host</code>. Practic vom configura pe stația <code>host</code> opțiuni de firewall cu ajutorul utilitarului <code>iptables</code>.
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Prezentare scurtă iptables (dați click)
</p>
</div><div class="hiddenOnVisible">
<p>
Prezentare scurtă iptables (dați click)
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
<code>iptables</code> este un utilitar Linux care oferă și rol de firewall software. <code>iptables</code> folosește suportul nucleului pentru a intercepta pachete de rețea în diverse puncte ale trecerii acestora prin nucleu și a efectua acțiuni asupra acestora. Astfel de acțiuni sunt:
</p>
<ul>
<li class="level1"><div class="li"> acceptarea pachetului (<code>ACCEPT</code>)</div>
</li>
<li class="level1"><div class="li"> respingerea pachetului (<code>REJECT</code>)</div>
</li>
<li class="level1"><div class="li"> aruncarea pachetului (<code>DROP</code>), similar cu respingerea dar nu se transmite nici o notificare de respingere către cel care a transmis pachetul inițial</div>
</li>
</ul>

<p>
O diagramă a drumului urmat de un pachet de rețea în nucleu este <a href="http://upload.wikimedia.org/wikipedia/commons/8/8f/Diagrama_linux_netfilter_iptables.gif" class="urlextern" title="http://upload.wikimedia.org/wikipedia/commons/8/8f/Diagrama_linux_netfilter_iptables.gif"  rel="nofollow">aici</a>.
</p>

<p>
Comanda <code>iptables</code> înseamnă lucrul cu reguli de filtrare de la nivelul nucleului. În mod obișnuit se va preciza:
</p>
<ul>
<li class="level1"><div class="li"> tipul de operație pe regulă (adăugare, ștergere, înlocuire, inserare)</div>
</li>
<li class="level1"><div class="li"> punctul din nucleul în care trebuie să se găsească pachetul pentru a se aplica regula</div>
</li>
<li class="level1"><div class="li"> regula în sine</div>
</li>
</ul>

<p>
De exemplu, comanda de mai jos are semnificația descrisă în continuare:
</p>
<pre class="code bash">iptables <span class="re5">-A</span> FORWARD <span class="re5">-d</span> green <span class="re5">-p</span> tcp <span class="re5">--dport</span> telnet <span class="re5">-j</span> REJECT</pre>
<ul>
<li class="level1"><div class="li"> <code>-A</code>: se adaugă regulă (este vorba de <em>append</em>, se adaugă la finalul listei de reguli);</div>
</li>
<li class="level1"><div class="li"> <code>FORWARD</code>: regula se aplică pachetelor care vor fi rutate; alte variante sunt <code>INPUT</code> (pachetele primite direct de sistem) și <code>OUTPUT</code> (pachetele care pleacă de la sistem);</div>
</li>
<li class="level1"><div class="li"> <code>-d green</code>: sunt selectate pachetele care au ca destinație adresa stației <code>green</code>;</div>
</li>
<li class="level1"><div class="li"> <code>-p tcp</code>: pachetele selectate sunt pachete TCP;</div>
</li>
<li class="level1"><div class="li"> <code>--dport telnet</code>: portul TCP destinație este portul specific protocolului telnet (adică portul <code>23</code>, identificat din fișierul <code>/etc/services</code>)</div>
</li>
<li class="level1"><div class="li"> <code>-j REJECT</code>: pachetul este respins</div>
</li>
</ul>

<p>
În tabela de filtrare aferentă <code>iptables</code> vom avea, așadar, o listă de reguli care sunt parcurse secvențial. Partea <code>-A FORWARD</code> identifică lanțul de reguli, partea <code>-d green -p tcp --dport telnet</code> este partea de <strong>match</strong> (ce pachete fac match pe regulă), iar partea <code>-j REJECT</code> este partea de <strong>acțiune</strong> (ce face regula cu pachetul).
</p>
</div></div>
<p>
Autentificați-vă prin SSH ca <code>root</code> pe stația <code>host</code>. Pentru a bloca accesul la serviciul telnet (port 23) destinat stației <code>green</code>, rulați pe stația <code>host</code> comanda de mai jos. Comanda adaugă regula <code>iptables</code> corespunzătoare.
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-A</span> FORWARD <span class="re5">-d</span> green <span class="re5">-p</span> tcp <span class="re5">--dport</span> telnet <span class="re5">-j</span> REJECT</pre>

<p>
Pentru a verifica adăugarea regulii de mai sus, rulați pe stația <code>host</code> comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-L</span> FORWARD
Chain FORWARD <span class="br0">&#40;</span>policy ACCEPT<span class="br0">&#41;</span>
target     prot opt <span class="kw3">source</span>               destination         
REJECT     tcp  <span class="re5">--</span>  anywhere             green                tcp dpt:telnet reject-with icmp-port-unreachable</pre>

<p>
Pentru a afișa informații și despre pachetele prelucrate și interfețele folosite, rulați pe stația <code>host</code> comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-L</span> FORWARD <span class="re5">-v</span>
Chain FORWARD <span class="br0">&#40;</span>policy ACCEPT <span class="nu0">0</span> packets, <span class="nu0">0</span> bytes<span class="br0">&#41;</span>
 pkts bytes target     prot opt <span class="kw1">in</span>     out     <span class="kw3">source</span>               destination         
    <span class="nu0">0</span>     <span class="nu0">0</span> REJECT     tcp  <span class="re5">--</span>  any    any     anywhere             green                tcp dpt:telnet reject-with icmp-port-unreachable</pre>

<p>
Pentru a afișa informații în format numeric (pentru nume de stații și nume de porturi), rulați pe stația <code>host</code> comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-L</span> FORWARD <span class="re5">-v</span> <span class="re5">-n</span>
Chain FORWARD <span class="br0">&#40;</span>policy ACCEPT <span class="nu0">0</span> packets, <span class="nu0">0</span> bytes<span class="br0">&#41;</span>
 pkts bytes target     prot opt <span class="kw1">in</span>     out     <span class="kw3">source</span>               destination         
    <span class="nu0">0</span>     <span class="nu0">0</span> REJECT     tcp  <span class="re5">--</span>  <span class="sy0">*</span>      <span class="sy0">*</span>       0.0.0.0<span class="sy0">/</span><span class="nu0">0</span>            192.168.2.2          tcp dpt:<span class="nu0">23</span> reject-with icmp-port-unreachable</pre>

<p>
De acum înainte recomandăm folosirea acestor opțiuni (<code>-v -n</code>) pentru listarea regulilor <code>iptables</code>.
</p>

<p>
Pentru a verifica blocarea traficului telnet către <code>green</code>, rulați pe stația <code>red</code> comanda
</p>
<pre class="code bash">telnet green</pre>

<p>
Vă apare un mesaj de forma
</p>
<pre class="code">Trying 192.168.2.2...
telnet: Unable to connect to remote host: Connection refused</pre>

<p>
 semnificând faptul că se încearcă realizarea conexiunii dar conexiunea este respinsă
</p>

<p>
Pentru a vedea că regula de blocare a funcționat, rulați din nou pe stația <code>host</code> comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-L</span> FORWARD <span class="re5">-v</span> <span class="re5">-n</span>
Chain FORWARD <span class="br0">&#40;</span>policy ACCEPT <span class="nu0">0</span> packets, <span class="nu0">0</span> bytes<span class="br0">&#41;</span>
 pkts bytes target     prot opt <span class="kw1">in</span>     out     <span class="kw3">source</span>               destination         
    <span class="nu0">2</span>   <span class="nu0">120</span> REJECT     tcp  <span class="re5">--</span>  <span class="sy0">*</span>      <span class="sy0">*</span>       0.0.0.0<span class="sy0">/</span><span class="nu0">0</span>            192.168.2.2          tcp dpt:<span class="nu0">23</span> reject-with icmp-port-unreachable</pre>

<p>
Observați, în output-ul comenzii, că există acum valori diferite de 0 în coloana <code>pkts</code> și <code>bytes</code>, semn că au fost pachete prelucrate de această regulă, deci blocate.
</p>

<p>
Pentru a verifica funcționarea în continuare a altor conexiuni (diferite de telnet) de la <code>red</code> la <code>green</code>, rulați pe stația <code>red</code> comenzile
</p>
<pre class="code bash"><span class="kw2">ftp</span> green
<span class="kw2">ssh</span> <span class="re5">-l</span> student green</pre>

<p>
Dorim să blocăm și celălalt serviciu necriptat, <abbr title="File Transfer Protocol">FTP</abbr>. Adăugați o regulă <code>iptables</code> similară pentru a bloca, pe stația <code>host</code>, traficul <abbr title="File Transfer Protocol">FTP</abbr> destinat stației <code>green</code>. După adăugarea regulii folosiți <code>iptables -L FORWARD -n -v</code> pentru a valida adăugarea regulii.
</p>

<p>
<p><div class="notetip">
Pentru această regulă puteți transmite argumentul <code>21</code> opțiunii <code>--dport</code> sau chiar numele <code>ftp</code>. Asocierea între port (număr) și protocol (nume) se găsește în fișierul <code>/etc/services</code>.

</div></p>
</p>

<p>
De pe stația <code>red</code> verificați blocarea traficului <abbr title="File Transfer Protocol">FTP</abbr> către stația green folosind comanda
</p>
<pre class="code bash"><span class="kw2">ftp</span> green</pre>

</div>
<!-- EDIT14 SECTION "2. [5p] Blocare servicii necriptate" [1-] --><!-- EDIT13 PLUGIN_INCLUDE_END "rl:labs:08:contents:02" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT15 PLUGIN_INCLUDE_START "rl:labs:08:contents:03" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:03">

<h3 class="sectionedit17" id="p_blocare_ssh">3. [5p] Blocare SSH</h3>
<div class="level3">

<p>
Ne propunem ca stația <code>green</code> să nu fie acesibilă nici prin SSH. Pentru aceasta adăugați pe stația <code>host</code> o regulă <code>iptables</code> care va bloca traficul aferent serviciului SSH (portul 22).
</p>

<p>
Verificați adăugarea regulii <code>iptables</code> și apoi verificați de pe stația <code>red</code> blocarea traficului SSH către stația <code>green</code>.
</p>

</div>
<!-- EDIT17 SECTION "3. [5p] Blocare SSH" [1-] --><!-- EDIT16 PLUGIN_INCLUDE_END "rl:labs:08:contents:03" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT18 PLUGIN_INCLUDE_START "rl:labs:08:contents:04" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:04">

<h3 class="sectionedit20" id="p_stergere_regula_ftp">4. [5p] Ștergere regulă FTP</h3>
<div class="level3">

<p>
Dorim să permitem accessul <abbr title="File Transfer Protocol">FTP</abbr> către stația <code>green</code>. Pentru aceasta pe stația <code>host</code> trebuie ștearsă regula <code>iptables</code> care blochează traficul <abbr title="File Transfer Protocol">FTP</abbr>.
</p>

<p>
Pe stația <code>host</code> ștergeți regula <code>iptables</code> aferentă. Pentru a șterge o regulă folosiți comanda <code>iptables</code> cu opțiunea <code>-D</code> (<em>delete</em>) urmată de restul argumentelor; practic, comanda este identică celei de adăugare, doar că folosiți opțiunea <code>-D</code> în locul opțiunii <code>-A</code>.
</p>

<p>
Listați regulile <code>iptables</code> pentru a verifica ștergerea regulii care bloca traficul <abbr title="File Transfer Protocol">FTP</abbr>.
</p>

<p>
După ștergerea regulii verificați realizarea conexiunii prin <abbr title="File Transfer Protocol">FTP</abbr> de la stația <code>red</code> la stația <code>green</code>. Verificați că nu se pot realiza conexiuni prin telnet sau SSH de la stația <code>red</code> la stația <code>green</code>.
</p>

</div>
<!-- EDIT20 SECTION "4. [5p] Ștergere regulă FTP" [1-] --><!-- EDIT19 PLUGIN_INCLUDE_END "rl:labs:08:contents:04" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT21 PLUGIN_INCLUDE_START "rl:labs:08:contents:05" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:05">

<h3 class="sectionedit23" id="p_stergere_reguli_adaugate">5. [5p] Ștergere reguli adăugate</h3>
<div class="level3">

<p>
Pentru a permite tot traficul către stația <code>green</code>, ștergeți pe stația <code>host</code> toate regulile <code>iptables</code> din lanțul <code>FORWARD</code>. Folosiți opțiunea <code>-F</code> (<em>flush</em>) a comenzii <code>iptables</code>. Practic revenim la situația inițială, fără reguli <code>iptables</code> pe stația <code>host</code>. Folosiți comanda <code>iptables -L FORWARD -n -v</code> pentru a valida ștergerea regulilor din lanțul <code>FORWARD</code>.
</p>

<p>
După ștergerea regulilor verificați funcționarea serviciilor telnet, <abbr title="File Transfer Protocol">FTP</abbr>, SSH prin conectare de la stația <code>red</code> la stația <code>green</code>.
</p>

</div>
<!-- EDIT23 SECTION "5. [5p] Ștergere reguli adăugate" [1-] --><!-- EDIT22 PLUGIN_INCLUDE_END "rl:labs:08:contents:05" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT24 PLUGIN_INCLUDE_START "rl:labs:08:contents:06" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:06">

<h3 class="sectionedit26" id="p_blocare_completa_a_traficului">6. [5p] Blocare completă a traficului</h3>
<div class="level3">

<p>
Pentru început verificați că stația <code>red</code> poate accesa alte stații din rețea. Rulați comanda
</p>
<pre class="code bash"><span class="co4">root@red:~# </span><span class="kw2">ping</span> <span class="re5">-c</span> <span class="nu0">2</span> green
PING green <span class="br0">&#40;</span>192.168.2.2<span class="br0">&#41;</span> <span class="nu0">56</span><span class="br0">&#40;</span><span class="nu0">84</span><span class="br0">&#41;</span> bytes of data.
<span class="nu0">64</span> bytes from green <span class="br0">&#40;</span>192.168.2.2<span class="br0">&#41;</span>: <span class="re2">icmp_req</span>=<span class="nu0">1</span> <span class="re2">ttl</span>=<span class="nu0">63</span> <span class="re2">time</span>=<span class="nu0">0.076</span> ms
<span class="nu0">64</span> bytes from green <span class="br0">&#40;</span>192.168.2.2<span class="br0">&#41;</span>: <span class="re2">icmp_req</span>=<span class="nu0">2</span> <span class="re2">ttl</span>=<span class="nu0">63</span> <span class="re2">time</span>=<span class="nu0">0.067</span> ms
&nbsp;
<span class="re5">---</span> green <span class="kw2">ping</span> statistics <span class="re5">---</span>
<span class="nu0">2</span> packets transmitted, <span class="nu0">2</span> received, <span class="nu0">0</span><span class="sy0">%</span> packet loss, <span class="kw1">time</span> 999ms
rtt min<span class="sy0">/</span>avg<span class="sy0">/</span>max<span class="sy0">/</span>mdev = <span class="nu0">0.067</span><span class="sy0">/</span><span class="nu0">0.071</span><span class="sy0">/</span><span class="nu0">0.076</span><span class="sy0">/</span><span class="nu0">0.009</span> ms</pre>

<p>
Asocierile între porturi și protocoale (<code>21</code> și <abbr title="File Transfer Protocol">FTP</abbr>, <code>22</code> și SSH, <code>23</code> și telnet) sunt cele implicite. Acest lucru nu împiedică însă un administrator să configureze un serviciu să asculte pe un port diferit de cel implicit. Pentru a preveni transferul de fișiere și conectare de la distanță pe stația <code>red</code> vom bloca accesul la toate porturile. Pentru aceasta vom configura stația <code>host</code> pentru a bloca <strong>întreg</strong> traficul de la stația <code>red</code>. Pentru blocarea <strong>întregului</strong> trafic rulați comanda
</p>
<pre class="code bash"><span class="co4">root@host:~# </span>iptables <span class="re5">-A</span> FORWARD <span class="re5">-s</span> <span class="kw2">red</span> <span class="re5">-j</span> REJECT
<span class="co4">root@host:~# </span>iptables <span class="re5">-L</span> FORWARD <span class="re5">-n</span> <span class="re5">-v</span>
Chain FORWARD <span class="br0">&#40;</span>policy ACCEPT <span class="nu0">0</span> packets, <span class="nu0">0</span> bytes<span class="br0">&#41;</span>
 pkts bytes target     prot opt <span class="kw1">in</span>     out     <span class="kw3">source</span>               destination         
    <span class="nu0">0</span>     <span class="nu0">0</span> REJECT     all  <span class="re5">--</span>  <span class="sy0">*</span>      <span class="sy0">*</span>       192.168.1.2          0.0.0.0<span class="sy0">/</span><span class="nu0">0</span>            reject-with icmp-port-unreachable</pre>

<p>
Comanda blochează întreg traficul <strong>de la</strong> stația <code>red</code> (opțiunea <code>-s</code>) pe care stația <code>host</code> l-ar fi rutat (lanțul <code>FORWARD</code>).
</p>

<p>
Verificați că stația <code>red</code> nu poate accesa alte stații. Rulați comenzile
</p>
<pre class="code bash"><span class="co4">root@red:~# </span><span class="kw2">ping</span> <span class="re5">-c</span> <span class="nu0">2</span> green
PING green <span class="br0">&#40;</span>192.168.2.2<span class="br0">&#41;</span> <span class="nu0">56</span><span class="br0">&#40;</span><span class="nu0">84</span><span class="br0">&#41;</span> bytes of data.
From host <span class="br0">&#40;</span>192.168.1.1<span class="br0">&#41;</span> <span class="re2">icmp_seq</span>=<span class="nu0">1</span> Destination Port Unreachable
From host <span class="br0">&#40;</span>192.168.1.1<span class="br0">&#41;</span> <span class="re2">icmp_seq</span>=<span class="nu0">2</span> Destination Port Unreachable
&nbsp;
<span class="re5">---</span> green <span class="kw2">ping</span> statistics <span class="re5">---</span>
<span class="nu0">2</span> packets transmitted, <span class="nu0">0</span> received, +<span class="nu0">2</span> errors, <span class="nu0">100</span><span class="sy0">%</span> packet loss, <span class="kw1">time</span> 999ms
&nbsp;
<span class="co4">root@red:~# </span>telnet green
Trying 192.168.2.2...
telnet: Unable to connect to remote host: Connection refused
&nbsp;
<span class="co4">root@red:~# </span><span class="kw2">ftp</span> green
ftp: connect: Connection refused
<span class="kw2">ftp</span><span class="sy0">&gt;</span> <span class="kw3">exit</span>
&nbsp;
<span class="co4">root@red:~# </span><span class="kw2">ssh</span> <span class="re5">-l</span> student green
ssh: connect to host green port <span class="nu0">22</span>: Connection refused</pre>

<p>
Observați că nu mai sosesc pachete de răspuns (sunt respinse de stația <code>host</code>), deci traficul de la stația <code>red</code> este blocat.
</p>

</div>
<!-- EDIT26 SECTION "6. [5p] Blocare completă a traficului" [1-] --><!-- EDIT25 PLUGIN_INCLUDE_END "rl:labs:08:contents:06" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT27 PLUGIN_INCLUDE_START "rl:labs:08:contents:07" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:07">

<h3 class="sectionedit29" id="p_permitere_trafic_ssh">7. [10p] Permitere trafic SSH</h3>
<div class="level3">

<p>
În acest moment, traficul de la stația <code>red</code> către celelalte stații din rețea este blocat.
</p>

<p>
Dorim să permitem traficul SSH <strong>de la</strong> stația <code>red</code> <strong>către</strong> stația <code>green</code>. Adăugați o regulă corespunzătoare pe stația <code>host</code>.
</p>

<p>
După ce ați adăugat regula, încercați realizarea unei conexiuni SSH de la stația <code>red</code> la stația <code>green</code>. Observați că nu se realizează conexiunea.
</p>

<p>
Afișați lista de reguli <code>iptables</code> de pe stația <code>host</code>. De ce nu a reușit conexiunea? Țineți cont de ordinea regulilor afișate; sunt parcurse secvențial.
</p>

<p>
Pentru rezolvarea problemei ștergeți regula <code>iptables</code> introdusă anterior și <strong>inserați</strong> regula pe stația <code>host</code>. Pentru inserare folosiți opțiunea <code>-I</code>  a comenzii <code>iptables</code>. Verificați că acum conexiunea SSH între <code>red</code> și <code>green</code> va fi realizată.
</p>

<p>
<p><div class="noteclassic">
Pentru a șterge o regulă puteți folosi opțiunea <code>-D</code> așa cum ați făcut și la <a href="../../../../rl/labs/08/contents/04.html" class="wikilink1" title="rl:labs:08:contents:04">exercițiul 4</a>.
</p>

<p>
Pentru a insera o regulă folosiți opțiunea <code>-I</code> urmată de numele lanțului (<code>INPUT</code>, <code>OUTPUT</code> sau <code>FORWARD</code>), urmată de indexul poziției unde doriți plasată regulă (1, 2, 3, …) și apoi urmată de specificarea regulii.

</div></p>
</p>

</div>
<!-- EDIT29 SECTION "7. [10p] Permitere trafic SSH" [1-] --><!-- EDIT28 PLUGIN_INCLUDE_END "rl:labs:08:contents:07" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT30 PLUGIN_INCLUDE_START "rl:labs:08:contents:08" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:08">

<h3 class="sectionedit32" id="p_stergere_completa_de_reguli_dintr-un_lant">8. [5p] Ștergere completă de reguli dintr-un lanț</h3>
<div class="level3">

<p>
Pe stația <code>host</code>, ștergeți toate regulile din lanțul <code>FORWARD</code> al <code>iptables</code>. Folosiți opțiunea <code>-F</code> a comenzii <code>iptables</code>.
</p>

<p>
Afișați lista de reguli <code>iptables</code> de pe stația <code>host</code> pentru a vedea că nu mai sunt reguli.
</p>

</div>
<!-- EDIT32 SECTION "8. [5p] Ștergere completă de reguli dintr-un lanț" [1-] --><!-- EDIT31 PLUGIN_INCLUDE_END "rl:labs:08:contents:08" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT33 PLUGIN_INCLUDE_START "rl:labs:08:contents:09" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:09">

<h3 class="sectionedit35" id="p_conectare_ssh_folosind_cheie_publica">9. [5p] Conectare SSH folosind cheie publică</h3>
<div class="level3">

<p>
Dorim să realizăm o sesiune securizată shell la distanță (<em>remote shell</em>).
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Sumar exerciții conectare SSH (dați click)
</p>
</div><div class="hiddenOnVisible">
<p>
Sumar exerciții conectare SSH (dați click)
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
Pentru exercițiile de conectare SSH, vom urma pașii:
</p>
<ol>
<li class="level1"><div class="li"> Conectare folosind SSH cu chei. Totul este configurat și vedem că merge. (exercițiul <a href="../../../../rl/labs/08/contents/09.html" class="wikilink1" title="rl:labs:08:contents:09">9. [5p] Conectare SSH folosind cheie publică</a>)</div>
</li>
<li class="level1"><div class="li"> Copiere cheie pentru conectare SSH. Cheia există și vom face apoi conectare ca mai sus. (exercițiul <a href="../../../../rl/labs/08/contents/11.html" class="wikilink1" title="rl:labs:08:contents:11">11. [5p] Copiere cheie publică la distanță pentru autentificare</a>)</div>
</li>
<li class="level1"><div class="li"> Crearea cheie, copiere și conectare SSH. (exercițiul <a href="../../../../rl/labs/08/contents/12.html" class="wikilink1" title="rl:labs:08:contents:12">12. [10p] Generare cheie publică și autentificare</a>)</div>
</li>
</ol>

<p>
Urmăm pașii în acest fel pentru a urmări întâi comenzile de conectare, sintaxa SSH și rolul său și apoi să investigăm cum se întâmplă lucrurile în spate.
</p>

<p>
În cazul în care veți avea un cont pe un server și veți dori conectare SSH cu chei, veți urma doar pasul 3.
</p>
</div></div>
<p>
Din contul <code>student</code> de pe stația <code>red</code> conectați-vă la stația <code>host</code> prin SSH prin rularea comenzii
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> student<span class="sy0">@</span>host
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
<span class="co4">student@host:~$</span></pre>

<p>
 Observați faptul că v-ați conectat direct, fără parolă, întrucât autentificarea s-a realizat folosind cheie publică. Folosiți combinația de taste <code>Ctrl+d</code> sau comanda <code>exit</code> pentru a închide sesiunea de shell la distanță.
</p>

<p>
Cheia publică folosită la conectare este disponibilă în fișierul <code>~/.ssh/id_rsa.pub</code>. Pentru vizualizarea cheii rulați, pe stația <code>red</code> din contul utilizatorului <code>student</code>, comanda
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">cat</span> ~<span class="sy0">/</span>.ssh<span class="sy0">/</span>id_rsa.pub 
ssh-rsa AAAAB3NzaC1<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span><span class="kw2">red</span></pre>

<p>
Un alt format de comandă SSH de conectare este cel de mai jos. Pe stația <code>red</code> rulați comanda
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> student host
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
<span class="co4">student@host:~$</span></pre>

<p>
 La fel, închideți sesiunea de shell la distanță prin folosirea combinației de taste <code>Ctrl+d</code>.
</p>

<p>
La distanță, cheia publică este stocată, împreună cu alte chei publice folosite pentru conectare, în fișierul <code>~/.ssh/authorized_keys</code>. Rulați comanda de mai jos pentru a confirma prezența cheii publice la distanță
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> student host <span class="st0">&quot;cat ~/.ssh/authorized_keys&quot;</span>
ssh-rsa AAAAB3N<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span>blue
ssh-rsa AAAAB3N<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span>green
ssh-rsa AAAAB3N<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span><span class="kw2">red</span>
ssh-rsa AAAAB3N<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span>host</pre>

<p>
Se observă că există cheia <code>student@red</code> în fișierul de la distanță de pe stația <code>host</code>, deci se poate realiza autentificarea SSH pe bază de chei.
</p>

</div>
<!-- EDIT35 SECTION "9. [5p] Conectare SSH folosind cheie publică" [1-] --><!-- EDIT34 PLUGIN_INCLUDE_END "rl:labs:08:contents:09" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT36 PLUGIN_INCLUDE_START "rl:labs:08:contents:10" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:10">

<h3 class="sectionedit38" id="p_problema_la_conectarea_ssh_folosind_chei">10. [10p] Problemă la conectarea SSH folosind chei</h3>
<div class="level3">

<p>
Din contul utilizatorului <code>student</code> de pe stația <code>red</code> conectați-vă la utilizatorul <code>ana</code> de pe stația <code>host</code> prin SSH prin rularea comenzii
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> ana host
ana<span class="sy0">@</span>host<span class="st_h">'s password:</span></pre>

<p>
Observați că vi se cere parola. Folosiți <code>Ctrl+c</code> pentru a anula promptul de parolă și a reveni la shell-ul inițial.
</p>

<p>
Afișați fișierul care conține cheia publică stocată local și cel care conține cheia publică stocată la distanță. Folosiți comenzile
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">cat</span> ~<span class="sy0">/</span>.ssh<span class="sy0">/</span>id_rsa.pub 
ssh-rsa AAAAB3NzaC1yc<span class="br0">&#91;</span>...<span class="br0">&#93;</span> student<span class="sy0">@</span><span class="kw2">red</span>
&nbsp;
<span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> ana host <span class="st0">&quot;cat ~/.ssh/authorized_keys&quot;</span>
ana<span class="sy0">@</span>host<span class="st_h">'s password: 
ssh-rsa AAAAB3NzaC1yc[...] student@red</span></pre>

<p>
Pentru a doua comandă introduceți parola <code>student</code>. Observați că cele două fișiere sunt identice. În mod obișnuit conectarea SSH ar trebui să funcționeze pe bază de chei, nu ar trebui să solicite parolă.
</p>

<p>
O primă metodă de identificare a problemelor de conectare este să rulați comanda de conectare cu opțiune de <em>verbosity</em>:
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-vvv</span> <span class="re5">-l</span> ana host
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
debug3: remaining preferred: ,password
debug3: authmethod_is_enabled password
debug1: Next authentication method: password
ana<span class="sy0">@</span>host<span class="st_h">'s password: </span></pre>

<p>
 Din păcate mesajele afișate nu oferă informații utile. Folosiți <code>Ctrl+c</code> pentru a anula promptul de parolă și a reveni la shell-ul inițial.
</p>

<p>
Pentru identificarea problemei vrem să consultăm fișierele jurnal ale serverului de SSH de la distanță. Autentificați ca <code>root</code> pe stația <code>host</code>, folosiți comanda <code>tail</code> pentru a urmări mesajele de jurnalizare. Comanda rulează în continuu și afișează noile mesaje din fișierul primit ca argument pe măsură ce acestea apar:
</p>
<pre class="code bash"><span class="co4">root@host:~# </span><span class="kw2">tail</span> <span class="re5">-f</span> <span class="sy0">/</span>var<span class="sy0">/</span>log<span class="sy0">/</span>auth.log 
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
Nov <span class="nu0">14</span> <span class="nu0">16</span>:<span class="nu0">48</span>:<span class="nu0">31</span> host sshd<span class="br0">&#91;</span><span class="nu0">20898</span><span class="br0">&#93;</span>: Authentication refused: bad ownership or modes <span class="kw1">for</span> directory <span class="sy0">/</span>home<span class="sy0">/</span>ana<span class="sy0">/</span>.ssh
Nov <span class="nu0">14</span> <span class="nu0">16</span>:<span class="nu0">49</span>:09 host sshd<span class="br0">&#91;</span><span class="nu0">20898</span><span class="br0">&#93;</span>: Connection closed by 192.168.1.2 <span class="br0">&#91;</span>preauth<span class="br0">&#93;</span></pre>

<p>
 Pentru a genera din nou mesaje legate de problemă, pe stația <code>red</code> rulați, din nou, comanda de conectare SSH:
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="re5">-l</span> ana host</pre>

<p>
 Folosiți <code>Ctrl+c</code> pentru a anula promptul de parolă și a reveni la shell-ul inițial.
</p>

<p>
Urmăriți mesajele de jurnalizare ale serverului. Urmăriți linia care începe cu “Authentication refused:”.
</p>

<p>
<p><div class="notetip">
Problema este la directorul <code>.ssh/</code> din directorul home al utilizatorului <code>ana</code>.

</div></p>
</p>

<p>
<p><div class="notetip">
Folosiți comanda
</p>
<pre class="code bash"><span class="kw2">ls</span> <span class="re5">-ld</span> <span class="sy0">&lt;</span>director<span class="sy0">&gt;</span></pre>

<p>
 pe un director pentru a afișa permisiunile pe directorul <code>&lt;director&gt;</code>. Permisiunile ar trebui să corespundă cu permisiuni pe directoarele identice deținute de alți utilizatori.

</div></p>
</p>

<p>
Corectați problema indicată de fișierele jurnal.
</p>

<p>
După corectarea problemei, verificați funcționarea conectării SSH folosind chei publice:
</p>
<pre class="code bash"><span class="co4">student@red:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> ana host
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
<span class="co4">ana@host:~$ </span></pre>

<p>
Dacă ați realizat configurația corectă atunci comanda de mai sus va conduce la conectarea SSH prin cheie publică, fără a vă fi solicitată parola de conectare pentru utilizatorul <code>ana</code> de pe stația <code>host</code>.
</p>

</div>
<!-- EDIT38 SECTION "10. [10p] Problemă la conectarea SSH folosind chei" [1-] --><!-- EDIT37 PLUGIN_INCLUDE_END "rl:labs:08:contents:10" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT39 PLUGIN_INCLUDE_START "rl:labs:08:contents:11" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:11">

<h3 class="sectionedit41" id="p_copiere_cheie_publica_la_distanta_pentru_autentificare">11. [5p] Copiere cheie publică la distanță pentru autentificare</h3>
<div class="level3">

<p>
În contul utilizatorului <code>bogdan</code> de pe stația <code>blue</code> (parola este <code>student</code>) este generată o pereche cheie privată / cheie publică, respectiv în fișierele <code>~/.ssh/id_rsa</code> și <code>~/.ssh/id_rsa.pub</code>. Dorim să realizăm conectare SSH folosind chei publice în contul utilizatorului <code>student</code> de pe stația <code>host</code>.
</p>

<p>
Copiați cheia publică la distanță pentru a permite conectarea. Conținutul fișierului aferent cheii publice (<code>~/.ssh/id_rsa.pub</code> din <code>bogdan@blue</code>) trebuie să ajungă în fișierul de la distanță care stochează cheile publice pentru autentificare (<code>~/.ssh/authorized_keys</code> din <code>student@host</code>). Pentru copierea cheii publice, rulați din contul utilizatorului <code>bogdan</code> de pe stația <code>blue</code> comanda
</p>
<pre class="code bash"><span class="co4">bogdan@blue:~$ </span>ssh-copy-id student<span class="sy0">@</span>host
student<span class="sy0">@</span>host<span class="st_h">'s password: 
Now try logging into the machine, with &quot;ssh '</span>student<span class="sy0">@</span>host<span class="st_h">'&quot;, and check in:
&nbsp;
  ~/.ssh/authorized_keys
&nbsp;
to make sure we haven'</span>t added extra keys that you weren<span class="st_h">'t expecting.</span></pre>

<p>
 Introduceți parola <code>student</code> la promptul afișat.
</p>

<p>
Verificați funcționarea corectă prin conectarea SSH la distanță:
</p>
<pre class="code bash"><span class="co4">bogdan@blue:~$ </span><span class="kw2">ssh</span> <span class="re5">-l</span> student host
<span class="br0">&#91;</span>...<span class="br0">&#93;</span>
<span class="co4">student@host:~$ </span></pre>

<p>
 Dacă v-ați conectat fără să vi se ceară parola înseamnă că s-a realizat autentificare prin chei publice și configurația este corectă.
</p>

</div>
<!-- EDIT41 SECTION "11. [5p] Copiere cheie publică la distanță pentru autentificare" [1-] --><!-- EDIT40 PLUGIN_INCLUDE_END "rl:labs:08:contents:11" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT42 PLUGIN_INCLUDE_START "rl:labs:08:contents:12" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:12">

<h3 class="sectionedit44" id="p_generare_cheie_publica_si_autentificare">12. [10p] Generare cheie publică și autentificare</h3>
<div class="level3">

<p>
În contul utilizatorului <code>corina</code> de pe stația <code>blue</code> generați o pereche cheie publică/cheie privată SSH prin rularea comenzii
</p>
<pre class="code bash"><span class="co4">corina@blue:~$ </span><span class="kw2">ssh-keygen</span> <span class="re5">-t</span> rsa
Generating public<span class="sy0">/</span>private rsa key pair.
Enter <span class="kw2">file</span> <span class="kw1">in</span> <span class="kw2">which</span> to save the key <span class="br0">&#40;</span><span class="sy0">/</span>home<span class="sy0">/</span>corina<span class="sy0">/</span>.ssh<span class="sy0">/</span>id_rsa<span class="br0">&#41;</span>: 
Created directory <span class="st_h">'/home/corina/.ssh'</span>.
Enter passphrase <span class="br0">&#40;</span>empty <span class="kw1">for</span> no passphrase<span class="br0">&#41;</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="kw1">in</span> <span class="sy0">/</span>home<span class="sy0">/</span>corina<span class="sy0">/</span>.ssh<span class="sy0">/</span>id_rsa.
Your public key has been saved <span class="kw1">in</span> <span class="sy0">/</span>home<span class="sy0">/</span>corina<span class="sy0">/</span>.ssh<span class="sy0">/</span>id_rsa.pub.
<span class="br0">&#91;</span>...<span class="br0">&#93;</span></pre>

<p>
 Folosiți <code>ENTER</code> pentru a folosi căile implicite. Nu folosiți passphrase (adică apăsați <code>ENTER</code> când vi se solicită passphrase-ul). Cheile sunt generate respectiv, în fișierele, <code>.ssh/id_rsa</code> (cheia privată) și <code>.ssh/id_rsa.pub</code> (cheia publică).
</p>

<p>
Realizați operațiile necesare pentru a permite autentificarea pe bază de chei din contul utilizatorului <code>corina</code> de pe stația <code>blue</code> în contul utilizatorului <code>student</code> de pe stația <code>host</code>. După aceea, verificați faptul că autentificarea se face pe baza de chei.
</p>

<p>
Aceștia sunt pașii pe care îi veți urma pentru a configura conectare SSH pe bază de chei:
</p>
<ol>
<li class="level1"><div class="li"> generare pereche de chei SSH (folosind comanda <code>ssh-keygen</code>)</div>
</li>
<li class="level1"><div class="li"> copiere cheie publică în contul de la distanță (folosind comanda <code>ssh-copy-id</code>)</div>
</li>
<li class="level1"><div class="li"> conectare la distanță (folosind comanda <code>ssh</code>)</div>
</li>
</ol>

</div>
<!-- EDIT44 SECTION "12. [10p] Generare cheie publică și autentificare" [1-] --><!-- EDIT43 PLUGIN_INCLUDE_END "rl:labs:08:contents:12" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT45 PLUGIN_INCLUDE_START "rl:labs:08:contents:13" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:13">

<h3 class="sectionedit47" id="p_copiere_fisiere_cu_diverse_protocoaledurata_si_consum_de_resurse">13. [5p] Copiere fișiere cu diverse protocoale: durată și consum de resurse</h3>
<div class="level3">

<p>
Ne propunem să măsurăm timpul de copiere și consumul de resurse pentru un transfer realizat între două stații folosind, pe rând, transfer direct, <abbr title="File Transfer Protocol">FTP</abbr> și SSH. În directorul home al utilizatorului <code>student</code> de pe stația <code>green</code> există un fișier <code>file-100M.dat</code>. Vom transfera acest fișier în directorul home al utilizatorului <code>student</code> de pe stația <code>host</code>. Vom folosi transfer direct, transfer <abbr title="File Transfer Protocol">FTP</abbr> și transfer SSH. Pentru fiecare caz, stația <code>host</code> va rula server-ul, iar stația <code>green</code> clientul.
</p>

<p>
<p><div class="notetip">
Dați copy-paste la comenzile de mai jos ca să vă asigurați că le scrieți corect. Pentru paste folosiți, în terminal, combinația de taste <code>Shift+Insert</code>.

</div></p>
</p>

<p>
<strong>Transfer direct</strong>
</p>

<p>
Pentru transfer direct vom porni un server simplu TCP pe stația <code>host</code> și un client pe stația <code>green</code>; vom folosi utilitarul <code>netcat</code>, prescurtat și <code>nc</code>. Rulați pe stația <code>host</code>, în contul utilizatorului <code>student</code>, comanda
</p>
<pre class="code bash"><span class="co4">student@host:~$ </span>nc <span class="re5">-l</span> <span class="nu0">12345</span> <span class="sy0">&gt;</span> file-100M-nc.dat</pre>

<p>
 Comanda deschide un server TCP care ascultă conexiuni pe portul <code>12345</code>. Comanda rămâne activă în așteptarea unei conexiuni de la un client.
</p>

<p>
De pe stația <code>green</code>, din contul utilizatorului <code>student</code>, transferați fișierul și măsurați timpul de transfer și consumul de resurse prin rularea comenzii<sup><a href="08.html#fn__1" id="fnt__1" class="fn_top">1)</a></sup>
</p>
<pre class="code bash"><span class="co4">student@green:~$ </span><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw1">time</span> <span class="re5">-v</span> <span class="kw2">cat</span> file-100M.dat <span class="sy0">|</span> nc host <span class="nu0">12345</span></pre>

<p>
Comanda de mai sus trimite un fișier comenzii <code>nc</code>, iar comanda <code>nc</code> are rolul unui client TCP care se conectează la stația <code>host</code> pe portul <code>12345</code>.
</p>

<p>
<strong>Transfer <abbr title="File Transfer Protocol">FTP</abbr></strong>
</p>

<p>
Pentru transfer <abbr title="File Transfer Protocol">FTP</abbr>, serverul de <abbr title="File Transfer Protocol">FTP</abbr> este deja pornit pe stația <code>host</code>. De pe stația <code>green</code>, din contul utilizatorului <code>student</code>, transferați fișierul și măsurați timpul de transfer și consumul de resurse prin rularea comenzii
</p>
<pre class="code bash"><span class="co4">student@green:~$ </span><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw1">time</span> <span class="re5">-v</span> curl <span class="re5">-T</span> file-100M.dat <span class="re5">-u</span> student:student ftp:<span class="sy0">//</span>host<span class="sy0">/</span>file-100M-ftp.dat</pre>

<p>
<strong>Transfer SSH</strong>
</p>

<p>
Pentru transfer SSH, serverul de SSH este deja pornit și configurat pe stația <code>host</code>. De pe stația <code>green</code>, în contul utilizatorului <code>student</code>, transferați fișierul și măsurați timpul de transfer și consumul de resurse prin rularea comenzii
</p>
<pre class="code bash"><span class="co4">student@green:~$ </span><span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw1">time</span> <span class="re5">-v</span> <span class="kw2">scp</span> file-100M.dat student<span class="sy0">@</span>host:file-100M-scp.dat</pre>

<p>
Urmăriți timpii de rulare și consumul de memorie și de procesor pentru cele trei cazuri de mai sus. Observați valorile ridicate pentru SSH pentru timpul utilizator (<em>User time</em>) și procentul de procesor (<em>Percent of CPU</em>). Acesta valori ridicate se datorează componentei de criptare a SSH: această componentă asigură securizarea datelor cu un cost de reducere de performanță.
</p>

</div>
<!-- EDIT47 SECTION "13. [5p] Copiere fișiere cu diverse protocoale: durată și consum de resurse" [1-] --><!-- EDIT46 PLUGIN_INCLUDE_END "rl:labs:08:contents:13" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT48 PLUGIN_INCLUDE_START "rl:labs:08:contents:14" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:14">

<h3 class="sectionedit50" id="p_download_si_upload_folosind_scp">14. [5p] Download și upload folosind &#039;&#039;scp&#039;&#039;</h3>
<div class="level3">

<p>
Upload-ul și download-ul prin intermediul protocolului SSH folosesc comanda <code>scp</code>. Vom folosi două fișiere:
</p>
<ul>
<li class="level1"><div class="li"> fișierul <code>host-file-10M.dat</code> din directorul home al utilizatorului <code>student</code> de pe stația <code>host</code>;</div>
</li>
<li class="level1"><div class="li"> fișierul <code>blue-file-10M.dat</code> din directorul home al utilizatorului <code>corina</code> de pe stația <code>blue</code>.</div>
</li>
</ul>

<p>
Autentificați-vă la cele două conturi (<code>student@host</code> și <code>corina@blue</code>) și observați prezența celor două fișiere:
</p>
<pre class="code bash"><span class="co4">corina@blue:~$ </span><span class="kw2">ls</span>
blue-file-10M.dat  solution
&nbsp;
<span class="co4">student@host:~$ </span><span class="kw2">ls</span>
assignment         file-100M-nc.dat   host-file-10M.dat
file-100M-ftp.dat  file-100M-scp.dat</pre>

<p>
Din contul <code>corina</code> de pe stația <code>blue</code>, <strong>descărcați</strong> fișierul <code>host-file-10M.dat</code> <strong>din</strong> directorul home al utilizatorului <code>student</code> de pe stația <code>host</code> folosind comanda
</p>
<pre class="code bash"><span class="kw2">scp</span> student<span class="sy0">@</span>host:host-file-10M.dat .</pre>

<p>
Fișierul a fost copiat în directorul curent (argumentul destinație este <code>.</code> - punct, <em>dot</em>), adică directorul home al utilizatorului <code>corina</code> de pe <code>blue</code>. Listați conținutul directorului curent pentru a verifica prezența fișierului descărcat:
</p>
<pre class="code bash"><span class="co4">corina@blue:~$ </span><span class="kw2">ls</span>
blue-file-10M.dat  host-file-10M.dat  solution</pre>

<p>
Din contul <code>corina</code> de pe stația <code>blue</code>, <strong>uploadați</strong> fișierul <code>blue-file-10M.dat</code> <strong>în</strong> directorul home al utilizatorului <code>student</code> de pe stația <code>host</code> folosind comanda
</p>
<pre class="code bash"><span class="kw2">scp</span> blue-file-10M.dat student<span class="sy0">@</span>host:</pre>

<p>
Fișierul a fost copiat în directorul home al utilizatorului <code>student</code> de pe <code>host</code>. Listați conținutul directorului de la distanță pentru a verifica prezența fișierului încărcat:
</p>
<pre class="code bash"><span class="co4">corina@blue:~$ </span><span class="kw2">ssh</span> student<span class="sy0">@</span>host <span class="kw2">ls</span>
assignment
blue-file-10M.dat
file-100M-ftp.dat
file-100M-nc.dat
file-100M-scp.dat
host-file-10M.dat</pre>

</div>
<!-- EDIT50 SECTION "14. [5p] Download și upload folosind ''scp''" [1-] --><!-- EDIT49 PLUGIN_INCLUDE_END "rl:labs:08:contents:14" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT51 PLUGIN_INCLUDE_START "rl:labs:08:contents:15" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:15">

<h3 class="sectionedit53" id="p_download_si_upload_de_director_folosind_scp">15. [10p] Download și upload de director folosind &#039;&#039;scp&#039;&#039;</h3>
<div class="level3">

<p>
<strong>Indicație</strong>: Pentru download-ul și upload-ul unui director folosiți opțiunea <code>-r</code> a comenzii <code>scp</code>.
</p>

<p>
Vom folosi două directoare:
</p>
<ul>
<li class="level1"><div class="li"> directorul <code>assignment/</code> din directorul home al utilizatorului <code>student</code> de pe stația <code>host</code>;</div>
</li>
<li class="level1"><div class="li"> directorul <code>solution/</code> din directorul home al utilizatorului <code>corina</code> de pe stația <code>blue</code>.</div>
</li>
</ul>

<p>
Din contul <code>corina</code> de pe stația <code>blue</code>, <strong>descărcați</strong> directorul <code>assignment/</code> <strong>din</strong> directorul home al utilizatorului <code>student</code> de pe stația <code>host</code>.
</p>

<p>
Din contul <code>corina</code> de pe stația <code>blue</code>, <strong>uploadați</strong> directorul <code>solution/</code> <strong>în</strong> directorul home al utilizatorului <code>student</code> de pe stația <code>host</code>.
</p>

</div>
<!-- EDIT53 SECTION "15. [10p] Download și upload de director folosind ''scp''" [1-] --><!-- EDIT52 PLUGIN_INCLUDE_END "rl:labs:08:contents:15" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT54 PLUGIN_INCLUDE_START "rl:labs:08:contents:16" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:16">

<h3 class="sectionedit56" id="p_alias-uri_de_conectare_ssh">16. [5p] Alias-uri de conectare SSH</h3>
<div class="level3">

<p>
În contul utilizatorului <code>student</code> de pe stația <code>host</code>, rulați comanda
</p>
<pre class="code">student@host:~$ ssh r
[...]
student@red:~$ </pre>

<p>
 În urma rulării comenzii vă veți conecta prin SSH în contul utilizatorului <code>student</code> de pe stația <code>red</code>. Deconectați-vă folosind combinația de taste <code>Ctrl+d</code>.
</p>

<p>
Comanda de mai sus a însemnat conectarea peste SSH datorită configurației de alias-uri SSH din fișierul <code>~/.ssh/config</code>. Urmăriți conținutul acestui fișier din contul utilizatorului <code>student</code> de pe stația <code>host</code>:
</p>
<pre class="code bash"><span class="co4">student@host:~$ </span><span class="kw2">cat</span> ~<span class="sy0">/</span>.ssh<span class="sy0">/</span>config 
Host r
	User student
	HostName <span class="kw2">red</span></pre>

<p>
În cadrul fișierului, șirul <code>r</code> din cadrul liniei <code>Host r</code> înseamnă un alias. Folosirea comenzii <code>ssh r</code> va conduce la conectarea prin SSH la utilizatorul aflat după șirul <code>User</code> către stația aflată după șirul <code>HostName</code>.
</p>

<p>
Actualizați fișierul <code>~/.ssh/config</code> astfel încât rularea comenzilor, respectiv,
</p>
<pre class="code">ssh g
ssh b</pre>

<p>
 să conducă la conectarea SSH în contul utilizatorului <code>student</code> de pe stația <code>green</code>, respectiv stația <code>blue</code>.
</p>

</div>
<!-- EDIT56 SECTION "16. [5p] Alias-uri de conectare SSH" [1-] --><!-- EDIT55 PLUGIN_INCLUDE_END "rl:labs:08:contents:16" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT57 PLUGIN_INCLUDE_START "rl:labs:08:contents:17" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:17">

<h3 class="sectionedit59" id="bonus_-_10p_blocare_acces_din_internet_la_reteaua_locala">17. [BONUS - 10p] Blocare acces din Internet la rețeaua locală</h3>
<div class="level3">

<p>
Pentru simularea unei situații reale, vom considera stația <code>red</code> ca fiind o stație din rețeaua locală (<abbr title="Local Area Network">LAN</abbr>), iar stația <code>green</code> o stație din Internet, conectate între ele prin stația <code>host</code>, pe post de gateway.
</p>

<p>
Dorim să blocăm traficul TCP <strong>inițiat</strong> din Internet către rețeaua locală, adică traficul TCP inițiat <strong>de la</strong> stația <code>green</code> <strong>către</strong> stația <code>red</code>. Traficul inițiat de stația <code>red</code> către stația <code>green</code> precum și traficul de răspuns de la stația <code>green</code> către stația <code>red</code> va fi permis.
</p>

<p>
Ca exemplu practic, de pe stația <code>red</code> vor putea fi inițiate conexiuni SSH către stația <code>green</code> folosind comanda
</p>
<pre class="code bash"><span class="kw2">ssh</span> green</pre>

<p>
, dar de pe stația <code>green</code> <strong>nu</strong> vor putea fi inițiate conexiuni SSH către stația <code>red</code> folosind comanda
</p>
<pre class="code bash"><span class="kw2">ssh</span> <span class="kw2">red</span></pre>

<p>
Configurați <code>iptables</code> pe stația <code>host</code> pentru a realiza acest lucru.
</p>

<p>
<p><div class="notetip">
Folosiți modulul <code>state</code> al <code>iptables</code>. Accesați pagina de manual <code>iptables</code> și căutați după <code>--state</code>. Pe distribuțiile mai noi accesați pagina de manual <code>iptables-extensions</code>. Pagina de manual este instalată și accesibilă pe stația <code>host</code>, <strong>nu</strong> pe stațiile <code>red</code>, <code>green</code> sau <code>blue</code>.

</div></p>
</p>

</div>
<!-- EDIT59 SECTION "17. [BONUS - 10p] Blocare acces din Internet la rețeaua locală" [1-] --><!-- EDIT58 PLUGIN_INCLUDE_END "rl:labs:08:contents:17" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT60 PLUGIN_INCLUDE_START "rl:labs:08:contents:18" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:18">

<h3 class="sectionedit62" id="bonus_-_10p_transfer_sincronizat_de_fisiere_folosind_rsync_peste_ssh">18. [BONUS - 10p] Transfer sincronizat de fișiere folosind &#039;&#039;rsync&#039;&#039; peste SSH</h3>
<div class="level3">

<p>
<a href="http://rsync.samba.org/" class="urlextern" title="http://rsync.samba.org/"  rel="nofollow">rsync</a> este un utilitar și protocol care permite transfer incremental. Este foarte potrivit pentru situații de backup, când se transferă doar actualizările sau pentru mentenanța unui mirror, la fel transferându-se de la serverul central doar noile date. Altfel de operații poartă numele de “sincronizare” (<em>syncing</em>).
</p>

<p>
Dorim să facem backup prin rsync al directorului <code>proiecte/</code> din directorul home al utilizatorului <code>ana</code> de pe stația <code>host</code> în contul <code>bogdan</code> de pe stația <code>blue</code>. Atunci când vom actualiza conținutul directorului <code>proiecte/</code>, procesul de backup va transfera doar modificările.
</p>

<p>
Folosiți <code>rsync</code> și protocolul SSH pentru a realiza acest lucru. Se dorește ca autentificarea să se realizeze pe bază de chei, fără parolă.
</p>

</div>
<!-- EDIT62 SECTION "18. [BONUS - 10p] Transfer sincronizat de fișiere folosind ''rsync'' peste SSH" [1-] --><!-- EDIT61 PLUGIN_INCLUDE_END "rl:labs:08:contents:18" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT63 PLUGIN_INCLUDE_START "rl:labs:08:contents:sidebar" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:contents:sidebar">

<h3 class="sectionedit65" id="navigare1">Navigare</h3>
<div class="level3">

<p>
<strong><span class="curid"><a href="../../../../rl/labs/08.html" class="wikilink1" title="rl:labs:08">Laboratorul 8</a></span></strong>
</p>

</div>
<!-- EDIT66 PLUGIN_INCLUDE_START "rl:labs:08:meta:nav" [0-] --><div class="plugin_include_content plugin_include__rl:labs:08:meta:nav">
<div class="level3">

<div><div id="nojs_indexmenu_66895312458356093b0043" data-jsajax="%26skipfile%3D%252B/sidebar/" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/01.html" class="wikilink1" title="rl:labs:08:contents:01">1. [5p] Trafic criptat și necriptat</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/02.html" class="wikilink1" title="rl:labs:08:contents:02">2. [5p] Blocare servicii necriptate</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/03.html" class="wikilink1" title="rl:labs:08:contents:03">3. [5p] Blocare SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/04.html" class="wikilink1" title="rl:labs:08:contents:04">4. [5p] Ștergere regulă FTP</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/05.html" class="wikilink1" title="rl:labs:08:contents:05">5. [5p] Ștergere reguli adăugate</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/06.html" class="wikilink1" title="rl:labs:08:contents:06">6. [5p] Blocare completă a traficului</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/07.html" class="wikilink1" title="rl:labs:08:contents:07">7. [10p] Permitere trafic SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/08.html" class="wikilink1" title="rl:labs:08:contents:08">8. [5p] Ștergere completă de reguli dintr-un lanț</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/09.html" class="wikilink1" title="rl:labs:08:contents:09">9. [5p] Conectare SSH folosind cheie publică</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/10.html" class="wikilink1" title="rl:labs:08:contents:10">10. [10p] Problemă la conectarea SSH folosind chei</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/11.html" class="wikilink1" title="rl:labs:08:contents:11">11. [5p] Copiere cheie publică la distanță pentru autentificare</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/12.html" class="wikilink1" title="rl:labs:08:contents:12">12. [10p] Generare cheie publică și autentificare</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/13.html" class="wikilink1" title="rl:labs:08:contents:13">13. [5p] Copiere fișiere cu diverse protocoale: durată și consum de resurse</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/14.html" class="wikilink1" title="rl:labs:08:contents:14">14. [5p] Download și upload folosind &#039;&#039;scp&#039;&#039;</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/15.html" class="wikilink1" title="rl:labs:08:contents:15">15. [10p] Download și upload de director folosind &#039;&#039;scp&#039;&#039;</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/16.html" class="wikilink1" title="rl:labs:08:contents:16">16. [5p] Alias-uri de conectare SSH</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/17.html" class="wikilink1" title="rl:labs:08:contents:17">17. [BONUS - 10p] Blocare acces din Internet la rețeaua locală</a></div></li>
<li class="level1"><div class="li"><a href="../../../../rl/labs/08/contents/18.html" class="wikilink1" title="rl:labs:08:contents:18">18. [BONUS - 10p] Transfer sincronizat de fișiere folosind &#039;&#039;rsync&#039;&#039; peste SSH</a></div></li>
</ul>
</div></div>

</div>
<!-- EDIT67 PLUGIN_INCLUDE_END "rl:labs:08:meta:nav" [0-] --></div>
<div class="level3">

</div>
<!-- EDIT65 SECTION "Navigare" [1-] --><!-- EDIT64 PLUGIN_INCLUDE_END "rl:labs:08:contents:sidebar" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT8 SECTION "Exerciții" [3089-] --><div class="footnotes">
<div class="fn"><sup><a href="08.html#fnt__1" id="fn__1" class="fn_bot">1)</a></sup> 
În cazul unui transfer prin rețea folosind <code>netcat</code> nu se face verificare de integritate (<em>integrity check</em>). Există riscul (mic, dar există) ca fișierul să nu fie transferat corespunzător. De aceea e bine să verificați integritatea acestuia prin calcularea sumei de control (<em>checksum</em>) folosind, de exemplu, utilitarul <code>sha512sum</code>.</div>
</div>
</div>
</body>
</html>
