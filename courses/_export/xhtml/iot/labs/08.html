    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>iot:labs:08</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-06-27T11:12:35+0300"/>
<meta name="keywords" content="iot,labs,08"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=iot:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="08.html"/>
<link rel="canonical" href="../../../../iot/labs/08.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='iot:labs';var JSINFO = {"id":"iot:labs:08","namespace":"iot:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="08.html#lab_8sensors_and_dashboard">Lab 8: Sensors and Dashboard</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="08.html#arduino_setup">Arduino Setup</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="08.html#what_you_need">What you need</a></div></li>
<li class="level3"><div class="li"><a href="08.html#the_setup">The setup</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="08.html#street_lightning">Street Lightning</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="08.html#what_you_need1">What you need</a></div></li>
<li class="level3"><div class="li"><a href="08.html#the_setup1">The Setup</a></div></li>
<li class="level3"><div class="li"><a href="08.html#the_code">The Code</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="08.html#exercises">Exercises</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="lab_8sensors_and_dashboard">Lab 8: Sensors and Dashboard</h1>
<div class="level1">

<p>
For the following applications, you will read data coming from sensors, which means that you will also need to use the Arduino board. As the Raspberry Pi has no ADCs, you cannot read values coming from analog sensors. 
</p>

</div>
<!-- EDIT1 SECTION "Lab 8: Sensors and Dashboard" [1-262] -->
<h2 class="sectionedit2" id="arduino_setup">Arduino Setup</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "Arduino Setup" [263-289] -->
<h3 class="sectionedit3" id="what_you_need">What you need</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> One Raspberry Pi board connected to Wyliodrin STUDIO;</div>
</li>
<li class="level1"><div class="li"> One Arduino board;</div>
</li>
<li class="level1"><div class="li"> One USB cable.</div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "What you need" [290-414] -->
<h3 class="sectionedit4" id="the_setup">The setup</h3>
<div class="level3">

<p>
As previously stated, the classical Arduino board is basically a micro-controller, which is capable of running one piece of software at once and that has little processing power and no network connectivity. So you will use the board to gather data from the environment and then pass it on to the Raspberry Pi.  
</p>

<p>
The Raspberry Pi is a computer that is capable of processing data and communicating with other smart devices. For instance, you could visualise the temperature on your smart phone.
</p>

<p>
The two boards need to be connected in order to send data between them. You can connect them via the USB cable and a serial connection will be established between the two. Once this is done, they can exchange data and the Arduino board can be controlled via the Raspberry Pi. This is done by the <strong>firmata</strong> protocol. The protocol allows the Raspberry Pi to send the Arduino messages in which it requests for a certain action or information and the Arduino will respond accordingly.
</p>

<p>
In order to implement the protocol, you need to flash the Arduino with the <strong>StandardFirmata</strong> firmware.
</p>

<p>
In the Wyliodrin STUDIO interface you have two tabs referring to <strong>SOFTWARE</strong> and <strong>FIRMWARE</strong>. So far, you used only the <strong>SOFTWARE</strong> tab, as you wrote applications for the Raspberry Pi solely. Now, select the <strong>FIRMARE</strong> tab and there is where you can write code which will be run on the Arduino. In this case, you will import an existing project.
</p>

<p>
<a href="../../../../_detail/iot/labs/select-firmata.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:select-firmata.png"><img src="../../../../_media/iot/labs/select-firmata.png%3Fw=300&amp;tok=4049a1" class="mediacenter" alt="" width="300" /></a>
</p>

<p>
Hit the <strong>Show examples</strong> button and select <strong>Arduino</strong>. Then <strong>use</strong> the <strong>Firmata/StandardFirmata</strong> example. Now that you have the software to run on the Arduino, once you hit the <strong>run</strong> button, you will be asked the tyype of the Arduino board and if you want to flash it or not. Select the board you are using and <strong>RUN AND FLASH</strong>. The <strong>StandardFirmata</strong> firmware will be deployed on the Arduino.
</p>

<p>
As you know, any micro-controller, including the Arduino, once flashed, runs the same firmware until another one is uploaded on the board. Thus, you don&#039;t have to flash the board each time you run a new Raspberry Pi application. If you are confident that the Arduino is running <strong>StandardFirmata</strong>, you can skip this step.
<a href="../../../../_detail/iot/labs/flash-arduino.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:flash-arduino.png"><img src="../../../../_media/iot/labs/flash-arduino.png%3Fw=300&amp;tok=0f36de" class="mediacenter" alt="" width="300" /></a>
</p>

</div>
<!-- EDIT4 SECTION "The setup" [415-2678] -->
<h2 class="sectionedit5" id="street_lightning">Street Lightning</h2>
<div class="level2">

<p>
In this application, you will build a system to monitor the light level and if there is the case, you will turn on the street lights brighter or dimmer, depending on the amount of light.
</p>

</div>
<!-- EDIT5 SECTION "Street Lightning" [2679-2896] -->
<h3 class="sectionedit6" id="what_you_need1">What you need</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> One Raspberry Pi connect to \Wyliodrin;</div>
</li>
<li class="level1"><div class="li"> One Arduino connected to the Raspberry Pi;</div>
</li>
<li class="level1"><div class="li"> One photocell;</div>
</li>
<li class="level1"><div class="li"> One LED;</div>
</li>
<li class="level1"><div class="li"> One 220 $\Omega$ resistor;</div>
</li>
<li class="level1"><div class="li"> One 10 k$\Omega$ resistor;</div>
</li>
<li class="level1"><div class="li"> Jumper wires. </div>
</li>
</ul>

</div>
<!-- EDIT6 SECTION "What you need" [2897-3126] -->
<h3 class="sectionedit7" id="the_setup1">The Setup</h3>
<div class="level3">

<p>
<a href="../../../../_detail/iot/labs/light_sensor_schematics.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:light_sensor_schematics.png"><img src="../../../../_media/iot/labs/light_sensor_schematics.png%3Fw=600&amp;tok=bd825d" class="mediacenter" alt="" width="600" /></a>
</p>

<p>
The photocell works just like resistor with a variable resistance. Depending on the amount of light it receives, its resistance gets higher or lower. As a result, you can connect it in a voltage divider, as well.
</p>

<p>
The sensor is connected to the 5V via the 10 K Ohms resistor and to the GND pin on the other side. In order to read the sensor&#039;s value, the yellow jumper wire is connected to the A0 pin of the board. The A0-A5 pins can be used for reading digital values, in this case values ranging from 0 to 1024. 
</p>

<p>
For the photocell, the resistance decreases proportionally with the amount of light, so for this schematics, the brighter the environment, the higher is the read value.
</p>

<p>
In addition, the photocell has a resistance varying from hundred of ohms to mega ohms and in order for the voltage divider to work, you should use the sensor as a pull-down resistor, while the actual resistor needs to have a resistance comparable with the sensor&#039;s, otherwise its effect is not visible. This is why you need a 10 k Ohms resistor.
</p>

<p>
The other part of the setup, the LED is connected similar to the previous schematics except that you can notice that its behaviour is controller by pin 3. That pin has a tilde next to it. That means that it is a PWM pin so you can control if the LED should light up brighter or dimmer. You can write values ranging from 0 to 255 on these pins, 0 being the equivalent of digital 0 and 255 the equivalent of digital 1. 
</p>

</div>
<!-- EDIT7 SECTION "The Setup" [3127-4647] -->
<h3 class="sectionedit8" id="the_code">The Code</h3>
<div class="level3">

<p>
<a href="../../../../_detail/iot/labs/street_lights_code.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:street_lights_code.png"><img src="../../../../_media/iot/labs/street_lights_code.png%3Fw=400&amp;tok=6b4d67" class="mediacenter" alt="" width="400" /></a>
</p>

<p>
First of all, you need to use an <strong>Arduino in</strong> node in order to read the values from the sensor. This node gets triggered each time the value on the pin it reads from changes. To actually configure the node&#039;s behavior you need to set its properties. 
</p>

<p>
<a href="../../../../_detail/iot/labs/arduino_in_properties.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:arduino_in_properties.png"><img src="../../../../_media/iot/labs/arduino_in_properties.png%3Fw=400&amp;tok=efa9fc" class="mediacenter" alt="" width="400" /></a>
</p>

<p>
The first property allows you to set the Raspberry Pi connection to the Arduino board so the Raspberry Pi knows the port through which it should send the messages. Usually, the port is <strong>/dev/ttyACM0</strong>. However, in order to make sure, go to the <strong>Shell</strong> tab and type <strong>dmesg</strong>. There you should see messages stating that an FTDI cable has been connected to the board and the port it is connected to. Concatenate that value to <strong>/dev/</strong> and place the value as the first property of the node.
</p>

<p>
Further on, you need to specify which pin you want to read from. In this case, the pin is 0 and is an analog pin. Afterwards, you will use a <strong>range</strong> node in order to map the read values to values that should light up the LED. For this, you need to adapt the system to your environment. Depending on the regular amount of light, usually you will read a value of around 400. So in this case, the range scales values going from 400 to 1024 to 0 to 255. However, if the regular value is different, you will need to scale a different range.
</p>

<p>
<a href="../../../../_detail/iot/labs/range-light.png%3Fid=iot%253Alabs%253A08.html" class="media" title="iot:labs:range-light.png"><img src="../../../../_media/iot/labs/range-light.png%3Fw=400&amp;tok=757879" class="mediacenter" alt="" width="400" /></a>
</p>

<p>
The last node to use is <strong>Arduino out</strong>. This node acts just like the <strong>digital write</strong> node used in the previous chapters. However, you still need to select the port for the Arduino board and you can choose from analog or digital write. As you want to make the LED light up brighter or dimmer, you will set the type to <strong>analog</strong> and the <strong>pin</strong> property has to be 3. 
</p>

<p>
<p><div class="noteclassic">
If you use more than one Arduino node in the application, add a new Raspberry Pi board only for one node. For the rest of the nodes, choose the previously added board from the drop-down.

</div></p>
</p>

<p>
Now you can run the application and watch how the LED gets brighter as you cover up the sensor. 
</p>

</div>
<!-- EDIT8 SECTION "The Code" [4648-6755] -->
<h2 class="sectionedit9" id="exercises">Exercises</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> Display the values coming from the light sensor in the dashboard using the <strong>gauge</strong> graph.</div>
</li>
<li class="level1"><div class="li"> Connect all the sensors in the kit to the Arduino and display the values you read in the dashboard. <strong>Note:</strong> Do not connect the Hall sensor, which works in a different way.</div>
</li>
<li class="level1"><div class="li"> Search the temperature sensor&#039;s datasheet online (TMP36) and transform the read values to celsius degrees.</div>
</li>
</ol>

</div>
<!-- EDIT9 SECTION "Exercises" [6756-] --></div>
</body>
</html>
