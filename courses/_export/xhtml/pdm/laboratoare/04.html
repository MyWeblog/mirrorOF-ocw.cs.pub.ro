    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>pdm:laboratoare:04</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-03-20T23:56:43+0200"/>
<meta name="keywords" content="pdm,laboratoare,04"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=pdm:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="04.html"/>
<link rel="canonical" href="../../../../pdm/laboratoare/04.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='pdm:laboratoare';var JSINFO = {"id":"pdm:laboratoare:04","namespace":"pdm:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="04.html#laborator_4_-_liste">Laborator 4 - Liste</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="04.html#listview">ListView</a></div></li>
<li class="level2"><div class="li"><a href="04.html#listactivity">ListActivity</a></div></li>
<li class="level2"><div class="li"><a href="04.html#listadapter">ListAdapter</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="04.html#arrayadapter">ArrayAdapter</a></div></li>
<li class="level3"><div class="li"><a href="04.html#exercitii">Exercitii</a></div></li>
<li class="level3"><div class="li"><a href="04.html#baseadapter">BaseAdapter</a></div></li>
<li class="level3"><div class="li"><a href="04.html#exercitii1">Exercitii</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_4_-_liste">Laborator 4 - Liste</h1>
<div class="level1">

<p>
In aplicatiile realizate, un element important pe care il vom utiliza il reprezinta listele. Sub platforma Android, acestea sunt implementate folosind modelul MVC (Model View Controller). Modelul este reprezentat de datele ce trebuie afisate, View-ul este lista propriu-zisa si Controller-ul este programul care controleaza modul de afisare. <a href="http://ocw.cs.pub.ro/courses/_detail/laboratoare/640px-list_adapter.png?id=pdm%3Alaboratoare%3A04" class="media wikilink2" title="laboratoare:640px-list_adapter.png"><img src="http://ocw.cs.pub.ro/courses/_media/laboratoare/640px-list_adapter.png" class="mediacenter" alt="" /></a>
</p>

</div>
<!-- EDIT1 SECTION "Laborator 4 - Liste" [1-421] -->
<h2 class="sectionedit2" id="listview">ListView</h2>
<div class="level2">

<p>
Un  este un View care contine o lista de elemente, care poate fi parcursa. Un View de tip  poate fi plasat pe orice tip de activitate. In mod normal, descriem ListView-ul in fisierul xml atasat activitatii, ii dam un id si in codul java luam un pointer catre el.
</p>

</div>
<!-- EDIT2 SECTION "ListView" [422-707] -->
<h2 class="sectionedit3" id="listactivity">ListActivity</h2>
<div class="level2">

<p>
Exista un mod mai simplu decat folosirea unui . In general, pe o activitate exista o singura lista, astfel ca Android ne pune la dispozitie un tip special de activitate, numit , care rezolva automat preluarea pointer-ului listei. In XML, trebuie declarat obligatoriu un  cu id-ul . De asemenea, ListActivity pune la dispozitie urmatoarele functii: <code java>// seteaza adaptorul pentru lista de pe fereastra void setListAdapter (ListAdapter adapter);
</p>

<p>
// intoarce adaptorul listei de pe fereastra ListAdapter getListAdapter ();
</p>

<p>
// intoarce un pointer catre lista din fereastra ListView getListView ();</code>
</p>

<p>
O alta functie oferita de catre ListActivity este onListItemClick(). Acesta este apelata automat de fiecare data cand se executa un click asupra unui element din lista. Initial functia este vida, in alte cuvinte, nu face nimic. Pentru a-i adauga o actiune, programatorul trebuie sa suprascrie acesta functie. <code java> @Override
</p>

<p>
<code>   public void onListItemClick (ListView list, View v, int position, long id)</code><br/>

<code>   {</code><br/>

<code>       // list - este lista de pe fereastra</code><br/>

<code>       // v - este elementul din lista pe care s-a dat click</code><br/>

<code>       // position - este pozitia pe care s-a dat click (de fapt pozitia la care se afla elementul v in lista)</code><br/>

<code>       // id - este id-ul elementului (obtinut prin functia getItemId () a adaptorului)</code><br/>

<code>   }</code></code>
</p>

</div>
<!-- EDIT3 SECTION "ListActivity" [708-2306] -->
<h2 class="sectionedit4" id="listadapter">ListAdapter</h2>
<div class="level2">

<p>
In Android, lista este de fapt un  vertical. Sarcina programatorului este de fapt crearea componentelor View pentru fiecare linie din acest , adica crearea unui element pe ecran pentru fiecare element pe care dorim sa il introducem in lista. In alte cuvinte, daca ne uitam la poza de mai sus, ceea ce trebuie noi sa facem este sa scriem componenta . Din punct de vedere ar programarii, asta inseamna crearea unui obiect care sa implementeze interfata . Biblioteciile Android ne pun la dispozitie mai multe variante de a implementa .
</p>

</div>
<!-- EDIT4 SECTION "ListAdapter" [2307-2865] -->
<h3 class="sectionedit5" id="arrayadapter">ArrayAdapter</h3>
<div class="level3">

<p>
Pentru liste simple, ce contin elemente cu o singura linie de text se poate folosi o clasa mult simplificata, si anume . Acesta presupune ca toate elementele sunt stocate intr-un sir (ex: Object[]) sau o lista (orice obiect ce implementeaza interfata ). Deoarece fiecare element din lista este o linie de text si in sir sau lista noi pastram obiecte, adaptorul va apela functia  pe fiecare obiect. Un exemplu de folosire este urmatorul: <code java>class Personaj {
</p>

<p>
<code>   public String nume;</code><br/>

<code>   public String desen;</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public String toString ()</code><br/>

<code>   {</code><br/>

<code>       // acesta functie este apelata de catre ArrayAdapter pentru a transforma obiectul intr-un String ce</code><br/>

<code>       // sa fie afisat in lista</code><br/>

<code>       return nume+&quot; din desenul animat &quot;+desen;</code><br/>

<code>   } </code>
</p>

<p>
}
</p>

<p>
public class ListaDeseneAnimate extends ListActivity {
</p>

<p>
<code>   ArrayList</code><Personaj><code> personaje;</code><br/>

<code>   ArrayAdapter</code><Personaj><code> adapter;</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public void onCreate (Bundle savedInstanceBundle)</code><br/>

<code>   {</code><br/>

<code>       super.onCreate (savedInstanceBundle);</code><br/>

<code>       personaje = new ArrayList</code><Personaj><code>();</code><br/>

<code>       adapter = new ArrayAdapter</code><Personaj><code>(this, android.R.layout.simple_list_item_1, personaje);</code><br/>

<code>       setContentView (R.layout.main);</code><br/>

<code>       setListAdapter (adapter);</code><br/>

<br/>

<code>       // adaugam cateva personaje in lista</code><br/>

<code>       adaugaFunnyGuy(&quot;Bugs Bunny&quot;, &quot;Looney Toons&quot;);</code><br/>

<code>       adaugaFunnyGuy(&quot;Fred Flinstone&quot;, &quot;The Flinstones&quot;);</code><br/>

<code>       adaugaFunnyGuy(&quot;Betty Rubble&quot;, &quot;The Flinstones&quot;);</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public void onListItemClick (ListView list, View v, int position, long id)</code><br/>

<code>   {</code><br/>

<code>       // afisam numele personajului pe care s-a dat click folosind un Toast</code><br/>

<code>       Toast.makeText(ListaDeseneAnimate.this, personaje.get(position).nume, Toast.LENGTH_LONG).show();</code><br/>

<code>   }</code><br/>

<br/>

<code>   private void adaugaFunnyGuy (String nume, String desen)</code><br/>

<code>   {</code><br/>

<code>       Personaj p = new Personaj ();</code><br/>

<code>       p.nume = nume;</code><br/>

<code>       p.desen = desen;</code><br/>

<code>       personaje.add (p);</code><br/>

<code>       // acesta functie determina adaptorul sa ceara listei sa reafiseze continutul</code><br/>

<code>       adapter.notifyDataSetChanged();</code><br/>

<code>   }</code>
</p>

<p>
}</code>
</p>

</div>
<!-- EDIT5 SECTION "ArrayAdapter" [2866-5739] -->
<h3 class="sectionedit6" id="exercitii">Exercitii</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Realizati o lista (editabila) cu personaje din desene animate. Pe activitate veti avea posibilitatea de a adauga un personaj in lista. Stergerea se va face prin apasarea lunga ( sau ) pe un element din lista.</div>
</li>
</ol>

</div>
<!-- EDIT6 SECTION "Exercitii" [5740-5974] -->
<h3 class="sectionedit7" id="baseadapter">BaseAdapter</h3>
<div class="level3">

<p>
Pentru o lista ce trebuie sa afiseze informatii mai complexe decat un rand de text, trebuie sa scriem un adaptor (o clasa ce implmenteaza interfata ). Pentru ca interfata  are foarte multe metode, un mod mai simplu este sa extindem clasa . De fapt trebuie sa implementam urmatoarele patru functii: <code java>class MyAdapter extends BaseAdapter {
</p>

<p>
<code>   @Override</code><br/>

<code>   public View getView (int position, View convertView, ViewGroup list) </code><br/>

<code>   {</code><br/>

<code>       // functia trebuie sa intoarca view-ul de pe pozitia position din lista</code><br/>

<code>       // convertView este un element din lista ce nu mai este vizibil si poate fi convertit</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>       public int getCount ()</code><br/>

<code>       {</code><br/>

<code>       // intoarce nr de elemente din lista</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public Object getItem(int position) </code><br/>

<code>   {</code><br/>

<code>       // intoarce elementul de pe pozitia position din model</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public long getItemId(int position) </code><br/>

<code>   {</code><br/>

<code>       // fiecare element din lista poate avea un id, nu este insa obligatoriu</code><br/>

<code>   }</code>
</p>

<p>
}</code> Pentru a exemplifica mai bine, vom modifica exemplul de mai sus, astfel incat sa afisam doua linii de text. Clasa Personaj ramane aceeasi ca in exemplul precedent. Primul pas este sa realizam un nou fisier XML (separat) ce va descrie cum arata fiecare element grafic (View) din lista. Il vom plasa in . personaj.xml <code xml>
</p>

<?xml version="1.0" encoding="utf-8"?>

<p>
<LinearLayout
  xmlns:android="http://schemas.android.com/apk/res/android"
  android:layout_width="fill_parent"
  android:layout_height="fill_parent"
  android:orientation="vertical">
</p>

<p>
<code>   </code><TextView android:id="@+id/personaj_nume"
         android:layout_width="fill_parent"
         android:layout_height="wrap_content"
         android:textStyle="bold"/><br/>

<br/>

<code>   </code><TextView android:id="@+id/personaj_desen"
         android:layout_width="fill_parent"
         android:layout_height="wrap_content"/>
</p>

<p>
</LinearLayout></code> Urmeaza sa realizam fisierul cu codul sursa. Acesta va contine o clasa ce extinde  si clasa activitatii (). <code java>class Personaj {
</p>

<p>
<code>   public String nume;</code><br/>

<code>   public String desen;</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public String toString ()</code><br/>

<code>   {</code><br/>

<code>       // acesta functie este apelata de catre ArrayAdapter pentru a transforma obiectul intr-un String ce</code><br/>

<code>       // sa fie afisat in lista</code><br/>

<code>       return nume+&quot; din desenul animat &quot;+desen;</code><br/>

<code>   } </code>
</p>

<p>
}
</p>

<p>
class PersonajeAdapter extends BaseAdapter {
</p>

<p>
<code>   private Activity context;</code><br/>

<code>   ArrayList</code><Personaj><code> personaje;</code><br/>

<br/>

<code>   public PersonajeAdapter (Activity _context)</code><br/>

<code>   {</code><br/>

<code>       this.context = _context;</code><br/>

<code>       personaje = new ArrayList</code><Personaj><code>();</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public View getView (int position, View convertView, ViewGroup list) </code><br/>

<code>   {</code><br/>

<code>       // functia trebuie sa intoarca view-ul de pe pozitia position din lista</code><br/>

<code>       // convertView este un element din lista ce nu mai este vizibil si poate fi convertit</code><br/>

<code>       View element;</code><br/>

<code>       LayoutInflater inflater = context.getLayoutInflater();</code><br/>

<code>       element = inflater.inflate(R.layout.personaj, null);</code><br/>

<br/>

<code>       TextView nume = (TextView)element.findViewById(R.id.personaj_nume);</code><br/>

<code>       TextView desen = (TextView)element.findViewById(R.id.personaj_desen);</code><br/>

<br/>

<code>       nume.setText(personaje.get(position).nume);</code><br/>

<code>       desen.setText(personaje.get(position).desen);</code><br/>

<br/>

<code>       return element;</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>       public int getCount ()</code><br/>

<code>       {</code><br/>

<code>       // intoarce nr de elemente din lista</code><br/>

<code>               return personaje.size ();</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public Object getItem(int position) </code><br/>

<code>   {</code><br/>

<code>       // intoarce elementul de pe pozitia position din model</code><br/>

<code>       return personaje.get(position);</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public long getItemId(int position) </code><br/>

<code>   {</code><br/>

<code>       // fiecare element din lista poate avea un id, nu este insa obligatoriu</code><br/>

<code>       return 0;</code><br/>

<code>   }</code><br/>

<br/>

<code>       public void adaugaFunnyGuy (String nume, String desen)</code><br/>

<code>       {</code><br/>

<code>             Personaj p = new Personaj ();</code><br/>

<code>             p.nume = nume;</code><br/>

<code>             p.desen = desen;</code><br/>

<code>             personaje.add (p);</code><br/>

<code>             // acesta functie determina adaptorul sa ceara listei sa reafiseze continutul</code><br/>

<code>             this.notifyDataSetChanged();</code><br/>

<code>       }</code>
</p>

<p>
}
</p>

<p>
public class ListaDeseneAnimate extends ListActivity {
</p>

<p>
<code>   // ArrayList</code><Personaj><code> personaje; -&gt; mutat in PersonajeAdapter</code><br/>

<code>   PersonajeAdapter adapter;</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public void onCreate (Bundle savedInstanceBundle)</code><br/>

<code>   {</code><br/>

<code>       super.onCreate (savedInstanceBundle);</code><br/>

<code>       // personaje = new ArrayList</code><Personaj><code>(); -&gt; mutat in Personaje Adapter</code><br/>

<code>       adapter = new PersonajeAdapter (this);</code><br/>

<code>       setContentView (R.layout.main);</code><br/>

<code>       setListAdapter (adapter);</code><br/>

<br/>

<code>       // adaugam cateva personaje in lista</code><br/>

<code>       adapter.adaugaFunnyGuy(&quot;Bugs Bunny&quot;, &quot;Looney Toons&quot;);</code><br/>

<code>       adapter.adaugaFunnyGuy(&quot;Fred Flinstone&quot;, &quot;The Flinstones&quot;);</code><br/>

<code>       adapter.adaugaFunnyGuy(&quot;Betty Rubble&quot;, &quot;The Flinstones&quot;);</code><br/>

<br/>

<code>       // pentru a seta actiunea click lung</code><br/>

<code>       getListView().setOnItemLongClickListener(new OnItemLongClickListener() </code><br/>

<code>       {</code><br/>

<br/>

<code>           public boolean onItemLongClick(AdapterView&lt;?&gt; listAdapter, View view,</code><br/>

<code>                   int position, long id) </code><br/>

<code>           {</code><br/>

<code>                               Personaj p = (Personaj)adapter.getItem (position);</code><br/>

<code>                               Toast.makeText(this, &quot;click lung pe &quot;+p.nume, Toast.LENGTH_LONG).show();</code><br/>

<code>               return true;</code><br/>

<code>           }</code><br/>

<code>       });</code><br/>

<code>   }</code><br/>

<br/>

<code>   @Override</code><br/>

<code>   public void onListItemClick (ListView list, View v, int position, long id)</code><br/>

<code>   {</code><br/>

<code>       // afisam numele personajului pe care s-a dat click folosind un Toast</code><br/>

<code>       Personaj p = (Personaj)adapter.getItem (position);</code><br/>

<code>       Toast.makeText(this, p.nume, Toast.LENGTH_LONG).show();</code><br/>

<code>   }</code>
</p>

<p>
}</code> Sunt importante urmatoarele observatii:
</p>
<ul>
<li class="level1"><div class="li"> modelul () a fost mutat in adaptor. Acesta este de fapt legatura intre lista si date, deci el este cel care trebuie sa cunoasca datele, si nu fereastra</div>
</li>
<li class="level1"><div class="li"> implementarea functiei  nu este eficienta, nu este folosit parametrul .</div>
</li>
<li class="level1"><div class="li"> setarea actiunii pentru click-ul lung se face direct pe lista, nu exista o functie in  ce sa poata fi suprascrisa</div>
</li>
</ul>

<p>
Implementarea eficienta presupune folosirea parametrului . Acesta este fie , caz in care trebuie ignorat, fie un obiect intors aterior de catre , insa obiect care nu mai este vizibil. Ideea este ca, in loc de a crea un nou View de fiecare data, sa se refoloseasca View-urile create anterior si care nu mai sunt vizibile. <code java>@Override
</p>

<p>
<code>   public View getView (int position, View convertView, ViewGroup list) </code><br/>

<code>   {</code><br/>

<code>       // functia trebuie sa intoarca view-ul de pe pozitia position din lista</code><br/>

<code>       // convertView este un element din lista ce nu mai este vizibil si poate fi convertit</code><br/>

<code>       View element;</code><br/>

<code>               if (convertView == null)</code><br/>

<code>               {</code><br/>

<code>                LayoutInflater inflater = context.getLayoutInflater();</code><br/>

<code>                element = inflater.inflate(R.layout.personaj, null);</code><br/>

<code>               }</code><br/>

<code>               else element = convertView;</code><br/>

<br/>

<code>       TextView nume = (TextView)element.findViewById(R.id.personaj_nume);</code><br/>

<code>       TextView desen = (TextView)element.findViewById(R.id.personaj_desen);</code><br/>

<br/>

<code>       nume.setText(personaje.get(position).nume);</code><br/>

<code>       desen.setText(personaje.get(position).desen);</code><br/>

<br/>

<code>       return element;</code><br/>

<code>   }</code></code>
</p>

</div>
<!-- EDIT7 SECTION "BaseAdapter" [5975-15977] -->
<h3 class="sectionedit8" id="exercitii1">Exercitii</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Realizati o lista mai complexa pentru afisarea personajelor din desene animate. Pe fereastra veti avea posibilitatea de a introduce un nou personaj. Nu folositi parametrul ! Fiecare personaj contine:</div>
<ul>
<li class="level2"><div class="li"> Nume</div>
</li>
<li class="level2"><div class="li"> Desenul animat din care face parte</div>
</li>
<li class="level2"><div class="li"> O poza (poza va fi aleasa in functie de butonul de adaugare apasat)</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Modificati problema precedenta, folosind , insa setati valorile View-urilor doar la creare. (In alte cuvinte, daca , pur si simplu il intoarceti, fara sa il modificati.) Observati ce se intampla.</div>
</li>
<li class="level1"><div class="li"> Modificati problema precedenta, folosind corespunzator .</div>
</li>
<li class="level1"><div class="li"> Optimizati lista de la exercitiul precedent, folosind tag-ul View-urilor.</div>
</li>
</ol>

</div>
<!-- EDIT8 SECTION "Exercitii" [15978-] --></div>
</body>
</html>
