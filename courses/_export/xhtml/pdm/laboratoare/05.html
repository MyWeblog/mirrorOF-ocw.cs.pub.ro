    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>pdm:laboratoare:05</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-03-22T12:22:23+0200"/>
<meta name="keywords" content="pdm,laboratoare,05"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=pdm:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="05.html"/>
<link rel="canonical" href="../../../../pdm/laboratoare/05.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='pdm:laboratoare';var JSINFO = {"id":"pdm:laboratoare:05","namespace":"pdm:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="05.html#laborator_5_-_intentii">Laborator 5 - Intenții</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="05.html#intentii">Intenții</a></div></li>
<li class="level2"><div class="li"><a href="05.html#controlul_fluxului_de_activitati_prin_intentii">Controlul fluxului de activități prin intenții</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="05.html#intentii_construite_prin_precizarea_clasei_incarcate">Intenții construite prin precizarea clasei încărcate</a></div></li>
<li class="level3"><div class="li"><a href="05.html#intentii_construite_prin_precizarea_actiunii">Intenții construite prin precizarea acțiunii</a></div></li>
<li class="level3"><div class="li"><a href="05.html#intentii_construite_prin_intermediul_unui_uri">Intenții construite prin intermediul unui URI</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="05.html#transmiterea_de_informatii_intre_componente_prin_intermediul_intentiilor">Transmiterea de informații între componente prin intermediul intențiilor</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="05.html#gestiunea_evenimentelor_cu_difuzare_prin_intermediul_intentiilor">Gestiunea evenimentelor cu difuzare prin intermediul intențiilor</a></div></li>
<li class="level3"><div class="li"><a href="05.html#trimiterea_unei_intentii_cu_difuzare">Trimiterea unei intenții cu difuzare</a></div></li>
<li class="level3"><div class="li"><a href="05.html#primirea_unui_intentii_cu_difuzare">Primirea unui intenții cu difuzare</a></div></li>
<li class="level3"><div class="li"><a href="05.html#gestiunea_intentiilor_cu_difuzare_native">Gestiunea intențiilor cu difuzare native</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="05.html#exercitii">Exerciții</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_5_-_intentii">Laborator 5 - Intenții</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 5 - Intenții" [1-39] -->
<h2 class="sectionedit2" id="intentii">Intenții</h2>
<div class="level2">

<p>
Conceptul de intenție în Android este destul de complex (și unic), putând fi definit ca o acțiune având asociată o serie de informații, transmisă sistemului de operare Android pentru a fi executată sub forma unui mesaj asincron. În acest fel, intenția asigură interacțiunea între toate aplicațiile instalate pe dispozitivul mobil, chiar dacă fiecare în parte are o existență autonomă. Din această perspectivă, sistemul de operare Android poate fi privit ca o colecție de componente funcționale, independente și interconectate.
</p>

<p>
De regulă, o intenție poate fi utilizată pentru:
</p>
<ul>
<li class="level1"><div class="li"> a invoca activități din cadrul aceleiași aplicații Android;</div>
</li>
<li class="level1"><div class="li"> a invoca alte activități, existente în contextul altor aplicații Android;</div>
</li>
<li class="level1"><div class="li"> a transmite mesaje cu difuzare (<em>eng.</em> broadcast messages), care sunt propagate la nivelul întregului sistem de operare Android și pe care unele aplicații Android le pot prelucra, prin definirea unor clase ascultător specifice; un astfel de comportament este util pentru a implementa aplicații bazate pe evenimente.</div>
</li>
</ul>

<p>
O intenție reprezintă o instanță a clasei <code>android.content.Intent</code>. Aceasta este transmisă ca parametru unor metode (de tipul <code>startActivity()</code> sau <code>startService()</code>, definite în clasa abstractă <code>android.content.Context</code>), pentru a invoca anumite componente (activități sau servicii). Un astfel de obiect poate încapsula anumite date (împachetate sub forma unui <code>android.os.Bundle</code>), care pot fi utilizate de componenta ce se dorește a fi executată prin intermediul intenției.
</p>

<p>
În programarea Android, un principiu de bază este de folosi intenții pentru a propaga acțiuni, chiar și în cadrul aceleiași aplicații, în detrimentul încărcării clasei corespunzătoare. În acest fel, se asigură cuplarea slabă a componentelor, oferind flexibilitate în cazul înlocuirii acestora, permițând totodată extinderea funcționalității cu ușurință.
</p>

</div>
<!-- EDIT2 SECTION "Intenții" [40-2029] -->
<h2 class="sectionedit3" id="controlul_fluxului_de_activitati_prin_intentii">Controlul fluxului de activități prin intenții</h2>
<div class="level2">

</div>
<!-- EDIT3 SECTION "Controlul fluxului de activități prin intenții" [2030-2092] -->
<h3 class="sectionedit4" id="intentii_construite_prin_precizarea_clasei_incarcate">Intenții construite prin precizarea clasei încărcate</h3>
<div class="level3">

<p>
În fișierul <code>AndroidManifest.xml</code>, orice activitate definește în cadrul elementului <code>&lt;intent-filter&gt;</code>, denumirea unei acțiuni care va putea fi folosită de o intenție pentru a o invoca.
</p>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;activity</span></span>
<span class="sc3">  <span class="re0">android:name</span>=<span class="st0">&quot;org.rosedu.dandroid.lab05.MainActivity&quot;</span></span>
<span class="sc3">  <span class="re0">android:label</span>=<span class="st0">&quot;@string/app_name&quot;</span> <span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;intent-filter<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">android:name</span>=<span class="st0">&quot;org.rosedu.dandroid.lab05.intent.action.MainActivity&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;category</span> <span class="re0">android:name</span>=<span class="st0">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/intent-filter<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/activity<span class="re2">&gt;</span></span></span></pre>

<p>
<p><div class="noteimportant">Pentru ca o activitate să poată fi invocată, aceasta trebuie să specifice la elementul <code>category</code> din <code>&lt;intent-filter&gt;</code> valoarea <code>android.intent.category.DEFAULT</code>.
</div></p>
</p>

<p>
Pentru ca o funcționalitatea expusă de o activitate să poată fi invocată (în mod anonim) și din contextul altor componente ale sistemului de operare Android, pentru tipul de acțiune și pentru tipurile de date precizate, în cadrul secțiunii <code>&lt;intent-filter&gt;</code> trebuie precizat atributul <code>android:label</code> (șir de caractere care conține o descriere a funcționalității implementate), indicându-se ca tip de categorie valorile <code>ALTERNATIVE</code>, <code>SELECTED_ALTERNATIVE</code> sau ambele.
</p>

<p>
O activitate este în principiu invocată de o intenție care poate fi identificată prin apelul metodei <code>getIntent()</code>. Rezultatul acestei metode poate fi inclusiv <code>null</code>, în cazul în care activitatea nu a fost pornită prin intermediul unei intenții.
</p>

<p>
Prin intermediul unei intenții, o aplicație poate invoca atât o activitate din cadrul său, cât și o activitate aparținând altei aplicații.
</p>
<ul>
<li class="level1"><div class="li"> în situația în care se apelează o activitate din cadrul aceleiași aplicații, se poate folosi folosi metoda <pre class="code java">startActivity<span class="br0">&#40;</span><span class="kw1">new</span> Intent<span class="br0">&#40;</span><span class="kw1">this</span>, AnotherActivity.<span class="kw1">class</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> dacă se dorește rularea unei activități existente în cadrul altei aplicații, aceasta va trebui referită prin numele său complet, inclusiv denumirea pachetului care o identifică  <pre class="code java">startActivity<span class="br0">&#40;</span><span class="kw1">new</span> Intent<span class="br0">&#40;</span><span class="st0">&quot;org.rosedu.dandroid.lab05.AnotherActivity&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
</ul>

<p>
De remarcat faptul că în situația în care este pornită o activitate din cadrul aceleiași aplicații Android, obiectul de tip <code>Intent</code> primește ca parametru și contextul curent (<code>this</code>), în timp ce în cazul în care este lansată în execuție o activitate din cadrul altei aplicații Android acest parametru este omis.
</p>

<p>
În momentul în care este invocată metoda <code>startActivity()</code>, activitatea respectivă este lansată în execuție (prin apelul metodelor <code>onCreate()</code>, <code>onStart()</code>, <code>onResume()</code>) și plasată în vârful stivei care conține toate componentele care au rulate anterior, fără a fi fost terminate. În momentul în care se apelează metoda <code>finish()</code> (sau se apasă butonul <em>Back</em>), activitatea este încheiată (prin apelul metodelor <code>onPause()</code>, <code>onStop()</code>, <code>onDestroy()</code>), fiind scoasă din stivă, restaurându-se activitatea anterioară.
</p>

</div>
<!-- EDIT4 SECTION "Intenții construite prin precizarea clasei încărcate" [2093-5150] -->
<h3 class="sectionedit5" id="intentii_construite_prin_precizarea_actiunii">Intenții construite prin precizarea acțiunii</h3>
<div class="level3">

<p>
O intenție poate fi definită și prin intermediul unei acțiuni care se dorește a fi realizată, pentru care pot fi atașate opțional și anumite date. Utilizatorul care folosește un astfel de mecanism nu cunoaște activitatea (sau aplicația Android) care va fi lansată în execuție pentru realizarea acțiunii respective. Pentru a putea îndeplini o astfel de solicitare, sistemul de operare Android trebuie să identifice, la momentul rulării, activitatea care este cea mai adecvată pentru a rezolva acțiunea dorită. În acest fel, pot fi utilizate funcționalități deja implementate în cadrul sistemului de operare Android, fără a cunoaște în prealabil aplicația responsabilă de aceasta.
</p>

<p>
<p><div class="noteclassic">În cazul în care există mai multe activități care au specificat la elementul <code>action</code> din <code>intent-category</code> aceeași valoare care este transmisă ca parametru constructorului clasei <code>Intent</code>, la execuția intenției în cauză utilizatorului i se va prezenta o listă de opțiuni dintre care poate alege. Dacă la realizarea selecției va fi precizată și opțiunea <code>Use by default for this action</code>, preferințele vor fi salvate astfel încât în continuare vor fi utilizate fără a se mai solicita intervenția utilizatorului în acest sens.
</div></p>
</p>

<p>
Procesul de rezolvare a unei intenții (<em>eng.</em> intent resolution) se face prin intermediul analizei tuturor ascultătorilor înregistrați pentru a procesa mesaje cu difuzare (<em>eng.</em> broascast receivers).
</p>

<p>
Cele mai frecvent utilizate acțiuni implicite ale unui obiect de tip <code>Intent</code> sunt:
</p>
<ul>
<li class="level1"><div class="li"> vizualizarea conținutului specificat în secțiunea <code>data</code> asociată intenției, sub forma unui <abbr title="Uniform Resource Identifier">URI</abbr>, de către aplicații Android diferite, în funcție de schema (protocolul) utilizat (<code>http</code> - navigator, <code>tel</code> - aplicația pentru formarea unui număr de telefon, <code>geo</code> - Google Maps, <code>content</code> - aplicația pentru gestiunea contactelor din agenda telefonică): <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_VIEW</span><span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">setData</span><span class="br0">&#40;</span>Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;http://android.rosedu.org&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> căutarea unor informații pe Internet folosind un motor de căutare, termenul căutat fiind indicat în secțiunea <code>extra</code> asociată intenției, fiind identificată prin cheia <code>SearchManager.QUERY</code>: <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_WEB_SEARCH</span><span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">setData</span><span class="br0">&#40;</span>Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;http://www.google.ro&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> invocarea aplicației Android pentru formarea unui număr de telefon (interfața grafică a aplicației Android poate fi populată deja cu numărul de telefon furnizat în secțiunea de date a intenției asociate, în cadrul unui <abbr title="Uniform Resource Identifier">URI</abbr>); aplicația Android nativă poate normaliza majoritatea schemelor de numere de telefon (cod de țară, prefix, număr de telefon propriu-zis): <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_DIAL</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> invocarea aplicației pentru formarea unui număr de telefon și realizarea propriu-zisă a apelului telefonic, folosind valoarea furnizată în secțiunea de date a intenției asociate (în cadrul unui <abbr title="Uniform Resource Identifier">URI</abbr>); se recomandă să fie folosită pentru activitățile care înlocuiesc aplicația Android nativă pentru formarea unui număr de telefon: <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_CALL</span><span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">setData</span><span class="br0">&#40;</span>Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;tel:0214029466&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
</ul>

<p>
<p><div class="noteimportant">Pentru a fi posibil ca aplicația să realizeze un apel telefonic, în fișierul <code>AndroidManifest.xml</code> trebuie specificată explicit permisiunea pentru o astfel de acțiune<br/>
<code>&lt;uses-permission android:name=“android.permission.CALL_PHONE”&gt;</code>. 
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> vizualizarea unei locații pe hartă pentru care s-au specificat coordonatele GPS <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_VIEW</span><span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">setData</span><span class="br0">&#40;</span>Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;geo:44.436877,26.048029?z=100&amp;q=Education&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> selectarea unei valori din cadrul furnizorului de conținut indicat în cadrul secțiunii de date asociate intenției, sub forma unui <abbr title="Uniform Resource Identifier">URI</abbr>; de regulă, este lansată în execuție ca subacvititate, fiind necesar să furnizeze un <abbr title="Uniform Resource Identifier">URI</abbr> către valoarea care a fost accesată, atunci când este terminată <pre class="code java">Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_PICK</span><span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">setData</span><span class="br0">&#40;</span>Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;content://contacts/people&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
</ul>

<p>
Alte acțiuni implicite utilizate sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>ACTION_ALL_APPS</code> - lansează în execuție o activitate care afișează toate aplicațiile Android instalate pe dispozitivul mobil; implicit, această acțiune este tratată de aplicația nativă care listează aplicațiile Android în meniul de aplicații din care pot fi rulate de utilizator prin accesarea pictogramei asociate;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_ANSWER</code> - lansează în execuție o activitate care gestionează apelurile primite;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_BUG_REPORT</code> - lansează în execuție o activitate prin intermediul căruia poate fi raportată funcționarea anormală a unei aplicații Android;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_CALL_BUTTON</code> - lansează în execuție o activitate responsabilă cu formarea numărului de telefon; de regulă, o astfel de acțiune este generată în momentul în care utilizatorul accesează un buton dedicat;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_DELETE</code> - lansează în execuție o activitate care permite ștergerea informațiilor specificate în secțiunea <code>data</code> asociată intenției, sub forma unui <abbr title="Uniform Resource Identifier">URI</abbr>;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_EDIT</code> - lansează în execuție o activitate care permite modificarea informațiilor specificate în secțiunea <code>data</code> asociată intenției, sub forma unui <abbr title="Uniform Resource Identifier">URI</abbr>;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_INSERT</code> - lansează în execuție o activitate care permite adăugarea unor informații în cursorul specificat în secțiunea de secțiunea <code>data</code> asociată intenției, sub forma unui <abbr title="Uniform Resource Identifier">URI</abbr> (în cazul în care este rulată ca subactivitate, trebuie să furnizeze <abbr title="Uniform Resource Identifier">URI</abbr>-ul informațiilor adăugate);</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_SEARCH</code> - lansează în execuție o activitate care implementează o activitate de căutare; termenul care este căutat trebuie să fie specificat în secțiunea <code>extra</code> a activității, fiind identificat prin cheia <code>SearchManager.QUERY</code>;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_SEARCH_LONG_PRESS</code>  - lansează în execuție o activitate care implementează o activitate de căutare, fiind generată în momentul în care este detectat un eveniment de tip apăsare prelungită a unui buton dedicat (implicit, lansează în execuție o activitate pentru a realiza o căutare vocală);</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_SENDTO</code> - lansează în execuție o activitate pentru a transmite anumite informații către un contact indicat în secțiunea <code>data</code> asociată intenției;</div>
</li>
<li class="level1"><div class="li"> <code>ACTION_SEND</code> - lansează în execuție o activitate care transmite informațiile conținute în cadrul intenției către un contact care va fi selectat ulterior (aflat pe un alt dispozitiv mobil):</div>
<ul>
<li class="level2"><div class="li"> tipul MIME trebuie indicat prin intermediul metodei <code>setType()</code>;</div>
</li>
<li class="level2"><div class="li"> informațiile propriu-zise trebnuie conținute în secțiunea <code>extra</code> asociată intenției, fiind identificate prin cheile <code>EXTRA_TEXT</code> sau <code>EXTRA_STREAM</code>, în funcție de tipul respectiv (pentru aplicațiile de poștă electronică sunt suportate și cheile <code>EXTRA_EMAIL</code>, <code>EXTRA_CC</code>, <code>EXTRA_BCC</code>, <code>EXTRA_SUBJECT</code>).</div>
</li>
</ul>
</li>
</ul>

<p>
Totuși, un utilizator nu poate avea garanția că acțiunea pe care o transmite ca parametru al unei intenții va putea fi rezolvată, întrucât există posibilitatea să nu existe nici o activitate asociată acesteia sau ca aplicația ce ar fi putut să o execute să nu fie instalată în contextul sistemului de operare Android. Din acest motiv, o practică curentă este de a verifica dacă o acțiune poate fi rezolvată <strong>înainte</strong> de a apela metoda <code>startActivity()</code>. Astfel, procesul de gestiune a pachetelor poate fi interogat (prin intermediul metodei <code>resolveActivity()</code>) dacă există o activitate ce poate executa o acțiune și în caz afirmativ, care este aceasta.
</p>
<pre class="code java">Intent applicationIntent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>...<span class="br0">&#41;</span><span class="sy0">;</span>
PackageManager packageManager <span class="sy0">=</span> <span class="kw1">new</span> PackageManager<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
ComponentName componentName <span class="sy0">=</span> applicationIntent .<span class="me1">resolveActivity</span><span class="br0">&#40;</span>packageManager<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">&#40;</span>componentName <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Intent marketIntent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_VIEW</span>, Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;market://search?q=pname:...&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>marketIntent.<span class="me1">resolveActivity</span><span class="br0">&#40;</span>packageManager<span class="br0">&#41;</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    startActivity<span class="br0">&#40;</span>marketIntent<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
    Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>getApplicationContext<span class="br0">&#40;</span><span class="br0">&#41;</span>, <span class="st0">&quot;Google Play Store is not available&quot;</span>, Toast.<span class="me1">LENGTH_LONG</span><span class="br0">&#41;</span>.<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
  startActivity<span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
În situația în care nu este identificată nici o activitate asociată acțiunii respective, utilizatorul poate dezactiva componenta grafică asociată până în momentul în care aceasta devine disponibilă, prin descărcarea aplicației Android corespunzătoare din Google Play Store.
</p>

<p>
Prin intermediul clasei <code>PackageManager</code> poate fi obținută lista tuturor acțiunilor care pot fi realizate pentru un set de date, atașat unei intenții, invocându-se metoda <code>queryIntentActivities()</code>.
</p>

<p>
Procesul de rezolvare a unei intenții pe baza unei acțiuni implică următoarele etape:
</p>
<ol>
<li class="level1"><div class="li"> se construiește o listă cu toate filtrele de intenții asociate componentelor din aplicațiile Android existente;</div>
</li>
<li class="level1"><div class="li"> sunt eliminate toate filtrele de intenții care nu corespund acțiunii sau categoriei intenției care se dorește a fi rezolvată:</div>
<ol>
<li class="level2"><div class="li"> verificările în privința acțiunii sunt realizate numai în situația în care filtrul de intenție specifică o acțiune; sunt eliminate acele filtre de intenții pentru care <strong>nici una</strong> dintre acțiunile pe care le include nu corespund acțiunii intenției care se dorește a fi rezolvată;</div>
</li>
<li class="level2"><div class="li"> verificările în privința categorie sunt realizate numai în situația în care filtrul de intenție specifică o categorie sau în cazul în care nu specifică nici o categorie, dacă nici intenția care se dorește a fi rezolvată nu include nici o categorie; sunt eliminate acele filtre de intenții care nu includ <strong>toate</strong> categoriile pe care le conține și intenția care se dorește a fi rezolvată (putând conține totuși și categorii suplimentare);</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> fiecare parte a <abbr title="Uniform Resource Identifier">URI</abbr>-ului datelor corespunzătoare intenției care se dorește a fi rezolvată este comparată cu secțiunea <code>data</code> din filtrul de intenție; gazda, autoritatea, tipul MIME, calea, portul, schema), orice neconcordanță conducând la eliminarea acestuia din listă (în situația în care filtrul de intenții nu specifică proprietăți în secțiunea <code>data</code>, acesta va fi considerat compatibil cu intenția care se dorește a fi rezolvată;</div>
</li>
<li class="level1"><div class="li"> în situația în care, ca urmare a acestui proces, există mai multe componente rămase în listă, utilizatorul va trebui să aleagă dintre toate aceste posibilități.</div>
</li>
</ol>

<p>
<p><div class="noteclassic">Aplicațiile Android native sunt supuse aceluiași proces în momentul în care se realizează rezolvarea unei intenții ca și aplicațiile Android instalate din alte surse, având aceeiași prioritate și putând fi chiar înlocuite de acestea, dacă definesc filtre de intenții cu aceleași acțiuni / categorii.
</div></p>
</p>

<p>
În cazul în care o componentă a unei activități este lansată în execuție prin intermediul unei intenții, aceasta trebuie să identifice acțiunea pe care trebuie să o realizeze și datele pe care trebuie sp le proceseze. În acest sens, clasa <code>Intent</code> pune la dispoziție metodele <code>getAction()</code>, <code>getData()</code> și <code>getExtras()</code>.
</p>
<pre class="code java">@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onCreate<span class="br0">&#40;</span>Bundle state<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onCreate</span><span class="br0">&#40;</span>state<span class="br0">&#41;</span><span class="sy0">;</span>
  setContentView<span class="br0">&#40;</span>R.<span class="me1">layout</span>.<span class="me1">activity_main</span><span class="br0">&#41;</span><span class="sy0">;</span>
  Intent intent <span class="sy0">=</span> getIntent<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>intent <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> action <span class="sy0">=</span> intent.<span class="me1">getAction</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    Uri data <span class="sy0">=</span> intent.<span class="me1">getData</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    Bundle extras <span class="sy0">=</span> intent.<span class="me1">getExtras</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="notetip">În anumite situații, o componentă poate primi și alte intenții după ce a fost creată. De fiecare dată, va fi apelată în mod automat metoda <code>onNewIntent()</code>: 
</p>
<pre class="code java">@Override
<span class="kw1">public</span> <span class="kw4">void</span> onNewIntent<span class="br0">&#40;</span>Intent newIntent<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onNewIntent</span><span class="br0">&#40;</span>newIntent<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>

<p>

</div></p>
</p>

<p>
<p><div class="notetip">O componentă are de asemenea posibilitatea de a transfera responsabilitatea cu privire la gestiunea unei intenții către altă componentă care corespunde criteriilor legate de acțiune și categorie, prin intermediul metodei <code>startNextMatchingActivity()</code>: 
</p>
<pre class="code java">Intent intent <span class="sy0">=</span> getIntent<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">&#40;</span>intent <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  startNextMatchingActivity<span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
În acest mod, o componentă poate indica condiții suplimentare cu privire la tratarea unei anumite acțiuni, în situația în care acestea nu pot fi exprimate în cadrul filtrului de intenții, pentru a putea fi luate în considerare în cadrul procesului automat de identificare a componentei care deservește o intenție.

</div></p>
</p>

</div>
<!-- EDIT5 SECTION "Intenții construite prin precizarea acțiunii" [5151-17902] -->
<h3 class="sectionedit6" id="intentii_construite_prin_intermediul_unui_uri">Intenții construite prin intermediul unui URI</h3>
<div class="level3">

<p>
De asemenea, un obiect de tip <code>Intent</code> poate fi creat și prin intermediul unui <abbr title="Uniform Resource Identifier">URI</abbr> care identifică în mod unic o anumită activitate:
</p>
<pre class="code java">Uri uri <span class="sy0">=</span> Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;myprotocol://mynamespace/myactivity&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_VIEW</span>, uri<span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">putExtra</span><span class="br0">&#40;</span><span class="st0">&quot;someKey&quot;</span>, someValue<span class="br0">&#41;</span><span class="sy0">;</span>
startActivity<span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Pentru a putea fi apelată folosind acest mecanism, activitatea va trebui să definească elementul <code>data</code> în cadrul <code>&lt;intent-filter&gt;</code>:
</p>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;activity</span></span>
<span class="sc3">  <span class="re0">android:name</span>=<span class="st0">&quot;org.rosedu.dandroid.lab05.AnotherActivity&quot;</span></span>
<span class="sc3">  <span class="re0">android:label</span>=<span class="st0">&quot;@string/app_name&quot;</span> <span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;intent-filter<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">android:name</span>=<span class="st0">&quot;org.rosedu.dandroid.lab05.intent.action.AnotherActivity&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;category</span> <span class="re0">android:name</span>=<span class="st0">&quot;android.intent.category.DEFAULT&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;data</span></span>
<span class="sc3">      <span class="re0">android:scheme</span>=<span class="st0">&quot;myprotocol&quot;</span></span>
<span class="sc3">      <span class="re0">android:host</span>=<span class="st0">&quot;mynamespace&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/intent-filter<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/activity<span class="re2">&gt;</span></span></span></pre>

<p>
De remarcat este faptul că în structura <abbr title="Uniform Resource Identifier">URI</abbr>-ului, partea de după <code>schemă://protocol/</code> poate conține orice șir de caractere, rolul său fiind strict acela de a respecta forma unui astfel de obiect (estetic), fără a influența în vreo formă funcționalitatea acestuia. 
</p>

</div>
<!-- EDIT6 SECTION "Intenții construite prin intermediul unui URI" [17903-19128] -->
<h2 class="sectionedit7" id="transmiterea_de_informatii_intre_componente_prin_intermediul_intentiilor">Transmiterea de informații între componente prin intermediul intențiilor</h2>
<div class="level2">

<p>
Intențiile pot încapsula anumite informații care pot fi partajate de componentele între care fac legătura (însă unidirecțional, de la componenta care invocă spre componenta invocată!) prin intermediul secțiunii <code>extra</code> care conține un obiect de tip <code>Bundle</code>. Obținerea valorii secțiunii <code>extra</code> corespunzătoare unei intenții poate fi obținute folosind metoda <code>getExtras()</code>, în timp ce specificarea unor informații care vor fi asociate unei intenții poate fi realizată printr-un apel al metodei <code>putExtras()</code>.
</p>

<p>
<p><div class="noteclassic">În cazul în care o intenție are deja atașat un obiect de tip <code>Bundle</code> în momentul în care se apelează metoda <code>putExtras()</code>, perechile (cheie, valoare) vor fi transferate din cadrul parametrului metodei în obiectul deja existent.
</div></p>
</p>

<p>
Construirea unui obiect de tip <code>Bundle</code> care să fie transmis ca parametru al metodei <code>putExtras()</code> poate fi evitată prin utilizarea metodei <code>putExtra()</code> apelată pe obiectul <code>Intent</code>, primind ca parametrii denumirea cheii prin care datele vor fi identificate și o valoare având un tip compatibil cu <code>android.os.Parcelable</code>. Obținerea datelor se realizează apelând metoda pereche <code>getExtra()</code> căreia i se transmite denumirea cheii ce identifică în mod unic informațiile respective. De asemenea, sunt implementate și metode specifice pentru fiecare tip de dată (<code>put&lt;type&gt;Extra()</code>, respectiv <code>get&lt;type&gt;Extra()</code>).
</p>

<p>
<p><div class="notetip">Se recomandă ca pentru cheie să se utilizeze o denumire prefixată de pachetul aplicației.
</div></p>
</p>

<p>
O activitate copil, lansată în execuție prin intermediul metodei <code>startActivity()</code>, este independentă de activitatea părinte, astfel încât aceasta nu va fi notificată cu privire la terminarea sa. În situațiile în care un astfel de comportament este necesar, activitatea copil va fi pornită de activitatea părinte ca subactivitate care transmite înapoi un rezultat. Acest lucru se realizează prin lansarea în execuție a activității copil prin intermediul metodei <code>startActivityForResult()</code>. În momentul în care este finalizată, va fi invocată automat metoda <code>onActivityResult()</code> de la nivelul activității părinte.
</p>

<p>
La nivelul <strong>activității părinte</strong>, vor trebui implementate:
</p>
<ul>
<li class="level1"><div class="li"> metoda <code>startActivityForResult()</code> va primi ca parametrii obiectul de tip <code>Intent</code> precum și un cod de cerere (de tip întreg), utilizat pentru a identifica în mod unic activitatea copil care a transmis un rezultat;</div>
</li>
<li class="level1"><div class="li"> metoda <code>onActivityResult()</code> care va fi apelată în mod automat în momentul în care activitatea copil a fost terminată; parametrii pe care îi furnizează aceasta sunt:</div>
<ul>
<li class="level2"><div class="li"> codul de cerere (prin care se distinge între instanțe diferite ale activității copil);</div>
</li>
<li class="level2"><div class="li"> codul de rezultat transmis activității părinte (poate avea valorile <code>RESULT_OK</code> sau <code>RESULT_CANCELED</code>);</div>
</li>
<li class="level2"><div class="li"> un obiect <code>Intent</code> prin intermediul căruia pot fi furnizate date suplimentare.</div>
</li>
</ul>
</li>
</ul>
<pre class="code java"><span class="kw1">final</span> <span class="kw1">private</span> <span class="kw1">static</span> <span class="kw4">int</span> ANOTHER_ACTIVITY_REQUEST_CODE <span class="sy0">=</span> <span class="nu0">2015</span><span class="sy0">;</span>
&nbsp;
@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onCreate<span class="br0">&#40;</span>Bundle state<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onCreate</span><span class="br0">&#40;</span>state<span class="br0">&#41;</span><span class="sy0">;</span>
  setContentView<span class="br0">&#40;</span>R.<span class="me1">layout</span>.<span class="me1">activity_main</span><span class="br0">&#41;</span><span class="sy0">;</span>
  Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span><span class="st0">&quot;org.rosedu.dandroid.lab05.AnotherActivity&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  intent.<span class="me1">putExtra</span><span class="br0">&#40;</span><span class="st0">&quot;org.rosedu.dandroid.lab05.someKey&quot;</span>, someValue<span class="br0">&#41;</span><span class="sy0">;</span>
  startActivityForResult<span class="br0">&#40;</span>intent, ANOTHER_ACTIVITY_REQUEST_CODE<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// start another activities with their own request codes</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw4">void</span> onActivityResult<span class="br0">&#40;</span><span class="kw4">int</span> requestCode, <span class="kw4">int</span> resultCode, Intent intent<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">switch</span><span class="br0">&#40;</span>requestCode<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">case</span> ANOTHER_ACTIVITY_REQUEST_CODE<span class="sy0">:</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>resultCode <span class="sy0">==</span> Activity.<span class="me1">RESULT_OK</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Bundle data <span class="sy0">=</span> intent.<span class="me1">getExtras</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="co1">// process information from data ...</span>
      <span class="br0">&#125;</span>
      <span class="kw1">break</span><span class="sy0">;</span>
&nbsp;
      <span class="co1">// process other request codes</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
În <strong>activitatea copil</strong>, înainte de apelul metodei <code>finish()</code>, va trebui transmis activității părinte codul de rezultat (<code>Activity.RESULT_OK</code>, <code>Activity.RESULT_CANCELED</code> sau orice fel de rezultat de tip întreg) și obiectul de tip intenție care conține datele (opțional, în situația în care trebuie întoarse rezultate explicit), ca parametrii ai metodei <code>setResult()</code>.
</p>
<pre class="code java">@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onCreate<span class="br0">&#40;</span>Bundle state<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onCreate</span><span class="br0">&#40;</span>state<span class="br0">&#41;</span><span class="sy0">;</span>
  setContentView<span class="br0">&#40;</span>R.<span class="me1">layout</span>.<span class="me1">activity_another</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="co1">// intent from parent</span>
  Intent intentFromParent <span class="sy0">=</span> getIntent<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  Bundle data <span class="sy0">=</span> intentFromParent.<span class="me1">getExtras</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// process information from data ...</span>
&nbsp;
  <span class="co1">// intent to parent</span>
  Intent intentToParent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  intent.<span class="me1">putExtra</span><span class="br0">&#40;</span><span class="st0">&quot;org.rosedu.dandroid.lab05.anotherKey&quot;</span>, anotherValue<span class="br0">&#41;</span><span class="sy0">;</span>
  setResult<span class="br0">&#40;</span>RESULT_OK, intentToParent<span class="br0">&#41;</span><span class="sy0">;</span>
  finish<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
În cazul folosirii unor intenții în care activitățile sunt invocate prin intermediul unor <abbr title="Uniform Resource Identifier">URI</abbr>-uri, datele vor putea fi concatenate direct în cadrul acestuia (fără a utiliza un obiect de tip <code>Bundle</code>), restricția constând în faptul că pot fi utilizate numai șiruri de caractere:
</p>
<ul>
<li class="level1"><div class="li"> în activitatea părinte <pre class="code java">Uri uri <span class="sy0">=</span> Uri.<span class="me1">parse</span><span class="br0">&#40;</span><span class="st0">&quot;myprotocol://mynamespace/myactivity?someKey=someValue&amp;...&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>Intent.<span class="me1">ACTION_VIEW</span>, uri<span class="br0">&#41;</span><span class="sy0">;</span>
startActivity<span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> în activitatea copil  <pre class="code java">Uri uri <span class="sy0">=</span> getIntent<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getData</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> someValue <span class="sy0">=</span> uri.<span class="me1">getQueryParameter</span><span class="br0">&#40;</span><span class="st0">&quot;someKey&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
</ul>

</div>
<!-- EDIT7 SECTION "Transmiterea de informații între componente prin intermediul intențiilor" [19129-24516] -->
<h3 class="sectionedit8" id="gestiunea_evenimentelor_cu_difuzare_prin_intermediul_intentiilor">Gestiunea evenimentelor cu difuzare prin intermediul intențiilor</h3>
<div class="level3">

<p>
Intențiile reprezintă și un mecanism de comunicație inter-proces, asigurând transferul unor mesaje structurate. Astfel, intențiile pot fi distribuite către toate componentele de la nivelul sistemului de operare Android, pentru a notifica producerea unui eveniment (legat de starea dispozitivului mobil sau a unor aplicații), fiind procesate în cadrul unor obiecte ascultător dedicate tipului de mesaj respectiv.
</p>

<p>
<p><div class="notetip">Și sistemul de operare Android folosește acest mecanism pentru a notifica producerea unor modificări la nivelul stării curente (primirea unui apel telefonic / mesaj, schimbarea nivelului de încărcare al bateriei sau a conectivității).
</div></p>
</p>

<p>
<p><div class="noteclassic">Trebuie realizată distincția între intențiile cu difuzare transmise la nivelul întregului sistem de operare Android și a celor transmise doar la nivelul aplicației, prin intermediul unui obiect de tipul <code>LocalBroadcastManager</code> (a cărui instanță se obține prin intermediul metodei statice <code>getInstance()</code> ce primește ca parametru contextul aplicației curente). Acesta operează într-un mod similar, implementând metodele <code>sendBroadcast()</code> și <code>registerReceiver()</code>. În plus, dispune de o metodă ce permite trimiterea sincronă a notificărilor, apelul acesteia fiind blocant până la momentul în care toți ascultătorii le-au primit.
</div></p>
</p>

<p>
Pentru o aplicație Android, în momentul rulării, pot fi activate / dezactivate oricare dintre componente (deci inclusiv ascultătorii pentru intențiile cu difuzare) prin intermediul metodei <code>setComponentEnabledSetting()</code> din cadrul clasei <code>PackageManager</code>. Un astfel de comportament este util pentru a optimiza performanțele aplicației atunci când o anumită funcționalitate nu este necesară.
</p>
<pre class="code java">PackageManager packageManager <span class="sy0">=</span> getPackageManager<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
ComponentName someEventBroadcastReceiver <span class="sy0">=</span> <span class="kw1">new</span> ComponentName<span class="br0">&#40;</span><span class="kw1">this</span>, SomeEventBroadcastReceiver.<span class="kw1">class</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
packageManager.<span class="me1">setComponentEnabledSetting</span><span class="br0">&#40;</span>someEventBroadcastReceiver ,
  PackageManager.<span class="me1">COMPONENT_ENABLED_STATE_ENABLED</span>,
  PackageManager.<span class="me1">DONT_KILL_APP</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
packageManager.<span class="me1">setComponentEnabledSetting</span><span class="br0">&#40;</span>someEventBroadcastReceiver ,
  PackageManager.<span class="me1">COMPONENT_ENABLED_STATE_DISABLED</span>,
  PackageManager.<span class="me1">DONT_KILL_APP</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT8 SECTION "Gestiunea evenimentelor cu difuzare prin intermediul intențiilor" [24517-26847] -->
<h3 class="sectionedit9" id="trimiterea_unei_intentii_cu_difuzare">Trimiterea unei intenții cu difuzare</h3>
<div class="level3">

<p>
Construirea unei intenții care urmează să fie difuzată la nivelul sistemului de operare Android poate fi realizată prin definirea unui obiect de tipul <code>Intent</code>, pentru care se vor specifica acțiunea, datele și categoria, astfel încât obiectele de tip ascultător să îl poată identifica cât mai exact. Ulterior, acesta va fi trimis tuturor proceselor aferente aplicațiilor instalate pe dispozitivul mobil prin intermediul metodei <code>sendBroadcast()</code>, căreia îi este atașat ca parametru.
</p>

<p>
<p><div class="notetip">Pot fi utilizate atât acțiuni predefinite (care vor fi procesate atât de aplicațiile Android native cât și de eventuale aplicații instalate din alte surse) cât și acțiuni definite de utilizator, pentru care trebuie implementate aplicații dedicate, responsabile cu procesarea acestora.
</div></p>
</p>
<pre class="code java"><span class="kw1">final</span> <span class="kw1">public</span> <span class="kw1">static</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> SOME_ACTION <span class="sy0">=</span> <span class="st0">&quot;org.rosedu.dandroid.lab05.SomeAction.SOME_ACTION&quot;</span><span class="sy0">;</span>
&nbsp;
Intent intent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span>SOME_ACTION<span class="br0">&#41;</span><span class="sy0">;</span>
intent.<span class="me1">putExtra</span><span class="br0">&#40;</span><span class="st0">&quot;org.rosedu.dandroid.lab05.someKey&quot;</span>, someValue<span class="br0">&#41;</span><span class="sy0">;</span>
sendBroadcast<span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT9 SECTION "Trimiterea unei intenții cu difuzare" [26848-27960] -->
<h3 class="sectionedit10" id="primirea_unui_intentii_cu_difuzare">Primirea unui intenții cu difuzare</h3>
<div class="level3">

<p>
Pentru a putea primi o intenție cu difuzare, o componentă trebuie să fie înregistrată în acest sens, definind un filtru de intenții pentru a specifica ce tipuri de acțiuni și ce tipuri de date asociate intenției poate procesa. 
</p>

<p>
Acesta poate fi precizat:
</p>
<ul>
<li class="level1"><div class="li"> în fișierul <code>AndroidManifest.xml</code> (caz în care nu este necesar ca aplicația să ruleze la momentul în care se produce evenimentul cu difuzare pentru a-l putea procesa); elementul <code>&lt;receiver&gt;</code> trebuie să conțină în mod obligatoriu filtrul de intenții prin care se indică acțiunea care poate fi procesată: <dl class="file">
<dt><a href="../../../code/pdm/laboratoare/05%3Fcodeblock=21" title="Download Snippet" class="mediafile mf_xml">AndroidManifest.xml</a></dt>
<dd><pre class="code file xml"><span class="sc3"><span class="re1">&lt;manifest</span> ... <span class="re2">&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;application</span> ... <span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;receiver</span></span>
<span class="sc3">      <span class="re0">android:name</span>=<span class="st0">&quot;.SomeEventBroadcastReceiver&quot;</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;intent-filter<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">android:name</span>=<span class="st0">&quot;org.rosedu.dandroid.lab05.SomeAction.SOME_ACTION&quot;</span> <span class="re2">/&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;/intent-filter<span class="re2">&gt;</span></span></span> 
    <span class="sc3"><span class="re1">&lt;/receiver<span class="re2">&gt;</span></span></span>
  <span class="sc3"><span class="re1">&lt;/application<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/manifest<span class="re2">&gt;</span></span></span></pre>
</dd></dl>
</div>
</li>
<li class="level1"><div class="li"> programatic, în codul sursă (caz în care aplicația trebuie să fie în execuție la momentul în care se produce evenimentul cu difuzare pentru a-l putea procesa); o astfel de abordare este utilă când procesarea intenției cu difuzare implică actualizarea unor componente din cadrul interfeței grafice asociate activității: <pre class="code java"><span class="kw1">private</span> SomeEventBroadcastReceiver someEventBroadcastReceiver <span class="sy0">=</span> <span class="kw1">new</span> SomeEventBroadcastReceiver<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">private</span> IntentFilter intentFilter <span class="sy0">=</span> <span class="kw1">new</span> IntentFilter<span class="br0">&#40;</span>SOME_ACTION<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onResume<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onResume</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  registerReceiver<span class="br0">&#40;</span>someEventBroadcastReceiver, intentFilter<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onPause<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">super</span>.<span class="me1">onPause</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  unregisterReceiver<span class="br0">&#40;</span>someEventBroadcastReceiver<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
</ul>

<p>
<p><div class="notetip">O regulă este de a înregistra obiectul ascultător pe metoda <code>onResume()</code> și de a-l deînregistra pe metoda <code>onPause()</code>, astfel încât acesta să nu reacționeze decât atunci când activitatea este vizibilă.
</div></p>
</p>

<p>
O clasă capabilă să proceseze intenții cu difuzare este derivată din <code>android.content.BroadcastReceiver</code>, implementând metoda <code>onReceive()</code> pe care realizează rutina de tratare propriu-zisă:
</p>
<dl class="file">
<dt><a href="../../../code/pdm/laboratoare/05%3Fcodeblock=23" title="Download Snippet" class="mediafile mf_java">SomeEventBroadcastReceiver.java</a></dt>
<dd><pre class="code file java"><span class="kw1">import</span> <span class="co2">android.content.BroadcastReceiver</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">android.content.Context</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">android.content.Intent</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> SomeEventBroadcastReceiver <span class="kw1">extends</span> BroadcastReceiver <span class="br0">&#123;</span>
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onReceive<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context, Intent intent<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// ...</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
Metoda <code>onReceive()</code> va fi invocată în mod automat în momentul în care este primită o intenție cu difuzare, fiind executată pe firul de execuție principal al aplicației. De regulă, în cadrul acestei metode utilizatorul este anunțat asupra producerii evenimentului prin intermediul serviciului de notificare (<em>Notification Manager</em>), este lansat în execuție un serviciu sau sunt actualizate componente din cadrul interfeței grafice.
</p>

<p>
<p><div class="noteimportant">Este necesar ca metoda <code>onReceive()</code> să se termine în maximum 5 secunde, în caz contrar fiind afișată o fereastră de dialog pentru a determina oprirea sa forțată.
</div></p>
</p>

</div>
<!-- EDIT10 SECTION "Primirea unui intenții cu difuzare" [27961-31076] -->
<h3 class="sectionedit11" id="gestiunea_intentiilor_cu_difuzare_native">Gestiunea intențiilor cu difuzare native</h3>
<div class="level3">

<p>
Cele mai multe servicii de sistem transmit intenții cu difuzare pentru a semnala faptul că s-au produs anumite modificări la nivelul stării dispozitivului mobil sau al aplicațiilor (primirea unui apel telefonic / mesaj, schimbarea nivelului de încărcare al bateriei, conectivitatea la Internet).
</p>
<div class="table sectionedit12"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>ACȚIUNE</strong>  </th><th class="col1 centeralign">  <strong>DESCRIERE</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>ACTION_BATTERY_CHANGED</code> </td><td class="col1"> acțiune transmisă în momentul în care se modifică nivelul de încărcare al bateriei; starea bateriei este disponibilă în secțiunea <code>extra</code>, prin intermediul cheii <code>EXTRA_STATUS</code>, putând avea valorile:<br/>
♦ <code>BatteryManager.BATTERY_STATUS_CHARGING</code><br/>
♦ <code>BatteryManager.BATTERY_STATUS_FULL</code> </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>ACTION_BATTERY_LOW</code> </td><td class="col1"> acțiune transmisă în momentul în care nivelul de încărcare al bateriei este scăzut, impunându-se încărcarea acesteia </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>ACTION_BATTERY_OKAY</code> </td><td class="col1"> acțiune transmisă în momentul în care nivelul de încărcare al bateriei este acceptabil </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>ACTION_BATTERY_CONNECTED</code> </td><td class="col1"> acțiune transmisă în momentul în care bateria este conectată la o sursă de energie externă </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>ACTION_BATTERY_DISCONNECTED</code> </td><td class="col1"> acțiune transmisă în momentul în care bateria este deconectată de la o sursă de energie externă </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>ACTION_BOOT_COMPLETED</code> </td><td class="col1"> acțiune transmisă în momentul în care a fost realizată complet secvența de pornire a dispozitivului mobil (aplicația poate primi o astfel de intenție cu difuzare dacă deține permisiunea <code>RECEIVE_BOOT_COMPLETED</code>) </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>ACTION_CAMERA_BUTTON</code> </td><td class="col1"> acțiune transmisă în momentul în momentul în care este accesat butonul pentru pornirea camerei foto </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>ACTION_DATE_CHANGED</code> / <code>ACTION_TIME_CHANGED</code> </td><td class="col1"> acțiuni transmise în momentul în care data calendaristică sau timpul sunt modificate manual (nu datorită progresului său natural) </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>ACTION_DOCK_EVENT</code> </td><td class="col1"> acțiune transmisă în momentul în care dispozitivul mobil este ancorat, printr-un dispozitiv de birou sau de mașină, stare plasată în secțiunea <code>extra</code> prin intermediul cheii <code>ETRA_DOCK_STATE</code> </td>
	</tr>
	<tr class="row10">
		<td class="col0"> <code>ACTION_MEDIA_EJECT</code> </td><td class="col1"> acțiune transmisă în momentul în care este îndepărtat un mediu de stocare extern (util în situația în care aplicația scrie / citește de pe acesta, pentru a salva conținutul și pentru a le închide) </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <code>ACTION_MEDIA_MOUNTED</code> / <code>ACTION_MEDIA_UNMOUNTED</code> </td><td class="col1"> acțiuni transmise de fiecare dată când dispozitive de stocare externe sunt adăugate sau îndepărtate cu succes </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <code>ACTION_NEW_OUTGOING_CALL</code> </td><td class="col1"> acțiune transmisă în momentul în care urmează să fie format un număr de telefon, a cărui valoare este plasată în secțiunea <code>extra</code>, prin intermediul cheii <code>EXTRA_PHONE_NUMBER</code> (aplicația poate primi o astfel de intenție cu difuzare dacă deține permisiunea <code>PROCESS_OUTGOING_CALLS</code> </td>
	</tr>
	<tr class="row13">
		<td class="col0"> <code>ACTION_SCREEN_OFF</code> / <code>ACTION_SCREEN_ON</code> </td><td class="col1"> acțiuni transmise în momentul în care ecranul este închis, respectiv este deschis </td>
	</tr>
	<tr class="row14">
		<td class="col0"> <code>ACTION_TIMEZONE_CHANGED</code> </td><td class="col1"> acțiune transmisă în momentul în care zona de timp a telefonului este modificată, a cărui valoare (identificator) este plasată în secțiunea <code>extra</code> prin intermediul cheii <code>time-zone</code> </td>
	</tr>
</table></div>
<!-- EDIT12 TABLE [31434-34302] -->
<p>
<p><div class="notetip">Pentru aceste tipuri de intenții cu difuzare, înregistrarea și deînregistrarea unor obiecte de tip ascultător poate fi realizată numai programatic, în codul sursă.
</div></p>
</p>

<p>
În cazul unei aplicații Android, foarte importante sunt și modificările în privința conectivității la Internet (inclusiv parametrii precum lățimea de bandă, latența) întrucât acestea pot fi semnificative în privința luării unor decizii legate de realizarea anumitor actualizări sau de descărcarea unor fișiere având dimensiuni mari. O astfel de funcționalitate poate fi definită prin implementarea unui obiect ascultător, care procesează acțiunea <code>android.net.conn.CONNECTIVITY_CHANGE</code> (<code>ConnectivityManager.CONNECTIVITY_ACTION</code>). Se transmise o intenție cu difuzie nepersistentă care nu conține informații suplimentare cu privire la schimbarea stării.
</p>
<pre class="code java">ConnectivityManager connectivityManager <span class="sy0">=</span> <span class="br0">&#40;</span>ConnectivityManager<span class="br0">&#41;</span>context.<span class="me1">getSystemService</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a>.<span class="me1">CONNECTIVITY_SERVICE</span><span class="br0">&#41;</span><span class="sy0">;</span>
NetworkInfo networkInfo <span class="sy0">=</span> connectivityManager.<span class="me1">getActiveNetworkInfo</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">boolean</span> isConnected <span class="sy0">=</span> networkInfo.<span class="me1">isConnectedOrConnecting</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">boolean</span> isMobile <span class="sy0">=</span> <span class="br0">&#40;</span>networkInfo.<span class="me1">getType</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">==</span> ConnectivityManager.<span class="me1">TYPE_MOBILE</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT11 SECTION "Gestiunea intențiilor cu difuzare native" [31077-35532] -->
<h2 class="sectionedit13" id="exercitii">Exerciții</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> Realizati o aplicatie Android care permite utiliztaorului sa introduca un numar de telefon si sa il apeleze. Folositi ACTION_DIAL si ACTION_CALL. Incercati si pe simulator si pe telefon. Pe simulator va trebui sa cereti permisiunea PHONE_CALL (requestPermission).</div>
</li>
<li class="level1"><div class="li"> Adaugati in aplicatia posibilitate de a trimite un SMS acelui numar. Folositi ACTION_VIEW si SmsManager. Incercati si pe simulator si pe telefon.</div>
</li>
<li class="level1"><div class="li"> Adaugati aplicatiei anterioare posibilitatea de a pune o semnatura pentru utiliztaor. Adaugati un buton care deschide o alta activitate unde utilizatorul isi poate scrie o semnatura. Acesa semantura este adaugata la SMS-urile trimise.</div>
</li>
<li class="level1"><div class="li"> Realizati o aplicatie care scrie afiseaza in logcat (System.out Sau Log) sms-urile primite. (BroadcastReceiver)</div>
</li>
<li class="level1"><div class="li"> Realizati o aplicatie care afiseaza SMS-urile primite (porniti o activitate la primirea unui SMS)</div>
</li>
<li class="level1"><div class="li"> Inregistrati o activitate care poate afisa fisiere de tip text (Activitatea este pronita de actiunea VIEW si categoria DEFAULT si are in data textul)</div>
</li>
<li class="level1"><div class="li"> Să se implementeze un ascultător pentru mesaje cu difuzare în aplicația <code>MessageMe</code>, care interceptează mesajele trimise de sistemul de operare Android cu privire la schimbările legate de conectivitatea la Internet. Acesta va jurnaliza toate operațiile care au fost detectate, cu ajutorul <code>Logcat</code>. Acțiunea care este transmisă în acest caz este <code>android.net.conn.CONNECTIVITY_CHANGE</code>. Astfel înregistrat, un obiect de acest tip va fi invocat în mod automat, furnizând informații legate de existența unei conexiuni precum și a unei rețele fără fir.</div>
</li>
</ol>
<pre class="code java">ConnectivityManager connectivityManager <span class="sy0">=</span> <span class="br0">&#40;</span>ConnectivityManager<span class="br0">&#41;</span>context.<span class="me1">getSystemService</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a>.<span class="me1">CONNECTIVITY_SERVICE</span><span class="br0">&#41;</span><span class="sy0">;</span>
NetworkInfo activeNetwork <span class="sy0">=</span> connectivityManager.<span class="me1">getActiveNetworkInfo</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">boolean</span> isConnected <span class="sy0">=</span> activeNetwork <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> activeNetwork.<span class="me1">isConnectedOrConnecting</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">boolean</span> isWiFi <span class="sy0">=</span> activeNetwork.<span class="me1">getType</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">==</span> ConnectivityManager.<span class="me1">TYPE_WIFI</span><span class="sy0">;</span></pre>

<p>
<p><div class="noteimportant">Informațiile cu privire la starea conectivității nu pot fi accesate decât în situația în care sunt acordate drepturile de acces corespunzătoare: 
</p>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;uses-permission</span> <span class="re0">android:name</span>=<span class="st0">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span> <span class="re2">/&gt;</span></span></pre>

<p>

</div></p>
</p>

</div>
<!-- EDIT13 SECTION "Exerciții" [35533-] --></div>
</body>
</html>
