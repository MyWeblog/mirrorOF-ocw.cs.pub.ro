    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>gsr:laboratoare:laborator-04</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-11-02T23:31:19+0200"/>
<meta name="keywords" content="gsr,laboratoare,laborator-04"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=gsr:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-04.html"/>
<link rel="canonical" href="../../../../gsr/laboratoare/laborator-04.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='gsr:laboratoare';var JSINFO = {"id":"gsr:laboratoare:laborator-04","namespace":"gsr:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-04.html#laborator_04serviciul_de_dns">Laborator 04: Serviciul de DNS</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-04.html#demofunctionarea_serviciului_dns">Demo: Funcționarea serviciului DNS</a></div></li>
<li class="level2"><div class="li"><a href="laborator-04.html#urmarire_configurare_server_dns">Urmărire configurare server DNS</a></div></li>
<li class="level2"><div class="li"><a href="laborator-04.html#modificare_configurare_server_dns">Modificare configurare server DNS</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#configurare_caching_dns_server">Configurare caching DNS server</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#configurare_forwarding_dns_server">Configurare forwarding DNS server</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-04.html#adaugare_o_noua_inregistrare">Adăugare o nouă înregistrare</a></div></li>
<li class="level2"><div class="li"><a href="laborator-04.html#delegare_server_dns">Delegare server DNS</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#instalare_si_configurare_domeniu_hostixlabs">Instalare și configurare domeniu &#039;&#039;host.ixlabs&#039;&#039;</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#delegare_domeniu_hostixlabs">Delegare domeniu &#039;&#039;host.ixlabs&#039;&#039;</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_04serviciul_de_dns">Laborator 04: Serviciul de DNS</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 04: Serviciul de DNS" [19-64] -->
<h2 class="sectionedit2" id="demofunctionarea_serviciului_dns">Demo: Funcționarea serviciului DNS</h2>
<div class="level2">

<p>
Pentru a verifica funcționarea serviciului <abbr title="Domain Name System">DNS</abbr>, putem folosi comenzi precum <code>host</code> sau <code>dig</code> care sunt aplicații de tip client <abbr title="Domain Name System">DNS</abbr>. Aceste aplicații interoghează server-ul <abbr title="Domain Name System">DNS</abbr> și afișează informațiile cerute.
</p>

<p>
Mai jos, aflăm adresa IP a domeniului <code>hotnews.ro</code> folosind <code>host</code> și <code>dig</code>:
</p>
<pre class="code">student@eg106-pc:~$ host hotnews.ro
hotnews.ro has address 91.195.7.1
hotnews.ro mail is handled by 10 smtp.hotnews.ro.

student@eg106-pc:~$ dig hotnews.ro

; &lt;&lt;&gt;&gt; DiG 9.9.5-9ubuntu0.3-Ubuntu &lt;&lt;&gt;&gt; hotnews.ro
;; global options: +cmd
;; Got answer:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 11548
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 5

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;hotnews.ro.			IN	A

;; ANSWER SECTION:
hotnews.ro.		86388	IN	A	91.195.7.1

;; AUTHORITY SECTION:
hotnews.ro.		69394	IN	NS	ns-1701.awsdns-20.co.uk.
hotnews.ro.		69394	IN	NS	ns-1148.awsdns-15.org.
hotnews.ro.		69394	IN	NS	ns-943.awsdns-53.net.
hotnews.ro.		69394	IN	NS	ns-302.awsdns-37.com.

;; ADDITIONAL SECTION:
ns-302.awsdns-37.com.	22667	IN	A	205.251.193.46
ns-943.awsdns-53.net.	22667	IN	A	205.251.195.175
ns-1148.awsdns-15.org.	100500	IN	A	205.251.196.124
ns-1701.awsdns-20.co.uk. 22667	IN	A	205.251.198.165

;; Query time: 1 msec
;; SERVER: 127.0.1.1#53(127.0.1.1)
;; WHEN: Thu Dec 03 13:31:01 EET 2015
;; MSG SIZE  rcvd: 259</pre>

<p>
Observăm că output-ul dig este mai <em>verbose</em> afișând și informații despre serverele de nume autoritare pe domeniul <code>hotnews.ro</code>. Pentru același comportament din partea comenzii <code>host</code> putem folosi opțiunea <code>-v</code> a acestei comenzi:
</p>
<pre class="code">student@eg106-pc:~$ host -v hotnews.ro
Trying &quot;hotnews.ro&quot;
;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 35674
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 4

;; QUESTION SECTION:
;hotnews.ro.			IN	A

;; ANSWER SECTION:
hotnews.ro.		86129	IN	A	91.195.7.1
[...]</pre>

<p>
În mod similar, dacă dorim forma scurtă a comenzii <code>dig</code> folosim comanda
</p>
<pre class="code">student@eg106-pc:~$ dig +short hotnews.ro
91.195.7.1</pre>

<p>
În comanda de mai sus am folosit pentru interogare serverul <abbr title="Domain Name System">DNS</abbr> configurat implicit în sistem, în fișierul <code>/etc/resolv.conf</code>. Dacă dorim să folosim alt server de nume (de exemplu <code>8.8.8.8</code>) folosim comenzile în forma de mai jos
</p>
<pre class="code">student@eg106-pc:~$ host hotnews.ro 8.8.8.8
Using domain server:
Name: 8.8.8.8
Address: 8.8.8.8#53
Aliases: 

hotnews.ro has address 91.195.7.1
hotnews.ro mail is handled by 10 smtp.hotnews.ro.
student@eg106-pc:~$ dig +short hotnews.ro @8.8.8.8
91.195.7.1</pre>

<p>
De avut în vedere că o comandă de interogare <abbr title="Domain Name System">DNS</abbr> (precum <code>host</code> sau <code>dig</code>) folosește direct serviciul <code><abbr title="Domain Name System">DNS</abbr></code>. Nu accesează fișierul <code>/etc/nsswitch.conf</code> și nici resolver-ul sistemului (de obicei o bibliotecă). Putem observa acest lucru în output-ul comenzilor de mai jos:
</p>
<pre class="code">student@eg106-pc:~$ strace -e open host hotnews.ro
[...[
open(&quot;/etc/resolv.conf&quot;, O_RDONLY)      = 6
hotnews.ro has address 91.195.7.1
hotnews.ro mail is handled by 10 smtp.hotnews.ro.
[...]

student@eg106-pc:~$ strace -e open ping -c 1 hotnews.ro
open(&quot;/etc/resolv.conf&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/etc/resolv.conf&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/etc/nsswitch.conf&quot;, O_RDONLY|O_CLOEXEC) = 3
[...]
open(&quot;/etc/host.conf&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/etc/hosts&quot;, O_RDONLY|O_CLOEXEC)  = 3
open(&quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/lib/x86_64-linux-gnu/libnss_myhostname.so.2&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/lib/x86_64-linux-gnu/libnss_mdns4_minimal.so.2&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/lib/x86_64-linux-gnu/libnss_dns.so.2&quot;, O_RDONLY|O_CLOEXEC) = 3
open(&quot;/lib/x86_64-linux-gnu/libresolv.so.2&quot;, O_RDONLY|O_CLOEXEC) = 3
[...]</pre>

<p>
Observăm că folosirea comenzii <code>host</code> duce la interogarea directă a fișierului <code>/etc/resolv.conf</code> în vreme ce folosirea comenzii <code>ping</code> duce la interogarea configurației de resolver: sunt deschise și fișierul <code>/etc/nsswitch.conf</code> și <code>/etc/hosts</code> și bibliotecile aferente pentru NSS (<em>Name Service Switch</em>) culminând cu apelarea bibliotecii de resolving (<code>libresolv.so.2</code>).
</p>

</div>
<!-- EDIT2 SECTION "Demo: Funcționarea serviciului DNS" [65-4376] -->
<h2 class="sectionedit3" id="urmarire_configurare_server_dns">Urmărire configurare server DNS</h2>
<div class="level2">

<p>
<p><div class="noteimportant">
Pentru următoarele exerciții folosim mașina virtuală <code>GSR Debian</code>. Mașina virtuală o gasiti la adresa de mai jos (trebuie sa va logati cu credentialele de pe cs.curs.pub.ro):
</p>

<p>
<a href="https://repository.grid.pub.ro/cs/gsr/GSR%20Debian.ova" class="urlextern" title="https://repository.grid.pub.ro/cs/gsr/GSR%20Debian.ova"  rel="nofollow">https://repository.grid.pub.ro/cs/gsr/GSR%20Debian.ova</a>
</p>

<p>
Dupa ce o descarcati, trebuie importata în VirtualBox (File → Import Appliance).
</p>

<p>
Pentru autentificarea în mașina virtuală folosim numele de utilizator <code>student</code> cu parola <code>student</code>. Ne putem conecta și prin SSH <strong>de pe sistemul fizic</strong> folosind comanda
</p>
<pre class="code">student@eg106-pc:~$ ssh -l student 192.168.56.115
[...]
Last login: Thu Dec  3 13:57:01 2015
student@gsr-server:~$</pre>

<p>
Contul <code>student</code> are permisiuni privilegiate. Putem accesa drepturile de <code>root</code> folosind comanda
</p>
<pre class="code">sudo su</pre>

<p>

</div></p>
</p>

<p>
Pe mașina virtuală este configurat numele de domeniu <code>ixlabs</code>. Putem interoga acest domeniu de pe sistemul fizic, folosind comanda <code>host</code> și folosind adresa IP a mașinii virtuale ca server <abbr title="Domain Name System">DNS</abbr>:
</p>
<pre class="code">student@eg106-pc:~$ host ixlabs 192.168.56.115
Using domain server:
Name: 192.168.56.115
Address: 192.168.56.115#53
Aliases:

ixlabs has address 192.168.56.115
ixlabs mail is handled by 10 mail.ixlabs.</pre>

<p>
Alte comenzi de interogare a serverului <abbr title="Domain Name System">DNS</abbr> pot fi pentru a afla serverul de nume al domeniului sau serverul de e-mail al domeniului:
</p>
<pre class="code">istudent@eg106-pc:~$ host -t NS ixlabs 192.168.56.115
Using domain server:
Name: 192.168.56.115
Address: 192.168.56.115#53
Aliases: 

ixlabs name server ns.ixlabs.
student@eg106-pc:~$ host -t MX ixlabs 192.168.56.115
Using domain server:
Name: 192.168.56.115
Address: 192.168.56.115#53
Aliases: 

ixlabs mail is handled by 10 mail.ixlabs.
student@eg106-pc:~$ host mail.ixlabs 192.168.56.115
Using domain server:
Name: 192.168.56.115
Address: 192.168.56.115#53
Aliases: 

mail.ixlabs has address 192.168.56.115
student@eg106-pc:~$ host ns.ixlabs. 192.168.56.115
Using domain server:
Name: 192.168.56.115
Address: 192.168.56.115#53
Aliases: 

ns.ixlabs has address 192.168.56.115</pre>

<p>
Pentru a verifica ce configurație avem definită pe serverul <abbr title="Domain Name System">DNS</abbr> inspectăm, <strong>în mașina virtuală</strong>, configurările serverului:
</p>
<pre class="code">istudent@gsr-server:/etc/bind$ cat named.conf.local
//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your
// organization
//include &quot;/etc/bind/zones.rfc1918&quot;;

zone &quot;ixlabs.&quot; {
	type master;
	file &quot;/etc/bind/db.ixlabs&quot;;
};

student@gsr-server:/etc/bind$ cat db.ixlabs
;
; BIND data file for ixlabs.
;
$TTL	604800
@	IN	SOA	ixlabs. root.ixlabs. (
			2015111901	; Serial
			 604800		; Refresh
			  86400		; Retry
			2419200		; Expire
			 604800 )	; Negative Cache TTL
;
@	IN	NS	ns
ns	IN	A	192.168.56.115
@	IN	A	192.168.56.115
@	IN	MX	10 mail
mail	IN	A	192.168.56.115</pre>

<p>
De aici observăm că serverul <abbr title="Domain Name System">DNS</abbr> configurat pe mașina virtuală este autoritar pe domeniul <code>ixlabs</code> și are configurat serverul de nume (înregistrare de tipul NS) și serverul de e-mail (înregistrare de tipul MX).
</p>

</div>
<!-- EDIT3 SECTION "Urmărire configurare server DNS" [4377-7441] -->
<h2 class="sectionedit4" id="modificare_configurare_server_dns">Modificare configurare server DNS</h2>
<div class="level2">

<p>
<p><div class="noteclassic">
În continuare vom configura <strong>pe sistemul fizic</strong> ca server <abbr title="Domain Name System">DNS</abbr> adresa IP a mașinii virtuale (adică <code>192.168.56.115</code>). Adică trebuie să scriem adresa <code>192.168.56.115</code> în fișierul <code>/etc/resolv.conf</code>.
</p>

<p>
Întrucât clientul de DHCP (<code>dhclient</code>) poate modifica adresa IP a sistemului fizic și poate suprascrie fișierul <code>/etc/resolv.conf</code>, vom dezactiva <code>Network Manager</code> și client DHCP. Adică vom urma pașii de mai jos:
</p>
<ol>
<li class="level1"><div class="li"> Aflăm interfața activă, adresa IP a sistemului fizic și default gateway-ul:<pre class="code">student@eg106-pc:~$ ip a s
[...]
2: eth4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 70:71:bc:08:25:c6 brd ff:ff:ff:ff:ff:ff
    inet 172.16.5.11/22 brd 172.16.7.255 scope global eth4
       valid_lft forever preferred_lft forever
[...]
student@eg106-pc:~$ ip r s
default via 172.16.4.254 dev eth4
172.16.4.0/22 dev eth4  proto kernel  scope link  src 172.16.5.11
172.16.242.0/24 dev vmnet8  proto kernel  scope link  metric 100
192.168.56.0/24 dev vboxnet0  proto kernel  scope link  metric 100
192.168.108.0/24 dev vmnet1  proto kernel  scope link  metric 100
&lt;code&gt; În cazul de mai sus (va diferi pe sistemul vostru), interfața activă este &#039;&#039;eth4&#039;&#039;, adresa IP este &#039;&#039;172.16.5.11/22&#039;&#039; iar adresa de broadcast este &#039;&#039;172.16.4.254&#039;&#039;.
  - Dezactivăm configurațiile curente realizate de &#039;&#039;NetworkManager&#039;&#039;/&#039;&#039;dhclient&#039;&#039; și încheiem execuția acestor procese:&lt;code&gt;
student@eg106-pc:~$ sudo ip a f eth4
student@eg106-pc:~$ sudo service network-manager stop
student@eg106-pc:~$ sudo pkill -f dhclient
student@eg106-pc:~$ ip a s eth4
2: eth4: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast state DOWN group default qlen 1000
    link/ether 70:71:bc:08:25:c6 brd ff:ff:ff:ff:ff:ff
student@eg106-pc:~$ ps -ef | grep dhclient
student   3958  3481  0 14:45 pts/2    00:00:00 grep --color=auto dhclient</pre>
</div>
</li>
<li class="level1"><div class="li"> Configurăm static adresa IP de mai sus și default gateway-ul:<pre class="code">student@eg106-pc:~$ sudo ip a a 172.16.5.11/22 dev eth4
student@eg106-pc:~$ sudo ip l s dev eth4 up
student@eg106-pc:~$ sudo ip r a default via 172.16.4.254
student@eg106-pc:~$ ip r s
default via 172.16.4.254 dev eth4
172.16.4.0/22 dev eth4  proto kernel  scope link  src 172.16.5.11</pre>
</div>
</li>
<li class="level1"><div class="li"> Reactivăm interfața <code>vboxnet0</code> pentru a permite comunicarea prin SSH dintre sistemul fizic și mașina virtuală VirtualBox:<pre class="code">student@eg106-pc:~$ vboxmanage hostonlyif ipconfig vboxnet0 --ip 192.168.56.1 --netmask 255.255.255.0
student@eg106-pc:~$ ip r s
default via 172.16.4.254 dev eth4
172.16.4.0/22 dev eth4  proto kernel  scope link  src 172.16.5.11
192.168.56.0/24 dev vboxnet0  proto kernel  scope link  src 192.168.56.1</pre>
</div>
</li>
<li class="level1"><div class="li"> Configurăm adresa IP a mașinii virtuale ca server de <abbr title="Domain Name System">DNS</abbr> în fișierul <code>/etc/resolv.conf</code><pre class="code">student@eg106-pc:~$ sudo vi /etc/resolv.conf
student@eg106-pc:~$ cat /etc/resolv.conf
nameserver 192.168.56.115
student@eg106-pc:~$ host ixlabs
ixlabs has address 192.168.56.115
ixlabs mail is handled by 10 mail.ixlabs.
student@eg106-pc:~$ host -NS ixlabs
ixlabs has address 192.168.56.115
ixlabs mail is handled by 10 mail.ixlabs.</pre>
</div>
</li>
</ol>

<p>
Dacă pe parcursul laboratorului apar probleme de conectare, se pot rerula pașii de mai sus pentru reconfigurarea interfeței active a sistemului fizic.

</div></p>
</p>

<p>
Pe configurația curentă a serverului <abbr title="Domain Name System">DNS</abbr>, dacă încercăm să aflăm adresa IP a unor stații din afara domeniului <code>ixlabs</code>, aceste cereri vor eșua:
</p>
<pre class="code">student@eg106-pc:~$ host google.com
Host google.com not found: 2(SERVFAIL)</pre>

<p>
Pentru aceasta putem opta pentru una din două configurații pentru serverul de <abbr title="Domain Name System">DNS</abbr>: un <em>caching <abbr title="Domain Name System">DNS</abbr> server</em> (numit și <em>resolver</em>) care va primi cereri recursive de la clienți, sau un <em>forwarding <abbr title="Domain Name System">DNS</abbr> server</em> care va transmite cereri mai departe la alte servere <abbr title="Domain Name System">DNS</abbr> (cele inițiale). Puteți opta pentru oricare dintre configurațiile de mai jos.
</p>

</div>
<!-- EDIT4 SECTION "Modificare configurare server DNS" [7442-11420] -->
<h3 class="sectionedit5" id="configurare_caching_dns_server">Configurare caching DNS server</h3>
<div class="level3">

<p>
Pentru a configura un server <abbr title="Domain Name System">DNS</abbr> de tip caching resolver, va trebui să definim o listă de control a accesului și să activăm posibilitatea primirii de cereri recursive. Pentru aceasta operăm, pe <strong>mașina virtuală</strong>, în directorul <code>/etc/bind/</code> corespunzătorul serverului <abbr title="Domain Name System">DNS</abbr>, modificările indicate mai jos:
</p>
<pre class="code">student@gsr-server:/etc/bind$ cat named.conf.options
acl goodclients {
	192.168.56.0/24;
	localhost;
	localnets;
};

options {
[...]
	recursion yes;
	allow-query { goodclients; };
[...]
};</pre>

<p>
În output-ul de mai sus am selectat liniile care trebuie adăugate în fișierul <code>/etc/bind/named.conf.options</code>.
</p>

<p>
Apoi repornim serviciul <code>bind9</code> și verificăm repornirea sa cu succes:
</p>
<pre class="code">student@gsr-server:/etc/bind$ sudo service bind9 restart

student@gsr-server:/etc/bind$ sudo tail /var/log/daemon.log
Dec  3 15:05:42 gsr-server named[1146]: managed-keys-zone: journal file is out of date: removing journal file
Dec  3 15:05:42 gsr-server named[1146]: managed-keys-zone: loaded serial 3
Dec  3 15:05:42 gsr-server named[1146]: zone 0.in-addr.arpa/IN: loaded serial 1
Dec  3 15:05:42 gsr-server named[1146]: zone 127.in-addr.arpa/IN: loaded serial 1
Dec  3 15:05:42 gsr-server named[1146]: zone 255.in-addr.arpa/IN: loaded serial 1
Dec  3 15:05:42 gsr-server named[1146]: zone ixlabs/IN: loaded serial 2015111901
Dec  3 15:05:42 gsr-server named[1146]: zone localhost/IN: loaded serial 2
Dec  3 15:05:42 gsr-server named[1146]: all zones loaded
Dec  3 15:05:42 gsr-server named[1146]: running
Dec  3 15:05:42 gsr-server named[1146]: zone ixlabs/IN: sending notifies (serial 2015111901)

student@gsr-server:/etc/bind$ sudo netstat -ulpn | grep named
udp        0      0 192.168.56.115:53       0.0.0.0:*                           1146/named
udp        0      0 10.0.2.15:53            0.0.0.0:*                           1146/named
udp        0      0 127.0.0.1:53            0.0.0.0:*                           1146/named
udp6       0      0 :::53                   :::*                                1146/named</pre>

<p>
Acum putem, de pe <strong>sistemul fizic</strong>, să interogăm serverul <abbr title="Domain Name System">DNS</abbr> de pe mașina virtuală și pentru domenii pentru care nu este autoritar și acesta va rezolva cererile și va oferi răspunsul:
</p>
<pre class="code">student@eg106-pc:~$ host google.com
google.com has address 217.73.160.226
google.com has address 217.73.160.230
google.com has address 217.73.160.221
[...]</pre>

</div>
<!-- EDIT5 SECTION "Configurare caching DNS server" [11421-13883] -->
<h3 class="sectionedit6" id="configurare_forwarding_dns_server">Configurare forwarding DNS server</h3>
<div class="level3">

<p>
Putem configura serverul <abbr title="Domain Name System">DNS</abbr> de pe mașina virtuală ca server de forwarding. Acesta va retransmite cererile recursive primite către alte servere <abbr title="Domain Name System">DNS</abbr> care să facă rezolvarea. În cazul nostru vom folosi serverele <abbr title="Domain Name System">DNS</abbr> inițial configurate pentru rețeaua laboratorului, adică <code>141.85.226.5</code> și <code>141.85.241.113</code>. Pentru aceasta operăm, pe <strong>mașina virtuală</strong>, în directorul <code>/etc/bind/</code> corespunzătorul serverului <abbr title="Domain Name System">DNS</abbr>, modificările indicate mai jos:
</p>
<pre class="code">student@gsr-server:/etc/bind$ sudo vi named.conf.options    
student@gsr-server:/etc/bind$ cat named.conf.options 
acl goodclients {
	192.168.56.0/24;
	localhost;
	localnets;
};

options {
[...]
	forwarders {
		141.85.226.5;
		141.85.241.113;
	};
	forward only;
	allow-query { goodclients; };
[...]
};</pre>

<p>
În output-ul de mai sus am selectat liniile care trebuie adăugate în fișierul <code>/etc/bind/named.conf.options</code>.
</p>

<p>
Apoi repornim serviciul <code>bind9</code> și verificăm repornirea sa cu succes:
</p>
<pre class="code">student@gsr-server:/etc/bind$ sudo service bind9 restart

student@gsr-server:/etc/bind$ sudo tail /var/log/daemon.log
Dec  3 15:22:35 gsr-server named[1301]: command channel listening on ::1#953
Dec  3 15:22:35 gsr-server named[1301]: managed-keys-zone: loaded serial 3
Dec  3 15:22:35 gsr-server named[1301]: zone 0.in-addr.arpa/IN: loaded serial 1
Dec  3 15:22:35 gsr-server named[1301]: zone 127.in-addr.arpa/IN: loaded serial 1
Dec  3 15:22:35 gsr-server named[1301]: zone 255.in-addr.arpa/IN: loaded serial 1
Dec  3 15:22:35 gsr-server named[1301]: zone ixlabs/IN: loaded serial 2015111901
Dec  3 15:22:35 gsr-server named[1301]: zone localhost/IN: loaded serial 2
Dec  3 15:22:35 gsr-server named[1301]: all zones loaded
Dec  3 15:22:35 gsr-server named[1301]: running
Dec  3 15:22:35 gsr-server named[1301]: zone ixlabs/IN: sending notifies (serial 2015111901)
student@gsr-server:/etc/bind$ sudo netstat -ulpn | grep named
udp        0      0 192.168.56.115:53       0.0.0.0:*                           1301/named      
udp        0      0 10.0.2.15:53            0.0.0.0:*                           1301/named      
udp        0      0 127.0.0.1:53            0.0.0.0:*                           1301/named      
udp6       0      0 :::53                   :::*                                1301/named </pre>

<p>
Acum putem, de pe <strong>sistemul fizic</strong>, să interogăm serverul <abbr title="Domain Name System">DNS</abbr> de pe mașina virtuală și pentru domenii pentru care nu este autoritar și acesta va rezolva cererile și va oferi răspunsul:
</p>
<pre class="code">istudent@eg106-pc:~$ host google.com
google.com has address 217.73.160.226
google.com has address 217.73.160.230
google.com has address 217.73.160.221
[...]</pre>

</div>
<!-- EDIT6 SECTION "Configurare forwarding DNS server" [13884-16595] -->
<h2 class="sectionedit7" id="adaugare_o_noua_inregistrare">Adăugare o nouă înregistrare</h2>
<div class="level2">

<p>
Ne propunem să adăugăm o nouă înregistrare în server-ul de <abbr title="Domain Name System">DNS</abbr>. Să mapăm adresa IP a sistemului fizic la numele <code>host.ixlabs</code>. Pentru aceasta operăm, în <strong>mașina virtuală</strong>, în directorul <code>/etc/bind</code>, modificările de mai jos
</p>
<pre class="code">istudent@gsr-server:/etc/bind$ sudo vi db.ixlabs
student@gsr-server:/etc/bind$ cat db.ixlabs
[...]
host	IN	A	192.168.56.1</pre>

<p>
Înregistrarea de mai sus, adăugată în cadrul fișierului <code>/etc/bind/db.ixlabs</code>, fișier de configurare a zonei <code>ixlabs</code>, face maparea dorită.
</p>

<p>
Repornim serverul de nume
</p>
<pre class="code">student@gsr-server:/etc/bind$ sudo service bind9 restart</pre>

<p>
și apoi, de pe <strong>sistemul fizic</strong>, validăm adăugarea noii întrări:
</p>
<pre class="code">student@eg106-pc:~$ host host.ixlabs
host.ixlabs has address 192.168.56.1
student@eg106-pc:~$ ping host.ixlabs
PING host.ixlabs (192.168.56.1) 56(84) bytes of data.
64 bytes from eg106-pc (192.168.56.1): icmp_seq=1 ttl=64 time=0.045 ms
64 bytes from eg106-pc (192.168.56.1): icmp_seq=2 ttl=64 time=0.042 ms</pre>

</div>
<!-- EDIT7 SECTION "Adăugare o nouă înregistrare" [16596-17662] -->
<h2 class="sectionedit8" id="delegare_server_dns">Delegare server DNS</h2>
<div class="level2">

<p>
Vrem să configurăm <code>host.ixlabs</code> ca domeniu pe <strong>sistemul fizic</strong> delegat de serverul <abbr title="Domain Name System">DNS</abbr> de pe mașina virtuală. Pentru aceasta vom urma doi pași:
</p>
<ol>
<li class="level1"><div class="li"> Instalăm serverul <code>bind9</code> pe sistemul fizic și îl configurăm să fie autoritar pe domeniul <code>host.ixlabs</code>.</div>
</li>
<li class="level1"><div class="li"> Delegăm din serverul de pe <strong>mașina virtuală</strong> domeniul <code>host.ixlabs</code> pe sistemul fizic.</div>
</li>
</ol>

</div>
<!-- EDIT8 SECTION "Delegare server DNS" [17663-18066] -->
<h3 class="sectionedit9" id="instalare_si_configurare_domeniu_hostixlabs">Instalare și configurare domeniu &#039;&#039;host.ixlabs&#039;&#039;</h3>
<div class="level3">

<p>
Pentru început instalăm pachetul <code>bind9</code> pe sistemul fizic și verificăm pornirea serverului <code>bind9</code>
</p>
<pre class="code">student@eg106-pc:~$ sudo apt-get install bind9
[...]

student@eg106-pc:~$ sudo service bind9 restart
student@eg106-pc:~$ sudo netstat -ulpn | grep named
udp        0      0 192.168.56.1:53         0.0.0.0:*                           5565/named
udp        0      0 172.16.5.11:53          0.0.0.0:*                           5565/named
udp        0      0 127.0.0.1:53            0.0.0.0:*                           5565/named
udp6       0      0 :::53                   :::*                                5565/named</pre>

<p>
Apoi adăugăm configurația pentru zona <code>host.ixlabs</code> și verificăm configurația:
</p>
<pre class="code">student@eg106-pc:/etc/bind$ vi named.conf.local
student@eg106-pc:/etc/bind$ cat named.conf.local
//
// Do any local configuration here
//

// Consider adding the 1918 zones here, if they are not used in your
// organization
//include &quot;/etc/bind/zones.rfc1918&quot;;

zone &quot;host.ixlabs&quot; {
	type master;
	file &quot;/etc/bind/db.host.ixlabs&quot;;
};

student@eg106-pc:/etc/bind$ named-checkconf named.conf.local </pre>

<p>
Apoi adăugăm fișierul de configurare a zonei, pornind de la un fișier existent și verificăm configurația:
</p>
<pre class="code">student@eg106-pc:/etc/bind$ sudo cp db.local db.host.ixlabs
student@eg106-pc:/etc/bind$ sudo vi db.host.ixlabs
student@eg106-pc:/etc/bind$ cat db.host.ixlabs
;
; BIND data file for host.ixlabs domain.
;
$TTL	604800
@	IN	SOA	ns.host.ixlabs. root.host.ixlabs. (
			      2		; Serial
			 604800		; Refresh
			  86400		; Retry
			2419200		; Expire
			 604800 )	; Negative Cache TTL
;
@	IN	NS	ns
@	IN	A	192.168.56.1
ns	IN	A	192.168.56.1

student@eg106-pc:/etc/bind$ named-checkzone host.ixlabs db.host.ixlabs
zone host.ixlabs/IN: loaded serial 2
OK</pre>

<p>
Repornim acum serviciul:
</p>
<pre class="code">student@eg106-pc:/etc/bind$ sudo service bind9 restart</pre>

<p>
și verificăm configurația locală
</p>
<pre class="code">student@eg106-pc:/etc/bind$ host host.ixlabs localhost
Using domain server:
Name: localhost
Address: 127.0.0.1#53
Aliases:

host.ixlabs has address 192.168.56.1
student@eg106-pc:/etc/bind$ host -t NS host.ixlabs localhost
Using domain server:
Name: localhost
Address: 127.0.0.1#53
Aliases:

host.ixlabs name server ns.host.ixlabs.</pre>

</div>
<!-- EDIT9 SECTION "Instalare și configurare domeniu ''host.ixlabs''" [18067-20415] -->
<h3 class="sectionedit10" id="delegare_domeniu_hostixlabs">Delegare domeniu &#039;&#039;host.ixlabs&#039;&#039;</h3>
<div class="level3">

<p>
Ca să facem legătura în domeniul <code>ixlabs</code> și subdomeniul <code>host.ixlabs</code>, vom configura delegare în cadrul serverului <code>bind9</code> de pe <strong>mașina virtuală</strong>. Pentru aceasta vom altera fișierul de configurare a zonei <code>ixlabs</code> (<code>/etc/bind/db.ixlabs</code>).
</p>

</div>
<!-- EDIT10 SECTION "Delegare domeniu ''host.ixlabs''" [20416-] --></div>
</body>
</html>
