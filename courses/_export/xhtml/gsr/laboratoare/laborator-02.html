    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>gsr:laboratoare:laborator-02</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-10-20T21:05:01+0300"/>
<meta name="keywords" content="gsr,laboratoare,laborator-02"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=gsr:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-02.html"/>
<link rel="canonical" href="../../../../gsr/laboratoare/laborator-02.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='gsr:laboratoare';var JSINFO = {"id":"gsr:laboratoare:laborator-02","namespace":"gsr:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-02.html#laborator_02servicii_sistem_si_server_basics">Laborator 02: Servicii sistem și server basics</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-02.html#investigarea_dinamica_a_unui_proces">01. Investigarea dinamică a unui proces</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-02.html#a_strace">a) strace</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#b_informatii_despre_retea">b) Informații despre rețea</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#c_atasarea_la_un_proces">c) Atașarea la un proces</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-02.html#demonizarea_proceselor">02. Demonizarea proceselor</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-02.html#a_procese_detasate_de_terminal">a) Procese detașate de terminal</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#b_disown">b) disown</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#c_nohup">c) nohup</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-02.html#serviciul_cron">03. Serviciul cron</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-02.html#a_demoinspectarea_configuratiei_cron">a) Demo: Inspectarea configurației cron</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#b_configurare_cron_cu_standard_output">b) Configurare cron cu standard output</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#c_alte_configurari_cron">c) Alte configurări cron</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#d_configurare_serviciu_cron_de_pornire_client_bittorrent">d) Configurare serviciu cron de pornire client Bittorrent</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#e_gestionare_client_de_bittorrent_folosind_supervisord">e) Gestionare client de BitTorrent folosind supervisord</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-02.html#serviciul_ntp">04. Serviciul NTP</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-02.html#a_functionarea_ntp">a) Funcționarea NTP</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#b_configurare_server_ntp_sincronizare_sisteme">b) Configurare server NTP. Sincronizare sisteme</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-02.html#jurnalizare">05. Jurnalizare</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-02.html#a_investigare_configuratie_syslog">a) Investigare configuratie syslog</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#b_reguli_de_jurnalizare">b) Reguli de jurnalizare</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#c_generate_mesaje_cu_logger">c) Generate mesaje cu logger</a></div></li>
<li class="level3"><div class="li"><a href="laborator-02.html#d_rotirea_fisierelor_de_log">d) Rotirea fisierelor de log</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_02servicii_sistem_si_server_basics">Laborator 02: Servicii sistem și server basics</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 02: Servicii sistem și server basics" [1-63] -->
<h2 class="sectionedit2" id="investigarea_dinamica_a_unui_proces">01. Investigarea dinamică a unui proces</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "01. Investigarea dinamică a unui proces" [64-117] -->
<h3 class="sectionedit3" id="a_strace">a) strace</h3>
<div class="level3">

<p>
Comanda <code>strace</code> (<em>system call trace</em>) ne este utilă pentru a investiga ce apeluri de sistem efectuează o comandă dată și ce parametri folosește.
</p>

<p>
De exemplu, dacă dorim să urmărim apelurile de sistem efectuate de comanda <code>ls</code> folosim comanda
</p>
<pre class="code">strace ls</pre>

<p>
Output-ul fiind destul de vast, ne preocupă să obținem doar informații despre fișierele deschide. Pentru aceasta folosim opțiunea <code>-e</code> a comenzii <code>strace</code> cu ajutorul căreia filtrăm tipuri de operații. În cazul de față folosim comanda
</p>
<pre class="code">strace -e file ls</pre>

<p>
Observăm fișierele deschise.
</p>

<p>
Pentru a vedea diferența între comenzile <code>ls</code> și <code>ls -l</code> folosim comanda
</p>
<pre class="code">strace -e file ls -l</pre>

<p>
Observăm că acum deschise și fișiere precum <code>/etc/passwd</code> și <code>/etc/group</code> pentru a determina username-ul și grupul aferent UID-ului și GID-ului din fișier.
</p>

</div>
<!-- EDIT3 SECTION "a) strace" [118-1022] -->
<h3 class="sectionedit4" id="b_informatii_despre_retea">b) Informații despre rețea</h3>
<div class="level3">

<p>
Comanda
</p>
<pre class="code bash"><span class="kw2">netstat</span> <span class="re5">-s</span></pre>

<p>
afișează informații statistice despre pachetele sistemului. Ne interesează să știm de unde obține comanda respectivă informațiile.
</p>

<p>
Rulați comanda
</p>
<pre class="code bash"><span class="kw2">strace</span> <span class="re5">-e</span> open <span class="kw2">netstat</span> <span class="re5">-s</span></pre>

<p>
pentru a afla ce fișiere deschide comanda la rulare.
</p>

<p>
Care fișier este citit pentru a afla informații despre pachetele primite (<em>packets received</em>)? Vizualizați acel fișier (luați-o pe încercate).
</p>

</div>
<!-- EDIT4 SECTION "b) Informații despre rețea" [1023-1509] -->
<h3 class="sectionedit5" id="c_atasarea_la_un_proces">c) Atașarea la un proces</h3>
<div class="level3">

<p>
<code>strace</code> permite investigarea unui proces aflat deja în rulare. Numim acest lucru atașarea la un proces. Putem astfel investiga apelurile de sistem efectuate de un proces aflat în rulare și diagnostica anumite probleme ale acestuia. Pentru a ne putea atașa la un proces avem nevoie de PID-ul acestuia.
</p>

<p>
Deschideți două tab-uri de terminal (adică să aveți două deschise; dacă aveți deja unul mai deschideți încă unul).
</p>

<p>
<p><div class="notetip">
Pentru a deschide un tab nou de terminal în GNOME Terminal puteți folosi combinația de taste <code>Ctrl+Shift+t</code>.

</div></p>
</p>

<p>
Într-unul dintre tab-uri aflați PID-ul procesului curent (a shell-ului) folosind comanda
</p>
<pre class="code">echo $$</pre>

<p>
Pentru a investiga shell-ul, din celălalt tab folosim comanda
</p>
<pre class="code">strace -p &lt;PID&gt;</pre>

<p>
unde <code>&lt;PID&gt;</code> este PID-ul shell-ului determinat mai sus.
</p>

<p>
Acum dacă în celălalt shell rulăm comenzi vom vedea ce se întâmplă în cadrul shell-ului.
</p>

<p>
Observăm că se folosește apelul de sistem <code>clone</code> pentru a crea un nou proces, dar nu apare apelul de sistem <code>execve</code> care înlocuiește imaginea de proces. Pentru a vedea aceste apeluri de sistem trebuie să precizăm comenzii <code>strace</code> să investigheze și procesele copil folosind opțiunea <code>-f</code> (de la <code>follow children</code>). Astfel, vom putea investiga folosind comanda
</p>
<pre class="code">strace -f -p &lt;PID&gt;</pre>

<p>
Dacă dorim să vedem doar operațiile cu procese și fișiere, de exemplu, vom folosi pentru investigație comanda
</p>
<pre class="code">strace -f -e process,file -p &lt;PID&gt;</pre>

</div>
<!-- EDIT5 SECTION "c) Atașarea la un proces" [1510-3064] -->
<h2 class="sectionedit6" id="demonizarea_proceselor">02. Demonizarea proceselor</h2>
<div class="level2">

</div>
<!-- EDIT6 SECTION "02. Demonizarea proceselor" [3065-3104] -->
<h3 class="sectionedit7" id="a_procese_detasate_de_terminal">a) Procese detașate de terminal</h3>
<div class="level3">

<p>
Sunt cazuri în care dorim să pornim procese detașate de terminal. Adică după pornirea procesului să închidem terminalul și procesul să nu fie “omorât” ci să își încheie execuția. Aceste procese sunt echivalente unor procese daemon.
</p>

<p>
Pentru a detașa un proces de un terminal se folosesc comenzi precum <code>nohup</code>, <code>dtach</code> și <code>disown</code>.
</p>

<p>
Folosiți comanda <code>wget</code> pentru a descărca fișierul <code>.torrent</code> de <a href="http://cdimage.debian.org/debian-cd/8.6.0/amd64/bt-cd/debian-8.6.0-amd64-netinst.iso.torrent" class="urlextern" title="http://cdimage.debian.org/debian-cd/8.6.0/amd64/bt-cd/debian-8.6.0-amd64-netinst.iso.torrent"  rel="nofollow">aici</a>.
</p>

</div>
<!-- EDIT7 SECTION "a) Procese detașate de terminal" [3105-3679] -->
<h3 class="sectionedit8" id="b_disown">b) disown</h3>
<div class="level3">

<p>
Porniți un proces <code>BitTorrent</code> folosind comanda:
</p>
<pre class="code">btdownloadheadless lin-prog.torrent</pre>

<p>
<p><div class="notetip">
Dacă nu aveți <code>btdownloadheadless</code> instalat pe sistem instalați pachetul <code>bittorrent</code>
</p>
<pre class="code">sudo apt-get install bittorrent</pre>

<p>
sau pachetul <code>bittornado</code>
</p>
<pre class="code">sudo apt-get install bittornado</pre>

<p>

</div></p>
</p>

<p>
Transferați procesul pornit în starea de rulare în background. Detașați procesul de terminal folosind comanda <code>disown</code>. Închideți terminalul. Investigați prezența procesului în alt terminal. Folosiți comanda <code>lsof</code> pentru a vedea ce folosește procesul pe post de standard input, standard output și standard error.
</p>

<p>
Apoi încheiați execuția acelui proces.
</p>

</div>
<!-- EDIT8 SECTION "b) disown" [3680-4411] -->
<h3 class="sectionedit9" id="c_nohup">c) nohup</h3>
<div class="level3">

<p>
Folosiți comanda <code>nohup</code> pentru a crea un proces BitTorrent precum cel de mai sus, detașat de terminal. Închideți terminalul. Investigați prezența procesului în alt terminal. Folosiți comanda <code>lsof</code> pentru a vedea ce folosește procesul pe post de standard input, standard output și standard error.
</p>

<p>
Trimiteți un semnal procesului pentru a-i încheia execuția și apoi reporniți-l sub <code>nohup</code> astfel încât ieșirea standard (<em>standard output</em>, <em>stdout</em>) să fie redirectată la <code>/dev/null</code> iar ieșirea de eroare standard (<em>standard error</em>, <em>stderr</em>) să fie redirectată în fișierul <code>err.log</code>. Investigați cu <code>lsof</code> unde pointează descriptorii standard ai procesului.
</p>

</div>
<!-- EDIT9 SECTION "c) nohup" [4412-5139] -->
<h2 class="sectionedit10" id="serviciul_cron">03. Serviciul cron</h2>
<div class="level2">

</div>
<!-- EDIT10 SECTION "03. Serviciul cron" [5140-5171] -->
<h3 class="sectionedit11" id="a_demoinspectarea_configuratiei_cron">a) Demo: Inspectarea configurației cron</h3>
<div class="level3">



<p>
Pentru a vedea configurația <code>cron</code> a sistemului inspectăm configurațiile din fișierele/directoarele <code>/etc/cron*</code>. Fișierele <code>/etc/cron.d/*</code> și fișierul <code>/etc/crontab</code> conțin configurații standard <code>cron</code> la nivelul sistemului. Liniile de configurare urmează sintaxa crontab așa cum este exemplificată <a href="http://techie-experience.blogspot.ro/2012/10/crontab.html" class="urlextern" title="http://techie-experience.blogspot.ro/2012/10/crontab.html"  rel="nofollow">aici</a>.
</p>

<p>
Pentru a vedea configurația pentru utilizatorul curent folosim comanda
</p>
<pre class="code">crontab -l</pre>

<p>
Dacă suntem autentificați ca utilizator privilegiat, putem vizualiza configurația <code>cron</code> pentru un utilizator dat putem folosi comanda
</p>
<pre class="code">crontab -u &lt;username&gt; -l</pre>

<p>
unde <code>&lt;username&gt;</code> este numele utilizatorului a cărui configurație dorim să o afișăm.
</p>

<p>
Pentru a afla job-urile cron active per utilizator putem inspecta, ca utilizator privilegiat, directorul de spooling <code>/var/spool/cron/</code>
</p>
<pre class="code">sudo tree /var/spool/cron/</pre>

<p>
În subdirectorul <code>/var/spool/cron/crontabs/</code> se găsesc job-urile cron active (marcate per utilizator).
</p>

</div>
<!-- EDIT11 SECTION "a) Demo: Inspectarea configurației cron" [5172-6373] -->
<h3 class="sectionedit12" id="b_configurare_cron_cu_standard_output">b) Configurare cron cu standard output</h3>
<div class="level3">

<p>
Dacă dorim să avem un job care să ruleze periodic vom crea o intrare în crontab-ul utilizatorului <code>root</code>.
</p>

<p>
Următorul exercițiu este didactic, ca să putem urmări comportamentul <code>cron</code>.
</p>

<p>
Comanda de mai jos este folosită pentru a afișa numărul de procese și thread-uri curente la nivelul sistemului:
</p>
<pre class="code">/bin/echo &quot;Num processes: $(ps -e --no-header | wc -l), num threads: $(ps -eL --no-header | wc -l)&quot;</pre>

<p>
Folosim calea completă către comanda <code>echo</code> pentru că nu știm cum arată variabila <code>PATH</code> în mediul în care rulează <code>cron</code>.
</p>

<p>
Adăugați comanda de mai sus să ruleze la fiecare două minute prin alterarea crontab-ului utilizatorului <code>root</code>. După adăugare urmăriți spool-ul cron în <code>/var/spool/cron/crontabs/root</code>.
</p>

<p>
În urma funcționării corecte, veți vedea o intrare in <code>/var/log/syslog</code> care arata ca a fost executata comanda.
</p>

<p>
<p><div class="notetip">
Dupa ce configurati regulile de cron, restartati serviciul <code>cron</code>.

</div></p>
</p>

<p>
<p><div class="notetip">
Pentru crearea intrării în crontab-ul utilizatorului <code>root</code> urmăriți indicațiile de <a href="http://techie-experience.blogspot.ro/2012/10/crontab.html" class="urlextern" title="http://techie-experience.blogspot.ro/2012/10/crontab.html"  rel="nofollow">aici</a>.

</div></p>
</p>

</div>
<!-- EDIT12 SECTION "b) Configurare cron cu standard output" [6374-7575] -->
<h3 class="sectionedit13" id="c_alte_configurari_cron">c) Alte configurări cron</h3>
<div class="level3">

<p>
Actualizați comanda din <code>cron</code> de mai sus astfel încât output-ul comenzii să fie adăugat într-un fișier dat. Output-ul să conțină și data la care a fost rulată comanda.
</p>

<p>
Instalați pachetul <code>debsums</code>. Urmăriți ce configurări de cron sunt adăugate la instalarea pachetului.
</p>

<p>
<p><div class="notetip">
Urmăriți conținutului unui pachet instalat folosind comanda
</p>
<pre class="code">dpkg -L &lt;nume-pachet&gt;</pre>

<p>
unde <code>&lt;nume-pachet&gt;</code> este numele pachetului.

</div></p>
</p>

</div>
<!-- EDIT13 SECTION "c) Alte configurări cron" [7576-8072] -->
<h3 class="sectionedit14" id="d_configurare_serviciu_cron_de_pornire_client_bittorrent">d) Configurare serviciu cron de pornire client Bittorrent</h3>
<div class="level3">

<p>
Instalați un client de Bittorrent care funcționează în linia de comandă, precum <code>transmission-cli</code> sau <code>bittorrent</code> sau <code>bittornado</code> și porniți-l în background (folosind <code>nohup</code>) ca să descarce un anumit conținut Bittorrent. Găsiți un fișier <code>.torrrent</code> pe Internet și descărcați-l.
</p>

<p>
Apoi creați un script care să verifice dacă este pornit clientul Bittorrent pentru acel fișier <code>.torrent</code> și dacă nu este pornit să-l repornească.
</p>

<p>
Plasați script-ul în crontab cu verificare la 10 minute.
</p>

</div>
<!-- EDIT14 SECTION "d) Configurare serviciu cron de pornire client Bittorrent" [8073-8669] -->
<h3 class="sectionedit15" id="e_gestionare_client_de_bittorrent_folosind_supervisord">e) Gestionare client de BitTorrent folosind supervisord</h3>
<div class="level3">

<p>
Folosiți <a href="http://supervisord.org/" class="urlextern" title="http://supervisord.org/"  rel="nofollow">supervisord</a> pentru a porni și gestiona clientul BitTorrent de mai sus.
</p>

<p>
<p><div class="notetip">
Urmăriți exemplele de configurare din link-urile de mai jos:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps" class="urlextern" title="https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps"  rel="nofollow">https://www.digitalocean.com/community/tutorials/how-to-install-and-manage-supervisor-on-ubuntu-and-debian-vps</a></div>
</li>
<li class="level1"><div class="li"> <a href="https://serversforhackers.com/monitoring-processes-with-supervisord" class="urlextern" title="https://serversforhackers.com/monitoring-processes-with-supervisord"  rel="nofollow">https://serversforhackers.com/monitoring-processes-with-supervisord</a></div>
</li>
</ul>

<p>

</div></p>
</p>

</div>
<!-- EDIT15 SECTION "e) Gestionare client de BitTorrent folosind supervisord" [8670-9117] -->
<h2 class="sectionedit16" id="serviciul_ntp">04. Serviciul NTP</h2>
<div class="level2">

</div>
<!-- EDIT16 SECTION "04. Serviciul NTP" [9118-9148] -->
<h3 class="sectionedit17" id="a_functionarea_ntp">a) Funcționarea NTP</h3>
<div class="level3">

<p>
Pentru a verifica funcționarea NTP (<em>Network Time Protocol</em>) o soluție este instalarea utilitarului <code>ntpdate</code>. Dacă nu-l aveți instalat, instalați-l folosind comanda
</p>
<pre class="code">sudo apt-get install ntpdate</pre>

<p>
Aveți două utilitare pe care le puteți folosi interschimbabil pentru actualizarea timpului sistemului: <code>ntpdate</code> care primește ca argument un server NTP, și <code>nptdate-debian</code> care folosește serverele configurate în <code>/etc/default/ntpdate</code> (directiva <code>NTPSERVERS</code>).
</p>

</div>
<!-- EDIT17 SECTION "a) Funcționarea NTP" [9149-9678] -->
<h3 class="sectionedit18" id="b_configurare_server_ntp_sincronizare_sisteme">b) Configurare server NTP. Sincronizare sisteme</h3>
<div class="level3">

<p>
Instalați, dacă nu este instalat serverul <code>NTP</code> prin intermediul pachetului <code>ntp</code>. Serverul va porni automat și veți putea verifica faptul că ascultă conexiuni pe portul <code>123</code> UDP folosind comanda
</p>
<pre class="code">sudo netstat -ulpn</pre>

<p>
Discutați cu 2-3 colegi și aflați adrese IP stațiilor pe care aceștia lucrează și adăugați configurare pentru serverul NTP în fișierul <code>/etc/ntp.conf</code>. După un timp se va crea un mesh de comunicare între serverele NTP din sala de laborator.
</p>

<p>
<p><div class="notetip">
Pentru a investiga la orice moment informații despre funcționarea serverului NTP și peer-ii cu care acesta comunică puteți folosi una dintre comenzile de mai jos
</p>
<pre class="code">ntpq -p
ntpq -pn</pre>

<p>

</div></p>
</p>

<p>
<p><div class="notetip">
Informații despre configurarea NTP găsiți în link-urile de mai jos:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://www.debianadmin.com/ntp-server-and-client-configuration-in-debian.html" class="urlextern" title="http://www.debianadmin.com/ntp-server-and-client-configuration-in-debian.html"  rel="nofollow">http://www.debianadmin.com/ntp-server-and-client-configuration-in-debian.html</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.tecmint.com/install-and-configure-ntp-server-client-in-debian/" class="urlextern" title="http://www.tecmint.com/install-and-configure-ntp-server-client-in-debian/"  rel="nofollow">http://www.tecmint.com/install-and-configure-ntp-server-client-in-debian/</a></div>
</li>
</ul>

<p>

</div></p>
</p>

</div>
<!-- EDIT18 SECTION "b) Configurare server NTP. Sincronizare sisteme" [9679-10707] -->
<h2 class="sectionedit19" id="jurnalizare">05. Jurnalizare</h2>
<div class="level2">

</div>
<!-- EDIT19 SECTION "05. Jurnalizare" [10708-10736] -->
<h3 class="sectionedit20" id="a_investigare_configuratie_syslog">a) Investigare configuratie syslog</h3>
<div class="level3">

<p>
Pe mașina virtulă verificați dacă daemonul de syslog este instalat (Hint: rsyslog).
</p>
<pre class="code">root@heimdall:~# apt-get install rsyslog
Reading package lists... Done
Building dependency tree       
Reading state information... Done
rsyslog is already the newest version.
0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</pre>

</div>
<!-- EDIT20 SECTION "a) Investigare configuratie syslog" [10737-11125] -->
<h3 class="sectionedit21" id="b_reguli_de_jurnalizare">b) Reguli de jurnalizare</h3>
<div class="level3">

<p>
Adaugati în <code>/etc/rsyslog.conf</code> o intrare prin care TOATE mesajele din sistem sa fie înregistrate în <code>/var/log/all_logs</code>
</p>
<pre class="code">root@heimdall:~# tail -n 1 /etc/rsyslog.conf
*.*		-/var/log/all_logs

Se adauga un minus (-) pentru a se evita sincronizarea fisierului dupa fiecare mesaj syslog (fiind vorba despre toate mesajele din sistem).</pre>

<p>
Creati fisierul <code>/var/log/all_logs</code>, apoi configurati owner-ul ca fiind user-ul sub care ruleaza <code>rsyslog</code>:
</p>
<pre class="code"># touch /var/log/all_logs
# chown syslog:adm /var/log/all_logs</pre>

<p>
Reporniți daemonul <code>rsyslog</code> și verificați conținutul fișierului <code>/var/log/all_logs</code>.
</p>
<pre class="code">root@heimdall:~# /etc/init.d/rsyslog restart
Stopping enhanced syslogd: rsyslogd.
Starting enhanced syslogd: rsyslogd.

root@heimdall:~# tail /var/log/all_logs 
Nov  9 15:34:04 heimdall kernel: imklog 5.8.5, log source = /proc/kmsg started.
Nov  9 15:34:04 heimdall rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.5&quot; x-pid=&quot;2604&quot; x-info=&quot;http://www.rsyslog.com&quot;] start</pre>

</div>
<!-- EDIT21 SECTION "b) Reguli de jurnalizare" [11126-12191] -->
<h3 class="sectionedit22" id="c_generate_mesaje_cu_logger">c) Generate mesaje cu logger</h3>
<div class="level3">

<p>
Folosind comanda <code>logger</code>, generați 5 mesaje de log cu facilitatea mail și cu proritatea info, care să conțină textele “mail log 1” … “mail log 5”. Verificați prezența mesajelor în <code>/var/log/all_logs</code>.
</p>
<pre class="code">root@heimdall:~# logger -p mail.info &quot;mail log 1&quot;

root@heimdall:~# logger -p mail.info &quot;mail log 2&quot;

root@heimdall:~# logger -p mail.info &quot;mail log 3&quot;

root@heimdall:~# logger -p mail.info &quot;mail log 4&quot;

root@heimdall:~# logger -p mail.info &quot;mail log 5&quot;

root@heimdall:~# tail /var/log/all_logs 
Nov  9 15:34:04 heimdall kernel: imklog 5.8.5, log source = /proc/kmsg started.
Nov  9 15:34:04 heimdall rsyslogd: [origin software=&quot;rsyslogd&quot; swVersion=&quot;5.8.5&quot; x-pid=&quot;2604&quot; x-info=&quot;http://www.rsyslog.com&quot;] start
Nov  9 15:36:55 heimdall root: mail log 1
Nov  9 15:36:57 heimdall root: mail log 2
Nov  9 15:36:58 heimdall root: mail log 3
Nov  9 15:36:59 heimdall root: mail log 4
Nov  9 15:37:00 heimdall root: mail log 5</pre>

</div>
<!-- EDIT22 SECTION "c) Generate mesaje cu logger" [12192-13182] -->
<h3 class="sectionedit23" id="d_rotirea_fisierelor_de_log">d) Rotirea fisierelor de log</h3>
<div class="level3">

<p>
Modificați <code>/etc/logrotate.conf</code> astfel încat fisierul <code>/var/log/all_logs</code> să fie rotit zilnic, folosind până la maxim 10 fișiere, fișire care să fie comprimate. Logurile trebuie să fie trimiste pe email la sysadmin@gsr.cs.pub.ro. (Hint: <code>man logrotate</code>)
</p>
<pre class="code">root@heimdall:~# tail -n 8 /etc/logrotate.conf
/var/log/all_logs {
	missingok
	daily
	create 0660 root utmp
	compress
	rotate 10
	mail sysadmin@gsr.cs.pub.ro
}</pre>



</div>
<!-- EDIT23 SECTION "d) Rotirea fisierelor de log" [13183-] --></div>
</body>
</html>
