    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>iot2015:labs:10</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-06-17T15:45:22+0300"/>
<meta name="keywords" content="iot2015,labs,10"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=iot2015:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="10.html"/>
<link rel="canonical" href="../../../../iot2015/labs/10.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='iot2015:labs';var JSINFO = {"id":"iot2015:labs:10","namespace":"iot2015:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="10.html#lab_10user_interface_and_user_experience">Lab 10: User Interface and User Experience</a></div></li>
<li class="level2"><div class="li"><a href="10.html#create_blank_pages_and_link_the_menu">1) Create blank pages and link the menu</a></div></li>
<li class="level2"><div class="li"><a href="10.html#inputs_buttons_and_message_boxes">2) Inputs, buttons and message boxes</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="10.html#alerts_and_timing">Alerts and Timing</a></div></li>
<li class="level3"><div class="li"><a href="10.html#css_selectors_input_boxes_and_values">CSS selectors,input boxes and values</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="10.html#displaying_the_news">3) Displaying the news</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h2 class="sectionedit1" id="lab_10user_interface_and_user_experience">Lab 10: User Interface and User Experience</h2>
<div class="level2">

<p>
In this laboratory we will try to see different ways we can interact interact programmatically with the interface from javascript.
</p>

<p>
In order to do these exercises you will need a new phoengap project and the IoT template. Also, in order to make builds, you will need an adobe account to access phonegap build.
</p>

</div>
<!-- EDIT1 SECTION "Lab 10: User Interface and User Experience" [1-367] -->
<h2 class="sectionedit2" id="create_blank_pages_and_link_the_menu">1) Create blank pages and link the menu</h2>
<div class="level2">

<p>
For starters we will need the following pages:
</p>
<ul>
<li class="level1"><div class="li"> news (which will display some news)</div>
</li>
<li class="level1"><div class="li"> chat (will allow the IoT app users to chat)</div>
</li>
<li class="level1"><div class="li"> images (display a gallery of images uploaded by IoT App users)</div>
</li>
<li class="level1"><div class="li"> sensors (interact with your boards)</div>
</li>
<li class="level1"><div class="li"> templates (a page that should never be shown to the users which will contain copies of the <abbr title="HyperText Markup Language">HTML</abbr> elements you need to use in the code)</div>
</li>
</ul>

<p>
Don&#039;t forget to give each page and ID and for testing purposes also write the name of the page inside the page.
Eg:
</p>
<pre class="code">&lt;div id=&quot;news&quot; data-role=&quot;page&quot;&gt;
   news
&lt;/div&gt;</pre>

<p>
Now that you&#039;ve created the pages start linking them to the menu by creating buttons as shown in the course:
Eg:
</p>
<pre class="code">&lt;li&gt;
  &lt;a href=&quot;#news&quot;&gt;
    &lt;i class=&quot;fa fa-newspaper-o&quot;&gt;&lt;/i&gt; News
  &lt;/a&gt;
&lt;/li&gt;</pre>

<p>
In your template you will find the close button already defined, so start creating your own buttons after that. Also try assigning a relevant icon to each menu item.
</p>

<p>
You should achieve an end result similar with the one presented in the course.
</p>

</div>
<!-- EDIT2 SECTION "1) Create blank pages and link the menu" [368-1424] -->
<h2 class="sectionedit3" id="inputs_buttons_and_message_boxes">2) Inputs, buttons and message boxes</h2>
<div class="level2">

</div>
<!-- EDIT3 SECTION "2) Inputs, buttons and message boxes" [1425-1475] -->
<h3 class="sectionedit4" id="alerts_and_timing">Alerts and Timing</h3>
<div class="level3">

<p>
The standard way to display a message box on the web is alert() for a notification base message box, confirm() for a yes/no answer message box.
</p>

<p>
The normal usage for the 2 is
</p>
<pre class="code">alert(&quot;Welcome&quot;);
if( confirm(&#039;Are you human?&#039;) ){
  //code for yes
}else{
  //code for no
}</pre>

<p>
There is a problem with apple phones where they need a delay of at least 0ms (a delay of 0 might not make sense but it actually waits 1 event loop cycle which can be less than 1ms) in order to show alerts. This problem exist for more elements not just alerts.
In javascript there are 2 main timing methods: setTimeout which delays a function and setInterval which run a function at set intervals.
</p>
<pre class="code">var id_of_timer = setTimeout(callback, time); //  to create a delay
clearTimeout(id_of_timer); // to delete the delay before it actually runs

var id_of_timer = setInterval(callback, time); //  to create an interval
clearInterval(id_of_timer); // to delete the interval</pre>

<p>
the callback can be the name of a function,method created before or an anonymous function crated in place:
</p>
<pre class="code">setTimeout(show_alert,0);

or

setTimeout(function(){
  alert(&quot;Hello&quot;);
},0);</pre>

<p>
This is true for any callbacks in javascript. You can always either point to a method/function or create a new one on the spot.
</p>

</div>
<!-- EDIT4 SECTION "Alerts and Timing" [1476-2801] -->
<h3 class="sectionedit5" id="css_selectors_input_boxes_and_values">CSS selectors,input boxes and values</h3>
<div class="level3">

<p>
jQuery (and javascript in general, we use jQuery for simplification) allows us to access elements by providing a css selector towards them. The selection can result 0,1 or more elements.
</p>

<p>
A css selector can select elements based on tag,id,class,attributes and many other constraints, but we will stick to tag id and class here.
An html/xml node in general looks like
</p>
<pre class="code">&lt;tag_name id=&quot;id&quot; class=&quot;class1 class2 class3&quot; attr1=&quot;attr1 value&quot; attr2=&quot;attr2 value&quot;&gt;
  html content
&lt;/tag_name&gt;</pre>

<p>
Even if browsers allow you to give the same id to multiple elements, <strong>each id needs to be unique</strong> for things to work properly.
In order to select a certain element the selector can be:
</p>
<pre class="code">tag_name#id.class
 </pre>

<p>
but each part can be omitted. In this case for example since the id is already unique there is no need to mention the tag_name and the class so
</p>
<pre class="code">#id</pre>

<p>
should suffice.
</p>

<p>
Also in order to select certain children we can use ”&gt;” or ” ” (black space) where
</p>
<pre class="code">#id&gt;div /*selects all the divs that are direct children of the tag with id #id*/
#id div /*selects all the divs that are children(including grandchildren) of the tag with id #id*/</pre>

<p>
For a complete list of <abbr title="Cascading Style Sheets">CSS</abbr> selectors check <a href="http://www.w3schools.com/cssref/css_selectors.asp" class="urlextern" title="http://www.w3schools.com/cssref/css_selectors.asp"  rel="nofollow">here</a>.
</p>

<p>
In order to select an element from javascript
</p>
<pre class="code">$(cssSelector as string); // EG $(&quot;#username&quot;)</pre>

<p>
This call returns a jQuery object on which we can use jQuery methods to modify the <abbr title="HyperText Markup Language">HTML</abbr> node.
</p>

<p>
In order to retrieve or change the contents of a javascript element we can muse the .html() jQuery method.
</p>
<pre class="code">&lt;div id=&quot;example&quot;&gt;
  &lt;p&gt;Example&lt;/p&gt;
&lt;/div&gt;</pre>

<p>
For the above code:
</p>
<pre class="code">$(&quot;#example&quot;).html(); //would return  &lt;p&gt;Example&lt;/p&gt;
$(&quot;#example&quot;).html(&quot;hi&quot;);
/* would change the node too
   &lt;div id=&quot;example&quot;&gt;
     hi
   &lt;/div&gt;
*/</pre>

<p>
Now, let&#039;s go to the chat page and create some interactive input boxes and buttons.
Since this page will represent a chat box we need to divide our space in 2:
</p>
<ul>
<li class="level1"><div class="li"> top part = diplaying the messages</div>
</li>
<li class="level1"><div class="li"> bottom part allowing user to send messages</div>
</li>
</ul>

<p>
In order to do that just copy the following code into your page
</p>
<pre class="code">&lt;div id=&quot;chat_controls&quot;&gt;
&lt;/div&gt;
&lt;div id=&quot;chat_box&quot;&gt;
&lt;/div&gt;</pre>

<p>
Now add to chat controls 2 input text boxes and a button. The code for generating an input box in html is
</p>
<pre class="code">&lt;input type=&quot;text&quot;&gt;</pre>

<p>
give the first input id username and the 2nd one id msg. After the 2 inputs include a button from the ones offered by the template.
</p>

<p>
The javasript will be written in teh index.js file (it can be written anywhere but in general event handling should be broken apart from design).
The general structure of an phoengap app is an app object containing properties and methods. The properties are used to store data and states of the apps while the methods are usuall used for events.
Your send button should be accessible by the
</p>
<pre class="code">$(&quot;chat_controls&gt;button&quot;) //cause there should be only one button</pre>

<p>
So in order to keep with the phonegap app structure instead of writing the whole code in bindEvents we should link a chatSend event.
</p>
<pre class="code">app={
  bindEvents: function(){
    
    ...other event binding code here ...
    
    $(&quot;chat_controls&gt;button&quot;).click(app.chatSend); //this jQuery method links 
    // the given function/method to the click event
    // click events can be linked to any html elemtns and not just buttons
  },
  chatSend:function(){
    //code for chatSend here
  }
  
}</pre>

<p>
In order to get values from input boxes the .val() jQuery method should be used:
</p>
<pre class="code">$(selector).val();</pre>

<p>
Now what we want is to display the message from the input box into the chat_box on click. We will do the following changes in the chatSend method:
</p>
<pre class="code">var user = $(&quot;#username&quot;).val(); //get username
var msg = $(&quot;#msg&quot;).val(); // get msg
var new_div = $(&quot;&lt;div&gt;&quot;+user+&quot;:&quot;+msg+&quot;&lt;/div&gt;&quot;); // create a new div
// the div will look like &lt;div&gt;user:msg&lt;/div&gt;
$(&quot;#chat_box&quot;).append(new_div);
//append new div to chat_box
//the append jQuery method adds new children to an HTML element.</pre>

<p>
Your own messages should now appear in the chatbox.
</p>

</div>
<!-- EDIT5 SECTION "CSS selectors,input boxes and values" [2802-6882] -->
<h2 class="sectionedit6" id="displaying_the_news">3) Displaying the news</h2>
<div class="level2">

<p>
For starters, since we do not learn how to fetch info from the server in this laboratory, we
will need to use some test data. so copy the following declaration at the start of your index.js.
</p>
<pre class="code">var test_news=[
	{
		pk:&quot;1&quot;,
		title:&quot;Title 1&quot;,
		content:&quot;Description 1&quot;,
		image:&quot;http://ocw.cs.pub.ro/courses/res/sigla_iot.png&quot;
	},
	{
		pk:&quot;2&quot;,
		title:&quot;Title 2&quot;,
		content:&quot;Description 2&quot;,
		image:&quot;http://ocw.cs.pub.ro/courses/res/sigla_iot.png&quot;
	},
	{
		pk:&quot;3&quot;,
		title:&quot;Title 3&quot;,
		content:&quot;Description 3&quot;,
		image:&quot;http://ocw.cs.pub.ro/courses/res/sigla_iot.png&quot;
	},
	{
		pk:&quot;4&quot;,
		title:&quot;Title 4&quot;,
		content:&quot;Description 4&quot;,
		image:&quot;http://ocw.cs.pub.ro/courses/res/sigla_iot.png&quot;
	},
	{
		pk:&quot;5&quot;,
		title:&quot;Title 5&quot;,
		content:&quot;Description 5&quot;,
		image:&quot;http://ocw.cs.pub.ro/courses/res/sigla_iot.png&quot;
	}
];</pre>

<p>
We will need a method which should be called at certain intervals to update the news page. For this create a new method/event in the app called udpateNews and inside bindEvents set an interval for it to run every 5 seconds.
</p>
<pre class="code">setInterval(app.updateNews, 5000);
app.udpateNews();//call once the update method in order to initialize
// the page (this line should be in initialization phase and not in bind events)</pre>

<p>
Now in updateNews initialize a variable with the value from test_news (we wil later initialize it with data from server) and then parse it and create the proper card elements for it. Don&#039;t forget to have a card element in the template page, we will clone this element in order to create our news elements. In jQuery we can run a <abbr title="Cascading Style Sheets">CSS</abbr> selector on an already selected element
EG:
</p>
<pre class="code">$(&quot;#id&quot;).find(&quot;li&quot;);</pre>

<p>
will select all the li items from the result of the first query. But remember that when we can write the selector as a single selector it&#039;s better to write it as
</p>
<pre class="code">$(&quot;#id li&quot;);</pre>

<p>
the find method is useful in situation where we can&#039;t write it in a single query, like when we want to run a query on a cloned element.
</p>
<pre class="code">updateNews: function(){
  var news = test_news;
  $(&quot;#news&quot;).html(&quot;&quot;); // we empty the contents of the page
  for(var i=0; i&lt;news.length; i++){
    var card = $(&quot;#templates&gt;.card&quot;).clone();
    card.find(&quot;.title&quot;).html(news[i].title); //set .title element of the card
    card.find(&quot;.content&quot;).html(news[i].content); //set .content element of the card
    card.find(&quot;.img&quot;).attr(&quot;src&quot;,news[i].image); //set src attribute of the image
    card.attr(&quot;data-pk&quot;,news[i].pk); //set a custom pk attribute to store the pk
    card.find(/*selector of the read more button*/).click(function(){
      //on click display in console the pk of the clicked card
      console.log($(this).parent().parent().attr(&quot;data-pk&quot;));
    });
    $(&quot;#news&quot;).append(card); //add card to page
   }
}</pre>

<p>
The above code will redraw the page every 5 seconds and when a “read more” button is pressed it will print in the javscript console the pk of the read more that was pressed. This is helpful for when we want to show the whole article in order to know which article we need to request from the server.
</p>

</div>
<!-- EDIT6 SECTION "3) Displaying the news" [6883-] --></div>
</body>
</html>
