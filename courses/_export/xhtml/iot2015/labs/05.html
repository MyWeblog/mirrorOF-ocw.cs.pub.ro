    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>iot2015:labs:05</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-06-17T15:45:22+0300"/>
<meta name="keywords" content="iot2015,labs,05"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=iot2015:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="05.html"/>
<link rel="canonical" href="../../../../iot2015/labs/05.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='iot2015:labs';var JSINFO = {"id":"iot2015:labs:05","namespace":"iot2015:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="05.html#lab_5connecting_analog_sensors_to_the_board_and_adding_charts">Lab 5: Connecting Analog Sensors to the board and adding charts</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="05.html#build_a_virtual_thermometer">Build a virtual thermometer</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="05.html#what_you_need">What you need</a></div></li>
<li class="level3"><div class="li"><a href="05.html#the_setup">The setup</a></div></li>
<li class="level3"><div class="li"><a href="05.html#the_code">The Code</a></div></li>
<li class="level3"><div class="li"><a href="05.html#use_a_thermistor">Use a thermistor</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="05.html#see_how_the_light_changes_in_a_room">See how the light changes in a room</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="05.html#the_setup1">The Setup</a></div></li>
<li class="level3"><div class="li"><a href="05.html#the_code1">The Code</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="05.html#exercises">Exercises</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="lab_5connecting_analog_sensors_to_the_board_and_adding_charts">Lab 5: Connecting Analog Sensors to the board and adding charts</h1>
<div class="level1">

<p>
At the end of this project you will know how to get data from different sensors you can place around your home and display the gathered data on graphs. 
</p>

<p>
In case you want to use a Raspberry Pi, please note that  you will need to use an Arduino as well. 
No analog pin dependent piece can be used with your Raspberry Pi only. You will need the help of an Arduino board.
</p>

<p>
Let&#039;s begin with the temperature sensor. 
</p>

</div>
<!-- EDIT1 SECTION "Lab 5: Connecting Analog Sensors to the board and adding charts" [1-490] -->
<h2 class="sectionedit2" id="build_a_virtual_thermometer">Build a virtual thermometer</h2>
<div class="level2">

</div>
<!-- EDIT2 SECTION "Build a virtual thermometer" [491-531] -->
<h3 class="sectionedit3" id="what_you_need">What you need</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> One temperature sensor; </div>
</li>
<li class="level1"><div class="li"> Three jumper wires;</div>
</li>
<li class="level1"><div class="li"> One Edison connected to Wyliodrin.</div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "What you need" [532-648] -->
<h3 class="sectionedit4" id="the_setup">The setup</h3>
<div class="level3">

<p>
<a href="../../../../_detail/iot2015/labs/tempstreams.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:tempstreams.png"><img src="../../../../_media/iot2015/labs/tempstreams.png%3Fw=450&amp;tok=0c96bb" class="mediacenter" alt="" width="450" /></a>
</p>

<p>
In this figure you can see a 3-leg temperature sensor. 
There is an alternative to this one, the thermistor. The latter has two legs and it should be connected as a voltage divider, which is explained in the electronics chapter. 
</p>

<p>
In this case, the sensor needs to be connected to the GND pin, the VCC and an analog pin. This sensor consists of a thermistor and several other electronic pieces. The leg situated in the middle outputs a different voltage depending on the temperature.
</p>

</div>
<!-- EDIT4 SECTION "The setup" [649-1195] -->
<h3 class="sectionedit5" id="the_code">The Code</h3>
<div class="level3">

<p>
In order to get the values from the the temperature sensor you will just have to use the usual <em>Analog read</em> blocks and read the analog pin. The values that you obtain are in a range of 0 to 1023. However, this doesn&#039;t look at all like the values you would expect from a thermometer. 
</p>

<p>
To transform these values into Celsius degrees, you are going to use this formula.  <br/>

<strong>temperature= (value*5/1024-0.500)*100</strong><br/>

How does it look in Streams programming language? You need no more than 3 nodes.
<a href="../../../../_detail/iot2015/labs/tempsenz.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:tempsenz.png"><img src="../../../../_media/iot2015/labs/tempsenz.png%3Fw=400&amp;tok=e1e0c8" class="mediacenter" alt="" width="400" /></a>
The first mandatory one, which is <em>run</em>. The next one will read the value that comes from the analog pin, in this case A0. Now the payload of the message sent will be this very value, between 0 and 1023. Now, you have to convert it to Celsius degrees.
</p>

<p>
To get from this value to Celsius degrees you have to follow the formula above. The resulting value is stored in the <em>temperature</em> variable. 
</p>

<p>
To write the formula you can use either a visual node or a formula node. Choose the latter and the code inside should look like the one in the next figure.
<a href="../../../../_detail/iot2015/labs/tempfct.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:tempfct.png"><img src="../../../../_media/iot2015/labs/tempfct.png%3Fw=400&amp;tok=d205e1" class="mediacenter" alt="" width="400" /></a>
In this JavaScipt function you create an object called <em>new_message</em> and a variable with the value of the message from the payload. Next, you apply the formula from which you obtain the temperature in degrees and make it the message to be sent forward. Your function will return this very message. 
</p>

<p>
As promised, you will now display the temperature on a thermometer using the <em>send signal</em> node. 
</p>

<p>
In dashboard choose the thermometer and assign it a signal with the same name as use the nodes
<a href="../../../../_detail/iot2015/labs/dashtermo.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:dashtermo.png"><img src="../../../../_media/iot2015/labs/dashtermo.png%3Fw=400&amp;tok=8e5c2a" class="mediacenter" alt="" width="400" /></a>
</p>

<p>
The <em>send signal</em> node stores the value it receives from the previous block and sends it further to the dashboard, where a graph with the exact same name as the node&#039;s signal is searched. Once found, the connection is established. The node will receive the signal the data, store it and send it to the graph via a signal.  
</p>

</div>
<!-- EDIT5 SECTION "The Code" [1196-3210] -->
<h3 class="sectionedit6" id="use_a_thermistor">Use a thermistor</h3>
<div class="level3">

<p>
As mentioned at the beginning, the same project can be easily built with a thermistor. 
</p>

<p>
 Note that there is a difference between the two sensors, consisting of the fact that the temperature sensor previously used has a linear resistance-temperature characteristic, while the other one usually has the output voltage as a logarithmic or exponential function. 
</p>

<p>
The wiring is quite simple, just follow the schematics of a voltage divider. 
<a href="../../../../_detail/iot2015/labs/thermistored.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:thermistored.png"><img src="../../../../_media/iot2015/labs/thermistored.png%3Fw=400&amp;tok=bcd034" class="mediacenter" alt="" width="400" /></a>
For the code you will need to know that this time the formulas you use are different to convert the values into Centigrade.<br/>

<strong>V_m = analogRead(pin) * 5/1023</strong><br/>

<strong>R_t = 5/V_m * 10000</strong><br/>

<strong>Ratio = 1/B* ln(R_t/10000)</strong><br/>

<strong>temperature = 1/(1/298 + Ratio)</strong><br/>

B = 4050, is one of the constants that comes with the sensor&#039;s specifications.
</p>

<p>
Vm is the voltage that you get in your analog input while Rt is the resistance of the thermistor. By having this value, you just have to apply the following formulas and you will obtain the temperature in Celsius degrees.
You only have to calculate what the formulas above will give and put it in a variable. Send the value of this variable to the thermometer in the Dashboard. 
The only difference will be in the function that you use to do the conversion.
<a href="../../../../_detail/iot2015/labs/termifct.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:termifct.png"><img src="../../../../_media/iot2015/labs/termifct.png%3Fw=450&amp;tok=0e0e2f" class="mediacenter" alt="" width="450" /></a>
In Visual Programming, the same function would look like this:
<a href="../../../../_detail/iot2015/labs/termivisual.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:termivisual.png"><img src="../../../../_media/iot2015/labs/termivisual.png%3Fw=450&amp;tok=56bdfd" class="mediacenter" alt="" width="450" /></a>
</p>

</div>
<!-- EDIT6 SECTION "Use a thermistor" [3211-4659] -->
<h2 class="sectionedit7" id="see_how_the_light_changes_in_a_room">See how the light changes in a room</h2>
<div class="level2">

<p>
You that now have a thermometer can you find something extra to make it more interesting? Try a light sensor.
</p>
<ul>
<li class="level1"><div class="li">  One photocell;</div>
</li>
<li class="level1"><div class="li">  One 220 $\Omega$ resistor;</div>
</li>
<li class="level1"><div class="li">  Three jumper wires.</div>
</li>
</ul>

</div>
<!-- EDIT7 SECTION "See how the light changes in a room" [4660-4895] -->
<h3 class="sectionedit8" id="the_setup1">The Setup</h3>
<div class="level3">

<p>
<a href="../../../../_detail/iot2015/labs/light.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:light.png"><img src="../../../../_media/iot2015/labs/light.png%3Fw=400&amp;tok=35ec6a" class="mediacenter" alt="" width="400" /></a>
</p>

<p>
The photocell works just like a voltage divider, as well (check the <em>Introduction to Electronics</em> chapter for more details). You need to connect it to the Gnd and Vcc and from between the photocell and the resistor to the analog pin of the board. This light sensor has a resistance that varies with the light, the more light there is, the lower the resistance of the photocell. Depending on how you place the sensor you can obtain a pull up or pull down voltage divider.
</p>

</div>
<!-- EDIT8 SECTION "The Setup" [4896-5424] -->
<h3 class="sectionedit9" id="the_code1">The Code</h3>
<div class="level3">

<p>
The new nodes are much simpler. You just add a block to read the analog pin that you use and send it to the chart. 
<a href="../../../../_detail/iot2015/labs/lightstreams.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:lightstreams.png"><img src="../../../../_media/iot2015/labs/lightstreams.png%3Fw=400&amp;tok=dcce12" class="mediacenter" alt="" width="400" /></a>
</p>

</div>
<!-- EDIT9 SECTION "The Code" [5425-5602] -->
<h2 class="sectionedit10" id="exercises">Exercises</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> Connect a photoresistor. Send the values to a chart. Set a maximum value. In case the sensor detects a value higher that the maximum, an LED will turn on for a few seconds.</div>
</li>
<li class="level1"><div class="li">  Do the same, but set the limit value from a slider, in the dashboard. This slider gives values between 0 and a maximum of your choice.  </div>
</li>
<li class="level1"><div class="li"> For this exercise you will have to make a chart using the values of a photoresistor as well, only that this time, the team next to you will have the sensor and they will send a signal with its values. You will receive this values and send them to the dashboard. In short, make a line chart using the values of a photoresistor connected to the neighbour&#039;s board. <br/>
<a href="../../../../_detail/iot2015/labs/boardid.png%3Fid=iot2015%253Alabs%253A05.html" class="media" title="iot2015:labs:boardid.png"><img src="../../../../_media/iot2015/labs/boardid.png%3Fw=300&amp;tok=e2e0f7" class="mediacenter" alt="" width="300" /></a> <br/>
 <strong> Hint</strong> In order to get a message from another board, you will need its Board ID. To find it, go to the main IOT page and in the boards settings, choose BoardID.</div>
</li>
<li class="level1"><div class="li">  Use a thermistor. You need to find online the value <em> B </em> and it&#039;s resistance at 25 degrees. Put its values in degrees in a thermometer chart.  <br/>
<strong>Hint</strong> You will wire it as a voltage divider with a similar resistance. </div>
</li>
</ol>

</div>
<!-- EDIT10 SECTION "Exercises" [5603-] --></div>
</body>
</html>
