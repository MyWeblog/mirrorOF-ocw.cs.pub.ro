    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>programare:laboratoare:lab12cb</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2014-01-13T20:38:15+0200"/>
<meta name="keywords" content="programare,laboratoare,lab12cb"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=programare:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="lab12cb.html"/>
<link rel="canonical" href="../../../../programare/laboratoare/lab12cb.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='programare:laboratoare';var JSINFO = {"id":"programare:laboratoare:lab12cb","namespace":"programare:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level2"><div class="li"><a href="lab12cb.html#laborator_recapitulativ">Laborator recapitulativ</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="lab12cb.html#obiective">Obiective</a></div></li>
<li class="level3"><div class="li"><a href="lab12cb.html#parametrii_liniei_de_comanda">Parametrii liniei de comandă</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="lab12cb.html#enuntul_laboratorului">Enuntul laboratorului</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="lab12cb.html#tools">Tools</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="lab12cb.html#cerinte_laborator">Cerinte Laborator</a></div></li>
<li class="level2"><div class="li"><a href="lab12cb.html#bonus">Bonus</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h2 class="sectionedit1" id="laborator_recapitulativ">Laborator recapitulativ</h2>
<div class="level2">

<p>
<strong>Responsabil:</strong> <a href="mailto:&#x62;&#x6f;&#x67;&#x64;&#x61;&#x6e;&#x2e;&#x6e;&#x69;&#x63;&#x75;&#x6c;&#x61;&#x32;&#x32;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;" class="mail" title="&#x62;&#x6f;&#x67;&#x64;&#x61;&#x6e;&#x2e;&#x6e;&#x69;&#x63;&#x75;&#x6c;&#x61;&#x32;&#x32;&#x40;&#x67;&#x6d;&#x61;&#x69;&#x6c;&#x2e;&#x63;&#x6f;&#x6d;">Bogdan Nicula</a>
</p>

</div>
<!-- EDIT1 SECTION "Laborator recapitulativ" [1-100] -->
<h3 class="sectionedit2" id="obiective">Obiective</h3>
<div class="level3">

<p>
Laboratorul este unul recapitulativ, dar vom introduce şi o notiune nouă:
</p>
<ul>
<li class="level1"><div class="li"> parametrii liniei de comandă</div>
</li>
</ul>

<p>
In cadrul acestui laborator studentul va recapitula urmatoarele noţiuni:
</p>
<ul>
<li class="level1"><div class="li"> pointeri</div>
</li>
<li class="level1"><div class="li"> structuri</div>
</li>
<li class="level1"><div class="li"> operaţii cu fişiere</div>
</li>
<li class="level1"><div class="li"> alocare dinamica</div>
</li>
<li class="level1"><div class="li"> prelucrarea şirurilor de caractere</div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Obiective" [101-421] -->
<h3 class="sectionedit3" id="parametrii_liniei_de_comanda">Parametrii liniei de comandă</h3>
<div class="level3">

<p>
Pentru a controla execuţia unui program, de multe ori este de dorit furnizarea datelor de lucru înaintea lansării în execuţie a programului, acesta urmând să se execute apoi fără intervenţia utilizatorului (aşa-numitul „batch mode”). Acest lucru se realizează prin intermediul parametrilor liniei de comandă. (Un exemplu cunoscut este lansarea compilatorului gcc în linia de comandă cu diverse argumente, care îi spun ce şi cum sa compileze.)
</p>

<p>
Din punct de vedere al utilizatorului, parametrii liniei de comandă sunt simple argumente care se adaugă după numele unui program, în linia de comandă, la rularea sa. Elementele acestei liste de argumente sunt şiruri de caractere separate de spaţii. Argumentele care conţin spaţii pot fi confinate într-un singur argument prin inchiderea acestuia între ghilimele. Shell-ul este cel care se ocupă de parsarea liniei de comandă şi de crearea listei de argumente.
</p>

<p>
Exemplu de apelare a unui program cu argumente în linia de comandă:
</p>
<pre class="code bash"><span class="kw2">gcc</span> <span class="re5">-Wall</span> -I<span class="sy0">/</span>usr<span class="sy0">/</span>include<span class="sy0">/</span>sys <span class="re5">-DDEBUG</span> <span class="re5">-o</span> <span class="st0">&quot;My Shell&quot;</span> myshell.c</pre>

<p>
În acest caz, argumentele liniei de comandă sunt în acest caz:
</p>
<ul>
<li class="level1"><div class="li"> gcc</div>
</li>
<li class="level1"><div class="li"> -Wall</div>
</li>
<li class="level1"><div class="li"> -I/usr/include/sys</div>
</li>
<li class="level1"><div class="li"> -DDEBUG</div>
</li>
<li class="level1"><div class="li"> -o</div>
</li>
<li class="level1"><div class="li"> My Shell</div>
</li>
<li class="level1"><div class="li"> myshell.c</div>
</li>
</ul>

<p>
Din punct de vedere al programatorului, parametrii liniei de comandă sunt accesibili prin utilizarea parametrilor funcţiei main(). Astfel, când se doreşte folosirea argumentelor liniei de comandă, funcţia main() se va defini astfel:
</p>
<pre class="code c"><span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">int</span> argc<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">*</span>argv<span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#41;</span></pre>

<p>
Astfel, funcţia <strong>main()</strong> primeşte, în mod formal, doi parametri, un întreg şi un vector de şiruri de caractere. Numele celor două variabile nu e obligatoriu să fie <strong>argc</strong> şi <strong>argv</strong>, dar tipul lor, da. Semnificaţia lor este următoarea:
</p>
<ul>
<li class="level1"><div class="li"> <strong>int argc</strong> (argument count) - reprezintă numărul de parametrii ai liniei de comandă. După cum se vede din exemplul anterior, există cel puţin un parametru, acesta fiind chiar numele programului (numele care a fost folosit pentru a lansa în execuţie programul - şi care poate fi diferit de numele executabilului - de exemplu prin crearea unui symlink, în Linux).</div>
</li>
<li class="level1"><div class="li"> <strong>char *argv[]</strong> (arguments value) - reprezintă un vector de şiruri de caractere, având <strong>argc</strong> elemente (indexate de la <strong>0</strong> la <strong>argc - 1</strong>). Întotdeauna <strong>argv[0]</strong> conţine numele programului.</div>
</li>
</ul>

<p>
Parametrii liniei de comandă se pot accesa prin intermediul vectorului <strong>argv</strong> şi pot fi prelucraţi cu funcţiile standard de prelucrare a şirurilor de caractere.
</p>

</div>
<!-- EDIT3 SECTION "Parametrii liniei de comandă" [422-3009] -->
<h2 class="sectionedit4" id="enuntul_laboratorului">Enuntul laboratorului</h2>
<div class="level2">

<p>
Vom simula baza de date a unui laborator de analize. O parte din aceasta va fi deja implementata, iar voi trebuie doar sa aduceti imbunatatiri codului deja-existent.
</p>

<p>
Baza de date va avea urmatoarea structura:
</p>

<p>
Se dau urmatoarele 2 tipuri:
</p>

<p>
<strong>Pers</strong>
</p>

<p>
Reprezinta un pacient. Campurile acestei structuri sunt:
</p>
<ul>
<li class="level1"><div class="li"> nume - sir de forma  Nume, Prenume (de ex. Ion,Ion), alocat static (31 octeti)</div>
</li>
<li class="level1"><div class="li"> ocupatie – reprezinta ocupatia persoanei (de ex. muncitor | student | casnica etc.), alocat static(21 octeti)</div>
</li>
<li class="level1"><div class="li"> cod_identif – sir de 15 caractere : primele 13 - cnp, ultimele 2 – judetul de domiciliu (de ex. 1870120400423BV), alocat static</div>
</li>
<li class="level1"><div class="li"> grupa_sanguina – grupa sanguina</div>
</li>
<li class="level1"><div class="li"> analize – adresa la care se vor memora valori intregi reprezentand rezultate analize medicale standard (este initializata de functia de alocare spatiu)</div>
</li>
</ul>
<pre class="code c"><span class="kw4">typedef</span> <span class="kw4">struct</span>
  <span class="br0">&#123;</span> <span class="kw4">char</span> nume<span class="br0">&#91;</span><span class="nu0">30</span><span class="br0">&#93;</span><span class="sy0">,</span> ocupatie<span class="br0">&#91;</span><span class="nu0">14</span><span class="br0">&#93;</span><span class="sy0">,</span> cod_identif<span class="br0">&#91;</span><span class="nu0">16</span><span class="br0">&#93;</span><span class="sy0">;</span>
    <span class="kw4">int</span> grupa_sanguina<span class="sy0">,</span> <span class="sy0">*</span>analize<span class="sy0">;</span>  <span class="coMULTI">/* adresa vector rez.analize */</span>
  <span class="br0">&#125;</span> Pers<span class="sy0">;</span></pre>

<p>
<strong>DB</strong>
</p>

<p>
Reprezinta baza de date. Campurile acestei structuri sunt:
</p>
<ul>
<li class="level1"><div class="li"> vect_pers – adresa vector de elemente de tip Pers, alocat dinamic initial</div>
</li>
<li class="level1"><div class="li"> nr_pers_curent – numar curent persoane (⇐ cu nr.maxim de persoane ce pot exista in vector)</div>
</li>
<li class="level1"><div class="li"> nr_analize – numar de analize medicale</div>
</li>
<li class="level1"><div class="li"> nr_pers_max - numar maxim de persoane</div>
</li>
<li class="level1"><div class="li"> vect_analize – adresa unui vector in care sunt pastrate valorile intregi reprezentand rezultatele analizelor medicale standard pentru numarul maxim de persoane din grup </div>
</li>
</ul>

<p>
<p><div class="noteclassic">adresa la care se gasesc analizele persoanei cu indice i (i &gt;= 0) din DB-ul cu adresa x este (x→vect_analize + i * x→nr_analize)
</div></p>
</p>
<pre class="code c"><span class="kw4">typedef</span> <span class="kw4">struct</span>
  <span class="br0">&#123;</span> Pers <span class="sy0">*</span>vect_pers<span class="sy0">;</span> <span class="coMULTI">/* adrese vector pers */</span>
    <span class="kw4">int</span> nr_pers_curent<span class="sy0">,</span> nr_analize<span class="sy0">,</span> <span class="sy0">*</span>vect_analize<span class="sy0">;</span>
    <span class="kw4">int</span> nr_pers_max<span class="sy0">;</span>
  <span class="br0">&#125;</span> DB<span class="sy0">,</span> <span class="sy0">*</span>ADB<span class="sy0">;</span></pre>

<p>
<p><div class="noteclassic"> ADB este echivalent cu *DB 
</div></p>
</p>

<p>
Aici aveti o imagine a structurii bazei de date:
</p>

<p>
(am notat: a3-vect_analize, a1-vect_pers, aa-analize)
</p>

<p>
<img src="../../../../_media/programare/laboratoare/structura2.png" class="media" alt="" />
</p>

</div>
<!-- EDIT4 SECTION "Enuntul laboratorului" [3010-5072] -->
<h3 class="sectionedit5" id="tools">Tools</h3>
<div class="level3">
<hr />

<p>
Aveti deja implementate urmatoarele functii:
</p>
<pre class="code c"><span class="coMULTI">/* Elibereaza spatiul alocat pentru baza de date aflata la adresa aag.*/</span>
<span class="kw4">void</span> elibereaza<span class="br0">&#40;</span>ADB<span class="sy0">*</span> aag<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/* Afiseaza baza de date aflata la adresa ag */</span>
<span class="kw4">void</span> afiseaza<span class="br0">&#40;</span>DB <span class="sy0">*</span>ag<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/* Aloca spatiu pentru o baza de date cu maximum MP persoane si NA analize. */</span>
ADB aloca<span class="br0">&#40;</span><span class="kw4">int</span> MP<span class="sy0">,</span> <span class="kw4">int</span> NA<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/* Scrie baza de date aflata la adresa ag in fisierul binar filename. */</span>
<span class="kw4">int</span> writeToBinary<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>filename<span class="sy0">,</span> DB <span class="sy0">*</span>ag<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/* Citeste baza de date ag din fisierul filename(se ocupa si de alocari). */</span>
<span class="kw4">int</span> readFromText<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>filename<span class="sy0">,</span> DB <span class="sy0">**</span>ag<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
De aici <a href="../../../../_media/programare/laboratoare/lab12_schelet.zip" class="media mediafile mf_zip" title="programare:laboratoare:lab12_schelet.zip (3.4 KB)">lab12_schelet.zip</a> puteti descarca scheletul laboratorului.
</p>

<p>
El contine fisierele:
</p>
<ul>
<li class="level1"><div class="li"> main.c : Fisierul principal, in care veti face modificari.</div>
</li>
<li class="level1"><div class="li"> utils.c : Fisierul cu functii utile(alocare, eliberare si afisare)</div>
</li>
<li class="level1"><div class="li"> database.h: Header</div>
</li>
<li class="level1"><div class="li"> in.txt : Fisier text de test</div>
</li>
<li class="level1"><div class="li"> in.bin : Fisier binar de test</div>
</li>
<li class="level1"><div class="li"> Makefile</div>
</li>
</ul>

<p>
<p><div class="noteclassic">Pentru compilare puteti rula make build. In urma acesteia va rezulta executabilul lab12. Acesta il puteti testa cu fisierul text in.txt:  ”./lab12 in.txt”
</div></p>
</p>

</div>
<!-- EDIT5 SECTION "Tools" [5073-6206] -->
<h2 class="sectionedit6" id="cerinte_laborator">Cerinte Laborator</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> [2p] Scrieti o functie de afisare selectiva a coloanelor din baza de date. Aceasta va interoga userul(stdin) cu privire la coloanele care trebuiesc afisate si ordinea lor, si apoi le va afisa doar pe acestea, in ordinea specificata.</div>
</li>
<li class="level1"><div class="li"> [4p] Scrieti functiile: <pre class="code c"><span class="coMULTI">/*Citeste o baza de date dintr-un fisier binar. 
Se ocupa si de alocarea spatiului pentru baza de date si vectorii de persoane si de analize. */</span>
<span class="kw4">int</span> readFromBinary<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>filename<span class="sy0">,</span> DB <span class="sy0">**</span>ag<span class="br0">&#41;</span>
&nbsp;
<span class="coMULTI">/* Scrie intr-un fisier text baza de date salvata la adresa ag. */</span>
<span class="kw4">int</span> writeToText<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>filename<span class="sy0">,</span> DB <span class="sy0">*</span>ag<span class="br0">&#41;</span></pre>

<p>
Folositi ca modele functiile <strong>writeToBinary</strong>, respectiv <strong>readFromText</strong>. Pentru functia <strong>readFromBinary</strong> tineti cont de faptul ca pentru fiecare persoana vectorul de analize(aa) va trebui sa pointeze catre o zona din vectorul a3 al bazei de date. 
</p>
</div>
</li>
<li class="level1"><div class="li"> [2p] Modificati functia main astfel incat programul vostru sa poata fi apelat astfel:<pre class="code">
./executabil nume_fis_intrare nume_fis_iesire</pre>

<p>
 Programul va extrage baza de date din fisierul de intrare si o va salva in fisierul de iesire tinand cont de formatul numelui celor 2 fisiere.(Se presupune ca va fi testat doar pe fisiere cu extensie ”.txt”, pentu text, ”.bin” pentru binar). Spre exemplu, pentru apelul:
</p>
<pre class="code">./executabil in.txt out.bin</pre>

<p>
 Programul va citi baza de date dintr-un fisier text si o va salva intr-un fisier binar.
</p>
</div>
</li>
<li class="level1"><div class="li"> [2p] Scrieti functia:<pre class="code c"><span class="kw4">int</span> insertUser<span class="br0">&#40;</span>DB <span class="sy0">*</span>ag<span class="br0">&#41;</span></pre>

<p>
 Aceasta va verifica daca se mai poate introduce o persoana in baza de date(nc &lt; max_size). Daca da, va prelua de la stdin(tastatura) credentialele acelei persoane si le va introduce in baza de date. Daca nu, va afisa un mesaj.
</p>
</div>
</li>
</ol>

</div>
<!-- EDIT6 SECTION "Cerinte Laborator" [6207-7917] -->
<h2 class="sectionedit7" id="bonus">Bonus</h2>
<div class="level2">
<ol>
<li class="level1"><div class="li"> [2p] Scrieti o functie care va unifica 2 baze de date, le va sorta dupa nume si le va salva intr-un fisier.</div>
</li>
</ol>
<pre class="code c"><span class="kw4">int</span> mergeDB<span class="br0">&#40;</span>DB <span class="sy0">*</span>a<span class="sy0">,</span> DB <span class="sy0">*</span>b<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">*</span>filename<span class="br0">&#41;</span></pre>

<p>
<p><div class="noteclassic"><strong>filename</strong> poate specifica un fisier binar, sau un fisier text.
</div></p>
</p>

</div>
<!-- EDIT7 SECTION "Bonus" [7918-] --></div>
</body>
</html>
