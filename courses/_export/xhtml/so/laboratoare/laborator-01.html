    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>so:laboratoare:laborator-01</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-03-02T16:23:10+0200"/>
<meta name="keywords" content="so,laboratoare,laborator-01"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=so:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-01.html"/>
<link rel="canonical" href="../../../../so/laboratoare/laborator-01.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='so:laboratoare';var JSINFO = {"id":"so:laboratoare:laborator-01","namespace":"so:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-01.html#laborator_01_-_introducere">Laborator 01 - Introducere</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-01.html#scop">Scop</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#cuvinte_cheie">Cuvinte cheie</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#materiale_ajutatoare">Materiale ajutătoare</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#nice_to_read">Nice to read</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#desfasurarea_laboratorului">Desfășurarea laboratorului</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#suport_de_laborator">Suport de laborator</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#prezentare">Prezentare</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#linux">Linux</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#gcc">GCC</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#utilizare_gcc">Utilizare GCC</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#fazele_compilarii">Fazele compilării</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#optiuni">Opţiuni</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#preprocesarea">Preprocesarea</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#compilarea">Compilarea</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#asamblarea">Asamblarea</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#editarea_de_legaturi">Editarea de legături</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#activarea_avertismentelor">Activarea avertismentelor</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#optiuni_utile">Opțiuni utile</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#compilarea_din_mai_multe_fisiere">Compilarea din mai multe fișiere</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#biblioteci_in_linux">Biblioteci în Linux</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#crearea_unei_biblioteci_statice">Crearea unei biblioteci statice</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#crearea_unei_biblioteci_partajate">Crearea unei biblioteci partajate</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#gnu_make">GNU Make</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#exemplu_simplu_de_makefile">Exemplu simplu de Makefile</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#sintaxa_unei_reguli">Sintaxa unei reguli</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#functionarea_unui_fisier_makefile">Funcționarea unui fișier Makefile</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#folosirea_variabilelor">Folosirea variabilelor</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#folosirea_regulilor_implicite">Folosirea regulilor implicite</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#depanarea_programelor">Depanarea programelor</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#windows">Windows</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#compilatorul_microsoft_clexe">Compilatorul Microsoft cl.exe</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#biblioteci_in_windows">Biblioteci în Windows</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#crearea_unor_biblioteci_statice">Crearea unor biblioteci statice</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#crearea_unor_biblioteci_partajate">Crearea unor biblioteci partajate</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#nmake">Nmake</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#exercitiul_1_-_joc_interactiv_2p">Exercițiul 1 - Joc interactiv (2p)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#windows1">Windows</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#exercitiul_2_-_utilizare_visual_studio_3p">Exercițiul 2 - Utilizare Visual Studio (3p)</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#a_compilare_si_rulare_1p">2a. Compilare și rulare (1p)</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#b_creare_proiect_nou_1p">2b. Creare proiect nou (1p)</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#c_debugging_1p">2c. Debugging (1p)</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#exercitiul_3_-_makefiles_2p">Exercițiul 3 - Makefiles (2p)</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#a_compilarea_unui_singur_fisier_1p">3a. Compilarea unui singur fișier (1p)</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#b_compilarea_din_mai_multe_surse_1p">3b. Compilarea din mai multe surse (1p)</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#linux1">Linux</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-01.html#exercitiul_4_-_fisiere_make_4p">Exercițiul 4 - Fișiere make (4p)</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-01.html#a_compilarea_unui_singur_fisier_1p1">4a. Compilarea unui singur fișier (1p)</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#b_creare_biblioteci_statice_15p">4b. Creare biblioteci statice (1.5p)</a></div></li>
<li class="level4"><div class="li"><a href="laborator-01.html#c_creare_biblioteci_dinamice_15p">4c. Creare biblioteci dinamice (1.5p)</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-01.html#bonus">BONUS</a></div></li>
<li class="level3"><div class="li"><a href="laborator-01.html#extra">EXTRA</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-01.html#solutii">Soluții</a></div></li>
<li class="level2"><div class="li"><a href="laborator-01.html#resurse_utile">Resurse utile</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_01_-_introducere">Laborator 01 - Introducere</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 01 - Introducere" [1-42] -->
<h2 class="sectionedit2" id="scop">Scop</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> introducerea în tematica laboratorului</div>
</li>
<li class="level1"><div class="li"> familiarizarea cu mediul și uneltele folosite în cadrul laboratorului</div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Scop" [43-180] -->
<h2 class="sectionedit3" id="cuvinte_cheie">Cuvinte cheie</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> programare de sistem, C, compilare, depanare, biblioteci</div>
</li>
<li class="level1"><div class="li"> gcc, make, gdb</div>
</li>
<li class="level1"><div class="li"> cl, nmake, Visual Studio</div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Cuvinte cheie" [181-316] -->
<h2 class="sectionedit4" id="materiale_ajutatoare">Materiale ajutătoare</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab01-slides.pdf" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab01-slides.pdf"  rel="nofollow"> lab01-slides.pdf</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab01-refcard.pdf" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab01-refcard.pdf"  rel="nofollow"> lab01-refcard.pdf</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://elf.cs.pub.ro/so/res/tutorial/asist-visual-studio/" class="urlextern" title="http://elf.cs.pub.ro/so/res/tutorial/asist-visual-studio/"  rel="nofollow">Visual Studio Tutorials</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://elf.cs.pub.ro/so/res/tutorial/lab-01-introducere/" class="urlextern" title="http://elf.cs.pub.ro/so/res/tutorial/lab-01-introducere/"  rel="nofollow">Video Introducere</a></div>
</li>
</ul>

</div>
<!-- EDIT4 SECTION "Materiale ajutătoare" [317-694] -->
<h3 class="sectionedit5" id="nice_to_read">Nice to read</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> TLPI - Chapter 3, System Programming Concepts</div>
</li>
<li class="level1"><div class="li"> WSP4 - Chapter 1, Getting started with Windows</div>
</li>
</ul>

</div>
<!-- EDIT5 SECTION "Nice to read" [695-819] -->
<h2 class="sectionedit6" id="desfasurarea_laboratorului">Desfășurarea laboratorului</h2>
<div class="level2">

<p>
Laboratorul de Sisteme de Operare este unul de <a href="http://en.wikipedia.org/wiki/System_programming" class="urlextern" title="http://en.wikipedia.org/wiki/System_programming"  rel="nofollow">programare de sistem</a> având drept scop aprofundarea conceptelor prezentate la curs și prezentarea interfețelor de programare oferite de sistemele de operare (system <abbr title="Application Programming Interface">API</abbr>). Un laborator va prezenta un anumit set de concepte și va conține următoarele activități:
</p>
<ul>
<li class="level1"><div class="li"> prezentare teoretică</div>
</li>
<li class="level1"><div class="li"> parcurgerea exercițiilor rezolvate</div>
</li>
<li class="level1"><div class="li"> rezolvarea exercițiilor propuse</div>
</li>
</ul>

<p>
Pentru o desfășurare cât mai bună a laboratorului și o <strong>înțelegere deplină</strong> a conceptelor vă recomandăm să parcurgeți <strong>conținutul laboratorului</strong> de acasă. De asemenea, pentru consolidarea cunoștințelor folosiți <strong>suportul de laborator</strong> prezentat în paragraful următor.
</p>

</div>
<!-- EDIT6 SECTION "Desfășurarea laboratorului" [820-1626] -->
<h2 class="sectionedit7" id="suport_de_laborator">Suport de laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> adăugați ca bookmark secțiunea <a href="https://elf.cs.pub.ro/so/res/doc/" class="urlextern" title="https://elf.cs.pub.ro/so/res/doc/"  rel="nofollow">Resurse</a></div>
</li>
<li class="level1"><div class="li"> Linux</div>
<ul>
<li class="level2"><div class="li"> <a href="http://nostarch.com/tlpi" class="urlextern" title="http://nostarch.com/tlpi"  rel="nofollow">The Linux Programming Interface</a> - TLPI</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Windows</div>
<ul>
<li class="level2"><div class="li"> <a href="http://www.amazon.com/Windows-Programming-Addison-Wesley-Microsoft-Technology/dp/0321657748" class="urlextern" title="http://www.amazon.com/Windows-Programming-Addison-Wesley-Microsoft-Technology/dp/0321657748"  rel="nofollow"> Windows System Programming 4th Edition</a> - WSP4</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> General</div>
<ul>
<li class="level2"><div class="li"> <a href="http://cursuri.cs.pub.ro/cgi-bin/mailman/listinfo/so" class="urlextern" title="http://cursuri.cs.pub.ro/cgi-bin/mailman/listinfo/so"  rel="nofollow"> lista de discuții</a></div>
</li>
<li class="level2"><div class="li"> canalul de <abbr title="Internet Relay Chat">IRC</abbr> dedicat cursului #cs_so, de pe serverul <a href="http://webchat.freenode.net/" class="urlextern" title="http://webchat.freenode.net/"  rel="nofollow"> freenode</a>.</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT7 SECTION "Suport de laborator" [1627-2191] -->
<h2 class="sectionedit8" id="prezentare">Prezentare</h2>
<div class="level2">

<p>
Pentru a oferi o arie de cuprindere cât mai largă, laboratoarele au ca suport familiile de sisteme de operare <code>Unix</code> și <code>Windows</code>. Instanțele de sisteme de operare din familiile de mai sus alese pentru acest laborator sunt <code>GNU/Linux</code>, respectiv <code>Windows 7</code>. 
</p>

<p>
În cadrul acestui laborator introductiv va fi prezentat mediul de lucru care va fi folosit în cadrul laboratorului de Sisteme de Operare cât și în rezolvarea temelor de casă.
</p>

<p>
Laboratorul folosește ca suport de programare limbajul <code>C/C++</code>. Pentru <code>GNU/Linux</code> se va folosi suita de compilatoare <code>GCC</code>, iar pentru <code>Windows</code> compilatorul Microsoft pentru C/C++ <code>cl</code>. De asemenea, pentru compilarea incrementală a surselor se vor folosi GNU <code>make</code> (Linux), respectiv <code>nmake</code> (Windows). Exceptând apelurile de bibliotecă standard, <abbr title="Application Programming Interface">API</abbr>-ul folosit va fi <a href="http://www.opengroup.org/onlinepubs/9699919799/" class="urlextern" title="http://www.opengroup.org/onlinepubs/9699919799/"  rel="nofollow">POSIX</a>, respectiv <a href="http://msdn.microsoft.com/en-us/library/aa163326.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/aa163326.aspx"  rel="nofollow">Win32</a>. 
</p>

</div>
<!-- EDIT8 SECTION "Prezentare" [2192-3195] -->
<h2 class="sectionedit9" id="linux">Linux</h2>
<div class="level2">

</div>
<!-- EDIT9 SECTION "Linux" [3196-3214] -->
<h3 class="sectionedit10" id="gcc">GCC</h3>
<div class="level3">

<p>
GCC este suita de compilatoare implicită pe majoritatea distribuțiilor Linux. Pentru mai multe detalii despre proiectul GCC apăsați pe butonul <code>Click to display</code> (de acum înainte secțiunile suplimentare vor fi ascunse folosind astfel de butoane).
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
GCC este unul dintre primele pachete software dezvoltate de organizația „Free Software Fundation” în cadrul proiectului GNU (Gnu&#039;s Not Unix). Proiectul GNU a fost inițiat de Richard Stallman ca un protest împotriva software-ului proprietar la începutul anilor &#039;80. 
</p>

<p>
La început, GCC se traducea prin “GNU C Compiler”, pentru că inițial scopul proiectului GCC era dezvoltarea unui compilator C portabil pe platforme UNIX. Ulterior, proiectul a evoluat astăzi fiind un compilator multi-frontend, multi-backend cu suport pentru limbajele <code>C</code>, <code>C++</code>, <code>Objective-C</code>, <code>Fortran</code>, <code>Java</code>, <code>Ada</code>. Drept urmare, acronimul GCC înseamnă, astăzi, “GNU Compiler Collection”.
</p>

<p>
La numărul impresionant de limbaje de mai sus se adaugă și numărul mare de platforme suportate atât din punctul de vedere al arhitecturii hardware (i386, alpha, vax, m68k, sparc, HPPA, arm, MIPS, PowerPC, etc.), cât și al sistemelor de operare (GNU/Linux, DOS, Windows 9x/NT/2000, *BSD, Solaris, Tru64, VMS, etc.). La ora actuală, GCC-ul este compilatorul cel mai portat.
</p>
</div></div>
<p>
<br/>

În cadrul laboratoarelor de Sisteme de Operare ne vom concentra asupra facilităților oferite de compilator pentru limbajele C și C++. GCC are suport pentru standardele <code>ANSI</code>, <code>ISO C</code>, <code>ISO C99</code>, <code>ISO C11</code>, <code>POSIX</code>, dar și multe extensii folositoare care nu sunt incluse în niciunul din standarde; unele dintre aceste extensii vor fi prezentate în secțiunile ce urmează.
</p>

</div>
<!-- EDIT10 SECTION "GCC" [3215-4972] -->
<h3 class="sectionedit11" id="utilizare_gcc">Utilizare GCC</h3>
<div class="level3">

<p>
Vom folosi pentru exemplificare un program simplu care tipărește la ieșirea standard un șir de caractere.
</p>
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=0" title="Download Snippet" class="mediafile mf_c">hello.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span> 
<span class="br0">&#123;</span>
      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;SO, ... hello world!<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
      <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
GCC folosește pentru compilarea de programe C/C++ comanda <code>gcc</code>, respectiv <code>g++</code>. O invocare tipică este pentru compilarea unui program dintr-un singur fișier sursă, în cazul nostru <code>hello.c</code>.
</p>
<table class="columns-plugin" style="width:50%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> hello.c                                 
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
a.out  hello.c
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>a.out
SO, ... hello world<span class="sy0">!</span></pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> hello.c <span class="re5">-o</span> hello                          
<span class="co4">so@spook$ </span><span class="kw2">ls</span>                      
hello  hello.c
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>hello
SO, ... hello world<span class="sy0">!</span></pre>
</td></tr></table>

<p>
Așadar, comanda <code>gcc hello.c</code> a fost folosită pentru compilarea fișierului sursă <code>hello.c</code>. Rezultatul a fost obținerea fișierului executabil <code>a.out</code> (nume implicit utilizat de <code>gcc</code>). Dacă se dorește obținerea unui executabil cu un alt nume se poate folosi opțiunea <code>-o</code>.
</p>

<p>
În mod similar se poate folosi <code>g++</code> pentru compilarea unui program sursă C++.
</p>

</div>
<!-- EDIT11 SECTION "Utilizare GCC" [4973-6220] -->
<h3 class="sectionedit12" id="fazele_compilarii">Fazele compilării</h3>
<div class="level3">

<p>
Compilarea se referă la obținerea unui fișier executabil dintr-un fișier sursă. După cum am văzut în paragraful anterior comanda <code>gcc</code> a dus la obținerea fişierului executabil <code>hello</code> din fişierul sursă <code>hello.c</code>. Intern, <code>gcc</code> trece prin mai multe faze de prelucrare a fişierului sursă până la obținerea executabilului. Aceste faze sunt evidențiate în diagrama de mai jos:
<a href="../../../../_detail/so/laboratoare/fig-01-intro.png%3Fid=so%253Alaboratoare%253Alaborator-01.html" class="media" title="so:laboratoare:fig-01-intro.png"><img src="../../../../_media/so/laboratoare/fig-01-intro.png" class="mediacenter" title="Fazele compilării" alt="Fazele compilării" /></a>
</p>

</div>

<h4 id="optiuni">Opţiuni</h4>
<div class="level4">

<p>
Implicit, la o invocare a comenzii <code>gcc</code>/<code>g++</code> se obţine din fişierul sursă un executabil. Folosind diverse opțiuni, putem opri compilarea la una din fazele intermediare astfel:
</p>
<ul>
<li class="level1"><div class="li"> <code>-E</code> - se realizează doar preprocesarea fişierului sursă</div>
<ul>
<li class="level2"><div class="li"> <code>gcc -E hello.c</code> – va genera fişierul preprocesat pe care, implicit, îl va afişa la ieşirea standard.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>-S</code> - se realizează inclusiv faza de compilare</div>
<ul>
<li class="level2"><div class="li"> <code>gcc -S hello.c</code> – va genera fişierul în limbaj de asamblare <code>hello.s</code></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>-c</code> - se realizează inclusiv faza de asamblare</div>
<ul>
<li class="level2"><div class="li"> <code>gcc -c hello.c</code> – va genera fişierul obiect <code>hello.o</code> </div>
</li>
</ul>
</li>
</ul>

<p>
Opţiunile de mai sus pot fi combinate cu <code>-o</code> pentru a specifica fişierul de ieşire.
</p>

</div>

<h4 id="preprocesarea">Preprocesarea</h4>
<div class="level4">

<p>
Preprocesarea presupune înlocuirea directivelor de preprocesare din fişierul sursă C. Directivele de preprocesare încep cu <code>#</code>. Printre cele mai folosite sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>#include</code> – pentru includerea fişierelor header într-un alt fișier.</div>
</li>
<li class="level1"><div class="li"> <code>#define</code> și <code>#undef</code> – pentru definirea, respectiv anularea definirii de macrouri.</div>
</li>
<li class="level1"><div class="li"> <code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code>, <code>#else</code>, <code>#elif</code>, <code>#endif</code>, pentru compilarea condiţionată.</div>
<ul>
<li class="level2"><div class="li"> utile pentru comentarea bucăților mari de cod. Pentru a comenta toată funcția <code>do_evil_things</code> de mai jos nu putem folosi comentarii de tip C, ca în exemplul din dreapta, întrucat limbajul C nu permite comentariile imbricate. În astfel de cazuri se poate folosi directiva <code>#if &lt;condiţie&gt;</code> ca în exemplul din stânga.</div>
</li>
</ul>
</li>
</ul>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c"><span class="co2">#if 0 </span>
<span class="kw4">int</span> do_evil_things<span class="br0">&#40;</span>context_t <span class="sy0">*</span>ctx<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
         <span class="kw4">int</span> go_drink<span class="sy0">;</span>
&nbsp;
         <span class="coMULTI">/* set student mode ON :) */</span>
&nbsp;
         ctx<span class="sy0">-&gt;</span>go_drink <span class="sy0">=</span> NO<span class="sy0">;</span>
<span class="br0">&#125;</span>
<span class="co2">#endif</span></pre>
</td><td class="columns-plugin last">
<pre class="code c"><span class="coMULTI">/*
int do_evil_things(context_t *ctx) 
{
         int go_drink;
&nbsp;
         /* set student mode ON :) */</span>
&nbsp;
         ctx<span class="sy0">-&gt;</span>go_drink <span class="sy0">=</span> NO<span class="sy0">;</span>    
<span class="br0">&#125;</span>
  <span class="sy0">*</span></pre>
</td></tr></table>
<ul>
<li class="level1"><div class="li"> utile pentru evitarea includerii de mai multe ori a unui fişier header, tehnică numită <a href="http://en.wikipedia.org/wiki/Include_guard" class="urlextern" title="http://en.wikipedia.org/wiki/Include_guard"  rel="nofollow"> include guard</a>. </div>
</li>
</ul>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Exemplu de folosire <code>Include guard</code>
</p>
</div><div class="hiddenOnVisible">
<p>
Exemplu de folosire <code>Include guard</code>
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
În exemplul de mai jos, dacă fişierul <code>&lt;string.h&gt;</code> este inclus, simbolul <code>_STRING_H</code> este deja definit de la prima includere, iar a doua operaţie de includere nu va avea niciun efect.
</p>
<pre class="code c"><span class="co2">#ifndef _STRING_H</span>
<span class="co2">#define _STRING_H       1</span>
&nbsp;
__BEGIN_DECLS
&nbsp;
<span class="coMULTI">/* Get size_t and NULL from &lt;stddef.h&gt;.  */</span>
<span class="co2">#define __need_size_t</span>
<span class="co2">#define __need_NULL</span>
&nbsp;
<span class="coMULTI">/*
  * string related defines 
  */</span>
&nbsp;
<span class="co2">#endif /* string.h  */</span></pre>
</div></div>
<p>
<br/>

</p>
<ul>
<li class="level1"><div class="li"> <code>__FILE__</code>, <code>__LINE__</code>, <code>__func__</code> sunt înlocuite cu numele fişierului, linia curentă în fișier şi numele funcției </div>
</li>
<li class="level2"><div class="li"> operatorul <code>#</code> este folosit pentru a înlocui o variabilă transmisă unui macro cu numele acesteia.</div>
</li>
</ul>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:40%;">
<pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="co2">#define show_var(a) printf(&quot;Variable %s has value %d\n&quot;, #a, a)</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
        <span class="kw4">int</span> teh_var <span class="sy0">=</span> <span class="nu0">42</span><span class="sy0">;</span>
        show_var<span class="br0">&#40;</span>teh_var<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</td><td class="columns-plugin last">
<pre class="code bash">&nbsp;
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-o</span> show show.c
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
show  show.c
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>show
Variable teh_var has value <span class="nu0">42</span>  </pre>
</td></tr></table>
<ul>
<li class="level1"><div class="li"> operatorul <code>##</code> (token paste) este folosit pentru concatenarea între un argument al macrodefiniţiei și un alt şir de caractere sau între două argumente ale macrodefiniţiei. </div>
</li>
</ul>

</div>

<h5 id="depanarea_folosind_directive_de_preprocesare">Depanarea folosind directive de preprocesare</h5>
<div class="level5">

<p>
De multe ori, un dezvoltator va dori să poată activa sau dezactiva foarte facil afişarea de mesaje suplimentare (de informare sau de debug) în sursele sale. 
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
Metoda cea mai simplă pentru a realiza acest lucru este prin intermediul unui macro: 
</p>
<pre class="code c"><span class="co2">#define DEBUG      1</span>
&nbsp;
<span class="co2">#ifdef DEBUG</span>
 <span class="coMULTI">/* afisare mesaje debug */</span>
<span class="co2">#endif</span></pre>

<p>
Folosirea perechii de directive <code>#ifdef</code>, <code>#endif</code> prezintă dezavantajul încărcării codului. Se poate încerca modularizarea afişării mesajelor de debug printr-o construcţie de forma:
</p>
<pre class="code c"><span class="co2">#ifdef DEBUG</span>
<span class="co2">#define Dprintf(msg)  printf(msg)</span>
<span class="co2">#else</span>
<span class="co2">#define Dprintf(msg)                /* do nothing */</span>
<span class="co2">#endif</span></pre>

<p>
Definiţia aceasta nu permite apelul lui <code>Dprintf</code> cu mai multe argumente şi, implicit, nici afişarea formatată. O soluţie este dată de implementarea prin intermediul macro-urilor cu număr variabil de parametri sau <a href="http://www.delorie.com/gnu/docs/gcc/cpp_19.html" class="urlextern" title="http://www.delorie.com/gnu/docs/gcc/cpp_19.html"  rel="nofollow">variadic macros</a>: 
</p>
<pre class="code c"><span class="co2">#ifdef DEBUG</span>
<span class="co2">#define Dprintf(msg,...)  printf(msg, __VA_ARGS__)</span>
<span class="co2">#else</span>
<span class="co2">#define Dprintf(msg,...)                /* do nothing */</span>
<span class="co2">#endif</span></pre>

<p>
Singura problemă care poate apărea este folosirea <code>Dprintf</code> exact cu un argument. În acest caz macroul se expandează la <code>Dprintf(msg<strong>,</strong>)</code> – expresie nevalidă în C (din cauza virgulei de la sfârșit). Pentru a elimina acest incovenient se folosește operatorul <code>##</code>. Dacă acesta este folosit peste un argument care nu există, atunci virgula se elimină şi expresia devine corectă. Acest lucru nu se întâmplă în cazul în care argumentul există (altfel spus operatorul <code>##</code> nu schimbă sensul de până atunci): 
</p>
<pre class="code c"><span class="co2">#ifdef DEBUG</span>
<span class="co2">#define Dprintf(msg,...)  printf(msg, ##__VA_ARGS__)</span>
<span class="co2">#else</span>
<span class="co2">#define Dprintf(msg,...)               /* do nothing */</span>
<span class="co2">#endif</span></pre>

<p>
Un ultim retuş este afişarea, dacă se doreşte, a fişierului şi liniei unde s-a apelat macroul: 
</p>
<pre class="code c"><span class="co2">#ifdef DEBUG</span>
<span class="co2">#define Dprintf(msg,...) printf(&quot;[%s]:%d&quot; msg, __FILE__, __LINE__, ##__VA_ARGS__)</span>
<span class="co2">#else</span>
<span class="co2">#define Dprintf(msg,...)                /* do nothing */</span>
<span class="co2">#endif</span></pre>
</div></div>
</div>

<h4 id="compilarea">Compilarea</h4>
<div class="level4">

<p>
Compilarea este faza în care din fişierul preprocesat se obţine un fişier în limbaj de asamblare. 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-S</span> hello.c 
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c  hello.s</pre>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
În exemplul de mai jos sunt prezentate, în stânga, fişierul sursă <code>hello.c</code>, iar în dreapta fişierul în limbaj de asamblare corespunzător <code>hello.s</code>.
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:40%;">
<pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;SO, ... hello world!<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>  
<span class="br0">&#125;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c">    .<span class="me1">file</span>  <span class="st0">&quot;hello.c&quot;</span>
    .<span class="me1">section</span>        .<span class="me1">rodata</span>
.<span class="me1">LC0</span><span class="sy0">:</span>
    .<span class="me1">string</span> <span class="st0">&quot;SO, ... hello world!&quot;</span>
    .<span class="me1">text</span>
.<span class="me1">globl</span> main
    .<span class="me1">type</span>  main<span class="sy0">,</span> @<span class="kw2">function</span>
main<span class="sy0">:</span>   
    pushl  <span class="sy0">%</span>ebp
    movl   <span class="sy0">%</span>esp<span class="sy0">,</span> <span class="sy0">%</span>ebp
    andl   $<span class="sy0">-</span><span class="nu0">16</span><span class="sy0">,</span> <span class="sy0">%</span>esp
    subl   $<span class="nu19">16</span><span class="sy0">,</span> <span class="sy0">%</span>esp
    movl   $.<span class="me1">LC0</span><span class="sy0">,</span> <span class="br0">&#40;</span><span class="sy0">%</span>esp<span class="br0">&#41;</span>
    call   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/puts.html"><span class="kw3">puts</span></a>
    movl   $<span class="nu19">0</span><span class="sy0">,</span> <span class="sy0">%</span>eax
    leave
    ret
    .<span class="me1">size</span>  main<span class="sy0">,</span> .<span class="sy0">-</span>main
    .<span class="me1">ident</span> <span class="st0">&quot;GCC: (Ubuntu 4.4.1-4ubuntu9) 4.4.1&quot;</span>
    .<span class="me1">section</span>      .<span class="me1">note</span>.<span class="me1">GNU</span><span class="sy0">-</span>stack<span class="sy0">,</span><span class="st0">&quot;&quot;</span><span class="sy0">,</span>@progbits</pre>
</td></tr></table>
</div></div>
</div>

<h4 id="asamblarea">Asamblarea</h4>
<div class="level4">

<p>
Asamblarea este faza în care codul scris în limbaj de asamblare este tradus în <em>cod mașină</em> reprezentând codificarea binară a instrucțiunilor programului iniţial. Fişierul obţinut poartă numele de fişier <em>cod obiect</em>, se obţine folosind opţiunea <code>-c</code> a compilatorului şi are extensia <code>.o</code>.
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-c</span> hello.c 
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
hello.c  hello.o</pre>

</div>

<h4 id="editarea_de_legaturi">Editarea de legături</h4>
<div class="level4">

<p>
Pentru obținerea unui fişier executabil este necesară rezolvarea diverselor simboluri prezente în fişierul obiect. Această operaţie poartă denumirea de <em>editare de legături</em>, <em>link-editare</em>, <em>linking</em> sau <em>legare</em>.
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code c"> <span class="kw4">void</span> f<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="coMULTI">/*
  * no definition for f here
  */</span>
&nbsp;
 <span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
        f<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>      
        <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
 <span class="br0">&#125;</span></pre>
</td><td class="columns-plugin last">
<pre class="code c"> <span class="kw4">void</span> f<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
 <span class="kw4">void</span> f<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
 <span class="br0">&#125;</span>
&nbsp;
&nbsp;
 <span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
 <span class="br0">&#123;</span>
         f<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
         <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
 <span class="br0">&#125;</span></pre>
</td></tr></table>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
sample.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-c</span> <span class="re5">-o</span> sample.o sample.c
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
sample.c sample.o
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-o</span> sample sample.c
<span class="sy0">/</span>tmp<span class="sy0">/</span>ccOVreJg.o: In <span class="kw1">function</span> <span class="sy0">`</span>main<span class="st_h">':
sample.c:(.text+0x7): undefined reference to `f'</span>
collect2: <span class="kw2">ld</span> returned <span class="nu0">1</span> <span class="kw3">exit</span> status</pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
sample.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-c</span> <span class="re5">-o</span> sample.o sample.c
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
sample.c sample.o
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-o</span> sample sample.c
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
sample sample.c  sample.o</pre>
</td></tr></table>

<p>
Observăm că în partea stângă deși am obținut fișierul obiect <code>sample.o</code>, linkerul nu poate genera fişierul executabil întrucât nu găseşte definiţia funcţiei <code>f</code>. În partea dreaptă totul decurge normal, definiţia funcţiei <code>f</code> fiind inclusă în fişierul sursă.
</p>

</div>
<!-- EDIT12 SECTION "Fazele compilării" [6221-15120] -->
<h3 class="sectionedit13" id="activarea_avertismentelor">Activarea avertismentelor</h3>
<div class="level3">

<p>
În mod implicit, o rulare a <code>gcc</code> oferă puține avertismente utilizatorului. Pentru a activa afișarea de avertismente se folosesc opțiunile de tip <code>-W</code> cu sintaxa <code>-W<em>optiune-avertisment</em></code>. <code><em>optiune-avertisment</em></code> poate lua mai multe valori posibile printre care <code>return-type</code>, <code>switch</code>, <code>unused-variable</code>, <code>uninitialized</code>, <code>implicit</code>, <code>all</code>. Folosirea opțiunii <code>-Wall</code> înseamnă afișarea tuturor avertismentelor care pot cauza inconsistențe la rulare.
</p>

<p>
Considerăm ca fiind indispensabilă folosirea opțiunii <code>-Wall</code> pentru a putea detecta încă din momentul compilării posibilele erori. O cauză importantă a aparițiilor acestor erori o constituie sintaxa foarte permisivă a limbajului C. Sperăm ca exemplul de mai jos să justifice utilitatea folosirii opțiunii <code>-Wall</code>:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=21" title="Download Snippet" class="mediafile mf_c">middle.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw4">int</span> min <span class="sy0">=</span> <span class="nu0">10</span><span class="sy0">,</span> max <span class="sy0">=</span> <span class="nu0">20</span><span class="sy0">,</span> midpoint<span class="sy0">;</span>
&nbsp;
   <span class="coMULTI">/* midpoint = min+(max-min)/2; */</span>
   midpoint <span class="sy0">=</span> min <span class="sy0">+</span> <span class="br0">&#40;</span>max <span class="sy0">-</span> min<span class="br0">&#41;</span> <span class="sy0">&gt;&gt;</span> <span class="nu0">1</span><span class="sy0">;</span>
&nbsp;
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;The middle of interval <span class="es1">\
</span>           [%d, %d] is %d<span class="es1">\n</span>&quot;</span><span class="sy0">,</span>     \
           min<span class="sy0">,</span> max<span class="sy0">,</span> midpoint<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
   <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
middle.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-o</span> middle middle.c
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>middle 
Middle of interval <span class="br0">&#91;</span><span class="nu0">10</span>, <span class="nu0">20</span><span class="br0">&#93;</span> is <span class="nu0">10</span></pre>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-o</span> middle middle.c
middle.c: In <span class="kw1">function</span> ‘main’:
middle.c:<span class="nu0">8</span>: warning: suggest parentheses around ‘+’ inside ‘<span class="sy0">&gt;&gt;</span>’</pre>
</td></tr></table>

<p>
La prima rulare, rezultatul nu e nici pe departe cel așteptat. Eroarea poate fi detectată ușor dacă includem și opțiunea <code>-Wall</code> la compilare. (operatorul <code>+</code> are prioritate în fața operatorului <code>&gt;&gt;</code>)
</p>

</div>
<!-- EDIT13 SECTION "Activarea avertismentelor" [15121-16838] -->
<h3 class="sectionedit14" id="optiuni_utile">Opțiuni utile</h3>
<div class="level3">
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Click to display ⇲
</p>
</div><div class="hiddenOnVisible">
<p>
Click to hide ⇱
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody"><ul>
<li class="level1"><div class="li"> <code>-L<em>cale</em></code> – instruiește compilatorul să caute și în directorul <code>cale</code> bibliotecile pe care le folosește programul; opțiunea se poate specifica de mai multe ori, pentru a adãuga mai multe directoare</div>
</li>
<li class="level1"><div class="li"> <code>-l<em>biblioteca</em></code> – instruiește compilatorul cã programul are nevoie de biblioteca <em>biblioteca</em>. Fișierul ce conține biblioteca trebuie să se numească <em>libbiblioteca.so</em> sau <em>libbiblioteca.a</em>.</div>
</li>
<li class="level1"><div class="li"> <code>-I<em>cale</em></code> – instruiește compilatorul sã caute fișierele antet (headere) și în directorul <code>cale</code>; opțiunea se poate specifica de mai multe ori, pentru a adãuga mai multe directoare</div>
</li>
<li class="level1"><div class="li"> <code>-O<em>nivel-optimizări</em></code>, instuiește compilatorul ce nivel de optimizare trebuie aplicat:</div>
<ul>
<li class="level2"><div class="li"> <code>-O0</code>, va determina compilatorul sã nu optimizeze codul generat; </div>
</li>
<li class="level2"><div class="li"> <code>-O3</code>, va determina compilatorul sã optimizeze la maxim codul generat; </div>
</li>
<li class="level2"><div class="li"> <code>-O2</code>, este pragul de unde compilatorul va începe sã insereze direct în cod functiile inline în loc sã le apeleze; </div>
</li>
<li class="level2"><div class="li"> <code>-Os</code>, va pune accentul pe optimizările care duc la reducerea dimensiunii codului generat, și nu a vitezei la execuție.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>-g</code>, dacã se folosește această opțiune compilatorul va genera în fișierele de ieșire informații care pot fi apoi folosite de un debugger (informații despre fișierele sursã și o mapare între codul mașinã și liniile de cod ale fișierelor sursã) </div>
</li>
</ul>

<p>
Paginile de ajutor ale <a href="http://linux.die.net/man/1/gcc" class="urlextern" title="http://linux.die.net/man/1/gcc"  rel="nofollow">GCC</a> (<code>man gcc</code>, <code>info gcc</code>) oferă o listă cu toate opțiunile posibile ale GCC. 
</p>
</div></div>
<p>
 <br/>

</p>

</div>
<!-- EDIT14 SECTION "Opțiuni utile" [16839-18452] -->
<h3 class="sectionedit15" id="compilarea_din_mai_multe_fisiere">Compilarea din mai multe fișiere</h3>
<div class="level3">

<p>
Exemplele de până acum tratează programe scrise într-un singur fișier sursă. În realitate, aplicațiile sunt complexe și scrierea întregului cod într-un singur fișier îl face greu de menținut și greu de extins. În acest sens aplicația este scrisă în mai multe fișiere sursă denumite module. Un modul conține, în mod obișnuit, funcții care îndeplinesc un rol comun.
</p>

<p>
Următoarele fișiere sunt folosite ca suport pentru a exemplifica modul de compilare a unui program provenind din mai multe fișiere sursă:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=24" title="Download Snippet" class="mediafile mf_c">main.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;util.h&quot;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	 f1<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	 f2<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	 <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=25" title="Download Snippet" class="mediafile mf_h">util.h</a></dt>
<dd><pre class="code c"><span class="co2">#ifndef UTIL_H</span>
<span class="co2">#define UTIL_H   1</span>
&nbsp;
<span class="kw4">void</span> f1 <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw4">void</span> f2 <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
&nbsp;
<span class="co2">#endif</span></pre>
</dd></dl>
</td></tr></table>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=26" title="Download Snippet" class="mediafile mf_c">f1.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;util.h&quot;</span>
&nbsp;
<span class="kw4">void</span> f1<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Current file name is %s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> __FILE__<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=27" title="Download Snippet" class="mediafile mf_c">f2.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;util.h&quot;</span>
&nbsp;
<span class="kw4">void</span> f2<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Current line %d in file %s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span>
           __LINE__<span class="sy0">,</span> __FILE__<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td></tr></table>

<p>
În programul de mai sus se apelează  funcțiile <code>f1</code> și <code>f2</code> în funcția <code>main</code> pentru a afișa diverse informații. Pentru compilarea acestora se transmit toate fișierele C ca argumente către <code>gcc</code>: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
f1.c  f2.c  main.c  util.h
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> main.c f1.c f2.c <span class="re5">-o</span> main
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
f1.c  f2.c  main  main.c  util.h
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main 
Current <span class="kw2">file</span> name f1.c
Current line <span class="nu0">8</span> <span class="kw1">in</span> <span class="kw2">file</span> f2.c</pre>

<p>
Executabilul a fost denumit <code>main</code>; pentru acest lucru s-a folosit opțiunea <code>-o</code>.
</p>

<p>
Se observă folosirea fișierului header <code>util.h</code> pentru declararea funcțiilor <code>f1</code> și <code>f2</code>. Declararea unei funcții se realizează prin precizarea antetului. Fișierul header este inclus în fișierul <code>main.c</code> pentru ca acesta să aibă cunoștință de formatul de apel al funcțiilor <code>f1</code> și <code>f2</code>. Funcțiile <code>f1</code> și <code>f2</code> sunt definite, respectiv, în fișierele <code>f1.c</code> și <code>f2.c</code>. Codul acestora este integrat în executabil în momentul link-editării.
</p>

<p>
În general, pentru obținerea unui executabil din surse multiple se obișnuiește compilarea fiecărei surse până la modul obiect și apoi link-editarea acestora: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span>
f1.c  f2.c  main.c  util.h
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span>  f1.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span>  f2.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span>  main.c
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
f1.c  f1.o  f2.c  f2.o  main.c  main.o  util.h
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-o</span> main main.o f1.o f2.o
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
f1.c  f1.o  f2.c  f2.o  main  main.c  main.o  util.h
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main 
Current <span class="kw2">file</span> name f1.c
Current line <span class="nu0">8</span> <span class="kw1">in</span> <span class="kw2">file</span> f2.c</pre>

<p>
Se observă obținerea executabilului <code>main</code> prin legarea modulelor obiect. Această abordare are avantajul eficienței. Dacă se modifică fișierul sursă <code>f2.c</code> atunci doar acesta va trebui compilat și refăcută link-editarea. Dacă s-ar fi obținut un executabil direct din surse atunci s-ar fi compilat toate cele trei fișiere și apoi refăcută link-editarea. Timpul consumat ar fi mult mai <a href="http://xkcd.com/303/" class="urlextern" title="http://xkcd.com/303/"  rel="nofollow"> mare</a>, în special în perioada de dezvoltare când fazele de compilare sunt dese și se dorește compilarea doar a fișierelor sursă modificate.
</p>

<p>
Scăderea timpului de dezvoltare prin compilarea numai a surselor care au fost modificate este motivația de bază pentru existența utilitarelor de automatizare precum <code>make</code> sau <code>nmake</code>. 
</p>

</div>
<!-- EDIT15 SECTION "Compilarea din mai multe fișiere" [18453-21948] -->
<h3 class="sectionedit16" id="biblioteci_in_linux">Biblioteci în Linux</h3>
<div class="level3">

<p>
O bibliotecă este o colecție de funcții precompilate. În momentul în care un program are nevoie de o funcție, linker-ul va apela respectiva funcție din bibliotecă. Numele fișierului reprezentând biblioteca trebuie să aibă prefixul <strong>lib</strong>: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ls</span> <span class="re5">-l</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>libm.<span class="sy0">*</span>
<span class="re5">-rw-r--r--</span> <span class="nu0">1</span> root root <span class="nu0">496218</span> <span class="nu0">2010</span>-01-03 <span class="nu0">15</span>:<span class="nu0">19</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>libm.a
lrwxrwxrwx <span class="nu0">1</span> root root     <span class="nu0">14</span> <span class="nu0">2010</span>-01-<span class="nu0">14</span> <span class="nu0">12</span>:<span class="nu0">17</span> <span class="sy0">/</span>usr<span class="sy0">/</span>lib<span class="sy0">/</span>libm.so -<span class="sy0">&gt;</span> <span class="sy0">/</span>lib<span class="sy0">/</span>libm.so.6</pre>

<p>
Biblioteca matematică este denumită <code>libm.a</code> sau <code>libm.so</code>. În Linux bibliotecile sunt de două tipuri:
</p>
<ul>
<li class="level1"><div class="li"> <strong>statice</strong> - au, de obicei, extensia .a</div>
</li>
<li class="level2"><div class="li"> <strong>partajate</strong> - au extensia .so </div>
</li>
</ul>

<p>
Legarea se face folosind opțiunea <code>-l</code> transmisă comenzii <code>gcc</code>. Astfel, dacă se dorește folosirea unor funcții din <code>math.h</code>, trebuie legată biblioteca matematică:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=31" title="Download Snippet" class="mediafile mf_c">cbrt.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &lt;math.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <span class="kw4">double</span> x <span class="sy0">=</span> <span class="nu16">1000.0</span><span class="sy0">;</span>
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Cubic root for %g is %g<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> x<span class="sy0">,</span> cbrt<span class="br0">&#40;</span>x<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<pre class="code bash">&nbsp;
<span class="co4">so@spook$ </span><span class="kw2">ls</span>
cbrt.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-o</span> cbrt cbrt.c
<span class="sy0">/</span>tmp<span class="sy0">/</span>ccwvm1zq.o: In <span class="kw1">function</span> <span class="sy0">`</span>main<span class="st_h">':
cbrt.c:(.text+0x1b): undefined reference to `cbrt'</span>
collect2: <span class="kw2">ld</span> returned <span class="nu0">1</span> <span class="kw3">exit</span> status
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-o</span> cbrt cbrt.c <span class="re5">-lm</span>
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>cbrt 
Cubic root <span class="kw1">for</span> <span class="nu0">1000</span> is <span class="nu0">10</span></pre>
</td></tr></table>

<p>
Se observă că, în primă fază, nu s-a rezolvat simbolul <code>cbrt</code>. După legarea bibliotecii matematice, programul s-a compilat și a rulat fără probleme.
</p>

</div>

<h4 id="crearea_unei_biblioteci_statice">Crearea unei biblioteci statice</h4>
<div class="level4">

<p>
Pentru crearea de biblioteci vom folosi fișierele din secțiunea <a href="laborator-01.html#compilarea_din_mai_multe_fisiere" title="so:laboratoare:laborator-01 ↵" class="wikilink1"> Compilarea din mai multe fișiere</a>. Vom include modulele obiect rezultate din fișierele sursă f1.c și f2.c într-o bibliotecă pe care o vom folosi ulterior pentru obținerea executabilului final.
</p>

<p>
Primul pas constă în obținerea modulelor obiect asociate:
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span> f1.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span> f2.c</pre>

<p>
O bibliotecă statică este o arhivă ce conține fișiere obiect creată cu ajutorul utilitarului <a href="http://linux.die.net/man/1/ar" class="urlextern" title="http://linux.die.net/man/1/ar"  rel="nofollow">ar</a> ( interpretați parametrii <code>rc</code>). 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">ar</span> rc libintro.a f1.o f2.o
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> main.c <span class="re5">-o</span> main <span class="re5">-lintro</span>
<span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>ld: cannot <span class="kw2">find</span> <span class="re5">-lintro</span>
collect2: <span class="kw2">ld</span> returned <span class="nu0">1</span> <span class="kw3">exit</span> status</pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> main.c <span class="re5">-o</span> main <span class="re5">-lintro</span> -L.
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main
Current <span class="kw2">file</span> name is f1.c
Current line <span class="nu0">5</span> <span class="kw1">in</span> <span class="kw2">file</span> f2.c</pre>
</td></tr></table>

<p>
<strong>Atenție</strong>: -lintro trebuie să apară după specificarea sursei
</p>

<p>
Linker-ul returnează eroare precizând că nu găsește biblioteca <code>libintro</code>. Aceasta deoarece linker-ul nu a fost configurat să caute și în directorul curent. Pentru aceasta se folosește opțiunea <strong><code>-L</code></strong>, urmată de directorul în care trebuie căutată biblioteca (în cazul nostru este vorba de directorul curent).
</p>

<p>
Dacă biblioteca se numește <code>libnume.a</code>, atunci ea va fi referită cu <code>-lnume</code>
</p>

</div>

<h4 id="crearea_unei_biblioteci_partajate">Crearea unei biblioteci partajate</h4>
<div class="level4">

<p>
Spre deosebire de o bibliotecă statică despre care am văzut că nu este nimic altceva decât o arhivă de fișiere obiect, o bibliotecă partajată este ea însăși un fișier obiect. Crearea unei biblioteci partajate se realizează prin intermediul linker-ului. Optiunea <strong><code>-shared</code></strong> indică compilatorului să creeze un obiect partajat și nu un fișier executabil. Este, de asemenea, indicată folosirea opțiunii <strong><code>-fPIC</code></strong> la crearea fișierelor obiect.
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-fPIC</span> <span class="re5">-c</span> f1.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-fPIC</span> <span class="re5">-c</span> f2.c
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-shared</span> f1.o f2.o <span class="re5">-o</span> libintro_shared.so
<span class="co4">so@spook$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> main.c <span class="re5">-o</span> main -lintro_shared -L.
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main
.<span class="sy0">/</span>main: error <span class="kw1">while</span> loading shared libraries: libintro_shared.so:
     cannot open shared object  file: No such <span class="kw2">file</span> or directory</pre>

<p>
La rularea executabilului se poate observa că nu se poate încărca biblioteca partajată. Cauza este deosebirea dintre bibliotecile statice și bibliotecile partajate. În cazul bibliotecilor statice codul funcției de bibliotecă este copiat în codul executabil la link-editare. De partea cealaltă, în cazul bibliotecilor partajate, codul este încărcat în memorie în momentul rulării.
</p>

<p>
Astfel, în momentul rulării unui program, loader-ul (programul responsabil cu încărcarea programului în memorie), trebuie să știe unde să caute biblioteca partajată pentru a o încărca în memorie în cazul în care aceasta nu a fost încărcată deja. Loader-ul folosește câteva căi predefinite (/lib, /usr/lib etc) și de asemenea locații definite în variabila de mediu <strong><code>LD_LIBRARY_PATH</code></strong>: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw3">export</span> <span class="re2">LD_LIBRARY_PATH</span>=<span class="re1">$LD_LIBRARY_PATH</span>:.
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main
Current <span class="kw2">file</span> name is f1.c
Current line <span class="nu0">5</span> <span class="kw1">in</span> <span class="kw2">file</span> f2.c</pre>

<p>
În exemplul de mai sus variabilei de mediu <code>LD_LIBRARY_PATH</code> i-a fost adăugată calea către directorul curent rezultând în posibilitatea rulării programului. <code>LD_LIBRARY_PATH</code> va rămâne modificată cât timp va rula consola curentă. Pentru a face o modificare a unei variabile de mediu doar pentru o instanță a unui program se face atribuirea noii valori înaintea comenzii de execuție: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="re2">LD_LIBRARY_PATH</span>=<span class="re1">$LD_LIBRARY_PATH</span>:.  .<span class="sy0">/</span>main
Fisierul curent este f1.c
Va aflati la linia <span class="nu0">5</span> din fisierul f2.c
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>main
.<span class="sy0">/</span>main: error <span class="kw1">while</span> loading shared libraries: libintro_shared.so:
     cannot open shared object  file: No such <span class="kw2">file</span> or directory</pre>

</div>
<!-- EDIT16 SECTION "Biblioteci în Linux" [21949-27463] -->
<h3 class="sectionedit17" id="gnu_make">GNU Make</h3>
<div class="level3">

<p>
<strong>Make</strong> este un utilitar care permite automatizarea și eficientizarea sarcinilor. În mod particular este folosit pentru automatizarea compilării programelor. După cum s-a precizat, pentru obținerea unui executabil provenind din mai multe surse este ineficientă compilarea de fiecare dată a fiecărui fișier și apoi link-editarea. Se compilează fiecare fișier separat, iar la o modificare se va recompila doar fișierul modificat.
</p>

</div>

<h4 id="exemplu_simplu_de_makefile">Exemplu simplu de Makefile</h4>
<div class="level4">

<p>
Utilitarul <a href="http://linux.die.net/man/1/make" class="urlextern" title="http://linux.die.net/man/1/make"  rel="nofollow">make</a> folosește un fișier de configurare denumit <code>Makefile</code>. Un astfel de fișier conține reguli și comenzi de automatizare. 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=39" title="Download Snippet" class="mediafile mf_">Makefile </a></dt>
<dd><pre class="code make">all<span class="sy0">:</span>
       gcc <span class="sy0">-</span>Wall hello<span class="sy0">.</span>c <span class="sy0">-</span>o hello
clean<span class="sy0">:</span>
       rm <span class="sy0">-</span>f hello</pre>
</dd></dl>
</td><td class="columns-plugin" style="width:50%;">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span>
<span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c <span class="re5">-o</span> hello
<span class="co4">so@spook$ </span>.<span class="sy0">/</span>hello
SO, ... hello world<span class="sy0">!</span></pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> clean
<span class="kw2">rm</span> <span class="re5">-f</span> hello
<span class="co4">so@spook$ </span><span class="kw2">make</span> all
<span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c <span class="re5">-o</span> hello</pre>
</td></tr></table>

<p>
Exemplul prezentat mai sus conține două reguli: <code>all</code> și <code>clean</code>. La rularea comenzii <strong><code>make</code></strong> se execută prima regulă din Makefile (în cazul de față <code>all</code>, nu contează în mod special denumirea). Comanda executată este <code>gcc -Wall hello.c -o hello</code>. Se poate preciza explicit ce regulă să se execute prin transmiterea ca argument comenzii <code>make</code>. (comanda <strong><code>make clean</code></strong> pentru a șterge executabilul <code>hello</code> și comanda <strong><code>make all</code></strong> pentru a obține din nou acel executabil).
</p>

<p>
În mod implicit, GNU Make caută, în ordine, fișierele GNUmakefile, Makefile, makefile și le analizează. Pentru a preciza ce fișier Makefile trebuie analizat, se folosește opțiunea <strong><code>-f</code></strong>. Astfel, în exemplul de mai jos, folosim fișierul Makefile.ex1:
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">mv</span> Makefile Makefile.ex1
<span class="co4">so@spook$ </span><span class="kw2">make</span>
make: <span class="sy0">***</span> No targets specified and no makefile found.  Stop.
<span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex1
<span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c <span class="re5">-o</span> hello
<span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex1 clean
<span class="kw2">rm</span> <span class="re5">-f</span> hello</pre>

</div>

<h4 id="sintaxa_unei_reguli">Sintaxa unei reguli</h4>
<div class="level4">

<p>
În continuare este prezentată sintaxa unei reguli dintr-un fișier Makefile: 
<a href="../../../../_detail/so/laboratoare/make_rule.png%3Fid=so%253Alaboratoare%253Alaborator-01.html" class="media" title="so:laboratoare:make_rule.png"><img src="../../../../_media/so/laboratoare/make_rule.png%3Fw=500&amp;tok=7fe65c" class="mediacenter" alt="" width="500" /></a>
</p>
<ul>
<li class="level1"><div class="li"> <strong>target</strong> - este, de obicei, fișierul care se va obține prin rularea comenzii command. După cum s-a observat și din exemplul anterior, poate să fie o țintă virtuală care nu are asociat un fișier. </div>
</li>
<li class="level1"><div class="li"> <strong>prerequisites</strong> - reprezintă dependențele necesare pentru a urmări regula; de obicei sunt fișiere necesare pentru obținerea țintei. </div>
</li>
<li class="level1"><div class="li"> <strong>&lt;tab&gt;</strong> - reprezintă caracterul tab și trebuie neaparat folosit înaintea precizării comenzii. </div>
</li>
<li class="level1"><div class="li"> <strong>command</strong> - o listă de comenzi (niciuna, una, oricâte) rulate în momentul în care se trece la obținerea țintei.</div>
</li>
</ul>

<p>
Un exemplu indicat pentru un fișier <code>Makefile</code> este: 
</p>
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=43" title="Download Snippet" class="mediafile mf_ex2">Makefile.ex2</a></dt>
<dd><pre class="code make">all<span class="sy0">:</span> hello
&nbsp;
hello<span class="sy0">:</span> hello<span class="sy0">.</span>o
        gcc hello<span class="sy0">.</span>o <span class="sy0">-</span>o hello
&nbsp;
hello<span class="sy0">.</span>o<span class="sy0">:</span> hello<span class="sy0">.</span>c
        gcc <span class="sy0">-</span>Wall <span class="sy0">-</span>c hello<span class="sy0">.</span>c
&nbsp;
clean<span class="sy0">:</span>
        rm <span class="sy0">-</span>f <span class="sy0">*.</span>o <span class="sy0">*</span>~ hello</pre>
</dd></dl>

<p>
Se observă prezența regulii <code>all</code> care va fi executată implicit.
</p>
<ul>
<li class="level1"><div class="li"> <strong>all</strong> are ca dependență <code>hello</code> și nu execută nicio comandă; </div>
</li>
<li class="level1"><div class="li"> <strong>hello</strong> are ca dependență <code>hello.o</code> și realizează link-editarea fișierului <code>hello.o</code>; </div>
</li>
<li class="level1"><div class="li"> <strong>hello.o</strong> are ca dependență <code>hello.c</code> și realizează compilarea și asamblarea fișierului <code>hello.c</code>. </div>
</li>
</ul>

<p>
Pentru obținerea executabilului se folosește comanda: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex2
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span> hello.c
<span class="kw2">gcc</span> hello.o <span class="re5">-o</span> hello</pre>

</div>

<h4 id="functionarea_unui_fisier_makefile">Funcționarea unui fișier Makefile</h4>
<div class="level4">

<p>
Pentru obținerea unui target trebuie satisfăcute dependențele (prerequisites) acestuia. Astfel, pentru obținerea targetului implicit (primul target), în cazul nostru <code>all</code>:
</p>
<ul>
<li class="level1"><div class="li"> pentru obținerea target-ului <code>all</code> trebuie obținut target-ul <code>hello</code>, care este un nume de executabil</div>
</li>
<li class="level2"><div class="li"> pentru obținerea target-ului <code>hello</code> trebuie obținut target-ul <code>hello.o</code></div>
</li>
<li class="level2"><div class="li"> pentru obținerea target-ului <code>hello.o</code> trebuie obținut <code>hello.c</code>; acest fișier există deja, și cum acesta nu apare la rândul lui ca target în <code>Makefile</code>, nu mai trebuie obținut</div>
</li>
<li class="level2"><div class="li"> drept urmare se rulează comanda asociată obținerii <code>hello.o</code>; aceasta este <code>gcc -Wall -c hello.c</code></div>
</li>
<li class="level2"><div class="li"> rularea comenzii duce la obținerea target-ului <code>hello.o</code>, care este folosit ca dependență pentru <code>hello</code></div>
</li>
<li class="level2"><div class="li"> se rulează comanda <code>gcc hello.o -o hello</code> pentru obținerea executabilului <code>hello</code></div>
</li>
<li class="level2"><div class="li"> <code>hello</code> este folosit ca dependență pentru <code>all</code>; acesta nu are asociată nicio comandă deci este automat obținut. </div>
</li>
</ul>

<p>
De remarcat este faptul că un target nu trebuie să aibă neapărat numele fișierului care se obține. Se recomandă, însă, acest lucru pentru înțelegerea mai ușoară a fișierului <code>Makefile</code>, și pentru a beneficia de faptul că <code>make</code> utilizează timpul de modificare al fișierelor pentru a decide când nu trebuie să facă nimic.
</p>

<p>
Acest format al fișierului <code>Makefile</code> are avantajul eficientizării procesului de compilare. Astfel, după ce s-a obținut executabilul hello conform fișierului <code>Makefile</code> anterior, o nouă rulare a make nu va genera nimic: 
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex2
make: Nothing to be <span class="kw1">done</span> <span class="kw1">for</span> <span class="st_h">'all'</span>.</pre>

</div>

<h4 id="folosirea_variabilelor">Folosirea variabilelor</h4>
<div class="level4">

<p>
Un fișier <code>Makefile</code> permite folosirea de variabile. Astfel, un exemplu uzual de fișier <code>Makefile</code> este:
</p>
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=46" title="Download Snippet" class="mediafile mf_ex3">Makefile.ex3</a></dt>
<dd><pre class="code make">CC <span class="sy0">=</span> gcc
CFLAGS <span class="sy0">=</span> <span class="sy0">-</span>Wall <span class="sy0">-</span>g
&nbsp;
all<span class="sy0">:</span> hello
&nbsp;
hello<span class="sy0">:</span> hello<span class="sy0">.</span>o
        <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CC</span><span class="br0">&#41;</span> <span class="re0">$^</span> <span class="sy0">-</span>o <span class="re0">$@</span>
&nbsp;
hello<span class="sy0">.</span>o<span class="sy0">:</span> hello<span class="sy0">.</span>c
        <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CC</span><span class="br0">&#41;</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CFLAGS</span><span class="br0">&#41;</span> <span class="sy0">-</span>c <span class="re0">$&lt;</span>
&nbsp;
<span class="kw2">.PHONY</span><span class="sy0">:</span> clean
clean<span class="sy0">:</span>
        rm <span class="sy0">-</span>f <span class="sy0">*.</span>o <span class="sy0">*</span>~ hello</pre>
</dd></dl>

<p>
În exemplul de mai sus au fost definite variabilele <code>CC</code> și <code>CFLAGS</code>. Variabila <code>CC</code> reprezintă compilatorul folosit, iar variabila <code>CFLAGS</code> reprezintă opțiunile (flag-urile) de compilare utilizate; în cazul de față sunt afișarea avertismentelor și compilarea cu suport de depanare. Referirea unei variabile se realizează prin intermediul construcției $(VAR_NAME). Astfel, <code>$(CC)</code> se înlocuiește cu <code>gcc</code>, iar <code>$(CFLAGS)</code> se înlocuiește cu <code>-Wall -g</code>.
</p>

<p>
Variabile predefinite folositoare sunt:
</p>
<ul>
<li class="level1"><div class="li"> <strong> $@ </strong> se expandează la numele target-ului. </div>
</li>
<li class="level1"><div class="li"> <strong> $^ </strong> se expandează la lista de cerințe.</div>
</li>
<li class="level1"><div class="li"> <strong> $&lt; </strong> se expandează la prima cerință. </div>
</li>
</ul>

<p>
Pentru mai multe detalii despre variabile consultați pagina info [1] sau manualul online [2]
</p>

</div>

<h4 id="folosirea_regulilor_implicite">Folosirea regulilor implicite</h4>
<div class="level4">

<p>
De foarte multe ori nu este nevoie să se precizeze comanda care trebuie rulată; aceasta poate fi detectată implicit.
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code bash">main.o: main.c           </pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">so@spook$ </span>$<span class="br0">&#40;</span>CC<span class="br0">&#41;</span> $<span class="br0">&#40;</span>CFLAGS<span class="br0">&#41;</span> <span class="re5">-c</span> <span class="re5">-o</span> $<span class="sy0">@</span> $<span class="sy0">&lt;</span></pre>
</td></tr></table>

<p>
Astfel, fișierul Makefile.ex2 de mai sus poate fi simplificat, folosind reguli implicite, ca mai jos:
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=49" title="Download Snippet" class="mediafile mf_ex4">Makefile.ex4</a></dt>
<dd><pre class="code make">CC <span class="sy0">=</span> gcc
CFLAGS <span class="sy0">=</span> <span class="sy0">-</span>Wall <span class="sy0">-</span>g
&nbsp;
all<span class="sy0">:</span> hello
&nbsp;
hello<span class="sy0">:</span> hello<span class="sy0">.</span>o
&nbsp;
hello<span class="sy0">.</span>o<span class="sy0">:</span> hello<span class="sy0">.</span>c
&nbsp;
<span class="kw2">.PHONY</span><span class="sy0">:</span> clean
&nbsp;
clean<span class="sy0">:</span>
       rm <span class="sy0">-</span>f <span class="sy0">*.</span>o <span class="sy0">*</span>~ hello</pre>
</dd></dl>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex4
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span>   <span class="re5">-c</span> <span class="re5">-o</span> hello.o hello.c
<span class="kw2">gcc</span>  hello.o   <span class="re5">-o</span> hello</pre>
</td><td class="columns-plugin last">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=51" title="Download Snippet" class="mediafile mf_ex5">Makefile.ex5</a></dt>
<dd><pre class="code make">CC <span class="sy0">=</span> gcc
CFLAGS <span class="sy0">=</span> <span class="sy0">-</span>Wall <span class="sy0">-</span>g
&nbsp;
all<span class="sy0">:</span> hello
&nbsp;
hello<span class="sy0">:</span> hello<span class="sy0">.</span>o
&nbsp;
&nbsp;
&nbsp;
<span class="kw2">.PHONY</span><span class="sy0">:</span> clean
&nbsp;
clean<span class="sy0">:</span>
        rm <span class="sy0">-</span>f <span class="sy0">*.</span>o <span class="sy0">*</span>~ hello</pre>
</dd></dl>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex5
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span>   <span class="re5">-c</span> <span class="re5">-o</span> hello.o hello.c
<span class="kw2">gcc</span>   hello.o   <span class="re5">-o</span> hello</pre>
</td></tr></table>

<p>
De remarcat faptul că dacă avem un singur fișier sursă nici nu trebuie să existe un fișier <code>Makefile</code> pentru a obține executabilul dorit.
</p>
<pre class="code bash"><span class="co4">so@spook$</span><span class="kw2">ls</span> 
hello.c 
<span class="co4">so@spook$ </span><span class="kw2">make</span> hello
<span class="kw2">cc</span> hello.c <span class="re5">-o</span> hello</pre>

<p>
Pentru mai multe detalii despre reguli implicite consultați pagina info [3] sau manualul online [4].
</p>
<div class="hiddenGlobal  hiddenActive"><div class="hiddenElements"></div><div class="hiddenHead  hiddenSinceBeginning"><div class="hiddenOnHidden">
<p>
Exemplu complet de <code>Makefile</code>
</p>
</div><div class="hiddenOnVisible">
<p>
Exemplu complet de <code>Makefile</code>
</p>
</div></div> <!-- .hiddenHead --><div class="hiddenBody">
<p>
Folosind toate facilitațile de până acum, ne propunem compilarea unui executabil <code>client</code> și a unui executabil <code>server</code>.
</p>

<p>
Fișierele folosite sunt:
</p>
<ul>
<li class="level1"><div class="li"> executabilul <code>server</code> depinde de fișierele C - <code>server.c</code>, <code>sock.c</code>, <code>cli_handler.c</code>, <code>log.c</code>, <code>sock.h</code>, <code>cli_handler.h</code>, <code>log.h</code>;</div>
</li>
<li class="level2"><div class="li"> executabilul <code>client</code> depinde de fișierele C - <code>client.c</code>, <code>sock.c</code>, <code>user.c</code>, <code>log.c</code>, <code>sock.h</code>, <code>user.h</code>, <code>log.h</code>; </div>
</li>
</ul>

<p>
Dorim, așadar, obținerea executabilelor client și server pentru rularea celor două entități. Structura fișierului <code>Makefile</code> este prezentată mai jos:
</p>
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=54" title="Download Snippet" class="mediafile mf_ex6">Makefile.ex6</a></dt>
<dd><pre class="code make">CC <span class="sy0">=</span> gcc                        <span class="co1"># compilatorul folosit</span>
CFLAGS <span class="sy0">=</span> <span class="sy0">-</span>Wall <span class="sy0">-</span>g               <span class="co1"># optiunile pentru compilare</span>
LDLIBS <span class="sy0">=</span> <span class="sy0">-</span>lefence               <span class="co1"># optiunile pentru linking</span>
&nbsp;
<span class="co1"># creeaza executabilele client si server</span>
all<span class="sy0">:</span> client server
&nbsp;
<span class="co1"># leaga modulele client.o user.o sock.o in executabilul client</span>
client<span class="sy0">:</span> client<span class="sy0">.</span>o user<span class="sy0">.</span>o sock<span class="sy0">.</span>o log<span class="sy0">.</span>o
&nbsp;
<span class="co1"># leaga modulele server.o cli_handler.o sock.o in executabilul server</span>
server<span class="sy0">:</span> server<span class="sy0">.</span>o cli_handler<span class="sy0">.</span>o sock<span class="sy0">.</span>o log<span class="sy0">.</span>o
&nbsp;
<span class="co1"># compileaza fisierul client.c in modulul obiect client.o</span>
client<span class="sy0">.</span>o<span class="sy0">:</span> client<span class="sy0">.</span>c sock<span class="sy0">.</span>h user<span class="sy0">.</span>h log<span class="sy0">.</span>h
&nbsp;
<span class="co1"># compileaza fisierul user.c in modulul obiect user.o</span>
user<span class="sy0">.</span>o<span class="sy0">:</span> user<span class="sy0">.</span>c user<span class="sy0">.</span>h
&nbsp;
<span class="co1"># compileaza fisierul sock.c in modulul obiect sock.o</span>
sock<span class="sy0">.</span>o<span class="sy0">:</span> sock<span class="sy0">.</span>c sock<span class="sy0">.</span>h
&nbsp;
<span class="co1"># compileaza fisierul server.c in modulul obiect server.o</span>
server<span class="sy0">.</span>o<span class="sy0">:</span> server<span class="sy0">.</span>c cli_handler<span class="sy0">.</span>h sock<span class="sy0">.</span>h log<span class="sy0">.</span>h
&nbsp;
<span class="co1"># compileaza fisierul cli_handler.c in modulul obiect cli_handler.o</span>
cli_handler<span class="sy0">.</span>o<span class="sy0">:</span> cli_handler<span class="sy0">.</span>c cli_handler<span class="sy0">.</span>h
&nbsp;
<span class="co1"># compileaza fisierul log.c in modulul obiect log.o</span>
log<span class="sy0">.</span>o<span class="sy0">:</span> log<span class="sy0">.</span>c log<span class="sy0">.</span>h
&nbsp;
<span class="kw2">.PHONY</span><span class="sy0">:</span> clean
&nbsp;
clean<span class="sy0">:</span>
        rm <span class="sy0">-</span>fr <span class="sy0">*</span>~ <span class="sy0">*.</span>o server client</pre>
</dd></dl>

<p>
Pentru obținerea executabilelor <code>server</code> și <code>client</code> se folosește:
</p>
<pre class="code bash"><span class="co4">so@spook$ </span><span class="kw2">make</span> <span class="re5">-f</span> Makefile.ex6
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> client.o client.c
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> user.o user.c
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> sock.o sock.c
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> log.o log.c
<span class="kw2">gcc</span> client.o user.o sock.o log.o <span class="re5">-lefence</span> <span class="re5">-o</span> client
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> server.o server.c
<span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-g</span> <span class="re5">-c</span> <span class="re5">-o</span> cli_handler.o cli_handler.c
<span class="kw2">gcc</span> server.o cli_handler.o sock.o log.o <span class="re5">-lefence</span> <span class="re5">-o</span> server</pre>

<p>
Regulile implicite intră în vigoare și se obțin, pe rând, fișierele obiect și fișierele executabile. Variabila <code>LDLIBS</code> este folosită pentru a preciza bibliotecile cu care se face link-editarea pentru obținerea executabilului. 
</p>
</div></div>
</div>
<!-- EDIT17 SECTION "GNU Make" [27464-37735] -->
<h3 class="sectionedit18" id="depanarea_programelor">Depanarea programelor</h3>
<div class="level3">

<p>
Există câteva unelte GNU care pot fi folosite atunci când nu reușim să facem un program să ne asculte. <strong>gdb</strong>, acronimul de la “Gnu DeBugger” este probabil cel mai util dintre ele, dar există și altele, cum ar fi <code>ElectricFence</code>, <code>gprof</code> sau <code>mtrace</code>. gdb este prezentat pe scurt <a href="../../../../so/laboratoare/resurse/gdb.html" class="wikilink1" title="so:laboratoare:resurse:gdb">aici</a>.
</p>

</div>
<!-- EDIT18 SECTION "Depanarea programelor" [37736-38102] -->
<h2 class="sectionedit19" id="windows">Windows</h2>
<div class="level2">

</div>
<!-- EDIT19 SECTION "Windows" [38103-38123] -->
<h3 class="sectionedit20" id="compilatorul_microsoft_clexe">Compilatorul Microsoft cl.exe</h3>
<div class="level3">

<p>
Soluția folosită pentru platforma Windows în cadrul acestui laborator este <code>cl.exe</code>, compilatorul Microsoft pentru C/C++. Recomandăm instalarea Microsoft Visual C++ Express 2010 (10.0) (versiunea Professional a Visual C++ este disponibilă gratuit în cadrul MSDNAA). Programele C/C++ pot fi compilate prin intermediul interfeței grafice sau în linie de comandă. În cele ce urmează vom prezenta compilarea folosind linia de comandă. În Windows fișierele cod obiect au extensia <code>*.obj</code>. 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=56" title="Download Snippet" class="mediafile mf_c">hello.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
    <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Hello, world!<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<pre class="code bash">cl hello.c</pre>
<pre class="code bash"><span class="co4">$ </span>cl <span class="sy0">/</span>?    <span class="sy0">/*</span> list of options <span class="kw1">for</span> compiler <span class="sy0">*/</span></pre>
<pre class="code bash"><span class="co4">$ </span><span class="kw2">link</span> <span class="sy0">/</span>?  <span class="sy0">/*</span> list of options <span class="kw1">for</span> linker <span class="sy0">*/</span></pre>
</td></tr></table>

<p>
Se vor prezenta mai jos o serie de opțiuni uzuale:
</p>
<ul>
<li class="level1"><div class="li"> <strong>/Wall</strong> - activează toate warning-urile</div>
</li>
<li class="level1"><div class="li"> <strong>/LIBPATH:&lt;dir&gt;</strong> - această opțiune indică linker-ului să caute și în directorul dir bibliotecile pe care trebuie să le folosească programul; opțiunea se folosește după /link</div>
</li>
<li class="level1"><div class="li"> <strong>/I&lt;dir&gt;</strong> - caută și în acest director fișierele incluse prin directiva include</div>
</li>
<li class="level1"><div class="li"> <strong>/c</strong> - se va face numai compilarea, adică se va omite etapa de link-editare. </div>
</li>
<li class="level1"><div class="li"> <strong>/D&lt;define_symbol&gt;</strong> - definirea unui macro de la compilare</div>
</li>
</ul>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">

<p>
Opțiuni privind optimizarea codului:
</p>
<ul>
<li class="level1"><div class="li"> <strong>/O1</strong> minimizează spațiul ocupat</div>
</li>
<li class="level1"><div class="li"> <strong>/O2</strong> maximizează viteza</div>
</li>
<li class="level1"><div class="li"> <strong>/Os</strong> favorizează spațiul ocupat</div>
</li>
<li class="level1"><div class="li"> <strong>/Ot</strong> favorizează viteza</div>
</li>
<li class="level1"><div class="li"> <strong>/Od</strong> fără optimizări (implicit)</div>
</li>
<li class="level1"><div class="li"> <strong>/Og</strong> activează optimizările globale</div>
</li>
</ul>
</td><td class="columns-plugin last">

<p>
Setarea numelui pentru diferite fișiere de ieșire: 
</p>
<ul>
<li class="level1"><div class="li"> <strong>/Fo&lt;file&gt;</strong> nume fișier obiect</div>
</li>
<li class="level1"><div class="li"> <strong>/Fa&lt;file&gt;</strong> nume fișier în cod de asamblare</div>
</li>
<li class="level1"><div class="li"> <strong>/Fp&lt;file&gt;</strong> nume fișier header precompilat</div>
</li>
<li class="level1"><div class="li"> <strong>/Fe&lt;file&gt;</strong> nume fișier executabil<br/>
<br/>
</div>
</li>
</ul>
</td></tr></table>

<p>
Exemple:
</p>
<ul>
<li class="level1"><div class="li">Creare fișier obiect <code>myobj.obj</code> din sursa <code>mysrc.c</code>: <pre class="code bash">cl <span class="sy0">/</span>Fomyobj.obj <span class="sy0">/</span>c mysrc.c</pre>
</div>
</li>
<li class="level1"><div class="li">Creare fișier <code>myasm.asm</code> în cod de asamblare din sursa <code>mysrc.c</code>: <pre class="code bash">cl <span class="sy0">/</span>Famyasm.asm <span class="sy0">/</span>FA <span class="sy0">/</span>c mysrc.c</pre>
</div>
</li>
</ul>

<p>
Lista completă de opțiuni o puteți găsi <a href="https://msdn.microsoft.com/en-us/library/fwkeyyhe.aspx" class="urlextern" title="https://msdn.microsoft.com/en-us/library/fwkeyyhe.aspx"  rel="nofollow"> aici</a>
</p>

</div>
<!-- EDIT20 SECTION "Compilatorul Microsoft cl.exe" [38124-40439] -->
<h3 class="sectionedit21" id="biblioteci_in_windows">Biblioteci în Windows</h3>
<div class="level3">

</div>

<h4 id="crearea_unor_biblioteci_statice">Crearea unor biblioteci statice</h4>
<div class="level4">

<p>
Pentru a crea biblioteci statice se folosește comanda <code>lib</code>
</p>
<pre class="code bash"><span class="sy0">&gt;</span>lib <span class="sy0">/</span>out:<span class="sy0">&lt;</span>nume.lib<span class="sy0">&gt;</span> <span class="sy0">&lt;</span>lista <span class="kw1">fi</span>șiere obiecte<span class="sy0">&gt;</span></pre>

<p>
Vom considera exemplul folosit pentru crearea de biblioteci în Linux (<code>main.c</code>, <code>util.h</code>, <code>f1.c</code>, <code>f2.c</code>): 
</p>

<p>
<img src="../../../../_media/so/laboratoare/win_static.png%3Fw=400&amp;tok=1cd9f4" class="media" alt="" width="400" />
</p>
<pre class="code bash"><span class="co0"># obținem fișierul obiect f1.obj din sursa f1.c</span>
<span class="sy0">&gt;</span>cl <span class="sy0">/</span>c f1.c
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
f1.c
&nbsp;
<span class="co0">#obținem fișierul f2.obj din sursa f2.c</span>
<span class="sy0">&gt;</span>cl <span class="sy0">/</span>c f2.c
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
f2.c
&nbsp;
<span class="sy0">&gt;</span>cl <span class="sy0">/</span>c main.c
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
main.c
&nbsp;
<span class="co0">#obținem biblioteca statică intro.lib din f1.obj și f2.obj</span>
<span class="sy0">&gt;</span>lib <span class="sy0">/</span>out:intro.lib f1.obj f2.obj
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> Library Manager Version 8.00.50727.42
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
<span class="co0">#intro.lib este compilat împreună cu main.obj pentru a obține main.exe</span>
<span class="sy0">&gt;</span>cl main.obj intro.lib
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> Incremental Linker Version 8.00.50727.42
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
<span class="sy0">/</span>out:main.exe
main.obj
intro.lib</pre>

<p>
Pentru obținerea unei biblioteci statice folosim comanda <code>lib</code>. Argumentul <code>/out:</code> precizează numele bibliotecii statice de ieșire. Biblioteca are de obicei extensia <code>*.lib</code>. Pentru obținerea executabilului se folosește <code>cl</code> care primește ca argumente fișierele obiect și bibliotecile care conțin funcțiile dorite. 
</p>

</div>

<h4 id="crearea_unor_biblioteci_partajate">Crearea unor biblioteci partajate</h4>
<div class="level4">

<p>
Bibliotecile partajate din Linux au ca echivalent bibliotecile <code>DLL</code> (Dynamic Link Library) în Windows. Crearea unei biblioteci partajate pe Windows este mai complicată decât pe Linux. Pe de o parte, pentru că în afara bibliotecii partajate (<code>dll</code>), mai trebuie creată o bibliotecă de import (<code>lib</code>). Pe de altă parte, legarea bibliotecii partajate presupune exportarea explicită a simbolurilor (funcții, variabile) care vor fi folosite.
</p>

<p>
Pentru precizarea simbolurilor care vor fi exportate de bibliotecă se folosesc identificatori predefiniți:
</p>
<ul>
<li class="level1"><div class="li"> <strong>__declspec(dllimport)</strong>, este folosit pentru a importa o funcție dintr-o bibliotecă. </div>
</li>
<li class="level1"><div class="li"> <strong>__declspec(dllexport)</strong>, este folosit pentru a exporta o funcție dintr-o bibliotecă. </div>
</li>
</ul>

<p>
Exemplul de mai jos prezintă trei programe: două dintre ele vor fi legate într-o bibliotecă partajată, iar celălalt conține codul de utilizare a funcțiilor exportate. 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=64" title="Download Snippet" class="mediafile mf_c_1">main.c 1</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="co2">#define DLL_IMPORTS</span>
<span class="co2">#include &quot;funs.h&quot;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
	 f1<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
	 f2<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
	 <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=65" title="Download Snippet" class="mediafile mf_h">funs.h</a></dt>
<dd><pre class="code c"><span class="co2">#ifndef FUNS_H</span>
<span class="co2">#define FUNS_H   1</span>
&nbsp;
<span class="co2">#ifdef DLL_IMPORTS</span>
<span class="co2">#define DLL_DECLSPEC __declspec(dllimport)</span>
<span class="co2">#else</span>
<span class="co2">#define DLL_DECLSPEC __declspec(dllexport)</span>
<span class="co2">#endif</span>
&nbsp;
DLL_DECLSPEC <span class="kw4">void</span> f1 <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
DLL_DECLSPEC <span class="kw4">void</span> f2 <span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co2">#endif</span></pre>
</dd></dl>
</td></tr></table>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=66" title="Download Snippet" class="mediafile mf_c">f1.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;funs.h&quot;</span>
&nbsp;
<span class="kw4">void</span> f1<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Current file name is %s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span> __FILE__<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="br0">&#125;</span></pre>
</dd></dl>
</td><td class="columns-plugin last">
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=67" title="Download Snippet" class="mediafile mf_c">f2.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
<span class="co2">#include &quot;funs.h&quot;</span>
&nbsp;
<span class="kw4">void</span> f2<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
   <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Current line %d in file %s<span class="es1">\n</span>&quot;</span><span class="sy0">,</span>
           __LINE__<span class="sy0">,</span> __FILE__<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</td></tr></table>

<p>
Așadar, pentru crearea bibliotecii partajate și utlizarea acesteia de către programul main parcurgem următorii pași:
</p>
<ul>
<li class="level1"><div class="li"><code>f1.c</code> va exporta funcția <code>f1()</code> folosind <strong>__declspec(dllexport)</strong></div>
</li>
<li class="level1"><div class="li"><code>f2.c</code> va exporta funcția <code>f2()</code> folosind <strong>__declspec(dllexport)</strong></div>
</li>
<li class="level1"><div class="li"><code>main.c</code> va importa funcțiile <code>f1()</code> și <code>f2()</code> folosind <strong>__declspec(dllimport)</strong></div>
</li>
<li class="level1"><div class="li">după obținerea fișierelor obiect <code>f1.obj</code> și <code>f2.obj</code> acestea vor fi folosite la crearea bibliotecii partajate folosind opțiunea <code>/LD</code> a comenzii <code>cl</code>.</div>
</li>
<li class="level1"><div class="li">în final legăm <code>main.obj</code> cu biblioteca partajată și obținem <code>main.exe</code> </div>
</li>
</ul>

<p>
<a href="../../../../_detail/so/laboratoare/win_din.png%3Fid=so%253Alaboratoare%253Alaborator-01.html" class="media" title="so:laboratoare:win_din.png"><img src="../../../../_media/so/laboratoare/win_din.png%3Fw=450&amp;tok=86d57b" class="media" alt="" width="450" /></a>
</p>
<pre class="code bash"><span class="sy0">&gt;</span>cl <span class="sy0">/</span>LD f1.obj f2.obj
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> Incremental Linker Version 8.00.50727.42
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
<span class="sy0">/</span>out:f1.dll
<span class="sy0">/</span>dll
<span class="sy0">/</span>implib:f1.lib
f1.obj
f2.obj
   Creating library f1.lib and object f1.exp
&nbsp;
<span class="sy0">&gt;</span>cl main.obj f1.lib
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> <span class="nu0">32</span>-bit C<span class="sy0">/</span>C++ Optimizing Compiler Version 14.00.50727.42 <span class="kw1">for</span> 80x86
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
Microsoft <span class="br0">&#40;</span>R<span class="br0">&#41;</span> Incremental Linker Version 8.00.50727.42
Copyright <span class="br0">&#40;</span>C<span class="br0">&#41;</span> Microsoft Corporation.  All rights reserved.
&nbsp;
<span class="sy0">/</span>out:main.exe
main.obj
f1.lib</pre>

<p>
Alternativ, biblioteca poate fi obținută cu ajutorul comenzii <code>link</code>: 
</p>
<pre class="code bash"><span class="sy0">&gt;</span><span class="kw2">link</span> <span class="sy0">/</span>nologo <span class="sy0">/</span>dll <span class="sy0">/</span>out:intro.dll <span class="sy0">/</span>implib:intro.lib f1.obj f2.obj
  Creating library intro.lib and object intro.exp
&nbsp;
<span class="sy0">&gt;</span><span class="kw2">link</span> <span class="sy0">/</span>nologo <span class="sy0">/</span>out:main.exe main.obj intro.lib
&nbsp;
<span class="sy0">&gt;</span>main.exe
Current <span class="kw2">file</span> name is f1.c
Current line <span class="nu0">6</span> <span class="kw1">in</span> <span class="kw2">file</span> f2.c</pre>

</div>
<!-- EDIT21 SECTION "Biblioteci în Windows" [40440-45746] -->
<h3 class="sectionedit22" id="nmake">Nmake</h3>
<div class="level3">

<p>
Nmake este utilitarul folosit pentru compilare incrementală pe Windows. Nmake are o sintaxă foarte asemănătoare cu Make. Un exemplu simplu de makefile este cel atașat parser-ului de la tema 1:
</p>
<dl class="code">
<dt><a href="../../../code/so/laboratoare/laborator-01%3Fcodeblock=70" title="Download Snippet" class="mediafile mf_">Makefile</a></dt>
<dd><pre class="code make">OBJ_LIST <span class="sy0">=</span> parser<span class="sy0">.</span>tab<span class="sy0">.</span>obj parser<span class="sy0">.</span>yy<span class="sy0">.</span>obj
CFLAGS   <span class="sy0">=</span> <span class="sy0">/</span>nologo <span class="sy0">/</span>W4 <span class="sy0">/</span>EHsc <span class="sy0">/</span>Za
&nbsp;
EXE_NAMES <span class="sy0">=</span> CUseParser<span class="sy0">.</span>exe UseParser<span class="sy0">.</span>exe DisplayStructure<span class="sy0">.</span>exe
&nbsp;
all <span class="sy0">:</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">EXE_NAMES</span><span class="br0">&#41;</span>
&nbsp;
CUseParser<span class="sy0">.</span>exe <span class="sy0">:</span> CUseParser<span class="sy0">.</span>obj <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">OBJ_LIST</span><span class="br0">&#41;</span>
  <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CPP</span><span class="br0">&#41;</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CFLAGS</span><span class="br0">&#41;</span> <span class="sy0">/</span>Fe<span class="re0">$@</span> <span class="re0">$*</span><span class="sy0">*</span>
&nbsp;
UseParser<span class="sy0">.</span>exe <span class="sy0">:</span> UseParser<span class="sy0">.</span>obj <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">OBJ_LIST</span><span class="br0">&#41;</span>
  <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CPP</span><span class="br0">&#41;</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CFLAGS</span><span class="br0">&#41;</span> <span class="sy0">/</span>Fe<span class="re0">$@</span> <span class="re0">$*</span><span class="sy0">*</span>
&nbsp;
DisplayStructure<span class="sy0">.</span>exe <span class="sy0">:</span> DisplayStructure<span class="sy0">.</span>obj <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">OBJ_LIST</span><span class="br0">&#41;</span>
  <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CPP</span><span class="br0">&#41;</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CFLAGS</span><span class="br0">&#41;</span> <span class="sy0">/</span>Fe<span class="re0">$@</span> <span class="re0">$*</span><span class="sy0">*</span>
&nbsp;
clean <span class="sy0">:</span> exe_clean obj_clean
&nbsp;
obj_clean <span class="sy0">:</span>
  del <span class="sy0">*.</span>obj
&nbsp;
exe_clean <span class="sy0">:</span>
  del <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">EXE_NAMES</span><span class="br0">&#41;</span></pre>
</dd></dl>

<p>
Nmake oferă următoarele variabile speciale:
</p>
<div class="table sectionedit23"><table class="inline">
	<tr class="row0">
		<th class="col0"> Macro </th><th class="col1"> Semnificație</th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> $@  </td><td class="col1"> numele țintei curente </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> $*  </td><td class="col1"> numele țintei curente mai puțin extensia </td>
	</tr>
	<tr class="row3">
		<td class="col0"> $** </td><td class="col1"> toate dependențele unei ținte </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> $?  </td><td class="col1"> toate dependențele mai vechi decât ținta </td>
	</tr>
</table></div>
<!-- EDIT23 TABLE [46514-46736] -->
</div>
<!-- EDIT22 SECTION "Nmake" [45747-46740] -->
<h2 class="sectionedit24" id="exercitii">Exerciții</h2>
<div class="level2">

<p>
<p><div class="notewarning">
Este recomandat ca înainte de a începe laboratorul, să dezarhivați și porniți mașina virtuală de Windows.
</p>
<ul>
<li class="level1"><div class="li"> arhiva se găsește în <code>/home/student/vm</code></div>
</li>
<li class="level1"><div class="li"> porniți VMPlayer și instalați modulele de kernel.</div>
</li>
<li class="level1"><div class="li"> porniți mașina virtuală</div>
</li>
<li class="level1"><div class="li"> nu folosiți VMPlayer în modul full-screen (se blochează)</div>
</li>
</ul>

<p>

</div></p>
</p>

</div>
<!-- EDIT24 SECTION "Exerciții" [46741-47102] -->
<h3 class="sectionedit25" id="exercitiul_1_-_joc_interactiv_2p">Exercițiul 1 - Joc interactiv (2p)</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Punctaj: <strong>2 puncte </strong></div>
</li>
<li class="level2"><div class="li"> Detalii desfășurare <a href="../../../../so/meta/notare.html#joc_interactiv" class="urlextern" title="http://ocw.cs.pub.ro/courses/so/meta/notare#joc_interactiv"  rel="nofollow">joc</a>.</div>
</li>
</ul>

<p>
<p><div class="noteimportant">
În rezolvarea laboratorului folosiți arhiva de sarcini <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab01-tasks.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab01-tasks.zip"  rel="nofollow"> lab01-tasks.zip</a>

</div></p>
</p>

</div>
<!-- EDIT25 SECTION "Exercițiul 1 - Joc interactiv (2p)" [47103-47435] -->
<h2 class="sectionedit26" id="windows1">Windows</h2>
<div class="level2">

<p>
<p><div class="noteimportant">
Pentru a parcurge laboratorul mai ușor, recomandăm deschiderea unui browser în interiorul mașinii virtuale de Windows.
Descărcați <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab01-tasks.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab01-tasks.zip"  rel="nofollow"> arhiva de laborator</a> și în cadrul mașinii virtuale.

</div></p>
</p>

</div>
<!-- EDIT26 SECTION "Windows" [47436-47733] -->
<h3 class="sectionedit27" id="exercitiul_2_-_utilizare_visual_studio_3p">Exercițiul 2 - Utilizare Visual Studio (3p)</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Punctaj total exercițiu: <strong>3 puncte</strong></div>
</li>
</ul>

</div>

<h4 id="a_compilare_si_rulare_1p">2a. Compilare și rulare (1p)</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Punctaj: <strong>1 punct</strong></div>
</li>
</ul>

<p>
Pentru acest pas vom folosi proiectul aflat în directorul <code>win/VS Tutorial</code>.
Deschideți proiectul folosind una dintre următoarele trei metode:
</p>
<ul>
<li class="level1"><div class="li"> click dreapta pe fișierul <code>*.sln</code> → <em>Open with</em> → <em>Microsoft Visual C++ 2010 Express</em>;</div>
</li>
<li class="level1"><div class="li"> deschideți Visual Studio și apoi <em>File</em> → <em>Open</em> → <em>Project/Solution</em> și selectați fișierul <code>*.sln</code> corespunzător;</div>
</li>
<li class="level1"><div class="li"> dublu click pe fișierul <code>*.sln</code>.</div>
</li>
</ul>

<p>
Dacă <em>Solution Explorer View</em> nu este vizibil (în stânga), îl putecți activa selectând <em>View</em> → <em>Solution Explorer</em> (sau <strong>Ctrl+Alt+L</strong>).
</p>

<p>
Pentru a compila proiectul selectați <em>Build</em> → <em>Build Solution</em> sau apăsați tasta <strong>F7</strong>.
În fereastra <em>Output</em> se poate observa output-ul prcesului de compilare. În acest caz, compilarea se va efectua cu succes.
</p>

<p>
Pentru a rula proiectul selectați <em>Debug</em> → <em>Start Without Debugging</em> sau tastați <strong>Ctrl+F5</strong>.
</p>

<p>
Similar cu mediul Linux, executabilele pot fi rulate și din linia de comandă.
<code>PowerShell</code> se poate deschide astfel:
</p>
<ul>
<li class="level1"><div class="li"> selectând <em>Tools</em> → <em>PowerShell Command Prompt</em> din Visual Studio;</div>
</li>
<li class="level1"><div class="li"> folosind link-ul <em>Windows PowerShell</em> aflat pe Desktop.</div>
</li>
</ul>

<p>
În consolă, navigați până când ajungeți în folderul <code>win/VS Tutorial/Debug</code>.
Rulați comanda: <code>.\Hello World.exe</code>. Se poate folosi tasta TAB pentru autocomplete, ca în Linux.
</p>

</div>

<h4 id="b_creare_proiect_nou_1p">2b. Creare proiect nou (1p)</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Punctaj: <strong>1 punct</strong></div>
</li>
</ul>

<p>
Pentru a crea un proiect nou selectați <em>File</em> → <em>New</em> → <em>Project</em>.
Pe ecran o să apară o fereastră nouă. Selectați <em>Win32 Console Application</em>.
În partea de jos a ferestrei, specificați un nume proiectului și apăsați butonul <code>OK</code>.
</p>

<p>
Se va deschide un nou wizard. Apăsați butonul <code>Next</code> pentru a începe etapa de configurare.
Selectați următoarele proprietări:
</p>
<ul>
<li class="level1"><div class="li"> <em>Application type</em> == <em>Console Application</em>;</div>
</li>
<li class="level1"><div class="li"> bifați opțiunea <em>Empty Project</em> din secțiunea <em>Additional options</em>.</div>
</li>
</ul>

<p>
Apoi puteți apăsa butonul <code>Finish</code>.
</p>

<p>
Vom adăuga un fișier (deja existent) la proiect.
În fereastra <em>Solution Explorer</em> (din stânga) selectați <em>Source files</em>. Dați click dreapta → <em>Add</em> → <em>Existing Item</em>.
O să apară o nouă fereastră din care vom selecta fișierul <code>win/VS Tutorial/debug.c</code>.
</p>

<p>
Compilați.
</p>

<p>
Pentru a vedea prima eroare, apăsați tasta <strong>F8</strong>. Cu <strong>F8</strong> și <strong>Shift+F8</strong> se poate naviga între erorile de compilare.
</p>

<p>
Modificați antetul funcției <code>f</code> astfel încât să întoarcă <code>int</code>.
</p>

<p>
Compilați din nou și rulați. 
Programul va afișa pe ecran un mesaj după care o să crape.
</p>

</div>

<h4 id="c_debugging_1p">2c. Debugging (1p)</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> Punctaj: <strong>1 punct</strong></div>
</li>
</ul>

<p>
Programul anterior ar trebui să afișeze valoarea salvată în variabila <code>bug</code>. 
După cum am observat, programul crapă înainte de a face acest lucru.
</p>

<p>
Vom adăuga un breakpoint la funcția <code>f</code>.
</p>
<ul>
<li class="level1"><div class="li"> click pe linia cu definiția funcției (linia 6) și apoi apăsăm tasta <strong>F9</strong>.</div>
</li>
<li class="level1"><div class="li"> observați cerculețul roșu</div>
</li>
</ul>

<p>
Rulați programul în mediul de debug apăsând tasta <strong>F5</strong>.
Programul a început execuția și s-a oprit în primul breakpoint întâlnit (cel adăugat anterior).
</p>

<p>
Pentru a continua execuția step-by-step, selectați <em>Debug</em> → <em>Step Over</em> sau apăsați tasta <strong>F10</strong>.
Observați faptul că săgeata galbenă a înaintat.
</p>

<p>
Pentru a urmări valorile diverselor variabile, vom seta watch-uri pentru variabilele <code>a</code>, <code>b</code>, <code>c</code> și <code>bug</code>.
</p>
<ul>
<li class="level1"><div class="li"> selectați <em>Debug</em> → <em>Windows</em> → <em>Watch</em> → <em>Watch1</em>;</div>
</li>
<li class="level1"><div class="li"> adăugați pe rând numele variabilelor.</div>
</li>
<li class="level1"><div class="li"> <a href="../../../../_detail/so/laboratoare/vs_set_watch.png%3Fid=so%253Alaboratoare%253Alaborator-01.html" class="media" title="so:laboratoare:vs_set_watch.png"><img src="../../../../_media/so/laboratoare/vs_set_watch.png%3Fw=450&amp;tok=c69aca" class="media" alt="" width="450" /></a></div>
</li>
</ul>

<p>
Vom continua rularea programului step-by-step (<strong>F10</strong>) și vom observa cum se schimbă valoarea variabilei <code>bug</code>, cât și mesajele afișate în fereastra Output.
</p>

<p>
Remediați problema și rulați din nou programul.
</p>

<p>
Mai multe informații utile despre Visual Studio găsiți <a href="../../../../so/laboratoare/resurse/vs_tips.html" class="wikilink1" title="so:laboratoare:resurse:vs_tips"> aici</a>.
</p>

</div>
<!-- EDIT27 SECTION "Exercițiul 2 - Utilizare Visual Studio (3p)" [47734-51782] -->
<h3 class="sectionedit28" id="exercitiul_3_-_makefiles_2p">Exercițiul 3 - Makefiles (2p)</h3>
<div class="level3">

<p>
<p><div class="notewarning">
Acest set de exerciții se rulează din command-shell-ul Windows PowerShell (<strong>nu</strong> <code>cmd.exe</code>).
</p>
<ul>
<li class="level1"><div class="li"> Găsiți link la acesta pe Desktop sau accesând <em>Tools</em> → <em>PowerShell Command Prompt</em>.</div>
</li>
</ul>

<p>

</div></p>
</p>

</div>

<h4 id="a_compilarea_unui_singur_fisier_1p">3a. Compilarea unui singur fișier (1p)</h4>
<div class="level4">

<p>
Intrați în directorul <code>win/1-hello</code>.
Folosind <a href="laborator-01.html#compilatorul_microsoft_clexe" title="so:laboratoare:laborator-01 ↵" class="wikilink1">cl</a> obțineți și rulați executabilul <code>hello</code>.
</p>
<pre class="code bash">cl hello.c
.\hello.exe</pre>

<p>
Rămâneți în directorul curent și analizați fișierul <code>Makefile</code> (folosiți comanda <code>cat</code>).
Folosind nmake obțineți și rulați executabilul <code>hello</code>.
</p>
<pre class="code bash">nmake 
.\hello.exe</pre>

</div>

<h4 id="b_compilarea_din_mai_multe_surse_1p">3b. Compilarea din mai multe surse (1p)</h4>
<div class="level4">

<p>
Intrați în directorul <code>win/2-debug</code>.
Analizați fișierele <code>add.c</code> și <code>main.c</code>. Folosiți comanda <code>cat</code>.
</p>

<p>
Completați fișierul <strong>Makefile.ndbg</strong> astfel încât
</p>
<ul>
<li class="level1"><div class="li"> să obțineți obiecte din sursele <code>main.c</code> și <code>add.c</code>.</div>
</li>
<li class="level1"><div class="li"> să obțineți executabilul <code>main.exe</code> din obiectele creat.</div>
</li>
</ul>

<p>
Completați fișierul <strong>Makefile.dbg</strong> astfel încât:
</p>
<ul>
<li class="level1"><div class="li"> să compilați cu simbolul DEBUG__ definit. </div>
</li>
<li class="level1"><div class="li"> să obțineți obiecte din sursele <code>main.c</code> și <code>add.c</code> și executabilul <code>main.exe</code> (ca la subpunctul precedent)</div>
</li>
</ul>

<p>
<strong>Hint</strong>: Revedeți secțiunea <a href="laborator-01.html#compilatorul_microsoft_clexe" title="so:laboratoare:laborator-01 ↵" class="wikilink1">cl</a>.
</p>

</div>
<!-- EDIT28 SECTION "Exercițiul 3 - Makefiles (2p)" [51783-53135] -->
<h2 class="sectionedit29" id="linux1">Linux</h2>
<div class="level2">



</div>
<!-- EDIT29 SECTION "Linux" [53136-53464] -->
<h3 class="sectionedit30" id="exercitiul_4_-_fisiere_make_4p">Exercițiul 4 - Fișiere make (4p)</h3>
<div class="level3">

</div>

<h4 id="a_compilarea_unui_singur_fisier_1p1">4a. Compilarea unui singur fișier (1p)</h4>
<div class="level4">

<p>
Intrați în directorul <code>lin/1-hello/</code> și analizați conținutul fișierului <code>hello.c</code>. 
Compilați folosind <a href="laborator-01.html#utilizare_gcc" title="so:laboratoare:laborator-01 ↵" class="wikilink1">gcc</a> și obțineți și rulați executabilul <code>a.out</code>.
</p>
<pre class="code bash">$ <span class="kw2">gcc</span> hello.c
$ .<span class="sy0">/</span>a.out </pre>

<p>
Pentru a specifica numele executabilului, folosiți opțiunea <code>-o</code>.
</p>
<pre class="code bash">$ <span class="kw2">gcc</span> <span class="re5">-o</span> hello hello.c
$ .<span class="sy0">/</span>hello</pre>

</div>

<h4 id="b_creare_biblioteci_statice_15p">4b. Creare biblioteci statice (1.5p)</h4>
<div class="level4">

<p>
Intrați în directorul <code>lin/2-lib/</code> și completați fișierul <code>Makefile_static</code> astfel încât:
</p>
<ul>
<li class="level1"><div class="li"> La rularea comenzii <code>make libhexdump_static</code> să creeze biblioteca statică <code>libhexdump_static.a</code> Biblioteca va conține fișierele obiect asociate fișierelor <code>hexdump.c</code> și <code>sample.c</code></div>
</li>
<li class="level1"><div class="li"> La rularea comenzii <code>make</code> să creeze executabilul <code>main_static</code> obținut din legarea fișierului obiect corespunzător lui <code>main.c</code> cu biblioteca <code>libhexdump_static.a</code>.</div>
</li>
</ul>

<p>
Revedeți secțiunea crearea unei <a href="laborator-01.html#crearea_unei_biblioteci_statice" title="so:laboratoare:laborator-01 ↵" class="wikilink1">biblioteci statice</a>.
</p>

</div>

<h4 id="c_creare_biblioteci_dinamice_15p">4c. Creare biblioteci dinamice (1.5p)</h4>
<div class="level4">

<p>
Rămâneți în directorul <code>lin/2-lib/</code> și completați fișierul <code>Makefile_dynamic</code> reguli astfel încât:
</p>
<ul>
<li class="level1"><div class="li"> La rularea comenzii <code>make libhexdump_dynamic</code> să creeze biblioteca dinamică <code>libhexdump_dynamic.so</code>. Biblioteca va conține fișierele obiect asociate fișierelor <code>hexdump.c</code> și <code>sample.c</code></div>
</li>
<li class="level1"><div class="li"> La rularea comenzii <code>make</code> pe lângă biblioteca dinamică <code>libhexdump_dynamic.so</code> obținută anterior să se creeze și executabilul <code>main_dynamic</code> obținut din legarea fișierului obiect corespunzător lui <code>main.c</code> cu biblioteca partajată <code>libhexdump_dynamic.so</code>.</div>
</li>
</ul>

<p>
Revedeți secțiunea despre crearea unei <a href="laborator-01.html#crearea_unei_biblioteci_partajate" title="so:laboratoare:laborator-01 ↵" class="wikilink1">biblioteci dinamice</a>.
</p>

</div>
<!-- EDIT30 SECTION "Exercițiul 4 - Fișiere make (4p)" [53465-55289] -->
<h3 class="sectionedit31" id="bonus">BONUS</h3>
<div class="level3">

</div>

<h5 id="so_karma_-_compilare_din_mai_multe_surse_optiuni_la_compilare">1 so karma - Compilare din mai multe surse, opțiuni la compilare</h5>
<div class="level5">

<p>
Intrați în directorul <code>lin/3-ops/</code> și analizați fișierele <code>ops.c</code>, <code>mul.c</code> și <code>add.c</code>.
Fișierul <code>ops.c</code>, se folosește de funcțiile definite în <code>mul.c</code> și <code>add.c</code> pentru a realiza operații de adunare și înmulțire simple. 
</p>

<p>
Creați fișierul <code>Makefile</code>, astfel încât să obțineți din surse fișierele obiect <code>mul.o</code>, <code>add.o</code> și <code>ops.o</code>, iar apoi să obțineți executabilul <code>ops</code> din obiectele create.
<strong>Observați</strong> rezultatul obținut pentru sumă și înmulțire. Este corect? Rezolvați.
Revedeți secțiunea despre <a href="laborator-01.html#compilarea_din_mai_multe_fisiere" title="so:laboratoare:laborator-01 ↵" class="wikilink1">compilarea mai multor fișiere</a>.
</p>

<p>
Rămâneți în directorul <code>lin/3-ops/</code> și folosiți opțiunea <code>-D</code> pentru a defini simbolul <code>HAVE_MATH</code> la compilarea fișierului <code>ops.c</code>. Obțineți și rulați executabilul <code>ops</code>.
Pentru a folosi funcția <strong>pow</strong> trebuie să includeți fișierul <code>math.h</code> și să legați biblioteca <code>libm</code>, folosindu-vă de opțiunea <code>-l</code>.
</p>

</div>

<h5 id="so_karma_-_utilizare_gdb">1 so karma -  Utilizare gdb</h5>
<div class="level5">

<p>
Intrați în directorul <code>lin/4-gdb/</code> și analizați fișierul <code>fault.c</code>.
Completați fișierul <code>Makefile</code> astfel încât la rularea comenzii <code>make</code> să se obțină fișierul executabil <code>fault</code>.
Compilați. 
</p>

<p>
Folosiți <a href="../../../../so/laboratoare/resurse/gdb.html#rulare-gdb" class="wikilink1" title="so:laboratoare:resurse:gdb">gdb</a> pentru a determina cauza erorilor din fișierul <code>fault.c</code>
Citiți secțiunea <a href="../../../../so/laboratoare/resurse/gdb.html#rulare-gdb" class="wikilink1" title="so:laboratoare:resurse:gdb">GDB</a>.
Folosiți opțiunea <code>-g</code> pentru a compila sursa cu simbolurile de debug incluse.
Folosiți comanda <code>print</code> pentru a printa valorile variabilelor când faceți depanarea.
</p>

</div>

<h5 id="so_karma_-_editare_de_legaturi">1 so karma - Editare de legături</h5>
<div class="level5">

<p>
Intrați în directorul <code>lin/5-linker/</code> și analizați fișierele <code>main.c</code> și <code>str.c</code>.
Compilați. De ce nu obținem o eroare de compilare?
Rulați programul <code>main</code> și explicați rezultatele.
</p>

</div>
<!-- EDIT31 SECTION "BONUS" [55290-57211] -->
<h3 class="sectionedit32" id="extra">EXTRA</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://en.wikipedia.org/wiki/Java_Native_Interface" class="urlextern" title="http://en.wikipedia.org/wiki/Java_Native_Interface"  rel="nofollow">JNI</a></div>
</li>
</ul>

</div>
<!-- EDIT32 SECTION "EXTRA" [57212-57293] -->
<h2 class="sectionedit33" id="solutii">Soluții</h2>
<div class="level2">

<p>
<a href="http://elf.cs.pub.ro/so/res/laboratoare/lab01-sol.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab01-sol.zip"  rel="nofollow"> lab01-sol.zip</a>
</p>

</div>
<!-- EDIT33 SECTION "Soluții" [57294-57390] -->
<h2 class="sectionedit34" id="resurse_utile">Resurse utile</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li">Linux</div>
</li>
</ul>
<ol>
<li class="level1"><div class="li"> <a href="https://gcc.gnu.org/onlinedocs/" class="urlextern" title="https://gcc.gnu.org/onlinedocs/"  rel="nofollow">GCC online documentation</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.youtube.com/watch?v=IHoWmi5GFRU&amp;context=C364d09dADOEgsToPDskLpLFav1qDpuI0xUTn1fIcF" class="urlextern" title="http://www.youtube.com/watch?v=IHoWmi5GFRU&amp;context=C364d09dADOEgsToPDskLpLFav1qDpuI0xUTn1fIcF"  rel="nofollow"> Tech Talk: Preprocesorul C</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://techblog.rosedu.org/library-management.html" class="urlextern" title="http://techblog.rosedu.org/library-management.html"  rel="nofollow"> Linking, Loading and Library Management under Linux</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.gnu.org/software/libc/manual/" class="urlextern" title="http://www.gnu.org/software/libc/manual/"  rel="nofollow"> The GNU C Library</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://tldp.org/HOWTO/Program-Library-HOWTO/" class="urlextern" title="http://tldp.org/HOWTO/Program-Library-HOWTO/"  rel="nofollow"> Program Library HOWTO</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.gnu.org/software/make/manual/make.html" class="urlextern" title="http://www.gnu.org/software/make/manual/make.html"  rel="nofollow"> GNU make manual</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://sourceware.org/gdb/documentation/" class="urlextern" title="http://sourceware.org/gdb/documentation/"  rel="nofollow"> GDB documentation</a></div>
</li>
</ol>
<ul>
<li class="level1"><div class="li">Windows</div>
</li>
</ul>
<ol>
<li class="level1"><div class="li"> <a href="http://www.microsoft.com/express/Windows/" class="urlextern" title="http://www.microsoft.com/express/Windows/"  rel="nofollow"> Visual C++ Express</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://msdn.microsoft.com/en-us/library/ms930369.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/ms930369.aspx"  rel="nofollow"> Nmake tool</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://msdn.microsoft.com/en-us/library/ms933742.aspx" class="urlextern" title="http://msdn.microsoft.com/en-us/library/ms933742.aspx"  rel="nofollow"> Nmake Macros</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://en.wikipedia.org/wiki/Dynamic-link_library" class="urlextern" title="http://en.wikipedia.org/wiki/Dynamic-link_library"  rel="nofollow"> Dynamic link library</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.flipcode.com/archives/Creating_And_Using_DLLs.shtml" class="urlextern" title="http://www.flipcode.com/archives/Creating_And_Using_DLLs.shtml"  rel="nofollow"> Creating and using DDL&#039;s</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://herbert.the-little-red-haired-girl.org/en/c-tips/windows/index.html" class="urlextern" title="http://herbert.the-little-red-haired-girl.org/en/c-tips/windows/index.html"  rel="nofollow"> Dynamic libraries </a></div>
</li>
</ol>

</div>
<!-- EDIT34 SECTION "Resurse utile" [57391-] --></div>
</body>
</html>
