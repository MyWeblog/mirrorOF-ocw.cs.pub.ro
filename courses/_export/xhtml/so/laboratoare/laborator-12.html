    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>so:laboratoare:laborator-12</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-05-25T09:05:16+0300"/>
<meta name="keywords" content="so,laboratoare,laborator-12"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=so:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-12.html"/>
<link rel="canonical" href="../../../../so/laboratoare/laborator-12.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='so:laboratoare';var JSINFO = {"id":"so:laboratoare:laborator-12","namespace":"so:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-12.html#laborator_12_-_implementarea_sistemelor_de_fisiere">Laborator 12 - Implementarea sistemelor de fișiere</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-12.html#nice_to_read">Nice to read</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-12.html#resurse_utile">Resurse utile</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-12.html#device_nodes">Device Nodes</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#sisteme_de_fisiere">Sisteme de fișiere</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#directoare_si_link-uri">Directoare și link-uri</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#link-uri_simbolice_soft">Link-uri simbolice (soft)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#crearea_si_stergerea_directoarelor">Crearea și ștergerea directoarelor</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#citirea_directoarelor">Citirea directoarelor</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#directorul_curent_al_unui_proces">Directorul curent al unui proces</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#schimbarea_directorului_curent">Schimbarea directorului curent</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#schimbarea_directorului_radacina_al_unui_proces">Schimbarea directorului rădăcina al unui proces</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#rezolvarea_unei_cai">Rezolvarea unei căi</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#dirname_si_basename">dirname și basename</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-12.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-12.html#exercitiu_bonus_-_completare_feedback_1p">Exercițiu bonus - Completare feedback (1p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#exercitiul_0_-_joc_interactiv_2p">Exercițiul 0 - Joc interactiv (2p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-12.html#linux_8p">Linux (8p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_1_1p">Exercițiul 1 (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_2_1p">Exercițiul 2 (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_3_1p">Exercițiul 3 (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_4_1p">Exercițiul 4 (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_5_1p">Exercițiul 5 (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_6_2p">Exercițiul 6 (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-12.html#exercitiul_7_1p">Exercițiul 7 (1p)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-12.html#solutii">Soluții</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_12_-_implementarea_sistemelor_de_fisiere">Laborator 12 - Implementarea sistemelor de fișiere</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 12 - Implementarea sistemelor de fișiere" [1-67] -->
<h2 class="sectionedit2" id="nice_to_read">Nice to read</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> TLPI - Chapter 14, File Systems</div>
</li>
<li class="level1"><div class="li"> TLPI - Chapter 15, File Attributes</div>
</li>
<li class="level1"><div class="li"> TLPI - Chapter 18, Directories and Links</div>
</li>
</ul>

</div>

<h4 id="resurse_utile">Resurse utile</h4>
<div class="level4">
<ul>
<li class="level1"><div class="li"> <a href="https://www.youtube.com/watch?v=ymYZPtrvgec" class="urlextern" title="https://www.youtube.com/watch?v=ymYZPtrvgec"  rel="nofollow"> How inodes work?</a></div>
</li>
<li class="level3"><div class="li"> <a href="https://lwn.net/Articles/252794/" class="urlextern" title="https://lwn.net/Articles/252794/"  rel="nofollow"> What chroot is really for?</a></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Nice to read" [68-387] -->
<h2 class="sectionedit3" id="device_nodes">Device Nodes</h2>
<div class="level2">

<p>
Nucleul gestionează fiecare device hardware sau virtual prin intermediul unui device driver. Un <em>device driver</em> este o porțiune de cod din nucleu care implementează o serie de operații corespunzătoare acțiunilor de I/E asociate cu un device hardware. Procesele din spațiul utilizator (userspace) interacționează cu device driver-ul prin intermediul unor fișiere speciale denumite <em>device nodes</em>. <abbr title="Application Programming Interface">API</abbr>-ul (interfața de programare) oferită de device drivere este fixată, și include următoarele operații:
</p>
<ul>
<li class="level1"><div class="li"> <code>open</code>, <code>close</code></div>
</li>
<li class="level1"><div class="li"> <code>read</code>, <code>write</code></div>
</li>
<li class="level1"><div class="li"> <code>ioctl</code>, <code>mmap</code></div>
</li>
</ul>

<p>
Unele device-uri sunt reale (mouse, tastatură, disc), altele sunt virtuale în sensul că nu au un device hardware asociat (e.g <code>/dev/zero</code>, <code>/dev/null</code>). După modul în care se accesează datele, device-urile sunt împărțite în două categorii:
</p>
<ul>
<li class="level1"><div class="li"> <code>device de tip caracter</code>, datele sunt procesate octet cu octet. În această categorie se înscriu: tastatura, linia serială, mouse-ul.</div>
</li>
<li class="level1"><div class="li"> <code>device de tip bloc</code>, datele pot fi procesate la nivel de bloc (e.g hard disk).</div>
</li>
</ul>

<p>
Fișierele device node se găsesc în <code>/dev</code> și au asociat un identificator format din <em>major ID</em> și <em>minor ID</em>.
</p>

<p>
Majorul și minorul sunt dați de coloanele 5 și 6 din output-ul <code>ls -l</code>, separate prin virgulă.
</p>

<p>
Puteți vizualiza majorii folosiți în sistem din fișierul <code>/proc/devices</code>.
</p>

<p>
Crearea unui device node se face folosind funcția <a href="http://man7.org/linux/man-pages/man2/mknod.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/mknod.2.html"  rel="nofollow"> mknod </a>
</p>
<pre class="code c">        <span class="kw4">int</span> mknod<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="sy0">,</span> mode_t mode<span class="sy0">,</span> dev_t dev<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
În general informații despre fișiere, și în particular despre device node-uri se pot afla cu funcțiile din familia <a href="http://man7.org/linux/man-pages/man2/stat.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/stat.2.html"  rel="nofollow">stat</a>.
</p>
<pre class="code c">       <span class="kw4">int</span> stat<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="sy0">,</span> <span class="kw4">struct</span> stat <span class="sy0">*</span>buf<span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="kw4">int</span> fstat<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="sy0">,</span> <span class="kw4">struct</span> stat <span class="sy0">*</span>buf<span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="kw4">int</span> lstat<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="sy0">,</span> <span class="kw4">struct</span> stat <span class="sy0">*</span>buf<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Toate aceste funcții completează informațiile despre un fișier în structura <code>struct stat</code>, care conține următoarele câmpuri:
</p>
<pre class="code c">           <span class="kw4">struct</span> stat <span class="br0">&#123;</span>
               dev_t     st_dev<span class="sy0">;</span>     <span class="coMULTI">/* ID of device containing file */</span>
               ino_t     st_ino<span class="sy0">;</span>     <span class="coMULTI">/* inode number */</span>
               mode_t    st_mode<span class="sy0">;</span>    <span class="coMULTI">/* protection */</span>
               nlink_t   st_nlink<span class="sy0">;</span>   <span class="coMULTI">/* number of hard links */</span>
               uid_t     st_uid<span class="sy0">;</span>     <span class="coMULTI">/* user ID of owner */</span>
               gid_t     st_gid<span class="sy0">;</span>     <span class="coMULTI">/* group ID of owner */</span>
               dev_t     st_rdev<span class="sy0">;</span>    <span class="coMULTI">/* device ID (if special file) */</span>
               <span class="kw4">off_t</span>     st_size<span class="sy0">;</span>    <span class="coMULTI">/* total size, in bytes */</span>
               blksize_t st_blksize<span class="sy0">;</span> <span class="coMULTI">/* blocksize for file system I/O */</span>
               blkcnt_t  st_blocks<span class="sy0">;</span>  <span class="coMULTI">/* number of 512B blocks allocated */</span>
               time_t    st_atime<span class="sy0">;</span>   <span class="coMULTI">/* time of last access */</span>
               time_t    st_mtime<span class="sy0">;</span>   <span class="coMULTI">/* time of last modification */</span>
               time_t    st_ctime<span class="sy0">;</span>   <span class="coMULTI">/* time of last status change */</span>
           <span class="br0">&#125;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT3 SECTION "Device Nodes" [388-3390] -->
<h2 class="sectionedit4" id="sisteme_de_fisiere">Sisteme de fișiere</h2>
<div class="level2">

<p>
Un <em>sistem de fișiere</em> este o colecție organizată de fișiere și directoare. Un sistem de fișiere este creat folosind comanda <a href="http://linux.die.net/man/8/mkfs" class="urlextern" title="http://linux.die.net/man/8/mkfs"  rel="nofollow"> mkfs</a>. Din punct de vedere funcțional sistemele de fișiere se pot împărți în:
</p>
<ul>
<li class="level1"><div class="li"> sisteme de fișiere pentru disc (ext2, ext3, reiserfs, fat, ntfs, etc.)</div>
</li>
<li class="level1"><div class="li"> sisteme de fișiere pentru rețea (nfs, smbfs, ncp, etc.)</div>
</li>
<li class="level1"><div class="li"> sisteme de fișiere virtuale (procfs, sysfs, sockfs, pipefs, etc.)</div>
</li>
</ul>

<p>
Tipurile de sisteme de fișiere suportate de nucleu pot fi observate în fișierul <code>/proc/filesystems</code>.  
</p>
<pre class="code">daniel@debian$ cat /proc/filesystems 
nodev	sysfs
nodev	proc
nodev	ramfs
	ext4
	fuseblk
</pre>

<p>
Pentru a putea fi folosit un sistem de fișiere trebuie atașat (montat) în ierarhia de directoare din sistem. Acest lucru se realizează cu comanda <a href="http://linux.die.net/man/8/mount" class="urlextern" title="http://linux.die.net/man/8/mount"  rel="nofollow"> mount(8)</a>:
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="re5">-t</span> <span class="kw3">type</span> device <span class="kw2">dir</span> </pre>

<p>
sau apelul <a href="http://man7.org/linux/man-pages/man2/mount.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/mount.2.html"  rel="nofollow"> mount(2)</a>:
</p>
<pre class="code c">    <span class="kw4">int</span> mount<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>source<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>target<span class="sy0">,</span>
                 <span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>filesystemtype<span class="sy0">,</span> <span class="kw4">unsigned</span> <span class="kw4">long</span> mountflags<span class="sy0">,</span>
                 <span class="kw4">const</span> <span class="kw4">void</span> <span class="sy0">*</span>data<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Operația inversă, demontarea sistemului de fișiere din ierarhia de directoare se face cu comanda <a href="http://man7.org/linux/man-pages/man8/umount.8.html" class="urlextern" title="http://man7.org/linux/man-pages/man8/umount.8.html"  rel="nofollow"> umount(8)</a>:
</p>
<pre class="code bash">       <span class="kw2">umount</span> <span class="br0">&#123;</span><span class="kw2">dir</span><span class="sy0">|</span>device<span class="br0">&#125;</span>...</pre>

<p>
sau apelul: <a href="http://man7.org/linux/man-pages/man2/umount.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/umount.2.html"  rel="nofollow">  umount(2)</a>
</p>
<pre class="code c">       <span class="kw4">int</span> umount<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>target<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT4 SECTION "Sisteme de fișiere" [3391-4954] -->
<h2 class="sectionedit5" id="directoare_si_link-uri">Directoare și link-uri</h2>
<div class="level2">

<p>
Fiecare proces are două atribute legate de directoare:
</p>
<ul>
<li class="level1"><div class="li"> <code>directorul rădăcina</code>, determină punctul de unde căile absolute sunt interpretate.</div>
</li>
<li class="level1"><div class="li"> <code>directorul curent</code>, determină punctul de unde căile relative sunt interpretate.</div>
</li>
</ul>

<p>
Un director este stocat în sistemul de fișiere într-un mod similar cu un fișier obișnuit. Există două lucruri diferite:
</p>
<ul>
<li class="level1"><div class="li"> tipul din structura inode este diferit.</div>
</li>
<li class="level1"><div class="li"> conținutul este diferit. Un director conține un vector de nume de fișiere și inode-uri.</div>
</li>
</ul>

</div>
<!-- EDIT5 SECTION "Directoare și link-uri" [4955-5500] -->
<h2 class="sectionedit6" id="link-uri_simbolice_soft">Link-uri simbolice (soft)</h2>
<div class="level2">

<p>
Un <em>link simbolic</em> (sau soft link), este un tip special de fișier al cărui conținut reprezintă numele altui fișier. Link-urile simbolice sunt create cu comanda <code>ln -s</code> sau cu apelul <a href="http://linux.die.net/man/2/symlink" class="urlextern" title="http://linux.die.net/man/2/symlink"  rel="nofollow"> symlink(2)</a>
</p>
<pre class="code c"><span class="kw4">int</span> symlink<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>oldpath<span class="sy0">,</span> <span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>newpath<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

<p>
Ștergerea unui link simbolic se face cu comanda <code>unlink</code> sau cu apelul <a href="http://linux.die.net/man/2/unlink" class="urlextern" title="http://linux.die.net/man/2/unlink"  rel="nofollow"> unlink(2)</a>
</p>
<pre class="code c"><span class="kw4">int</span> unlink<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

</div>
<!-- EDIT6 SECTION "Link-uri simbolice (soft)" [5501-6036] -->
<h2 class="sectionedit7" id="crearea_si_stergerea_directoarelor">Crearea și ștergerea directoarelor</h2>
<div class="level2">

<p>
Un director poate fi creat folosind comanda <code>mkdir</code> sau apelul <a href="http://man7.org/linux/man-pages/man2/mkdir.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/mkdir.2.html"  rel="nofollow"> mkdir(2))</a>
</p>
<pre class="code c"><span class="kw4">int</span> mkdir<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="sy0">,</span> mode_t mode<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Apelul <a href="http://man7.org/linux/man-pages/man2/rmdir.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/rmdir.2.html"  rel="nofollow"> rmdir(2)</a> șterge directorul specificat în argumentul <code>pathname</code>:
</p>
<pre class="code c"><span class="kw4">int</span> rmdir<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
De asemenea, pentru a șterge un fișier sau un director gol se poate folosi funcția <a href="http://linux.die.net/man/3/remove" class="urlextern" title="http://linux.die.net/man/3/remove"  rel="nofollow"> remove(3)</a>
</p>
<pre class="code c"><span class="kw4">int</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/remove.html"><span class="kw3">remove</span></a><span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>pathname<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

</div>
<!-- EDIT7 SECTION "Crearea și ștergerea directoarelor" [6037-6654] -->
<h2 class="sectionedit8" id="citirea_directoarelor">Citirea directoarelor</h2>
<div class="level2">

<p>
După cum am precizat mai sus, un director conține nume de directoare sau fișiere.
</p>

<p>
Apelul <a href="http://linux.die.net/man/3/opendir" class="urlextern" title="http://linux.die.net/man/3/opendir"  rel="nofollow"> opendir(3)</a> deschide un director și întoarce un handle ce poate fi folosit mai târziu pentru a referi directorul.
</p>
<pre class="code c">DIR <span class="sy0">*</span>opendir<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>name<span class="br0">&#41;</span><span class="sy0">;</span>
DIR <span class="sy0">*</span>fdopendir<span class="br0">&#40;</span><span class="kw4">int</span> fd<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Apelul <a href="http://linux.die.net/man/3/readdir" class="urlextern" title="http://linux.die.net/man/3/readdir"  rel="nofollow">readdir(3)</a> citește intrări succesive dintr-un stream de directoare (DIR).
</p>
<pre class="code c"><span class="kw4">struct</span> dirent <span class="sy0">*</span>readdir<span class="br0">&#40;</span>DIR <span class="sy0">*</span>dirp<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Apelul <code>readdir</code> întoarce un pointer la următoarea structură <code>struct dirent</code> streamul referit de <code>dir</code>:
</p>
<pre class="code c"><span class="kw4">struct</span> dirent <span class="br0">&#123;</span>
    ino_t          d_ino<span class="sy0">;</span>       <span class="coMULTI">/* inode number */</span>
    <span class="kw4">off_t</span>          d_off<span class="sy0">;</span>       <span class="coMULTI">/* offset to the next dirent */</span>
    <span class="kw4">unsigned</span> <span class="kw4">short</span> d_reclen<span class="sy0">;</span>    <span class="coMULTI">/* length of this record */</span>
    <span class="kw4">unsigned</span> <span class="kw4">char</span>  d_type<span class="sy0">;</span>      <span class="coMULTI">/* type of file; not supported
                                   by all file system types */</span>
    <span class="kw4">char</span>           d_name<span class="br0">&#91;</span><span class="nu0">256</span><span class="br0">&#93;</span><span class="sy0">;</span> <span class="coMULTI">/* filename */</span>
<span class="br0">&#125;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT8 SECTION "Citirea directoarelor" [6655-7692] -->
<h2 class="sectionedit9" id="directorul_curent_al_unui_proces">Directorul curent al unui proces</h2>
<div class="level2">

<p>
Directorul curent al unui proces definește punctul de start pentru formarea căilor relative referite de procesul respectiv. Un proces nou creat moștenește directorul curent de la procesul părinte.
</p>

<p>
Directorul curent al unui proces poate fi determinat folosind apelul <a href="http://linux.die.net/man/3/getcwd" class="urlextern" title="http://linux.die.net/man/3/getcwd"  rel="nofollow"> getcwd(3)</a>:
</p>
<pre class="code c">  <span class="kw4">char</span> <span class="sy0">*</span>getcwd<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>cwdbuf<span class="sy0">,</span> <span class="kw4">size_t</span> size<span class="br0">&#41;</span><span class="sy0">;</span> </pre>
<ul>
<li class="level1"><div class="li"> <code>cwdbuf</code>, trebuie alocat înainte de apel astfel încât să poată stoca cel puțin <code>size</code> octeți.</div>
</li>
<li class="level1"><div class="li"> după apel <code>cwdbuf</code> va conține calea absolută a directorului curent.</div>
</li>
</ul>

</div>
<!-- EDIT9 SECTION "Directorul curent al unui proces" [7693-8311] -->
<h2 class="sectionedit10" id="schimbarea_directorului_curent">Schimbarea directorului curent</h2>
<div class="level2">

<p>
Apelul <a href="http://linux.die.net/man/2/chdir" class="urlextern" title="http://linux.die.net/man/2/chdir"  rel="nofollow"> chdir(2)</a> schimbă directorul curent al procesului apelant către numele absolut sau relativ primit ca argument.
</p>
<pre class="code c"> <span class="kw4">int</span> chdir<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

</div>
<!-- EDIT10 SECTION "Schimbarea directorului curent" [8312-8561] -->
<h2 class="sectionedit11" id="schimbarea_directorului_radacina_al_unui_proces">Schimbarea directorului rădăcina al unui proces</h2>
<div class="level2">

<p>
Fiecare proces are un director rădăcină reprezentând punctul de unde căile absolute sunt interpretate. În mod implicit, acesta este directorul rădăcina real al sistemului de fișiere. Un proces nou moștenește directorul rădăcină de la părintele său. Există situații (e.g pentru a ascunde o parte din sistemul de fișiere) în care este util pentru un proces să-și schimbe directorul rădăcină. Acest lucru se realizează folosind apelul <a href="http://linux.die.net/man/2/chroot" class="urlextern" title="http://linux.die.net/man/2/chroot"  rel="nofollow"> chroot(2)</a>
</p>
<pre class="code c"> <span class="kw4">int</span> chroot<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

</div>
<!-- EDIT11 SECTION "Schimbarea directorului rădăcina al unui proces" [8562-9181] -->
<h2 class="sectionedit12" id="rezolvarea_unei_cai">Rezolvarea unei căi</h2>
<div class="level2">

<p>
Apelul <a href="http://man7.org/linux/man-pages/man3/realpath.3.html" class="urlextern" title="http://man7.org/linux/man-pages/man3/realpath.3.html"  rel="nofollow"> realpath(3)</a> dereferențiază link-ul simbolic primit ca argument și rezolvă toate referințele către &#039;/.&#039;și &#039;/..&#039; pentru a produce un șir de caractere conținând calea absolută.
</p>
<pre class="code c">  <span class="kw4">char</span> <span class="sy0">*</span>realpath<span class="br0">&#40;</span><span class="kw4">const</span> <span class="kw4">char</span> <span class="sy0">*</span>path<span class="sy0">,</span> <span class="kw4">char</span> <span class="sy0">*</span>resolved_path<span class="br0">&#41;</span><span class="sy0">;</span> </pre>

</div>
<!-- EDIT12 SECTION "Rezolvarea unei căi" [9182-9541] -->
<h2 class="sectionedit13" id="dirname_si_basename">dirname și basename</h2>
<div class="level2">

<p>
Apelurile <a href="http://linux.die.net/man/3/dirname" class="urlextern" title="http://linux.die.net/man/3/dirname"  rel="nofollow"> dirname(3)</a> și <a href="http://linux.die.net/man/3/basename" class="urlextern" title="http://linux.die.net/man/3/basename"  rel="nofollow"> basename(3)</a> împart un șir de caractere reprezentând o cale în partea de <code>director</code> și partea de fișier.
</p>
<pre class="code c"><span class="kw4">char</span> <span class="sy0">*</span>dirname<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>path<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="kw4">char</span> <span class="sy0">*</span>basename<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>path<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
De exemplu:
</p>
<pre class="code bash">path         <span class="kw2">dirname</span>    <span class="kw2">basename</span>
<span class="st0">&quot;/usr/lib&quot;</span>    <span class="st0">&quot;/usr&quot;</span>    <span class="st0">&quot;lib&quot;</span>
<span class="st0">&quot;/usr/&quot;</span>       <span class="st0">&quot;/&quot;</span>       <span class="st0">&quot;usr&quot;</span>
<span class="st0">&quot;usr&quot;</span>         <span class="st0">&quot;.&quot;</span>       <span class="st0">&quot;usr&quot;</span>
<span class="st0">&quot;/&quot;</span>           <span class="st0">&quot;/&quot;</span>       <span class="st0">&quot;/&quot;</span>
<span class="st0">&quot;.&quot;</span>           <span class="st0">&quot;.&quot;</span>       <span class="st0">&quot;.&quot;</span>
<span class="st0">&quot;..&quot;</span>          <span class="st0">&quot;.&quot;</span>       <span class="st0">&quot;..&quot;</span> </pre>

</div>
<!-- EDIT13 SECTION "dirname și basename" [9542-10113] -->
<h1 class="sectionedit14" id="exercitii">Exerciții</h1>
<div class="level1">

</div>
<!-- EDIT14 SECTION "Exerciții" [10114-10139] -->
<h2 class="sectionedit15" id="exercitiu_bonus_-_completare_feedback_1p">Exercițiu bonus - Completare feedback (1p)</h2>
<div class="level2">

<p>
Vă invităm să <strong>evaluați activitatea echipei de SO</strong> și să precizați punctele tari și punctele slabe și sugestiile voastre de îmbunătățire a materiei. Feedback-ul vostru este foarte important pentru noi să creștem calitatea materiei în anii următori și să îmbunătățim materiile pe care le veți face în continuare.
</p>

<p>
<p><div class="notetip">Găsiți <strong>formularul de feedback</strong> în partea dreaptă a paginii principale de SO de pe cs.curs.pub.ro într-un frame numit <em>“FEEDBACK”</em> (sau  <a href="http://cs.curs.pub.ro/2015/blocks/simplehtml/view.php?courseid=115&amp;blockid=1468" class="urlextern" title="http://cs.curs.pub.ro/2015/blocks/simplehtml/view.php?courseid=115&amp;blockid=1468"  rel="nofollow">click aici</a>). Trebuie să fiți inrolați la cursul de SO, altfel veți primi o eroare de acces.

</div></p>
Vă mulțumim!
</p>

</div>
<!-- EDIT15 SECTION "Exercițiu bonus - Completare feedback (1p)" [10140-10895] -->
<h2 class="sectionedit16" id="exercitiul_0_-_joc_interactiv_2p">Exercițiul 0 - Joc interactiv (2p)</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Detalii desfășurare <a href="../../../../so/meta/notare.html#joc_interactiv" class="urlextern" title="http://ocw.cs.pub.ro/courses/so/meta/notare#joc_interactiv"  rel="nofollow">joc</a>.</div>
</li>
</ul>

</div>
<!-- EDIT16 SECTION "Exercițiul 0 - Joc interactiv (2p)" [10896-11039] -->
<h2 class="sectionedit17" id="linux_8p">Linux (8p)</h2>
<div class="level2">

<p>
<p><div class="noteimportant">Pentru rezolvarea laboratorului descărcați arhiva de <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab12-tasks.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab12-tasks.zip"  rel="nofollow"> lab12-tasks.zip</a>. Codul va fi scris în fișierul <code>mini.c</code> din directorul <code>1-mini/</code>. Pentru fiecare exercițiu decomentați linia TODO corespunzătoare. 
</div></p>
</p>

</div>
<!-- EDIT17 SECTION "Linux (8p)" [11040-11363] -->
<h3 class="sectionedit18" id="exercitiul_1_1p">Exercițiul 1 (1p)</h3>
<div class="level3">

<p>
Folosiți comanda <code>ls -l /dev</code> și precizați două device node-uri de tip caracter și două device node-uri de tip bloc. Ce major și minor au?
</p>

</div>
<!-- EDIT18 SECTION "Exercițiul 1 (1p)" [11364-11541] -->
<h3 class="sectionedit19" id="exercitiul_2_1p">Exercițiul 2 (1p)</h3>
<div class="level3">

<p>
Implementați comanda <code>list</code> &lt;device_node&gt;, ce va primi ca argument un device node și va afișa pentru acesta tipul (c/b), identificatorii <code>major</code>, respectiv <code>minor</code>. Folosiți funcția <a href="http://man7.org/linux/man-pages/man2/stat.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/stat.2.html"  rel="nofollow"> stat(2)</a> pentru a obține o structură de tipul <code>struct stat</code> din care veți extrage tipul device-ului (<code>st_mode</code>) (hint: <a href="http://www.gnu.org/software/libc/manual/html_node/Testing-File-Type.html#Testing-File-Type" class="urlextern" title="http://www.gnu.org/software/libc/manual/html_node/Testing-File-Type.html#Testing-File-Type"  rel="nofollow">S_ISCHR, S_ISBLK</a>) apoi din câmpul <code>st_rdev</code> extrageți <a href="http://man7.org/linux/man-pages/man3/makedev.3.html" class="urlextern" title="http://man7.org/linux/man-pages/man3/makedev.3.html"  rel="nofollow"> major</a> și <a href="http://man7.org/linux/man-pages/man3/makedev.3.html" class="urlextern" title="http://man7.org/linux/man-pages/man3/makedev.3.html"  rel="nofollow">minor</a>. Nu uitați să decomentați linia marcată cu <em> #define TODO2 </em>
</p>

</div>
<!-- EDIT19 SECTION "Exercițiul 2 (1p)" [11542-12296] -->
<h3 class="sectionedit20" id="exercitiul_3_1p">Exercițiul 3 (1p)</h3>
<div class="level3">

<p>
Creați punctul de montare <code>/mnt/my</code>. Ca root, rulați comanda:
</p>
<pre class="code bash"><span class="kw2">mkdir</span> <span class="sy0">/</span>mnt<span class="sy0">/</span>my</pre>

<p>
Parcurgeți paginile de manual ale funcțiilor <a href="http://man7.org/linux/man-pages/man2/mount.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/mount.2.html"  rel="nofollow">mount</a> și <a href="http://man7.org/linux/man-pages/man2/umount.2.html" class="urlextern" title="http://man7.org/linux/man-pages/man2/umount.2.html"  rel="nofollow">umount</a>.
</p>

<p>
Folosiți comenzile <code>mount</code> și <code>umount</code> din executabilul mini pentru a monta discul <code>/dev/sda1</code> în punctul de montare <code>/mnt/my</code>. Citiți secțiunea marcată cu TODO din fișierul <code>mini.c</code>. Pentru argumentul 4 și argumentul 5 al funcției <code>mount</code> folosiți, respectiv, valorile <code>0</code> și <code>NULL</code>.
</p>

<p>
Testare: Rulați, ca root, comanda:
</p>
<pre class="code bash">.<span class="sy0">/</span>mini</pre>

<p>
și apoi rulați comanda de montare în cadrul acestui shell:
</p>
<pre class="code bash"><span class="kw2">mount</span> <span class="sy0">/</span>dev<span class="sy0">/</span>sda1 <span class="sy0">/</span>mnt<span class="sy0">/</span>my ext4</pre>

<p>
Într-o altă consolă, într-un shell obișnuit, verificați rezultatele folosind comanda
</p>
<pre class="code bash"><span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>mounts</pre>

<p>
Pentru demontare rulați comanda:
</p>
<pre class="code bash"><span class="kw2">umount</span> <span class="sy0">/</span>mnt<span class="sy0">/</span>my</pre>

</div>
<!-- EDIT20 SECTION "Exercițiul 3 (1p)" [12297-13282] -->
<h3 class="sectionedit21" id="exercitiul_4_1p">Exercițiul 4 (1p)</h3>
<div class="level3">

<p>
Adăugați suport pentru comenzile symlink și unlink în programul <code>mini</code>. Urmăriți <em> TODO4 </em>.
</p>

<p>
Pentru testare folosiți, în shell-ul aferent comenzii <code>./mini</code>, comanda:
</p>
<pre class="code bash">symlink <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span> local-passwd</pre>

<p>
Ca să verificați, într-o altă consolă, în același director cu cel în care ați rulat comanda <code>./mini</code>, folosiți
</p>
<pre class="code bash"><span class="kw2">ls</span> <span class="re5">-l</span></pre>

<p>
Pentru a șterge symlink-ul folosiți comanda
</p>
<pre class="code bash"><span class="kw2">unlink</span> local-passwd</pre>

<p>
Pentru validare rulați din nou comanda
</p>
<pre class="code bash"><span class="kw2">ls</span> <span class="re5">-l</span></pre>

</div>
<!-- EDIT21 SECTION "Exercițiul 4 (1p)" [13283-13844] -->
<h3 class="sectionedit22" id="exercitiul_5_1p">Exercițiul 5 (1p)</h3>
<div class="level3">

<p>
Adăugați suport pentru comenzile mkdir și rmdir în programul <code>mini</code>. Urmăriți <em> TODO5 </em>.
</p>

<p>
Ca al doilea argument pentru funcția <code>mkdir</code> folosiți <code>(mode_t) 0755</code>.
</p>

</div>
<!-- EDIT22 SECTION "Exercițiul 5 (1p)" [13845-14055] -->
<h3 class="sectionedit23" id="exercitiul_6_2p">Exercițiul 6 (2p)</h3>
<div class="level3">

<p>
Adăugați suport pentru comanda <code>ls dirname/</code> în programul <code>mini</code>. Aceasta va trebui să afișeze recursiv toate directoarele și fișierele începând cu directorul dat ca parametru  (puteți parcurge recursiv în adâncime arborele de fișiere). Urmăriți <em> TODO6 </em> și demo-ul 5 de la <a href="../../../../so/cursuri/curs-12.html" class="urlextern" title="http://ocw.cs.pub.ro/courses/so/cursuri/curs-12"  rel="nofollow"> curs</a>
</p>

</div>
<!-- EDIT23 SECTION "Exercițiul 6 (2p)" [14056-14446] -->
<h3 class="sectionedit24" id="exercitiul_7_1p">Exercițiul 7 (1p)</h3>
<div class="level3">

<p>
Adăugați suport pentru comenzile pwd și chdir în programul <code>mini</code>. Urmăriți <em> TODO7 </em>.
</p>

</div>
<!-- EDIT24 SECTION "Exercițiul 7 (1p)" [14447-14575] -->
<h2 class="sectionedit25" id="solutii">Soluții</h2>
<div class="level2">

<p>
 <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab12-sol.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab12-sol.zip"  rel="nofollow"> Soluții exerciții laborator 12</a>
</p>

</div>
<!-- EDIT25 SECTION "Soluții" [14576-] --></div>
</body>
</html>
