    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>so:laboratoare:laborator-07</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-04-13T14:03:53+0300"/>
<meta name="keywords" content="so,laboratoare,laborator-07"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=so:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-07.html"/>
<link rel="canonical" href="../../../../so/laboratoare/laborator-07.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='so:laboratoare';var JSINFO = {"id":"so:laboratoare:laborator-07","namespace":"so:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-07.html#laborator_07_-_profiling_debugging">Laborator 07 - Profiling &amp; Debugging</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-07.html#materiale_ajutatoare">Materiale ajutătoare</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-07.html#nice_to_watch">Nice to Watch</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#latency_comparison_numbers">Latency Comparison Numbers</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-07.html#profiling">Profiling</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-07.html#tehnici_de_profiling">Tehnici de profiling</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#tehnica_de_instrumentare">Tehnica de instrumentare</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#tehnica_de_esantionare_sampling">Tehnica de eșantionare (sampling)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#suport_pentru_profiler">Suport pentru profiler</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-07.html#unelte">Unelte</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-07.html#perfcounters">perfcounters</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#perf">perf</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-07.html#utilizare">Utilizare</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#perf_list">perf list</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#perf_stat">perf stat</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#perf_top">perf top</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#perf_record">perf record</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#perf_report">perf report</a></div></li>
<li class="level2"><div class="li"><a href="laborator-07.html#debugging">Debugging</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-07.html#strace">strace</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#gdb">gdb</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#valgrind">valgrind</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#alte_utilitare">Alte utilitare</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-07.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-07.html#exercitii_laborator_-_linux_11p">Exerciții laborator - Linux (11p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_1_-_custom_profiling_15p">Exercițiul 1 - Custom Profiling (1.5p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_2_-_rowcolumn_major_order_15p">Exercițiul 2 - Row/Column major order (1.5p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_3_-_busy_1p">Exercițiul 3 - busy (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_4_-_cautare_intr-un_sir_de_caractere_2p">Exercițiul 4 - Căutare într-un șir de caractere (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_5_-_printing_order_1p">Exercițiul 5 - Printing order (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_6_-_flowers_reloaded_15p">Exercițiul 6 - Flowers reloaded (1.5p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_7_-_buffer_overflow_exploit_15p">Exercițiul 7 - Buffer overflow exploit (1.5p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-07.html#exercitiul_8_-_trace_the_mystery_1p">Exercițiul 8 - Trace the mystery (1p)</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-07.html#solutii">Soluții</a></div></li>
<li class="level1"><div class="li"><a href="laborator-07.html#resurse_utile">Resurse utile</a></div></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_07_-_profiling_debugging">Laborator 07 - Profiling &amp; Debugging</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 07 - Profiling & Debugging" [1-52] -->
<h2 class="sectionedit2" id="materiale_ajutatoare">Materiale ajutătoare</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"><a href="http://elf.cs.pub.ro/so/res/laboratoare/lab07-slides.pdf" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab07-slides.pdf"  rel="nofollow"> lab07-slides.pdf</a> </div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Materiale ajutătoare" [53-172] -->
<h3 class="sectionedit3" id="nice_to_watch">Nice to Watch</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"><a href="http://www.youtube.com/watch?v=73IyVBMf2uY" class="urlextern" title="http://www.youtube.com/watch?v=73IyVBMf2uY"  rel="nofollow"> Google I/O 2010 - Measure in milliseconds: Meet Speed Tracer</a></div>
</li>
<li class="level1"><div class="li"><a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-5-performance-engineering-with-profiling-tools/" class="urlextern" title="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-172-performance-engineering-of-software-systems-fall-2010/video-lectures/lecture-5-performance-engineering-with-profiling-tools/"  rel="nofollow"> MIT Lecture: Performance Engineering with Profiling Tools</a></div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Nice to Watch" [173-579] -->
<h3 class="sectionedit4" id="latency_comparison_numbers">Latency Comparison Numbers</h3>
<div class="level3">
<div class="table sectionedit5"><table class="inline">
	<tr class="row0">
		<th class="col0"> Operation </th><th class="col1"> Time (ns) </th><th class="col2"> Notes </th>
	</tr>
	<tr class="row1">
		<td class="col0"> L1 cache reference </td><td class="col1">0.5 ns </td><td class="col2"> </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Branch mispredict  </td><td class="col1 leftalign">5   ns  </td><td class="col2"> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> L2 cache reference </td><td class="col1 leftalign">7   ns  </td><td class="col2">14x L1 cache</td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Mutex lock/unlock  </td><td class="col1">25   ns </td><td class="col2"> </td>
	</tr>
	<tr class="row5">
		<td class="col0"> Main memory reference </td><td class="col1">100   ns</td><td class="col2">20x L2 cache, 200x L1 cache </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Compress 1K bytes with Zippy </td><td class="col1">3,000 ns </td><td class="col2"> </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Send 1K bytes over 1 Gbps network </td><td class="col1">10,000 ns </td><td class="col2">0.01 ms</td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> Read 4K randomly from SSD*        </td><td class="col1 leftalign">150,000 ns  </td><td class="col2"> 0.15 ms</td>
	</tr>
	<tr class="row9">
		<td class="col0"> Read 1 <abbr title="Megabyte">MB</abbr> sequentially from memory </td><td class="col1 leftalign">250,000 ns  </td><td class="col2"> 0.25 ms</td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> Round trip within same datacenter   </td><td class="col1 leftalign">500,000 ns   </td><td class="col2">0.5 ms</td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> Read 1 <abbr title="Megabyte">MB</abbr> sequentially from SSD*   </td><td class="col1 leftalign">1,000,000 ns  </td><td class="col2">1 ms,  4X memory</td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> Disk seek                         </td><td class="col1 leftalign">10,000,000 ns  </td><td class="col2">10 ms,  20x datacenter roundtrip</td>
	</tr>
	<tr class="row13">
		<td class="col0 leftalign"> Read 1 <abbr title="Megabyte">MB</abbr> sequentially from disk  </td><td class="col1 centeralign">   20,000,000   ns  </td><td class="col2"> 20 ms  80x memory, 20X SSD</td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> Send packet Caracal - NY - Caracal   </td><td class="col1 centeralign">  150,000,000   ns  </td><td class="col2">150 ms </td>
	</tr>
</table></div>
<!-- EDIT5 TABLE [617-1460] -->
<p>
Credits:
</p>
<ul>
<li class="level1"><div class="li"> By Jeff Dean:               <a href="http://research.google.com/people/jeff/" class="urlextern" title="http://research.google.com/people/jeff/"  rel="nofollow">http://research.google.com/people/jeff/</a></div>
</li>
<li class="level1"><div class="li"> Originally by Peter Norvig: <a href="http://norvig.com/21-days.html#answers" class="urlextern" title="http://norvig.com/21-days.html#answers"  rel="nofollow">http://norvig.com/21-days.html#answers</a></div>
</li>
</ul>

</div>
<!-- EDIT4 SECTION "Latency Comparison Numbers" [580-1613] -->
<h2 class="sectionedit6" id="profiling">Profiling</h2>
<div class="level2">

<p>
Un <strong>profiler</strong> este un utilitar de analiză a <strong>performanței</strong> care ajută programatorul să determine punctele critice – <strong>bottleneck</strong> – ale unui program. Acest lucru se realizează prin investigarea comportamentului programului, evaluarea consumului de memorie și relația dintre modulele acestuia.
</p>

</div>
<!-- EDIT6 SECTION "Profiling" [1614-1946] -->
<h3 class="sectionedit7" id="tehnici_de_profiling">Tehnici de profiling</h3>
<div class="level3">

</div>
<!-- EDIT7 SECTION "Tehnici de profiling" [1947-1978] -->
<h3 class="sectionedit8" id="tehnica_de_instrumentare">Tehnica de instrumentare</h3>
<div class="level3">

<p>
Profiler-ele bazate pe această tehnică necesită de obicei <strong>modificări</strong> în codul programului: se inserează secțiuni de cod la începutul și sfârșitul funcției ce se dorește analizată. De asemenea, se rețin și funcțiile apelate. Astfel, se poate estima timpul total al apelului în sine cât și al apelurilor de subfuncții.
<strong>Dezavantajul</strong> major al acestor profilere este legat de modificarea codului: în funcții de dimensiune scăzută și des apelate, acest overhead poate duce la o interpretare greșită e rezultatelor.
</p>

</div>
<!-- EDIT8 SECTION "Tehnica de instrumentare" [1979-2559] -->
<h3 class="sectionedit9" id="tehnica_de_esantionare_sampling">Tehnica de eșantionare (sampling)</h3>
<div class="level3">

<p>
Profiler-ele bazate pe sampling <strong>nu fac schimbări</strong> în codul programului, ci verifică periodic procesorul cu scopul de a determina ce funcție (instrucțiune) se execută la momentul respectiv. Apoi estimează frecvența și timpul de execuție al unei anumite funcții într-o perioadă de timp.
</p>

</div>
<!-- EDIT9 SECTION "Tehnica de eșantionare (sampling)" [2560-2907] -->
<h3 class="sectionedit10" id="suport_pentru_profiler">Suport pentru profiler</h3>
<div class="level3">

<p>
Suportul pentru profilere este disponibil la nivel de:
</p>
<ul>
<li class="level1"><div class="li"><strong>bibliotecă C</strong> (GNU libc), prin informații legate de timpul de viață al alocărilor de memorie,</div>
</li>
<li class="level1"><div class="li"><strong>compilator</strong>, prin modificarea codului în tehnica de <strong>instrumentare</strong> se poate realiza ușor în procesul de compilare, compilatorul fiind cel ce inserează secțiunile de cod necesare,</div>
</li>
<li class="level1"><div class="li"><strong>nucleu</strong> al sistemului de operare, prin punerea la dispoziție de apeluri de sistem specifice,</div>
</li>
<li class="level1"><div class="li"><strong>hardware</strong>, unele procesoare sunt dotate cu contoare de temporizare (<a href="http://en.wikipedia.org/wiki/Time_Stamp_Counter" class="urlextern" title="http://en.wikipedia.org/wiki/Time_Stamp_Counter"  rel="nofollow">Time Stamp Counter - TSC</a>) sau contoare de performanță care numără evenimente precum cicluri de procesor sau TLB miss-uri.</div>
</li>
</ul>

</div>
<!-- EDIT10 SECTION "Suport pentru profiler" [2908-3647] -->
<h2 class="sectionedit11" id="unelte">Unelte</h2>
<div class="level2">

<p>
În continuare sunt prezentate câteva unelte folosite în profiling.
</p>

</div>
<!-- EDIT11 SECTION "Unelte" [3648-3738] -->
<h3 class="sectionedit12" id="perfcounters">perfcounters</h3>
<div class="level3">

<p>
Majoritatea procesoarelor moderne oferă registre speciale (<code>performance counters</code>) care contorizează diferite tipuri de evenimente hardware: instrucțiuni executate, cache-miss-uri, instrucțiuni de salt anticipate greșit, fără să afecteze performanța nucleului sau a aplicațiilor. Aceste registre pot declanșa întreruperi atunci când se acumulează un anumit număr de evenimente și astfel se pot folosi pentru analiza codului care rulează pe procesorul în cauză. 
</p>

<p>
Subsistemul <code>perfcounters</code>:
</p>
<ul>
<li class="level1"><div class="li"> se găsește în nucleul Linux începând cu versiunea <a href="http://lwn.net/Articles/339361/" class="urlextern" title="http://lwn.net/Articles/339361/"  rel="nofollow"> 2.6.31</a>  (<code>CONFIG_PERF_COUNTERS=y</code> )</div>
</li>
<li class="level1"><div class="li"> este înlocuitorul lui <code>oprofile</code></div>
</li>
<li class="level1"><div class="li"> oferă suport pentru:</div>
<ul>
<li class="level2"><div class="li"> <code>evenimente hardware</code> (instrucțiuni, accese cache, ciclii de magistrală).</div>
</li>
<li class="level2"><div class="li"> <code>evenimente software</code> (page fault, cpu-clock, cpu migrations).</div>
</li>
<li class="level2"><div class="li"> <code>tracepoints</code> (e.g: sys_enter_open, sys_exit_open).</div>
</li>
</ul>
</li>
</ul>

</div>
<!-- EDIT12 SECTION "perfcounters" [3739-4693] -->
<h3 class="sectionedit13" id="perf">perf</h3>
<div class="level3">

<p>
Utilitarul <code>perf</code> este interfața subsistemului <code>perfcounters</code> cu utilizatorul. Oferă o linie de comandă asemănătoare cu <code>git</code> și nu necesită existența unui daemon. 
</p>

<p>
Un tutorial despre perf găsiți <a href="https://perf.wiki.kernel.org/index.php/Tutorial" class="urlextern" title="https://perf.wiki.kernel.org/index.php/Tutorial"  rel="nofollow">aici</a>.
</p>

</div>
<!-- EDIT13 SECTION "perf" [4694-4981] -->
<h2 class="sectionedit14" id="utilizare">Utilizare</h2>
<div class="level2">
<pre class="code bash"><span class="co4">$ </span>perf <span class="br0">&#91;</span>--version<span class="br0">&#93;</span> <span class="br0">&#91;</span>--help<span class="br0">&#93;</span> COMMAND <span class="br0">&#91;</span>ARGS<span class="br0">&#93;</span></pre>

<p>
Cele mai folosite <code>comenzi</code> sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>annotate</code> - Citește <code>perf.data</code> și afișează codul cu adnotări</div>
</li>
<li class="level1"><div class="li"> <code>list</code>     - Listează numele simbolice ale tuturor tipurilor de evenimente ce pot fi urmărite de <code>perf</code></div>
</li>
<li class="level1"><div class="li"> <code>lock</code>     - Analizează evenimentele de tip lock</div>
</li>
<li class="level1"><div class="li"> <code>record</code>   - Rulează o comandă și salvează informațiile de profiling în fișierul <code>perf.data</code></div>
</li>
<li class="level1"><div class="li"> <code>report</code>   - Citește <code>perf.data</code> (creat de <code>perf record</code>) și afișează profilul</div>
</li>
<li class="level1"><div class="li"> <code>sched</code>    - Utilitar pentru măsurarea proprietăților planificatorului (latențe)</div>
</li>
<li class="level1"><div class="li"> <code>stat</code>     - Rulează o comandă și afișează statisticile înregistrate de subsistemul performance counters</div>
</li>
<li class="level1"><div class="li"> <code>top</code>      - Generează și afișează informații în timp real despre încărcarea unui sistem</div>
</li>
</ul>

</div>
<!-- EDIT14 SECTION "Utilizare" [4982-5860] -->
<h2 class="sectionedit15" id="perf_list">perf list</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://manpages.ubuntu.com/manpages/natty/man1/perf-list.1.html" class="urlextern" title="http://manpages.ubuntu.com/manpages/natty/man1/perf-list.1.html"  rel="nofollow">man perf-list</a></div>
</li>
</ul>

<p>
Afișează numele simbolice ale tuturor tipurilor de evenimente ce pot fi urmărite de <code>perf</code>. 
</p>
<pre class="code bash">$ perf list 
List of pre-defined events <span class="br0">&#40;</span>to be used <span class="kw1">in</span> -e<span class="br0">&#41;</span>:
&nbsp;
  cpu-cycles OR cycles                       <span class="br0">&#91;</span>Hardware event<span class="br0">&#93;</span>
  instructions                               <span class="br0">&#91;</span>Hardware event<span class="br0">&#93;</span>
&nbsp;
  cpu-clock                                  <span class="br0">&#91;</span>Software event<span class="br0">&#93;</span>
  page-faults OR faults                      <span class="br0">&#91;</span>Software event<span class="br0">&#93;</span>
&nbsp;
  L1-dcache-loads                            <span class="br0">&#91;</span>Hardware cache event<span class="br0">&#93;</span>
  L1-dcache-load-misses                      <span class="br0">&#91;</span>Hardware cache event<span class="br0">&#93;</span>
&nbsp;
  rNNN                                       <span class="br0">&#91;</span>Raw hardware event descriptor<span class="br0">&#93;</span>
&nbsp;
  mem:<span class="sy0">&lt;</span>addr<span class="sy0">&gt;</span><span class="br0">&#91;</span>:access<span class="br0">&#93;</span>                        <span class="br0">&#91;</span>Hardware breakpoint<span class="br0">&#93;</span>
&nbsp;
  syscalls:sys_enter_accept                  <span class="br0">&#91;</span>Tracepoint event<span class="br0">&#93;</span>
  syscalls:sys_exit_accept                   <span class="br0">&#91;</span>Tracepoint event<span class="br0">&#93;</span></pre>

<p>
Atunci când un eveniment nu este disponibil în forma simbolică, poate fi folosit cu perf în forma procesorului din sistemul analizat.
</p>

</div>
<!-- EDIT15 SECTION "perf list" [5861-6953] -->
<h2 class="sectionedit16" id="perf_stat">perf stat</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://manpages.ubuntu.com/manpages/lucid/man1/perf-stat.1.html" class="urlextern" title="http://manpages.ubuntu.com/manpages/lucid/man1/perf-stat.1.html"  rel="nofollow">perf-stat</a></div>
</li>
</ul>

<p>
Rulează o comandă și afișează statisticile înregistrate de subsistemul performance counters.
</p>
<pre class="code bash">$ perf <span class="kw2">stat</span> <span class="kw2">ls</span> <span class="re5">-R</span> <span class="sy0">/</span>usr<span class="sy0">/</span>src<span class="sy0">/</span>linux
 Performance counter stats <span class="kw1">for</span> <span class="st_h">'ls -R /usr/src/linux'</span>:
&nbsp;
         <span class="nu0">934.512846</span>  task-clock-msecs         <span class="co0">#      0.114 CPUs </span>
               <span class="nu0">1695</span>  context-switches         <span class="co0">#      0.002 M/sec</span>
                <span class="nu0">163</span>  CPU-migrations           <span class="co0">#      0.000 M/sec</span>
                <span class="nu0">306</span>  page-faults              <span class="co0">#      0.000 M/sec</span>
          <span class="nu0">725144010</span>  cycles                   <span class="co0">#    775.959 M/sec </span>
          <span class="nu0">419392509</span>  instructions             <span class="co0">#      0.578 IPC   </span>
           <span class="nu0">80242637</span>  branches                 <span class="co0">#     85.866 M/sec </span>
            <span class="nu0">5680112</span>  branch-misses            <span class="co0">#      7.079 %     </span>
          <span class="nu0">174667968</span>  cache-references         <span class="co0">#    186.908 M/sec </span>
            <span class="nu0">4178882</span>  cache-misses             <span class="co0">#      4.472 M/sec </span>
&nbsp;
        <span class="nu0">8.199187316</span>  seconds <span class="kw1">time</span> elapsed</pre>

<p>
<code>perf stat</code> oferă posibilitatea colectării datelor în urma rulării de mai multe ori a unui program specificând opțiunea <code>-r</code>.
</p>
<pre class="code bash">$ perf <span class="kw2">stat</span> <span class="re5">-r</span> <span class="nu0">6</span> <span class="kw2">sleep</span> <span class="nu0">1</span>
 Performance counter stats <span class="kw1">for</span> <span class="st_h">'sleep 1'</span> <span class="br0">&#40;</span><span class="nu0">6</span> runs<span class="br0">&#41;</span>:
&nbsp;
           <span class="nu0">1.757147</span>  task-clock-msecs <span class="co0">#      0.002 CPUs    ( +-   3.000% )</span>
                  <span class="nu0">1</span>  context-switches <span class="co0">#      0.001 M/sec   ( +-  14.286% )</span>
                  <span class="nu0">0</span>  CPU-migrations   <span class="co0">#      0.000 M/sec   ( +- 100.000% )</span>
                <span class="nu0">144</span>  page-faults      <span class="co0">#      0.082 M/sec   ( +-   0.147% )</span>
            <span class="nu0">1373254</span>  cycles           <span class="co0">#    781.525 M/sec   ( +-   2.856% )</span>
             <span class="nu0">588831</span>  instructions     <span class="co0">#      0.429 IPC     ( +-   0.667% )</span>
             <span class="nu0">106846</span>  branches         <span class="co0">#     60.806 M/sec   ( +-   0.324% )</span>
              <span class="nu0">11312</span>  branch-misses    <span class="co0">#     10.587 %       ( +-   0.851% )</span>
        <span class="nu0">1.002619407</span>  seconds <span class="kw1">time</span> elapsed   <span class="br0">&#40;</span> +-   <span class="nu0">0.012</span><span class="sy0">%</span> <span class="br0">&#41;</span></pre>

<p>
Observați mai sus evenimentele cele mai importante contorizate.
</p>

</div>
<!-- EDIT16 SECTION "perf stat" [6954-8927] -->
<h2 class="sectionedit17" id="perf_top">perf top</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"><a href="http://manpages.ubuntu.com/manpages/natty/man1/perf-top.1.html" class="urlextern" title="http://manpages.ubuntu.com/manpages/natty/man1/perf-top.1.html"  rel="nofollow">man perf-top</a></div>
</li>
</ul>

<p>
Generează și afișează informații în timp real despre încărcarea unui sistem.
</p>
<pre class="code bash">$ <span class="kw2">ls</span> <span class="re5">-R</span> <span class="sy0">/</span>home
$ perf top <span class="re5">-p</span> $<span class="br0">&#40;</span><span class="kw2">pidof</span> <span class="kw2">ls</span><span class="br0">&#41;</span>
<span class="re5">--------------------------------------------------------------</span>
   PerfTop:     <span class="nu0">181</span> irqs<span class="sy0">/</span>sec  kernel:<span class="nu0">72.4</span><span class="sy0">%</span> <span class="br0">&#40;</span>target_pid: <span class="nu0">10421</span><span class="br0">&#41;</span>
<span class="re5">--------------------------------------------------------------</span>
             samples  pcnt <span class="kw1">function</span>             DSO
             _______ _____ ____________________ ___________________
&nbsp;
              <span class="nu0">270.00</span> <span class="nu0">15.8</span><span class="sy0">%</span> __d_lookup           <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
              <span class="nu0">145.00</span>  <span class="nu0">8.5</span><span class="sy0">%</span> __GI___strcoll_l     <span class="sy0">/</span>lib<span class="sy0">/</span>libc-2.12.1.so
               <span class="nu0">99.00</span>  <span class="nu0">5.8</span><span class="sy0">%</span> link_path_walk       <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">97.00</span>  <span class="nu0">5.7</span><span class="sy0">%</span> find_inode_fast      <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">91.00</span>  <span class="nu0">5.3</span><span class="sy0">%</span> __GI_strncmp         <span class="sy0">/</span>lib<span class="sy0">/</span>libc-2.12.1.so
               <span class="nu0">55.00</span>  <span class="nu0">3.2</span><span class="sy0">%</span> move_freepages_block <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">44.00</span>  <span class="nu0">2.6</span><span class="sy0">%</span> ext3_dx_find_entry   <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">41.00</span>  <span class="nu0">2.4</span><span class="sy0">%</span> ext3_find_entry      <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">40.00</span>  <span class="nu0">2.3</span><span class="sy0">%</span> dput                 <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  
               <span class="nu0">39.00</span>  <span class="nu0">2.3</span><span class="sy0">%</span> ext3_check_dir_entry <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  </pre>

<p>
Observăm că funcțiile de lucru cu fișiere (parcurgere, căutare) sunt cele care apar cel mai des în outputul lui perf-top corespunzător rulării comenzii de listare recursivă a directorului <code>home</code>.
</p>

</div>
<!-- EDIT17 SECTION "perf top" [8928-10374] -->
<h2 class="sectionedit18" id="perf_record">perf record</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"><a href="http://manpages.ubuntu.com/manpages/natty/man1/perf-record.1.html" class="urlextern" title="http://manpages.ubuntu.com/manpages/natty/man1/perf-record.1.html"  rel="nofollow"> man perf-record</a></div>
</li>
</ul>

<p>
Rulează o comandă și salvează informațiile de profiling în fișierul <code>perf.data</code>.
</p>
<pre class="code bash">$ perf record <span class="kw2">wget</span> http:<span class="sy0">//</span>elf.cs.pub.ro<span class="sy0">/</span>so<span class="sy0">/</span>wiki<span class="sy0">/</span>laboratoare<span class="sy0">/</span>laborator-07
&nbsp;
<span class="br0">&#91;</span> perf record: Woken up <span class="nu0">1</span> <span class="kw3">times</span> to <span class="kw2">write</span> data <span class="br0">&#93;</span>
<span class="br0">&#91;</span> perf record: Captured and wrote <span class="nu0">0.008</span> MB perf.data <span class="br0">&#40;</span>~<span class="nu0">334</span> samples<span class="br0">&#41;</span> <span class="br0">&#93;</span>
&nbsp;
$ <span class="kw2">ls</span>
laborator-07  perf.data</pre>

</div>
<!-- EDIT18 SECTION "perf record" [10375-10822] -->
<h2 class="sectionedit19" id="perf_report">perf report</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://manpages.ubuntu.com/manpages/natty/man1/perf-report.1.html" class="urlextern" title="http://manpages.ubuntu.com/manpages/natty/man1/perf-report.1.html"  rel="nofollow"> man perf-report</a></div>
</li>
</ul>

<p>
Interpretează datele salvate în <code>perf.data</code> în urma analizei folosind <code>perf record</code>. Astfel pentru exemplul <code>wget</code> de mai sus avem:
</p>
<pre class="code bash">$ perf report 
<span class="co0"># Events: 13  cycles</span>
<span class="co0">#</span>
<span class="co0"># Overhead  Command      Shared Object  Symbol</span>
<span class="co0"># ........  .......  .................  ......</span>
<span class="co0">#</span>
    <span class="nu0">86.43</span><span class="sy0">%</span>     <span class="kw2">wget</span>             e8ee21  <span class="br0">&#91;</span>.<span class="br0">&#93;</span> 0x00000000e8ee21
    <span class="nu0">11.03</span><span class="sy0">%</span>     <span class="kw2">wget</span>  <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  <span class="br0">&#91;</span>k<span class="br0">&#93;</span> prep_new_page
     <span class="nu0">2.37</span><span class="sy0">%</span>     <span class="kw2">wget</span>  <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  <span class="br0">&#91;</span>k<span class="br0">&#93;</span> sock_aio_read
     <span class="nu0">0.11</span><span class="sy0">%</span>     <span class="kw2">wget</span>  <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  <span class="br0">&#91;</span>k<span class="br0">&#93;</span> perf_event_comm
     <span class="nu0">0.05</span><span class="sy0">%</span>     <span class="kw2">wget</span>  <span class="br0">&#91;</span>kernel.kallsyms<span class="br0">&#93;</span>  <span class="br0">&#91;</span>k<span class="br0">&#93;</span> native_write_msr_safe</pre>

</div>
<!-- EDIT19 SECTION "perf report" [10823-11538] -->
<h2 class="sectionedit20" id="debugging">Debugging</h2>
<div class="level2">

</div>
<!-- EDIT20 SECTION "Debugging" [11539-11560] -->
<h3 class="sectionedit21" id="strace">strace</h3>
<div class="level3">

<p>
strace interceptează şi înregistrează apelurile de sistem făcute de un proces şi semnalele pe care acesta le primeşte. În cea mai simplă formă <code>strace</code> rulează comanda specificată până când procesul asociat se încheie.
</p>
<pre class="code bash"><span class="re1">$strace</span> <span class="kw2">cat</span> <span class="sy0">/</span>proc<span class="sy0">/</span>cpuinfo
execve<span class="br0">&#40;</span><span class="st0">&quot;/bin/cat&quot;</span>, <span class="br0">&#91;</span><span class="st0">&quot;cat&quot;</span>, <span class="st0">&quot;/proc/cpuinfo&quot;</span><span class="br0">&#93;</span>, <span class="br0">&#91;</span><span class="sy0">/*</span> <span class="nu0">30</span> vars <span class="sy0">*/</span><span class="br0">&#93;</span><span class="br0">&#41;</span> = <span class="nu0">0</span>
open<span class="br0">&#40;</span><span class="st0">&quot;/proc/cpuinfo&quot;</span>, O_RDONLY<span class="br0">&#41;</span>         = <span class="nu0">3</span>
<span class="kw2">read</span><span class="br0">&#40;</span><span class="nu0">3</span>, <span class="st0">&quot;processor<span class="es1">\t</span>: 0<span class="es1">\n</span>vendor_id<span class="es1">\t</span>: Genuin&quot;</span>..., <span class="nu0">32768</span><span class="br0">&#41;</span> = <span class="nu0">3652</span>
<span class="kw2">write</span><span class="br0">&#40;</span><span class="nu0">1</span>, <span class="st0">&quot;processor<span class="es1">\t</span>: 0$<span class="es1">\n</span>vendor_id<span class="es1">\t</span>: Genui&quot;</span>..., <span class="nu0">7512</span><span class="br0">&#41;</span> = <span class="nu0">7512</span></pre>

<p>
Cele mai folosite opțiuni pentru strace sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>-f</code>, cu această opțiune vor fi urmărite şi procesele copil create de procesul curent</div>
</li>
<li class="level1"><div class="li"> <code>-o filename</code>, în mod implicit strace afişează informațiile la <code>stderr</code>. Cu această opțiune, output-ul va fi pus în fişierul <code>filename</code></div>
</li>
<li class="level1"><div class="li"> <code>-p pid</code>, pid-ul procesului de urmărit.</div>
</li>
<li class="level1"><div class="li"> <code>-e expresie</code>, modifică apelurile urmărite. </div>
</li>
<li class="level1"><div class="li"> <pre class="code bash"><span class="co4">daniel@debian$ </span><span class="kw2">strace</span> <span class="re5">-f</span> <span class="re5">-e</span> connect,socket,<span class="kw3">bind</span> <span class="re5">-p</span> $<span class="br0">&#40;</span><span class="kw2">pidof</span> iceweasel<span class="br0">&#41;</span>
Process <span class="nu0">6429</span> attached with <span class="nu0">30</span> threads - interrupt to quit
socket<span class="br0">&#40;</span>PF_INET, SOCK_STREAM, IPPROTO_IP<span class="br0">&#41;</span> = <span class="nu0">50</span>
connect<span class="br0">&#40;</span><span class="nu0">50</span>, <span class="br0">&#123;</span><span class="re2">sa_family</span>=AF_INET, <span class="re2">sin_port</span>=htons<span class="br0">&#40;</span><span class="nu0">80</span><span class="br0">&#41;</span>, <span class="re2">sin_addr</span>=inet_addr<span class="br0">&#40;</span><span class="st0">&quot;141.85.227.65&quot;</span><span class="br0">&#41;</span><span class="br0">&#125;</span>, <span class="nu0">16</span><span class="br0">&#41;</span> = <span class="re5">-1</span> EINPROGRESS
&nbsp;</pre>
</div>
</li>
</ul>

<p>
Un alt utilitar înrudit cu <code>strace</code> este <a href="http://linux.die.net/man/1/ltrace" class="urlextern" title="http://linux.die.net/man/1/ltrace"  rel="nofollow"> ltrace</a>. Acesta urmăreşte apelurile de bibliotecă.
</p>

</div>
<!-- EDIT21 SECTION "strace" [11561-12946] -->
<h3 class="sectionedit22" id="gdb">gdb</h3>
<div class="level3">

<p>
Scopul unui debugger (de exemplu GDB) este să ne permită să inspectăm ce se întâmplă <em>în interiorul</em> unui program în timp ce acesta rulează sau în momentul când s-a produs o eroare fatală.
</p>

<p>
Mai multe detalii în secțiunea de <a href="../../../../so/laboratoare/resurse/gdb.html" class="urlextern" title="http://ocw.cs.pub.ro/courses/so/laboratoare/resurse/gdb"  rel="nofollow"> resurse</a>.
</p>

</div>
<!-- EDIT22 SECTION "gdb" [12947-13272] -->
<h3 class="sectionedit23" id="valgrind">valgrind</h3>
<div class="level3">

<p>
Mai multe detalii <a href="../../../../so/laboratoare/laborator-05.html#valgrind" class="urlextern" title="http://ocw.cs.pub.ro/courses/so/laboratoare/laborator-05#valgrind"  rel="nofollow"> aici</a>.
</p>

</div>
<!-- EDIT23 SECTION "valgrind" [13273-13388] -->
<h3 class="sectionedit24" id="alte_utilitare">Alte utilitare</h3>
<div class="level3">

<p>
<a href="../../../../_detail/so/laboratoare/tools.png%3Fid=so%253Alaboratoare%253Alaborator-07.html" class="media" title="so:laboratoare:tools.png"><img src="../../../../_media/so/laboratoare/tools.png%3Fw=700&amp;h=500&amp;tok=6f9ff3" class="mediacenter" alt="" width="700" height="500" /></a>
</p>
<ul>
<li class="level1"><div class="li"><a href="http://elf.cs.pub.ro/so/wiki/laboratoare/resurse/oprofile" class="urlextern" title="http://elf.cs.pub.ro/so/wiki/laboratoare/resurse/oprofile"  rel="nofollow">Oprofile</a> </div>
</li>
<li class="level1"><div class="li"><a href="http://www.microsoft.com/downloads/details.aspx?familyid=d6e95259-8d9d-4c22-89c4-fad382eddcd1&amp;displaylang=en" class="urlextern" title="http://www.microsoft.com/downloads/details.aspx?familyid=d6e95259-8d9d-4c22-89c4-fad382eddcd1&amp;displaylang=en"  rel="nofollow">Kernrate</a> este un echivalent al oprofile pentru Windows.</div>
</li>
<li class="level1"><div class="li"><a href="http://kcachegrind.sourceforge.net/html/Home.html" class="urlextern" title="http://kcachegrind.sourceforge.net/html/Home.html"  rel="nofollow">KCachegrind</a></div>
</li>
<li class="level1"><div class="li"><a href="http://code.google.com/p/google-perftools/" class="urlextern" title="http://code.google.com/p/google-perftools/"  rel="nofollow"> perf-tools</a></div>
</li>
<li class="level1"><div class="li"><a href="http://blogs.msdn.com/ntdebugging/archive/2008/04/03/windows-performance-toolkit-xperf.aspx" class="urlextern" title="http://blogs.msdn.com/ntdebugging/archive/2008/04/03/windows-performance-toolkit-xperf.aspx"  rel="nofollow">XPerf</a></div>
</li>
<li class="level1"><div class="li"><a href="http://sourceware.org/binutils/docs/gprof" class="urlextern" title="http://sourceware.org/binutils/docs/gprof"  rel="nofollow">GNU gprof</a></div>
</li>
</ul>

</div>
<!-- EDIT24 SECTION "Alte utilitare" [13389-14001] -->
<h1 class="sectionedit25" id="exercitii">Exerciții</h1>
<div class="level1">

</div>
<!-- EDIT25 SECTION "Exerciții" [14002-14028] -->
<h2 class="sectionedit26" id="exercitii_laborator_-_linux_11p">Exerciții laborator - Linux (11p)</h2>
<div class="level2">

<p>
<p><div class="noteimportant">Folosiți arhiva <a href="http://elf.cs.pub.ro/so/res/laboratoare/lab07-tasks.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab07-tasks.zip"  rel="nofollow"> lab07-tasks.zip</a> aferentă laboratorului.
</div></p>
</p>

<p>
<p><div class="noteimportant">
Întrucât avem nevoie de suport hardware, suport inexistent pe mașina virtuală, <strong>lucrați pe sistemul fizic</strong>.
</p>

<p>
Pentru a vedea ce pachet trebuie să instalați, rulați comanda <code>perf</code> fără parametri.

</div></p>
</p>

<p>
<p><div class="noteimportant">
Pentru a putea face exercițiile e nevoie de utilitarul <code>linux-tools</code>. Puteți verifica asta rulând comanda <code>perf --help</code>. Dacă comanda nu e găsită, trebuie să instalați pachetul:
</p>
<pre class="code bash"><span class="co4">student@so:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get update</span>
<span class="co4">student@so:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> linux-tools-generic</pre>

<p>
Trebuie descarcate urmatoarele pachete:
</p>
<pre class="code bash"><span class="co4">student@so:~$ </span><span class="kw2">wget</span> http:<span class="sy0">//</span>ro.archive.ubuntu.com<span class="sy0">/</span>ubuntu<span class="sy0">/</span>pool<span class="sy0">/</span>main<span class="sy0">/</span>l<span class="sy0">/</span>linux-lts-vivid<span class="sy0">/</span>linux-lts-vivid-tools-3.19.0-<span class="nu0">51</span>_3.19.0-<span class="nu0">51.58</span>~14.04.1_i386.deb
<span class="co4">student@so:~$ </span><span class="kw2">wget</span> http:<span class="sy0">//</span>ro.archive.ubuntu.com<span class="sy0">/</span>ubuntu<span class="sy0">/</span>pool<span class="sy0">/</span>main<span class="sy0">/</span>l<span class="sy0">/</span>linux-lts-vivid<span class="sy0">/</span>linux-tools-3.19.0-<span class="nu0">51</span>-generic_3.19.0-<span class="nu0">51.58</span>~14.04.1_i386.deb</pre>

<p>
Trebuie instalate din Ubuntu Software Center.

</div></p>
</p>

</div>
<!-- EDIT26 SECTION "Exerciții laborator - Linux (11p)" [14029-15179] -->
<h3 class="sectionedit27" id="exercitiul_1_-_custom_profiling_15p">Exercițiul 1 - Custom Profiling (1.5p)</h3>
<div class="level3">

<p>
Perf pune la dispoziție un mod de a extrage datele importante din profiling prin suportul de scripting oferit de <code>perf script</code>. Acesta funcționează împreună cu <code>perf record</code> care obține lista de samples și o salvează în fișierul <code>perf.data</code>. Cu ajutorul lui <code>perf script</code> se pot parsa eventurile înregistrate in sampleuri în metoda <code>process_event</code>. Mai multe informații despre <code>perf script</code> se pot găsi la:
<a href="http://man7.org/linux/man-pages/man1/perf-script-python.1.html" class="urlextern" title="http://man7.org/linux/man-pages/man1/perf-script-python.1.html"  rel="nofollow">man perf-script-python</a> și <a href="https://lwn.net/Articles/620900/" class="urlextern" title="https://lwn.net/Articles/620900/"  rel="nofollow">exemplu de utilizare</a>
</p>

<p>
Intrați în directorul <code>1-custom</code>. Primul pas este să generăm fișierul <code>perf.data</code> care conține sampleurile. Pentru asta executați :
</p>
<pre class="code bash"><span class="kw2">make</span>
perf record <span class="re5">-e</span> cycles:pp <span class="re5">-c</span> <span class="nu0">10000</span> <span class="re5">-d</span> .<span class="sy0">/</span><span class="kw3">hash</span></pre>

<p>
Folosiți comanda <code>perf script</code> cu opțiunea <code>-f</code> (investigați <code>man perf-script</code>) astfel încât să gasiți numărul total de valori ale <code>instruction pointer-ului</code> și apoi pe cele aflate în funcția <code>hash_search_index</code>. Având cele două valori, calculați procentul valorilor din funcția <code>hash_search_index</code>.
<p><div class="notetip">
Folosiți <code>wc -l</code> pentru a număra liniile outputului și <code>grep</code>  pentru a filtra după simbolul <code>hash_search_index</code>. Pentru a face calcule cu numere raționale folosiți o comandă de tipul: <code>echo 7/2 | bc -l</code>.

</div></p>
</p>

<p>
Verificați rezultatul utilizând comanda <code>perf report</code>.
</p>

</div>
<!-- EDIT27 SECTION "Exercițiul 1 - Custom Profiling (1.5p)" [15180-16659] -->
<h3 class="sectionedit28" id="exercitiul_2_-_rowcolumn_major_order_15p">Exercițiul 2 - Row/Column major order (1.5p)</h3>
<div class="level3">

<p>
Folosind utilitarul <code>perf_3.2</code> dorim să determinăm dacă limbajul C este column-major sau row-major (<a href="http://en.wikipedia.org/wiki/Row-major_order" class="urlextern" title="http://en.wikipedia.org/wiki/Row-major_order"  rel="nofollow">row-major-order</a>).
</p>

<p>
Intrați în directorul <code>2-major</code> și completați programul <code>row.c</code> astfel încât să incrementeze elementele unei matrice pe linii,
după care completați programul <code>columns.c</code> astfel încât să incrementeze elementele unei matrice pe coloane.
</p>

<p>
Determinați numărul de cache-miss-uri comparativ cu numărul de accese la cache folosind <code>perf stat</code> pentru a urmări evenimentul <code>L1-dcache-load-misses</code>. Pentru a vedea evenimentele disponibile folosiți comanda <code>perf list</code>. Folosiți opțiunea <code>-e</code> a utilitarului <code>perf</code> pentru a specifica un anumit eveniment de urmărit (revedeți secțiunea <a href="laborator-07.html#perfcounters" title="so:laboratoare:laborator-07 ↵" class="wikilink1"> perfcounters</a>).
</p>

</div>
<!-- EDIT28 SECTION "Exercițiul 2 - Row/Column major order (1.5p)" [16660-17536] -->
<h3 class="sectionedit29" id="exercitiul_3_-_busy_1p">Exercițiul 3 - busy (1p)</h3>
<div class="level3">

<p>
Intrați în directorul <code>3-busy</code> și inspectați fișierul <code>busy.c</code>. Rulați programul <code>busy</code> și analizați încărcarea sistemului folosind comanda <code>sudo perf top</code>. Ce funcție pare să încarce sistemul?
</p>

</div>
<!-- EDIT29 SECTION "Exercițiul 3 - busy (1p)" [17537-17788] -->
<h3 class="sectionedit30" id="exercitiul_4_-_cautare_intr-un_sir_de_caractere_2p">Exercițiul 4 - Căutare într-un șir de caractere (2p)</h3>
<div class="level3">

<p>
Intrați în directorul <code>4-find-char/</code> și analizați conținutul fișierului <code>find-char.c</code>. Compilați fișierul <code>find-char.c</code> și rulați executabilul obținut.
</p>

<p>
Identificați, folosind <code>perf record</code> și <code>perf report</code>, care este funcția care ocupă cel mai mult timp de procesor și încercați să îmbunătățiți performanțele programului.
</p>

</div>
<!-- EDIT30 SECTION "Exercițiul 4 - Căutare într-un șir de caractere (2p)" [17789-18213] -->
<h3 class="sectionedit31" id="exercitiul_5_-_printing_order_1p">Exercițiul 5 - Printing order (1p)</h3>
<div class="level3">

<p>
Intrați în directorul <code>5-print/</code> și analizați conținutul fișierului <code>print.c</code>. Folosiți comanda <code>make print</code> pentru a compila programul <code>print</code>. Există fișierul <code>Makefile</code>?
</p>

<p>
Care este ordinea în care se fac scrierile la consolă? Explicați output-ul.
</p>

<p>
Puneți o instrucțiune <code>sleep(5)</code> înainte de <code>return 0;</code> în funcția <code>main</code> și folosiți comanda <code>strace -e write ./print</code> pentru a găsi explicația.
</p>

</div>
<!-- EDIT31 SECTION "Exercițiul 5 - Printing order (1p)" [18214-18696] -->
<h3 class="sectionedit32" id="exercitiul_6_-_flowers_reloaded_15p">Exercițiul 6 - Flowers reloaded (1.5p)</h3>
<div class="level3">

<p>
Intrați în directorul <code>6-flowers/</code> și analizați conținutul fișierului <code>flowers.c</code>. Compilați fișierul <code>flowers.c</code> şi rulați executabilul <code>flowers</code>. Ce se întâmplă? Folosiți valgrind cu opțiunea <code>--tool=memcheck</code>. Afișați valoarea celui de-al treilea element al array-ului <code>flowers</code>, adică <code>flowers[2]</code>.
</p>

</div>
<!-- EDIT32 SECTION "Exercițiul 6 - Flowers reloaded (1.5p)" [18697-19099] -->
<h3 class="sectionedit33" id="exercitiul_7_-_buffer_overflow_exploit_15p">Exercițiul 7 - Buffer overflow exploit (1.5p)</h3>
<div class="level3">

<p>
<p><div class="noteimportant">
Rezolvați acest exercițiu pe mașina virtuală.

</div></p>
</p>

<p>
Intrați în directorul <code>7-exploit/</code> și analizați conținutul fișierului exploit.c. Folosiți comanda <code>make</code> pentru a compila executabilul <code>exploit</code>. Identificați o problemă în funcția <code>read_name</code>.
</p>

<p>
Folosiți <code>gdb</code> pentru a investiga stiva înaintea efectuării apelului <code>read</code>.
</p>
<pre class="code bash">student<span class="sy0">@</span>spook:~ <span class="kw2">gdb</span> .<span class="sy0">/</span>exploit
<span class="br0">&#40;</span><span class="kw2">gdb</span><span class="br0">&#41;</span> <span class="kw3">break</span> read_name
<span class="br0">&#40;</span><span class="kw2">gdb</span><span class="br0">&#41;</span> run</pre>

<p>
Afișați adresele variabilelor <code>name</code> și <code>access</code>.
</p>
<pre class="code bash"><span class="br0">&#40;</span><span class="kw2">gdb</span><span class="br0">&#41;</span> print<span class="sy0">/</span>x <span class="sy0">&amp;</span>access
<span class="br0">&#40;</span><span class="kw2">gdb</span><span class="br0">&#41;</span> print<span class="sy0">/</span>x <span class="sy0">&amp;</span>name</pre>

<p>
Observați că diferența între adresa variabilei <code>access</code> și adresa bufferului <code>name</code> este de 0x10 (16) octeți, ceea ce înseamnă că variabila <code>access</code> se află imediat la sfârșitul datelor din bufferul <code>name</code>.
</p>

<p>
Folosindu-vă de informațiile obținute, construiți un input convenabil pe care să îl oferiți executabilului <code>exploit</code>, astfel încât acesta să vă afișeze stringul “Good job, you hacked me!”.
</p>

<p>
<p><div class="noteimportant">
Pentru a genera caractere neprintabile, puteți folosi interpretorul Python: <code>python -c</code>.
</p>
<pre class="code bash">student<span class="sy0">@</span>spook:~ python <span class="re5">-c</span> <span class="st_h">'print &quot;A&quot;*8 + &quot;\x01\x00\x00\x00&quot;'</span> <span class="sy0">|</span> .<span class="sy0">/</span>exploit</pre>

<p>
Comanda de mai sus va genera 8 octeți cu valoarea &#039;A&#039; (codul <abbr title="American Standard Code for Information Interchange">ASCII</abbr> 0x41), un octet cu valoarea 0x01 și încă 3 octeți cu valoarea 0x00 și îi va oferi la <code>stdin</code> executabilului <code>exploit</code>. Rețineti că datele sunt structurate în memorie în format little endian, prin urmare, dacă ultimii 4 octeți vor ajunge să suprascrie o adresă, aceasta va fi interpretată ca <code>0x00000001</code>, NU <code>0x01000000</code>.

</div></p>
</p>

</div>
<!-- EDIT33 SECTION "Exercițiul 7 - Buffer overflow exploit (1.5p)" [19100-20796] -->
<h3 class="sectionedit34" id="exercitiul_8_-_trace_the_mystery_1p">Exercițiul 8 - Trace the mystery (1p)</h3>
<div class="level3">

<p>
Intrați în directorul <code>8-mystery/</code> unde găsiți executabilul <code>mystery</code>. Investigați și explicați ce face acesta. Revedeți secțiunea <a href="laborator-07.html#strace" title="so:laboratoare:laborator-07 ↵" class="wikilink1"> strace</a>.
</p>

</div>
<!-- EDIT34 SECTION "Exercițiul 8 - Trace the mystery (1p)" [20797-23321] -->
<h1 class="sectionedit35" id="solutii">Soluții</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"><a href="http://elf.cs.pub.ro/so/res/laboratoare/lab07-sol.zip" class="urlextern" title="http://elf.cs.pub.ro/so/res/laboratoare/lab07-sol.zip"  rel="nofollow"> Soluții laborator 7</a></div>
</li>
</ul>

</div>
<!-- EDIT35 SECTION "Soluții" [23322-23429] -->
<h1 class="sectionedit36" id="resurse_utile">Resurse utile</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="http://sourceware.org/binutils/docs/gprof/" class="urlextern" title="http://sourceware.org/binutils/docs/gprof/"  rel="nofollow"> GNU grof manual</a> </div>
</li>
<li class="level1"><div class="li"> <a href="http://lxr.linux.no/linux+v2.6.38/tools/perf/" class="urlextern" title="http://lxr.linux.no/linux+v2.6.38/tools/perf/"  rel="nofollow"> linux/tools/perf</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://lkml.org/lkml/2009/6/6/149" class="urlextern" title="http://lkml.org/lkml/2009/6/6/149"  rel="nofollow"> [Announce] Performance Counters for Linux, v8</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.pixelbeat.org/programming/profiling/" class="urlextern" title="http://www.pixelbeat.org/programming/profiling/"  rel="nofollow"> Profiling tools and techniques</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://kernel.org/pub/linux/kernel/people/paulmck/perfbook/perfbook.html" class="urlextern" title="http://kernel.org/pub/linux/kernel/people/paulmck/perfbook/perfbook.html"  rel="nofollow"> Is Parallel Programming Hard, And, If So, What Can You Do About It?</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://gernotklingler.com/blog/gprof-valgrind-gperftools-evaluation-tools-application-level-cpu-profiling-linux/" class="urlextern" title="http://gernotklingler.com/blog/gprof-valgrind-gperftools-evaluation-tools-application-level-cpu-profiling-linux/"  rel="nofollow">gprof, Valgrind and gperftools – an evaluation of some tools for application level CPU profiling on Linux</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.pixelbeat.org/programming/profiling/" class="urlextern" title="http://www.pixelbeat.org/programming/profiling/"  rel="nofollow">Linux Profiling Tools and Techniques</a></div>
</li>
</ul>

</div>
<!-- EDIT36 SECTION "Resurse utile" [23430-] --></div>
</body>
</html>
