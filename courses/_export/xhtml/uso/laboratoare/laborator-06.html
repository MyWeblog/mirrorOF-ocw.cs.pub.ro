    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>uso:laboratoare:laborator-06</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-11-17T08:15:07+0200"/>
<meta name="keywords" content="uso,laboratoare,laborator-06"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=uso:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-06.html"/>
<link rel="canonical" href="../../../../uso/laboratoare/laborator-06.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='uso:laboratoare';var JSINFO = {"id":"uso:laboratoare:laborator-06","namespace":"uso:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-06.html#laborator_06_-_interfata_in_linia_de_comanda">Laborator 06 - Interfața în linia de comandă</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-06.html#suport_laborator">Suport laborator</a></div></li>
<li class="level2"><div class="li"><a href="laborator-06.html#demo">Demo</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-06.html#redirectare">Redirectare</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#inlantuirea_comenzilor">Înlănțuirea comenzilor</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#comunicarea_interprocese_folosind_pipe">Comunicarea interprocese, folosind pipe</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#variabile_in_terminalul_bash">Variabile în terminalul Bash</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#variabile_speciale_in_terminalul_bash">Variabile speciale în terminalul Bash</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#variabile_de_mediu">Variabile de mediu</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#globbing">Globbing</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#shell_scripting">Shell scripting</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-06.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-06.html#cine_pe_cine_include_2p">[1] Cine pe cine include (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#mesaj_de_intampinare_2p">[2] Mesaj de întâmpinare (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#cautare_de_fisiere_1p">[3] Căutare de fișiere (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#lucrul_cu_arhive_tar_1p">[4] Lucrul cu arhive tar (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#globbing_1p">[5] Globbing (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#lucrul_cu_arhive_tar_-_continuare_1p">[6] Lucrul cu arhive tar - continuare (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#lucrul_cu_arhive_tar_-_continuare_1p1">[7] Lucrul cu arhive tar - continuare (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#folosirea_shell_operators_1p">[8] Folosirea shell operators (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#bonus_1_user_password_generator_2_karma_wouso">[Bonus #1] User &amp; Password generator (2 karma WoUSO)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#bonus_2_sleeping_processes_1_karma_wouso">[Bonus #2] Sleeping processes (1 karma WoUSO)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#bonus_3_variabila_path_1_karma_wouso">[Bonus #3] Variabila $PATH (1 karma WoUSO)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-06.html#bonus_4_log_inspection_3_karma_wouso">[Bonus #4] Log inspection (3 karma WoUSO)</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_06_-_interfata_in_linia_de_comanda">Laborator 06 - Interfața în linia de comandă</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 06 - Interfața în linia de comandă" [18-81] -->
<h2 class="sectionedit2" id="suport_laborator">Suport laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="../../../../uso/cursuri/curs-06.html" class="wikilink1" title="uso:cursuri:curs-06">Cursul 06</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA365" class="urlextern" title="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA365"  rel="nofollow">Capitolul 12 - Shell scripting</a> </div>
<ul>
<li class="level3"><div class="li"> Secțiunile 12.1, 12.2, 12.6, 12.7 </div>
</li>
<li class="level3"><div class="li"> Celor interesați să afle și mai multe le recomandăm <a href="http://www.tldp.org/LDP/Bash-Beginners-Guide/html/" class="urlextern" title="http://www.tldp.org/LDP/Bash-Beginners-Guide/html/"  rel="nofollow">TLDP - Bash guide for beginners</a> și <a href="http://www.cyberciti.biz/open-source/learning-bash-scripting-for-beginners/" class="urlextern" title="http://www.cyberciti.biz/open-source/learning-bash-scripting-for-beginners/"  rel="nofollow">articolele sugerate aici</a></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <a href="../../../../uso/resurse/cheatsheet.html" class="wikilink1" title="uso:resurse:cheatsheet">Cheatsheet</a> - în special pagina a doua</div>
</li>
<li class="level1"><div class="li"> <a href="http://xkcd.com/1205/" class="urlextern" title="http://xkcd.com/1205/"  rel="nofollow">Is it worth spending time to automate a task?</a></div>
</li>
<li class="level1"><div class="li"> Motto laborator: <em>Never use the graphical tool; always learn the old Unix tool. You&#039;ll be far more effective over time and your data will still work in 2030.</em></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Suport laborator" [82-862] -->
<h2 class="sectionedit3" id="demo">Demo</h2>
<div class="level2">

</div>
<!-- EDIT3 SECTION "Demo" [863-881] -->
<h3 class="sectionedit4" id="redirectare">Redirectare</h3>
<div class="level3">

<p>
Redirectare <code>stdout</code> (standard output, în general mesaje afișate prin comenzi similare cu <code>printf</code> din C). De exemplu, într-un sistem în care avem multe procese, e greu sa urmărim direct în consolă output-ul comenzii <code>ps</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">ps</span> <span class="re5">-f</span> <span class="re5">-u</span> student <span class="sy0">&gt;</span> stdout.txt 
<span class="co4">student@midgard:~$ </span><span class="kw2">cat</span> stdout.txt</pre>

<p>
Putem redirecta <strong>doar</strong> mesajele de eroare către un fișier. Scenariu: Vrem să găsim toate fișierele cu extensia <code>*.conf</code> din directorul <code>/etc</code>. 
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-name</span> <span class="st_h">'*.conf'</span>
<span class="br0">&#40;</span>...<span class="br0">&#41;</span>
find: <span class="sy0">`/</span>etc<span class="sy0">/</span>ppp<span class="sy0">/</span>peers<span class="st_h">': Permission denied
(...)</span></pre>

<p>
Ne deranjează mesajele de eroare din cauza lipsei drepturilor de citire asupra unor fișiere sau directoare. Pentru aceasta vom folosi:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-name</span> <span class="st_h">'*.conf'</span> <span class="nu0">2</span><span class="sy0">&gt;</span> errors.txt
<span class="co4">student@midgard:~$ </span><span class="kw2">cat</span> errors.txt</pre>

<p>
Putem face combinații acum: redirectăm erorile într-un fișier și rezultatele în alt fișier: 
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-name</span> <span class="st_h">'*.conf'</span> <span class="nu0">2</span><span class="sy0">&gt;</span> errors.txt <span class="sy0">&gt;</span> stdout.txt</pre>

<p>
În cazul în care dorim să redirecționăm <strong>toate</strong> mesajele afișate de o comandă, la grămadă, folosim operatorul <code>&amp;&gt;</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-name</span> <span class="st_h">'*.conf'</span> <span class="sy0">&amp;&gt;</span> find_output.txt</pre>

<p>
<p><div class="notetip">
Reamintiți-vă de la procese <code>procfs</code>, montat în <code>/proc</code>. Pentru fiecare proces identificat printr-un PID, aveam directorul <code>/proc/19827/fd</code>, care conținea link-uri simbolice către fișierele deschise de acel proces. Pentru fiecare proces în acel director găseam <code>0, 1, 2</code>. Acestea reprezintă respectiv:
</p>
<ul>
<li class="level1"><div class="li"> <code>0</code> - intrarea standard (stdin). Exemplu: tastatura</div>
</li>
<li class="level1"><div class="li"> <code>1</code> - ieșirea standard (stdout). Exemplu: mesaje afișate cu <code>printf</code> de un program C</div>
</li>
<li class="level1"><div class="li"> <code>2</code> - ieșirea standard de eroare (stderr), unde se duc mesaje precum cele afișate de find mai sus.</div>
</li>
</ul>

<p>

</div></p>
</p>

<p>
Putem redirecta outputul și către device-uri virtuale, cum ar fi <code>/dev/null</code>. În general facem acest lucru deoarece vrem să executăm o anumită comandă (într-un program sau într-un script), fără a ne interesa outputul ei. Pentru exemplul cu <code>find</code> de mai sus, să zicem că dorim să ignorăm erorile:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-name</span> <span class="st_h">'*.conf'</span> <span class="nu0">2</span><span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null </pre>

</div>
<!-- EDIT4 SECTION "Redirectare" [882-3480] -->
<h3 class="sectionedit5" id="inlantuirea_comenzilor">Înlănțuirea comenzilor</h3>
<div class="level3">

<p>
Este o metodă foarte bună prin care executăm mai multe comenzi simultan, în funcție, eventual, de anumite condiții. 
</p>
<ol>
<li class="level1"><div class="li"> <strong>Înlănțuire simplă: <code>;</code></strong>: execută comenzile una după alta, indiferent de rezultatul comenzii anterioare: <pre class="code bash"> root<span class="sy0">@</span>asgard:~<span class="co0"># apt-get update ; apt-get upgrade ; apt-get dist-upgrade </span></pre>

<p>
 În exemplul de mai sus am executat un update complet (de surse de unde sunt luate pachetele și de pachete) al unui sistem Ubuntu. 
</p>
</div>
</li>
<li class="level1"><div class="li"> Dacă vrem să înlănțuim două comenzi, dar s-o executăm pe a doua <strong>doar</strong> dacă prima s-a terminat cu succes, vom folosi operatorul <code>&amp;&amp;</code>: <pre class="code bash"> student<span class="sy0">@</span>midgard:~$ <span class="kw2">grep</span> www-data <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="st0">&quot;Avem userul www-data&quot;</span> </pre>
</div>
</li>
<li class="level1"><div class="li"> Dacă vrem să înlănțuim două comenzi, dar s-o executăm pe a doua <strong>doar</strong> dacă prima s-a terminat cu eșec, vom folosi operatorul <code>||</code>:  <pre class="code bash"> student<span class="sy0">@</span>midgard:~$ <span class="kw2">grep</span> costel <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span> <span class="sy0">&gt;</span> <span class="sy0">/</span>dev<span class="sy0">/</span>null <span class="sy0">||</span> <span class="kw3">echo</span> <span class="st0">&quot;Nu avem userul costel&quot;</span> </pre>
</div>
</li>
</ol>

<p>
<p><div class="notetip">În general, pentru a vedea ce rezultat a avut o comandă, inspectăm variabila <code>$?</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">ls</span> <span class="re5">-l</span> ~ <span class="sy0">&gt;</span> out.txt
<span class="co4">student@midgard:~$ </span><span class="kw3">echo</span> <span class="re4">$?</span>
<span class="nu0">0</span>
<span class="co4">student@midgard:~$ </span><span class="kw2">cat</span> <span class="sy0">/</span>etc<span class="sy0">/</span>sudoers
<span class="co4">student@midgard:~$ </span><span class="kw3">echo</span> <span class="re4">$?</span>
<span class="nu0">1</span></pre>

<p>
Observăm că o comandă care s-a încheiat cu success returnează <code><strong>0</strong></code>. 

</div></p>
</p>

<p>
<p><div class="noteimportant">Atenție! Toți operatorii de redirectare din acest demo <code>2&gt;</code>, <code>&amp;&gt;</code>, <code>&gt;</code> trunchiază conținutul fișierului, dacă acesta exista. Ca alternativă aveam <em>append mode</em>, care se poate aplica și aici, fără probleme, astfel:
<code>2&gt;&gt;</code>, <code>&amp;&gt;&gt;</code>, <code>&gt;&gt;</code>.

</div></p>
</p>

</div>
<!-- EDIT5 SECTION "Înlănțuirea comenzilor" [3481-5135] -->
<h3 class="sectionedit6" id="comunicarea_interprocese_folosind_pipe">Comunicarea interprocese, folosind pipe</h3>
<div class="level3">

<p>
Care e diferența dintre cele două comenzi de mai jos? Câte procese se execută pentru fiecare dintre cele două comenzi?
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">cat</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span><span class="st_h">':'</span> <span class="re5">-f1</span>
<span class="co4">student@midgard:~$ </span><span class="kw2">cut</span> <span class="re5">-d</span><span class="st_h">':'</span> <span class="re5">-f1</span> <span class="sy0">&lt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="kw2">passwd</span></pre>

<p>
Dorim să inspectăm jurnalul (log-ul) pachetelor instalate sau șterse în sistemul nostru Ubuntu. Dar ne interesează doar ultimele 40 de acțiuni. Pentru a putea obține și un output în care putem căuta și filtra text ca în pagina de manual vom folosi <code>less</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">tail</span> <span class="re5">-n</span> <span class="nu0">40</span> <span class="sy0">/</span>var<span class="sy0">/</span>log<span class="sy0">/</span>bootstrap.log <span class="sy0">|</span> <span class="kw2">less</span></pre>

<p>
<p><div class="notetip">
Dacă vrem să monitorizăm fișierel de tip log în timp real, folosim comanda
</p>
<pre class="code bash"><span class="kw2">tail</span> <span class="re5">-f</span> <span class="sy0">/</span>path<span class="sy0">/</span>to<span class="sy0">/</span>logfile </pre>

<p>
unde <code>/path/to/logfile</code> este calea către fișierul pe care vrem să-l monitorizăm în timp real.

</div></p>
</p>

<p>
Similar putem cere primele 40 de acțiuni jurnalizate în acest fișier: 
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">head</span> <span class="re5">-n</span> <span class="nu0">40</span> <span class="sy0">/</span>var<span class="sy0">/</span>log<span class="sy0">/</span>bootstrap.log <span class="sy0">|</span> <span class="kw2">less</span></pre>

<p>
Scenariu: suntem administratorii unui server. Dorim să folosim un one liner pentru a afișa ultimii 30 de utilizatori (doar username-ul lor, plus trebuie evitate duplicatele, ne interesează 30 de persoane) care s-au autentificat în sistemul nostru, să îi sortăm alfabetic:
</p>
<pre class="code bash"><span class="co4">root@testingsrv:~$ </span><span class="kw2">last</span> <span class="re5">-30</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span> <span class="st_h">' '</span> <span class="re5">-f1</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="sy0">|</span> <span class="kw2">uniq</span></pre>

<p>
Totuși există o problemă cu comanda de mai sus: <code>last</code> afișează pe ultima linie un mesaj de forma 
</p>
<pre class="code bash">wtmp begins Mon Nov  <span class="nu0">3</span> <span class="nu0">19</span>:<span class="nu0">24</span>:<span class="nu0">55</span> <span class="nu0">2014</span></pre>

<p>
Ne deranjează ultimele două linii (un spațiu gol și mesajul descris mai sus) și deci vrem să le eliminăm:
</p>
<pre class="code bash"><span class="co4">root@testingsrv:~$ </span><span class="kw2">last</span> <span class="re5">-30</span> <span class="sy0">|</span> <span class="kw2">head</span> <span class="re5">-n</span> <span class="re5">-2</span> <span class="sy0">|</span> <span class="kw2">cut</span> <span class="re5">-d</span> <span class="st_h">' '</span> <span class="re5">-f1</span> <span class="sy0">|</span> <span class="kw2">sort</span> <span class="sy0">|</span> <span class="kw2">uniq</span></pre>

</div>
<!-- EDIT6 SECTION "Comunicarea interprocese, folosind pipe" [5136-7153] -->
<h3 class="sectionedit7" id="variabile_in_terminalul_bash">Variabile în terminalul Bash</h3>
<div class="level3">
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="re2">MY_VAR</span>=<span class="st0">&quot;value&quot;</span>
<span class="co4">student@midgard:~$ </span><span class="re2">a</span>=<span class="nu0">1</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">echo</span> <span class="re1">$a</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">echo</span> <span class="re1">$MY_VAR</span></pre>

<p>
Într-o variabilă putem salva și output-ul unei comenzi pentru a îl transmite ca parametru altei comenzi (similar cu un pipe). Spre exemplu, dorim să ștergem toate fișierele cu extensia <code>*.tmp</code> din directorul curent:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">rm</span> <span class="re5">-f</span> $<span class="br0">&#40;</span><span class="kw2">find</span> . <span class="re5">-name</span> <span class="st_h">'*.tmp'</span><span class="br0">&#41;</span></pre>

</div>
<!-- EDIT7 SECTION "Variabile în terminalul Bash" [7154-7628] -->
<h3 class="sectionedit8" id="variabile_speciale_in_terminalul_bash">Variabile speciale în terminalul Bash</h3>
<div class="level3">
<div class="table sectionedit9"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Variabila     </th><th class="col1 leftalign"> Semnificație                                 </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong><code>$$</code></strong>    </td><td class="col1 leftalign"> PID-ul procesului curent                     </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong><code>$!</code></strong>    </td><td class="col1"> PID-ul ultimului proces lansat in background </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <strong><code>$?</code></strong>    </td><td class="col1 leftalign"> Valoarea de exit a ultimei comenzi           </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong><code>$_</code></strong>    </td><td class="col1 leftalign"> Ultimul argument al ultimei comenzi (similar cu <code>ALT+.</code>   </td>
	</tr>
</table></div>
<!-- EDIT9 TABLE [7681-8021] -->
<p>
Putem folosi comanda <code>echo</code> și să îi transmitem parametru variabilele respective, pentru a vedea rezultatul lor. 
</p>

</div>
<!-- EDIT8 SECTION "Variabile speciale în terminalul Bash" [7629-8141] -->
<h3 class="sectionedit10" id="variabile_de_mediu">Variabile de mediu</h3>
<div class="level3">

<p>
Variabilele de mediu sunt un set de variabile care afectează modul în care un program rulează. În general, un proces moștenește variabilele de mediu ale procesului părinte. Astfel, pentru procesul asociat rulării unei comenzi, sunt moștenite variabilele shell-ului.
</p>

<p>
Pentru a vedea variabliele de mediu definite, putem folosi comanda <code>env</code> fără nici un parametru.
</p>
<pre class="code">student@uso:~$ env</pre>

<p>
Pentru a defini o variabilă de mediu folosim:
</p>
<pre class="code">student@uso:~$ export VARIABLE=value</pre>

<p>
<p><div class="noteclassic">
Dacă nu folosim <code>export</code> variablia nu va fi moștenită de procesele copii.

</div></p>
</p>

<p>
Variabliele de mediu se scriu în mod obișnuit cu litere mari. Exemple de variabile de mediu:
</p>
<ul>
<li class="level1"><div class="li"> <code>PATH</code> - o listă de directoare folosite de shell pentru a găsi executabilul asociat comenzii. Directoarele sunt separate prin <code>:</code>.</div>
</li>
<li class="level1"><div class="li"> <code>HOME</code> - directorul <code>home</code> al utilizatorului curent.</div>
</li>
<li class="level1"><div class="li"> <code>USER</code> - utilizatorul curent</div>
</li>
<li class="level1"><div class="li"> <code>OLDPWD</code> - calea directorului anterior</div>
</li>
<li class="level1"><div class="li"> <code>EDITOR</code> - editorul implicit.</div>
</li>
</ul>

</div>
<!-- EDIT10 SECTION "Variabile de mediu" [8142-9194] -->
<h3 class="sectionedit11" id="globbing">Globbing</h3>
<div class="level3">
<ol>
<li class="level1"><div class="li"> Dorim să afișăm toate fișierele cu extensia <code>.conf</code> din <code>/etc</code>, care încep cu <code>a, b, c, d</code> sau <code>e</code>: <pre class="code bash"> student<span class="sy0">@</span>midgard:~$ <span class="kw2">ls</span> <span class="re5">-l</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="br0">&#91;</span>a-e<span class="br0">&#93;</span><span class="sy0">*</span>.conf</pre>
</div>
</li>
<li class="level1"><div class="li"> Dorim să afișăm fișierele (sau directoarele) cu extensiile <code>.conf</code> sau <code>.d</code> din <code>/etc</code>: <pre class="code bash"> student<span class="sy0">@</span>midgard:~$ <span class="kw2">ls</span> <span class="re5">-ld</span> <span class="sy0">/</span>etc<span class="sy0">/*</span><span class="br0">&#123;</span>.conf,.d<span class="br0">&#125;</span></pre>

<p>
 De ce am folosit parametrul <code>-d</code> la <code>ls</code>?
</p>
</div>
</li>
<li class="level1"><div class="li"> Dorim să afișăm fișierele (sau directoarele) cu extensiile <code>.conf</code> sau <code>.d</code> din <code>/etc</code> care nu încep cu <code>a, b, c</code>: <pre class="code bash"> student<span class="sy0">@</span>midgard:~$ <span class="kw2">ls</span> <span class="re5">-ld</span> <span class="sy0">/</span>etc<span class="sy0">/</span><span class="br0">&#91;</span>^abc<span class="br0">&#93;</span><span class="sy0">*</span><span class="br0">&#123;</span>.conf,.d<span class="br0">&#125;</span></pre>
</div>
</li>
</ol>

</div>
<!-- EDIT11 SECTION "Globbing" [9195-9804] -->
<h3 class="sectionedit12" id="shell_scripting">Shell scripting</h3>
<div class="level3">

<p>
În loc să scriem one-linere putem automatiza execuția mai multor într-un fișier, numit script, care va fi interpretat de Bash linie cu linie. În general shell script-urile sunt fișiere care au extensia <code>.sh</code> și pe prima linie au așa-numitul <strong>shebang</strong>, o linie care începe cu <code><strong>#!</strong></code> prin care instruim terminalul ce interpretor sa folosească. Iată un exemplu simplu:
</p>
<dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=25" title="Download Snippet" class="mediafile mf_sh">hello.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="kw3">echo</span> <span class="st0">&quot;Hello, World!&quot;</span></pre>
</dd></dl>

<p>
Preuspunând că fișierul <code>hello.sh</code> e salvat în <code>/home/student</code> acesta se execută ca un binar generat în urma compilării unui program C. Este foarte important de observat că trebuie să avem drepturi de execuție asupra lui:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw3">cd</span> ~; <span class="kw2">ls</span> <span class="re5">-l</span> hello.sh
<span class="re5">-rw-rw-r--</span> <span class="nu0">1</span> student student <span class="nu0">34</span> nov  <span class="nu0">8</span> <span class="nu0">21</span>:<span class="nu0">44</span> hello.sh
<span class="co4">student@midgard:~$ </span>.<span class="sy0">/</span>hello.sh
bash: .<span class="sy0">/</span>hello.sh: Permission denied
&nbsp;
<span class="co4">student@midgard:~$ </span><span class="kw2">chmod</span> +x hello.sh; <span class="kw2">ls</span> <span class="re5">-l</span> hello.sh
<span class="re5">-rwxrwxr-x</span> <span class="nu0">1</span> student student <span class="nu0">34</span> nov  <span class="nu0">8</span> <span class="nu0">21</span>:<span class="nu0">44</span> hello.sh
<span class="co4">student@midgard:~$ </span>.<span class="sy0">/</span>hello.sh
Hello, World<span class="sy0">!</span></pre>

<p>
Înlănțuirea de comenzi de upgrade poate fi transpusă într-un script, astfel:
</p>
<dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=27" title="Download Snippet" class="mediafile mf_sh">upgrade_ubuntu.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="co0"># This is a comment</span>
<span class="kw3">echo</span> <span class="st0">&quot;Upgrading Ubuntu!&quot;</span>
&nbsp;
<span class="co0"># Please run this script as root</span>
<span class="kw2">apt-get update</span>
<span class="kw2">apt-get upgrade</span>
<span class="kw2">apt-get dist-upgrade</span>
&nbsp;
<span class="co0"># Make some cleanup</span>
<span class="kw3">echo</span> <span class="st0">&quot;Cleaning dependencies not needed anymore&quot;</span>
<span class="kw2">apt-get autoremove</span>
&nbsp;
<span class="kw3">echo</span> <span class="st0">&quot;Cleaning retrieved package files&quot;</span>
<span class="kw2">apt-get autoclean</span></pre>
</dd></dl>

<p>
<p><div class="notetip">La <strong>shebang</strong> în loc să specificăm calea absolută către interpretor, am putea interoga variabila de mediu, pentru a avea scriptul <em>portabil</em> (e posibil ca pe alte stații interpretorul Bash să nu fie localizat în <code>/bin/bash</code>. Să urmărim prima linie din exemplul de mai jos:
</p>
<dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=28" title="Download Snippet" class="mediafile mf_sh">hello.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/usr/bin/env bash</span>
&nbsp;
<span class="kw3">echo</span> <span class="st0">&quot;Hello, World!&quot;</span></pre>
</dd></dl>

<p>

</div></p>
</p>

</div>
<!-- EDIT12 SECTION "Shell scripting" [9805-11645] -->
<h2 class="sectionedit13" id="exercitii">Exerciții</h2>
<div class="level2">

<p>
<p><div class="noteimportant">
Pe parcursul exercițiilor, rulați părțile din exerciții pas cu pas. Scrieți o comandă, verificați că funcționează. Adăugați apoi o prelucrare cu operatorul <code>|</code> (<em>pipe</em>) și verificați că funcționează. Și tot așa, <strong>din aproape în aproape</strong>.

</div></p>
</p>

</div>
<!-- EDIT13 SECTION "Exerciții" [11646-11960] -->
<h3 class="sectionedit14" id="cine_pe_cine_include_2p">[1] Cine pe cine include (2p)</h3>
<div class="level3">

<p>
Dorim să afișăm fișierele din ierarhia <code>/usr/include</code> care includ header-ul <code>features.h</code>, împreună cu linia unde acest antet apare. Vom folosi comanda <code>grep</code> și opțiunile acesteia și vom construi un one liner.
</p>

<p>
Pentru început, folosiți <code>grep</code> pentru a căuta recursiv în ierarhia <code>/usr/include</code> fișierele care conțin șirul <code>features.h</code>. Opțiunea <code>-r</code> (de la <em>recursive</em>) este cea care permite căutarea recursivă într-o ierarhie.
</p>

<p>
Completați opțiunile comenzii <code>grep</code> de mai sus cu opțiunea care permitea afișarea numărului liniei din cadrul fiecărui fișier unde a fost găsit match-ul. Pentru a afla opțiunea <code>grep</code> care afișează numărul liniei pe care a fost găsit șirul, căutați în pagina de manual a comenzii <code>grep</code> șirul <code>line-number</code>.
</p>

<p>
În output-ul obținut mai sus sunt afișate trei elemente separate de caracterul două puncte (<code>:</code>, <em>colon</em>): numele fișierului, numărul liniei pe care a fost făcut match și conținutul liniei. Afisați doar numele fișierului și numărul liniei pe care a fost făcut match.
</p>

<p>
<p><div class="notetip">
Folosiți comanda <code>cut</code> și extrageți doar coloanele de interes: coloana 1 și coloana 2.

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code bash"><span class="kw2">grep</span> <span class="re5">-Rn</span> features.h <span class="sy0">/</span>usr<span class="sy0">/</span>include<span class="sy0">/</span> <span class="sy0">|</span> <span class="kw2">grep</span> \<span class="co0">#include | cut -d':' -f1,2</span></pre>
</div></div>

</div>
<!-- EDIT14 SECTION "[1] Cine pe cine include (2p)" [11961-13314] -->
<h3 class="sectionedit15" id="mesaj_de_intampinare_2p">[2] Mesaj de întâmpinare (2p)</h3>
<div class="level3">

<p>
Dorim să afișăm un mesaj de întâmpinare custom pentru momentul în care un utilizator deschide un shell. Mesajul vrem să fie
</p>
<pre class="code">Welcome, &lt;nume-utilizator&gt;, to Pearson-Hardman-Specter. &lt;nume-utilizator&gt; just got Litt-up!</pre>

<p>
unde <code>&lt;nume-utilizator&gt;</code> este username-ul.
</p>

<p>
Pentru aceasta va trebui să editați, ca <code>root</code> (adică folosind <code>sudo</code>), fișierul <code>/etc/bash.bashrc</code> și să scrieți la <strong>sfârșitul</strong> fișierului comanda dorită. Comanda va fi rulată la orice deschidere de shell nou. Folosiți comanda <code>sudo vim /etc/bash.bashrc</code> pentru a edita ca root fișierul <code>/etc/bash.bashrc</code>.
</p>

<p>
<p><div class="noteclassic">
Fișierul <code>/etc/bash.bashrc</code> este un fișier global de configurare a shell-ului. Fișierul este parcurs la fiecare deschidere de shell.

</div></p>
</p>

<p>
Pentru început afișați șirul <code>Welcome</code> la fiecare deschidere de shell. Adică scrieți la sfârșitul fișierului <code>/etc/bash.bashrc</code> comanda pentru afișarea șirului. Apoi deschideți un shell nou (sau un tab nou de shell pentru verificare).
</p>

<p>
<p><div class="notetip">
Pentru a afișa un mesaj folosiți comanda <code>echo</code> urmată de șirul de afișat. Este recomandat ca șirul de afișat, transmis ca argument comenzii <code>echo</code> să fie pus între ghilimele (<code>&quot;</code>, <em>quotes</em>).

</div></p>
</p>

<p>
Pentru afișarea șirului dorit, care conține username-ul, folosiți variabila <code>USER</code>, variabilă deja definită în shell. Variabila <code>USER</code> conține username-ul. Pentru a afișa valoarea unei variabile folosim construcția de forma <code>$USER</code>. De exemplu, pentru a afișa numele de utilizator și un mesaj de salut folosim comanda
</p>
<pre class="code">echo &quot;Salut, $USER&quot;</pre>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code bash"><span class="kw2">sudo</span> <span class="kw3">echo</span> <span class="st_h">'echo &quot;Welcome, $USER, to Pearson-Hardman-Specter. $USER just got Litt-up!&quot;'</span> <span class="sy0">&gt;&gt;</span> <span class="sy0">/</span>etc<span class="sy0">/</span>bash.bashrc</pre>

<p>
Sau se adauga comanda 
</p>
<pre class="code bash"> <span class="kw3">echo</span> <span class="st0">&quot;Welcome, <span class="es2">$USER</span>, to Pearson-Hardman-Specter. <span class="es2">$USER</span> just got Litt-up!&quot;</span> </pre>

<p>
 pe orice linie care nu se afla sub un <code>if</code> in fisierul <code>/etc/bash.bashrc</code>
</p>
</div></div>

</div>
<!-- EDIT15 SECTION "[2] Mesaj de întâmpinare (2p)" [13315-15338] -->
<h3 class="sectionedit16" id="cautare_de_fisiere_1p">[3] Căutare de fișiere (1p)</h3>
<div class="level3">

<p>
De multe ori dorim să căutăm într-o ierarhie de fișiere și directoare, dar după anumite criterii. Comanda cea mai potrivită în acest caz este <code>find</code>. Folosiți <code>find</code> pentru a afișa toate fișierele din ierarhia <code>/etc/</code> (adică toate fișierele din /etc/, din subdirectoarele acestuia, din subdirectoarele subdirectoarelor etc.). <strong>Hint</strong>: Folosiți opțiunea <code>-type</code> a comenzii find.
</p>

<p>
Extindeți comanda anterioară pentru a afișa toate fișierele din ierarhia <code>/etc/</code> al căror nume începe cu litere între <em>a</em> și <em>d</em>. <strong>Hint</strong>: Folosiți opțiunea <code>-name</code> a comenzii find și construcția <code>[a-d]*</code> pentru a indica un șir care începe cu o literă între <em>a</em> și <em>d</em> urmată de orice altceva.
</p>

<p>
Extindeți comanda anterioară pentru a afișa toate fișierele din ierahia <code>/etc/</code> care au permisiunile de forma <code>rw-------</code>, adică 600. <strong>Hint</strong>: Folosiți opțiunea <code>-perm</code> urmată de permisiunile căutate în format octal.
</p>

<p>
Pentru comanda finală, redirectați outputul în fișierul <code>~/file_list.txt</code> și erorile în <code>~/errors.txt</code>.
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents">Comanda finala: <pre class="code bash"><span class="kw2">find</span> <span class="sy0">/</span>etc <span class="re5">-type</span> f <span class="re5">-name</span> <span class="st0">&quot;[a-d]*&quot;</span> <span class="re5">-perm</span> <span class="nu0">600</span> <span class="nu0">2</span><span class="sy0">&gt;</span> ~<span class="sy0">/</span>errors.txt <span class="sy0">&gt;</span> ~<span class="sy0">/</span>file_list.txt</pre>
</div></div>

</div>
<!-- EDIT16 SECTION "[3] Căutare de fișiere (1p)" [15339-16603] -->
<h3 class="sectionedit17" id="lucrul_cu_arhive_tar_1p">[4] Lucrul cu arhive tar (1p)</h3>
<div class="level3">

<p>
<p><div class="noteimportant">
Luați exercițiul pe bucăți, faceți o parte apoi treceți la următoarea.

</div></p>
</p>

<p>
Descărcați arhiva <a href="../../../../_media/uso/laboratoare/practic.tar.gz" class="media mediafile mf_gz" title="uso:laboratoare:practic.tar.gz (371 B)">de aici</a> folosind una dintre comenzile <code>wget</code> sau <code>curl</code>.
</p>

<p>
<p><div class="notetip">
Atât <code>wget</code> cât și <code>curl</code> primesc ca parametru un <abbr title="Uniform Resource Locator">URL</abbr> (link). <abbr title="Uniform Resource Locator">URL</abbr>-ul îl puteți obține folosind, în browser, click dreapta și selectând opțiunea <code>Copy link location</code>. Pentru a da paste în terminal folosiți click dreapta și selectând <code>Paste</code>, sau, mai direct, combinația de taste <code>Shift+Insert</code>. Dacă alegeți să folosiți <code>curl</code>, fiți atenți la faptul că, implicit, acesta afișează conținutul fișierului pe ecran, deci va trebui să-l redirectați voi într-un fișier <code>practic.tar.gz</code>.

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code bash"><span class="kw2">wget</span> http:<span class="sy0">//</span>ocw.cs.pub.ro<span class="sy0">/</span>courses<span class="sy0">/</span>_media<span class="sy0">/</span>uso<span class="sy0">/</span>laboratoare<span class="sy0">/</span>practic.tar.gz</pre>
</div></div>
<ul>
<li class="level1"><div class="li"> Fără a o dezarhiva, listați conținutul arhivei <code>practic.tar.gz</code>. (<strong>Hint</strong>: Folosiți opțiunea <code>-t</code> a comenzii <code>tar</code>).</div>
</li>
</ul>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code bash"><span class="kw2">tar</span> <span class="re5">-tf</span> practic.tar.gz</pre>
</div></div>
<ul>
<li class="level1"><div class="li"> Dezarhivați arhiva <code>practic.tar.gz</code>. (<strong>Hint</strong>: Arhiva este în format <code>.tar.gz</code>. Pentru a afla comanda de dezarhivare căutați pe Google șirul <code>unpack .tar.gz</code>. După dezarhivare directorul obținut este <code>practic/</code>.)</div>
</li>
</ul>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents">tar -xvf practic.tar.gz
</div></div>

</div>
<!-- EDIT17 SECTION "[4] Lucrul cu arhive tar (1p)" [16604-18009] -->
<h3 class="sectionedit18" id="globbing_1p">[5] Globbing (1p)</h3>
<div class="level3">

<p>
Listați, folosind <strong>globbing</strong>, toate imaginile cu extensiile <code>bmp, jpg, png, gif</code> din directorul rezultat în urma dezarhivării.
</p>

<p>
<p><div class="notetip">
Parcurgeți secțiunea <a href="laborator-06.html#globbing" title="uso:laboratoare:laborator-06 ↵" class="wikilink1">Globbing</a> din cadrul laboratorului.
</p>

<p>
Pentru a lista toate fișierele cu extensiile <code>bmp</code>, <code>jpg</code>, <code>png</code> și <code>gif</code> folosiți operatorii de globbing <code>*</code> (<em>star</em>) si <code>{opt1,opt2,opt3}</code> (acolade). Un exemplu simplu de utilizare (porniți de la acesta) este
</p>
<pre class="code">ls practic/*/*.png</pre>

<p>
În comanda de mai sus listăm toate fișierele cu extensia <code>png</code> din toate subdirectoarele directorului <code>practic</code>.

</div></p>
</p>

<p>
Redirectați outputul într-un fișier numit <code>images.dat</code>.
</p>

<p>
<p><div class="noteclassic">
Pentru redirectare într-un fișier folosiți operatorul <code>&gt;</code>.

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code">mihai@wormhole:~$ ls practic/*/*.{bmp,jpg,png,gif} &gt; images.dat
mihai@wormhole:~$ cat images.dat
practic/a/showmeyes.gif
practic/b/britney.jpg
practic/c/landscape.png
practic/d/trickynot.bmp
</pre>
</div></div>

<p>
Ștergeți directorul dezarhivat folosind comanda
</p>
<pre class="code">rm -fr practic/</pre>

</div>
<!-- EDIT18 SECTION "[5] Globbing (1p)" [18010-19104] -->
<h3 class="sectionedit19" id="lucrul_cu_arhive_tar_-_continuare_1p">[6] Lucrul cu arhive tar - continuare (1p)</h3>
<div class="level3">

<p>
Extrageți din arhiva <code>practic.tar.gz</code> <strong>doar</strong> fișierele listate în fișierul <code>images.dat</code>.
</p>

<p>
<p><div class="notetip">
Pentru a afla opțiunile <code>tar</code> de extragere doar a anumitor fișiere dintr-o arhivă, căutați pe Google șirul <code>tar extract specific files</code>.
</p>

<p>
În cadrul comenzii porniți de la exemplul de mai jos care listează în format lung fișierele indicate în fișierul <code>images.dat</code>:
</p>
<pre class="code">ls -l $(cat images.dat)</pre>

<p>
Comanda va da eroare pentru că directorul <code>practic/</code> nu mai există, dar sintaxa este corectă și o puteți adapta pentru comanda <code>tar</code>. Adică să aveți o comandă de forma
</p>
<pre class="code">tar ... $(cat images.dat)</pre>

<p>
Pentru verificarea dezarhivării doar a fișierelor de tip imagine folosiți comanda
</p>
<pre class="code">tree practic/</pre>

<p>

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code bash"><span class="co4">mihai@wormhole:~$ </span><span class="kw2">cat</span> images.dat
practic<span class="sy0">/</span>a<span class="sy0">/</span>showmeyes.gif
practic<span class="sy0">/</span>b<span class="sy0">/</span>britney.jpg
practic<span class="sy0">/</span>c<span class="sy0">/</span>landscape.png
practic<span class="sy0">/</span>d<span class="sy0">/</span>trickynot.bmp
<span class="co4">mihai@wormhole:~$ </span><span class="kw2">tar</span> <span class="re5">-xf</span> practic.tar.gz $<span class="br0">&#40;</span><span class="kw2">cat</span> images.dat<span class="br0">&#41;</span>      
<span class="co4">mihai@wormhole:~$ </span><span class="kw2">tree</span> practic
practic
├── a
│   └── showmeyes.gif
├── b
│   └── britney.jpg
├── c
│   └── landscape.png
└── d
    └── trickynot.bmp
&nbsp;
<span class="nu0">4</span> directories, <span class="nu0">4</span> files</pre>
</div></div>

</div>
<!-- EDIT19 SECTION "[6] Lucrul cu arhive tar - continuare (1p)" [19105-20404] -->
<h3 class="sectionedit20" id="lucrul_cu_arhive_tar_-_continuare_1p1">[7] Lucrul cu arhive tar - continuare (1p)</h3>
<div class="level3">

<p>
Creați un script numit <code>extract-images-only.sh</code> care să conțină comenzile folosite la cele 3 exerciții precedente. Acordați permisiuni de execuție și rulați scriptul. Scriptul va trebui să:
</p>
<ul>
<li class="level1"><div class="li"> dezarhiveze arhiva <code>practic.tar.gz</code></div>
</li>
<li class="level1"><div class="li"> listeze toate fișierele cu una dintre extensiile <em>png</em>, <em>jpg</em>, <em>bmp</em> sau <em>gif</em> în fișierul <strong>images.dat</strong>. Fișierul <strong>images.dat</strong> va trebui suprascris de fiecare dată.</div>
</li>
<li class="level1"><div class="li"> șteargă directorul <code>practic</code></div>
</li>
<li class="level1"><div class="li"> dezarhiveze din arhiva <code>practic.tar.gz</code> doar fișierele aflate în fișierul <code>images.dat</code></div>
</li>
<li class="level1"><div class="li"> listeze conținutul directorului <code>practic</code> pe ecran, folosind comanda <code>tree</code>.</div>
</li>
</ul>

<p>
<p><div class="notetip">
Parcurgeți secțiunea <a href="laborator-06.html#shell_scripting" title="uso:laboratoare:laborator-06 ↵" class="wikilink1">Shell Scripting</a> din cadrul laboratorului.
</p>

<p>
Scriptul trebuie să înceapă cu shebang adică șirul <code>#!/bin/bash</code>.
</p>

<p>
Pentru acordarea permisiunilor de execuție folosiți comanda <code>chmod</code>.

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=44" title="Download Snippet" class="mediafile mf_sh">extract-images-only.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="kw2">wget</span> http:<span class="sy0">//</span>ocw.cs.pub.ro<span class="sy0">/</span>courses<span class="sy0">/</span>_media<span class="sy0">/</span>uso<span class="sy0">/</span>laboratoare<span class="sy0">/</span>practic.tar.gz
&nbsp;
<span class="kw2">tar</span> <span class="re5">-zxf</span> practic.tar.gz
&nbsp;
<span class="kw2">ls</span> practic<span class="sy0">/*/*</span>.<span class="br0">&#123;</span>png,jpg,gif,bmp<span class="br0">&#125;</span> <span class="sy0">&gt;&gt;</span> images.dat
<span class="kw2">rm</span> <span class="re5">-fr</span> practic<span class="sy0">/</span>
&nbsp;
<span class="kw2">tar</span> <span class="re5">-zxf</span> practic.tar.gz $<span class="br0">&#40;</span><span class="kw2">cat</span> images.dat<span class="br0">&#41;</span>
<span class="kw2">tree</span> practic<span class="sy0">/</span></pre>
</dd></dl>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw3">pwd</span>
<span class="sy0">/</span>home<span class="sy0">/</span>student
<span class="co4">student@midgard:~$ </span><span class="kw2">chmod</span> +x extract-images-only.sh
<span class="co4">student@midgard:~$ </span>.<span class="sy0">/</span>extract-images-only.sh
<span class="br0">&#40;</span>...<span class="br0">&#41;</span></pre>
</div></div>

</div>
<!-- EDIT20 SECTION "[7] Lucrul cu arhive tar - continuare (1p)" [20405-21822] -->
<h3 class="sectionedit21" id="folosirea_shell_operators_1p">[8] Folosirea shell operators (1p)</h3>
<div class="level3">

<p>
Uneori putem testa rezultatul execuției unei comenzi folosind una dintre construcțiile următoare: 
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span>comanda <span class="sy0">&amp;&amp;</span> <span class="kw3">echo</span> <span class="st0">&quot;SUCCESS&quot;</span></pre>

<p>
sau
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span>comanda <span class="sy0">||</span> <span class="kw3">echo</span> <span class="st0">&quot;FAIL&quot;</span></pre>

<p>
Pe baza conținutului celor două fișiere create la <a href="../../../../uso/laboratoare/laborator-06.html#cautare_de_fisiere_1p" class="urlextern" title="http://ocw.cs.pub.ro/courses/uso/laboratoare/laborator-06#cautare_de_fisiere_1p"  rel="nofollow">Exercițiul 3</a>, <code>file_list.txt</code> și <code>errors.txt</code>, scrieți un one liner care afișează pe ecran textul <code>SUCCESS</code>, dacă nu s-a produs nicio eroare la folosirea comenzii <code>find</code> (fișierul <code>errors.txt</code> este gol) sau <code>FAILED WITH &lt;num_erori&gt; ERRORS</code>, unde <code>&lt;num_erori&gt;</code> este numărul de linii (erori) din fișierul <code>errors.txt</code>.
</p>

<p>
<p><div class="notetip">
Considerăm că orice linie din fișierul <code>errors.txt</code> reprezintă o eroare separată. Pentru a calcula numărul de linii dintr-un fișier <code>a.txt</code> putem folosi comanda
</p>
<pre class="code">student@uso:~$ wc -l &lt; a.txt</pre>

<p>

</div></p>
</p>

<p>
<p><div class="notetip">
Pentru a verifica dacă fișierul <code>errors.txt</code> are conținut (are dimensiunea mai mare ca <code>0</code>), folosiți comanda
</p>
<pre class="code">test -s errors.txt</pre>

<p>
Această comandă se întoarce cu succes dacă fișierul are conținut (are dimensiunea mai mare ca <code>0</code>). Adică puteți să folosiți în continuarea comenzii de mai sus operatorii <code>&amp;&amp;</code> și <code>||</code> pentru a afișa un mesaj de succes sau de insucces.
</p>

<p>
Ca să expandați numărul de linii din cadrul unui fișier folosiți o construcție de forma <code>$(wc -l &lt; a.txt)</code>.

</div></p>
</p>

</div>
<!-- EDIT21 SECTION "[8] Folosirea shell operators (1p)" [21823-23352] -->
<h3 class="sectionedit22" id="bonus_1_user_password_generator_2_karma_wouso">[Bonus #1] User &amp; Password generator (2 karma WoUSO)</h3>
<div class="level3">

<p>
Unui script îi putem da și argumente în linia de comandă. Urmăriți scriptul exemplu de mai jos:
</p>
<dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=50" title="Download Snippet" class="mediafile mf_sh">args.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="kw3">echo</span> <span class="st0">&quot;Numarul argumentelor este $#&quot;</span>
<span class="kw3">echo</span> <span class="st0">&quot;Numele scriptului este $0&quot;</span>
<span class="kw3">echo</span> <span class="st0">&quot;Primele 2 argumente sunt: $1 \\ $2&quot;</span></pre>
</dd></dl>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">chmod</span> +x args.sh
<span class="co4">student@midgard:~$ </span>.<span class="sy0">/</span>args.sh <span class="nu0">1</span> <span class="nu0">2</span> <span class="nu0">3</span> <span class="nu0">4</span> <span class="nu0">5</span>
Numarul argumentelor este <span class="nu0">5</span>
Numele scriptului este .<span class="sy0">/</span>args.sh
Primele <span class="nu0">2</span> argumente sunt: <span class="nu0">1</span> \ <span class="nu0">2</span></pre>

<p>
Realizați un script numit <code>simple_adduser.sh</code> care adaugă în sistem utilizatorul U, îi configurează homedir-ul la <code>/home/U</code> și îi generează o parolă de <code>N</code> caractere, unde <code>N</code> este dat ca argument scriptului.
</p>

<p>
Scriptul va fi chemat astfel: <code>./simple_adduser.sh username 20</code>
</p>

<p>
La final trebuie să afișați un string de forma: <code>Utilizator:parola_generata</code>
</p>

<p>
<p><div class="notetip">Indicații: 
Pentru adăugarea neinteractivă a utilizatorilor în sistem, folosiți comanda <code>useradd</code>
</p>

<p>
Parola generată o salvați într-o variabilă. Pentru un utilizator existent în sistem, putem configura o parolă neinteractiv folosind <code>chpasswd</code> astfel: 
</p>
<pre class="code bash"><span class="kw3">echo</span> <span class="st0">&quot;user:newpassword&quot;</span> <span class="sy0">|</span> chpasswd</pre>

<p>

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><dl class="code">
<dt><a href="../../../code/uso/laboratoare/laborator-06%3Fcodeblock=53" title="Download Snippet" class="mediafile mf_sh">simple_adduser.sh</a></dt>
<dd><pre class="code bash"><span class="co0">#!/bin/bash</span>
&nbsp;
<span class="re2">NUM_CHARS</span>=<span class="re4">$2</span>
<span class="re2">USERNAME</span>=<span class="re4">$1</span>
&nbsp;
useradd <span class="re1">$USERNAME</span> <span class="re5">-d</span> <span class="sy0">/</span>home<span class="sy0">/</span><span class="re1">$USERNAME</span> <span class="re5">-s</span> <span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw2">bash</span> <span class="sy0">&amp;&amp;</span> <span class="kw2">mkdir</span> <span class="sy0">/</span>home<span class="sy0">/</span><span class="re1">$USERNAME</span>
&nbsp;
<span class="re2">PASSWORD</span>=$<span class="br0">&#40;</span><span class="kw2">cat</span> <span class="sy0">/</span>dev<span class="sy0">/</span>urandom <span class="sy0">|</span> <span class="kw2">tr</span> <span class="re5">-d</span> <span class="re5">-c</span> <span class="st_h">'A-Za-z0-9'</span> <span class="sy0">|</span> <span class="kw2">head</span> <span class="re5">-c</span> <span class="re1">$NUM_CHARS</span><span class="br0">&#41;</span>
&nbsp;
<span class="kw3">echo</span> <span class="st0">&quot;<span class="es2">$USERNAME</span>:<span class="es2">$PASSWORD</span>&quot;</span>
<span class="kw3">echo</span> <span class="st0">&quot;<span class="es2">$USERNAME</span>:<span class="es2">$PASSWORD</span>&quot;</span> <span class="sy0">|</span> chpasswd</pre>
</dd></dl>
</div></div>

</div>
<!-- EDIT22 SECTION "[Bonus #1] User & Password generator (2 karma WoUSO)" [23353-24896] -->
<h3 class="sectionedit23" id="bonus_2_sleeping_processes_1_karma_wouso">[Bonus #2] Sleeping processes (1 karma WoUSO)</h3>
<div class="level3">

<p>
Folosiți un one-liner pentru a determina PID-ul și comanda tuturor proceselor din sistem aflate în starea <code>sleeping</code>. Indicație: <code>man ps</code>, <code>/user-defined format</code>
</p>

<p>
Folosiți un one-liner pentru a determina câte procese sunt în starea <code>sleeping</code>. Indicație: folosiți comanda utilizată anterior și dați outputul ca parametru (prin pipe sau ca variabilă) lui <code>wc</code> (word count) cu un anumit parametru. 
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents">O potentiala solutie<pre class="code bash"><span class="kw2">ps</span> <span class="re5">-eo</span> state,<span class="kw3">command</span>,pid <span class="sy0">|</span> <span class="kw2">grep</span> <span class="st0">&quot;^[SD]&quot;</span> <span class="sy0">|</span> <span class="kw2">wc</span> <span class="re5">-l</span></pre>
</div></div>

</div>
<!-- EDIT23 SECTION "[Bonus #2] Sleeping processes (1 karma WoUSO)" [24897-25489] -->
<h3 class="sectionedit24" id="bonus_3_variabila_path_1_karma_wouso">[Bonus #3] Variabila $PATH (1 karma WoUSO)</h3>
<div class="level3">

<p>
Creați directorul <code>/home/student/executables/</code>. Plasați scriptul <code>extract-images-only.sh</code>, creat la <a href="../../../../uso/laboratoare/laborator-06.html#lucrul_cu_arhive_tar_-_continuare_1p1" class="urlextern" title="http://ocw.cs.pub.ro/courses/uso/laboratoare/laborator-06#lucrul_cu_arhive_tar_-_continuare_1p1"  rel="nofollow">Exercițiul 8</a> în acest director și redenumiți-l în <code>extract-images-only</code> (fără <code>.sh</code>). Configurați sistemul astfel încât să putem executa scriptul direct, fără a folosi calea către acesta (așa cum executăm <code>ls</code>, de exemplu). La final veți putea rula scriptul doar cu ajutorul comenzii
</p>
<pre class="code">extract-images-only</pre>

<p>
<p><div class="notetip">
Va trebui să actualizați valoarea variabilei de mediu <code>PATH</code>, variabilă ce conține căile către <strong>directoarele</strong> ce conțin executabile/scripturi care sunt rulate direct. Adică va trebui să adăugați în cadrul variabilei <code>PATH</code> directorul <code>/home/student/executables/</code>.
</p>

<p>
Pentru documentare despre cum puteți actualiza valoarea variabilei de mediu <code>PATH</code> urmăriți <a href="http://www.cyberciti.biz/faq/unix-linux-adding-path/" class="urlextern" title="http://www.cyberciti.biz/faq/unix-linux-adding-path/"  rel="nofollow">acest link</a>.

</div></p>
</p>
<div class="solution"><div class="solution_title"><span class="title_text">Rezolvare</span></div><div class="solution_contents"><pre class="code">student@midgard:~$ mv extract-images-only.sh /home/student/executables/extract-images-only
student@midgard:~$ export PATH=$PATH:/home/student/executables/
student@midgard:~$ extract-images-only</pre>
</div></div>

</div>
<!-- EDIT24 SECTION "[Bonus #3] Variabila $PATH (1 karma WoUSO)" [25490-26796] -->
<h3 class="sectionedit25" id="bonus_4_log_inspection_3_karma_wouso">[Bonus #4] Log inspection (3 karma WoUSO)</h3>
<div class="level3">

<p>
În fișierul <code>/var/log/syslog</code> se găsesc jurnalizate mai multe mesaje printre care și mesajele afișate de clientul de DHCP, numit <code>dhclient</code>. Acest fișier îl afișați folosind <code>less</code>.
</p>

<p>
<p><div class="noteimportant">
Evitați să deschideți fișiere de jurnalizare folosind <code>vim</code>, din cauza faptului că logul poate fi foarte mare și vă poate bloca pentru secunde bune terminalul. Întotdeauna, inspectați logurile cu <code>less</code>, <code>tail</code>, <code>grep | less</code> etc.

</div></p>
</p>

<p>
După ce ați observat formatul datelor din fișierul <code>/var/log/syslog</code>, scrieți un one-liner care afișează pe ecran adresele IP care au fost furnizate de clientul de DHCP (adică acele mesaje care conțin șirul <code>bound to</code>).
</p>

</div>
<!-- EDIT25 SECTION "[Bonus #4] Log inspection (3 karma WoUSO)" [26797-] --></div>
</body>
</html>
