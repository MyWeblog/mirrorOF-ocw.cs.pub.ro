    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>eim:colocvii:colocviu02</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-05-16T11:25:39+0300"/>
<meta name="keywords" content="eim,colocvii,colocviu02"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=eim:colocvii"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="colocviu02.html"/>
<link rel="canonical" href="../../../../eim/colocvii/colocviu02.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='eim:colocvii';var JSINFO = {"id":"eim:colocvii:colocviu02","namespace":"eim:colocvii","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="colocviu02.html#colocviu_2">Colocviu 2</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="colocviu02.html#model_de_subiect">Model de Subiect</a></div></li>
<li class="level2"><div class="li"><a href="colocviu02.html#observatii_generale">Observații Generale</a></div></li>
<li class="level2"><div class="li"><a href="colocviu02.html#rezolvari">Rezolvări</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="colocviu_2">Colocviu 2</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Colocviu 2" [1-26] -->
<h2 class="sectionedit2" id="model_de_subiect">Model de Subiect</h2>
<div class="level2">

<center>

<p>
<iframe title="" src="../../../../_media/eim/colocvii/colocviu02/eim2016-tp02-varsim.pdf" style="width:90%; height:800px"></iframe>
</p>

</center>

<p>
<a href="../../../../_media/eim/colocvii/colocviu02/eim2016-tp02-varsim.pdf" class="media mediafile mf_pdf" title="eim:colocvii:colocviu02:eim2016-tp02-varsim.pdf (353.4 KB)">eim2016-tp02-varsim.pdf</a>
</p>

</div>
<!-- EDIT2 SECTION "Model de Subiect" [27-266] -->
<h2 class="sectionedit3" id="observatii_generale">Observații Generale</h2>
<div class="level2">

<p>
Pentru rezolvarea subiectelor propuse în cadrul colocviului 2, sunt necesare:
</p>
<ul>
<li class="level1"><div class="li"> un cont Github personal, pe care să existe drepturi de citire și de scriere;</div>
</li>
<li class="level1"><div class="li"> SDK-ul de Android (cu o imagine pentru nivelul de <abbr title="Application Programming Interface">API</abbr> 16 - Jelly Bean 4.1);</div>
</li>
<li class="level1"><div class="li"> mediul de dezvoltare integrat Android Studio sau Eclipse, împreună cu plugin-ul Android Developer Tools;</div>
</li>
<li class="level1"><div class="li"> un dispozitiv mobil:</div>
<ul>
<li class="level2"><div class="li"> fizic (bring your own device);</div>
</li>
<li class="level2"><div class="li"> virtual: Genymotion, AVD.</div>
</li>
</ul>
</li>
</ul>

<p>
În situația în care este necesară procesarea codului sursă (în format <abbr title="HyperText Markup Language">HTML</abbr>) al paginii Internet furnizat ca răspuns la cererea transmisă către un serviciu web, se poate folosi <a href="http://jsoup.org/packages/jsoup-1.9.1.jar" class="urlextern" title="http://jsoup.org/packages/jsoup-1.9.1.jar"  rel="nofollow">biblioteca Jsoup</a>.
</p>

<p>
Integrarea sa în mediul integrat pentru dezvoltare <strong>Android Studio 1.5.1</strong> se face prin plasarea fișierului corespunzător în directorul <em>libs</em> al proiectului. Ulterior, din meniul contextual al aplicației Android (accesibil prin click dreapta) se accesează opțiunea <em>Open Module Settings</em> sau se apasă tasta F4.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/androidstudio_library01.png" class="mediacenter" alt="" />
</p>

<p>
În fereastra <em>Project Structure</em> se apasă tasta <em>+</em> pentru a se specifica un modul nou.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/androidstudio_library02.png%3Fw=600&amp;tok=8dca45" class="mediacenter" alt="" width="600" />
</p>

<p>
În fereastra <em>Create New Module</em> se indică tipul de modul <em>Import .JAR/.AAR Package</em>.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/androidstudio_library03.png%3Fw=600&amp;tok=188210" class="mediacenter" alt="" width="600" />
</p>

<p>
Se precizează:
</p>
<ul>
<li class="level1"><div class="li"> locația la care se găsește biblioteca ce va fi importată sub formă de modul;</div>
</li>
<li class="level1"><div class="li"> denumirea subproiectului din care va face parte modulul;</div>
</li>
</ul>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/androidstudio_library04.png%3Fw=600&amp;tok=0d29cd" class="mediacenter" alt="" width="600" />
</p>

<p>
După ce biblioteca a fost integrată în cadrul mediului integrat pentru dezvoltare Android Studio 1.5.1, aceasta va putea fi vizualizată în fereastra <em>Project Structure</em>.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/androidstudio_library05.png%3Fw=600&amp;tok=0de2a2" class="mediacenter" alt="" width="600" />
</p>

<p>
Integrarea sa în mediul integrat pentru dezvoltare <strong>Eclipse Mars 1 (4.5.1)</strong> se face prin plasarea fișierului corespunzător în directorul <em>libs</em> al proiectului. Acesta devine vizibil în momentul în care se accesează operația <em>Refresh</em> din meniul contextual, disponibilă și prin tasta <em>F5</em>. Ulterior, pentru a fi inclus în classpath, este necesar ca din meniul contextual asociat fișierului <code>jsoup-1.9.1.jar</code> (disponibil pe butonul drept al mouse-ului) să se acceseze <em>Build Path</em> → <em>Add to Build Path</em>.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/eclipse_library01.png" class="mediacenter" alt="" />
</p>

<p>
După ce biblioteca a fost integrată în cadrul mediului integrat pentru dezvoltare Eclipse Mars 1 (4.5.1), aceasta va putea fi vizualizată în secțiunea <em>Referenced Libraries</em> din proiectul corespunzător.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/eclipse_library02.png" class="mediacenter" alt="" />
</p>

<p>
În situația în care este necesară procesarea unui document JSON furnizat ca răspuns la cererea transmisă către un serviciu web, se vor utiliza clasele <a href="http://developer.android.com/reference/org/json/JSONObject.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html"  rel="nofollow">JSONObject</a>, respectiv <a href="http://developer.android.com/reference/org/json/JSONArray.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONArray.html"  rel="nofollow">JSONArray</a>, din cadrul SDK-ului Android. Pentru vizualizare, se poate folosi utilitarul <a href="http://jsonformatter.curiousconcept.com/" class="urlextern" title="http://jsonformatter.curiousconcept.com/"  rel="nofollow">JSON Formatter &amp; Validator</a>, prin care structura documentului JSON poate fi inspectată cu ușurință.
</p>

</div>
<!-- EDIT3 SECTION "Observații Generale" [267-4144] -->
<h2 class="sectionedit4" id="rezolvari">Rezolvări</h2>
<div class="level2">

<p>
Proiectele Android Studio și Eclipse corespunzătoare aplicației Android ce conține rezolvările complete ale cerințelor colocviului sunt disponibile pe <a href="https://github.com/eim2016/PracticalTest02" class="urlextern" title="https://github.com/eim2016/PracticalTest02"  rel="nofollow">contul de Github al disciplinei</a>.
</p>

<p>
<strong>1.</strong> Se accesează <a href="https://www.github.com" class="urlextern" title="https://www.github.com"  rel="nofollow">Github</a> și se realizează autentificarea în contul personal, prin intermediul butonului <em>Sign in</em>.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu01/github_authentication.png%3Fw=700&amp;tok=e14534" class="mediacenter" alt="" width="700" />
</p>

<p>
Se creează o zonă de lucru corespunzătoare unui proiect prin intermediului butonului <em>New Repository</em>.
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/github_new_repository.png" class="mediacenter" alt="" />
</p>

<p>
Configurarea depozitului la distanță presupune specificarea:
</p>
<ul>
<li class="level1"><div class="li"> unei denumiri;</div>
</li>
<li class="level1"><div class="li"> unei descrieri (opțional);</div>
</li>
<li class="level1"><div class="li"> tipului de director (public sau privat - doar contra cost!!!);</div>
</li>
<li class="level1"><div class="li"> modului de inițializare:</div>
<ul>
<li class="level2"><div class="li"> local, prin <code>git init</code>;</div>
</li>
<li class="level2"><div class="li"> la distanță, prin <code>git clone</code> - depozitul la distanță nu trebuie să fie vid, în această situațoe </div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> unui fișier <code>README</code> (opțional);</div>
</li>
<li class="level1"><div class="li"> extensiilor ignorate (corespunzătoare limbajului de programare folosit, în cazul de față - Android) - incluse în fișierul <code>.gitignore</code>;</div>
</li>
<li class="level1"><div class="li"> tipului de licență sub care este publicat codul sursă.</div>
</li>
</ul>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/github_repository_configuration.png" class="mediacenter" alt="" />
</p>

<p>
<strong>2.</strong> Prin intermediul comenzii <code>git clone</code> se poate descărca întregul conținut în directorul curent (de pe discul local), inclusiv istoricul complet al versiunilor anterioare (care poate fi ulterior reconstituit după această copie, în cazul coruperii informațiilor stocate pe serverul la distanță).
</p>

<p>
<p><div class="noteclassic">În situația în care se dorește clonarea conținutului din depozitul la distanță în alt director decât cel curent, acesta poate fi transmis ca parametru al comenzii, după <abbr title="Uniform Resource Locator">URL</abbr>-ul la care poate fi accesat proiectul în Github.
</div></p>
</p>
<pre class="code">student@eim2016:~$ git clone https://www.github.com/perfectstudent/PracticalTest02</pre>

<p>
<strong>3.</strong> Se urmăresc indicațiile disponibile în secțiunea <a href="../../../../eim/laboratoare/laborator01.html#crearea_unei_aplicatii_android_in_eclipse_mars_1_451_-_obligatoriu" class="wikilink1" title="eim:laboratoare:laborator01">Crearea unei aplicații Android în Eclipse Mars 1 (4.5.1)</a>, respecti <a href="../../../../eim/laboratoare/laborator01.html#crearea_unei_aplicatii_android_in_android_studio_151_-_obligatoriu" class="wikilink1" title="eim:laboratoare:laborator01">Crearea unei aplicații Android în Android Studio 1.5.1</a>.
</p>

<p>
<strong>4.</strong> Pentru implementarea interfeței grafice, se vor defini controalele care asigură interacțiunea cu utilizatorul pentru fiecare dintre componentele aplicației Android:
</p>
<ul>
<li class="level1"><div class="li"> serverul</div>
<ul>
<li class="level2"><div class="li"> un câmp text pentru specificarea portului pe care va accepta conexiuni de la clienți;</div>
</li>
<li class="level2"><div class="li"> un buton pentru lansarea în execuție;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> clientul</div>
<ul>
<li class="level2"><div class="li"> câmpuri text pentru precizarea parametrilor de conexiune la server:</div>
<ul>
<li class="level3"><div class="li"> adresa Internet (se va folosi <code>localhost</code> sau <code>127.0.0.1</code>);</div>
</li>
<li class="level3"><div class="li"> port;</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> elemente grafice pentru indicarea informațiilor solicitate:</div>
<ul>
<li class="level3"><div class="li"> un câmp text pentru oraș;</div>
</li>
<li class="level3"><div class="li"> o listă populată cu datele meteorologice care se doresc a fi furnizate (<em>temperature</em>, <em>wind_speed</em>, <em>condition</em>, <em>pressure</em>, <em>humidity</em>, <em>all</em>); ca alternativă, se poate folosi tot un câmp text, cu restricția ca valorile introduse să facă parte din mulțimea acceptată;</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> un buton pentru trimiterea cererii și primirea răspunsului, condiționată de completarea anterioară a tuturor celorlalte informații.</div>
</li>
</ul>
</li>
</ul>

<p>
<p><div class="noteclassic">Nu este necesar ca în dezvoltarea interfeței grafice să se utilizeze elemente grafice complexe (de tipul fragmentelor sau listelor). Nu este punctat nici aspectul estetic al acesteia. Tot ce contează este ca interfața grafică să poată fi utilizată pentru implementarea cerințelor funcționale.
</div></p>
</p>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/graphic_interface01.png%3Fw=400&amp;tok=b05af3" class="mediacenter" alt="" width="400" />
</p>
<dl class="file">
<dt><a href="../../../code/eim/colocvii/colocviu02%3Fcodeblock=1" title="Download Snippet" class="mediafile mf_xml">activity_practical_test02_main.xml</a></dt>
<dd><pre class="code file xml"><span class="sc3"><span class="re1">&lt;LinearLayout</span> <span class="re0">xmlns:android</span>=<span class="st0">&quot;http://schemas.android.com/apk/res/android&quot;</span></span>
<span class="sc3">  <span class="re0">xmlns:tools</span>=<span class="st0">&quot;http://schemas.android.com/tools&quot;</span></span>
<span class="sc3">  <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">  <span class="re0">android:layout_height</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">  <span class="re0">android:orientation</span>=<span class="st0">&quot;vertical&quot;</span></span>
<span class="sc3">  <span class="re0">tools:context</span>=<span class="st0">&quot;ro.pub.cs.systems.eim.practicaltest02.graphicuserinterface.PracticalTest02MainActivity&quot;</span> <span class="re2">&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;TextView</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_gravity</span>=<span class="st0">&quot;center&quot;</span></span>
<span class="sc3">    <span class="re0">android:textSize</span>=<span class="st0">&quot;25sp&quot;</span></span>
<span class="sc3">    <span class="re0">android:textStyle</span>=<span class="st0">&quot;bold&quot;</span></span>
<span class="sc3">    <span class="re0">android:text</span>=<span class="st0">&quot;@string/server&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;LinearLayout</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:baselineAligned</span>=<span class="st0">&quot;false&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;ScrollView</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;0dp&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_weight</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
      <span class="sc3"><span class="re1">&lt;EditText</span></span>
<span class="sc3">        <span class="re0">android:id</span>=<span class="st0">&quot;@+id/server_port_edit_text&quot;</span></span>
<span class="sc3">	<span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">	<span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">	<span class="re0">android:hint</span>=<span class="st0">&quot;@string/server_port&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;/ScrollView<span class="re2">&gt;</span></span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;ScrollView</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;0dp&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_weight</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
      <span class="sc3"><span class="re1">&lt;Button</span></span>
<span class="sc3">        <span class="re0">android:id</span>=<span class="st0">&quot;@+id/connect_button&quot;</span></span>
<span class="sc3">	<span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">	<span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">	<span class="re0">android:layout_gravity</span>=<span class="st0">&quot;center&quot;</span></span>
<span class="sc3">	<span class="re0">android:text</span>=<span class="st0">&quot;@string/connect&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;/ScrollView<span class="re2">&gt;</span></span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;/LinearLayout<span class="re2">&gt;</span></span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;Space</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;10dp&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;TextView</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_gravity</span>=<span class="st0">&quot;center&quot;</span></span>
<span class="sc3">    <span class="re0">android:textSize</span>=<span class="st0">&quot;25sp&quot;</span></span>
<span class="sc3">    <span class="re0">android:textStyle</span>=<span class="st0">&quot;bold&quot;</span></span>
<span class="sc3">    <span class="re0">android:text</span>=<span class="st0">&quot;@string/client&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;LinearLayout</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:baselineAligned</span>=<span class="st0">&quot;false&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;ScrollView</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;0dp&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_weight</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
      <span class="sc3"><span class="re1">&lt;EditText</span></span>
<span class="sc3">        <span class="re0">android:id</span>=<span class="st0">&quot;@+id/client_address_edit_text&quot;</span></span>
<span class="sc3">        <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">        <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">        <span class="re0">android:hint</span>=<span class="st0">&quot;@string/client_address&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;/ScrollView<span class="re2">&gt;</span></span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;ScrollView</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;0dp&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_weight</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
      <span class="sc3"><span class="re1">&lt;EditText</span></span>
<span class="sc3">        <span class="re0">android:id</span>=<span class="st0">&quot;@+id/client_port_edit_text&quot;</span></span>
<span class="sc3">        <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">        <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">        <span class="re0">android:hint</span>=<span class="st0">&quot;@string/client_port&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;/ScrollView<span class="re2">&gt;</span></span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;/LinearLayout<span class="re2">&gt;</span></span></span>    
&nbsp;
  <span class="sc3"><span class="re1">&lt;GridLayout</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">    <span class="re0">android:rowCount</span>=<span class="st0">&quot;2&quot;</span></span>
<span class="sc3">    <span class="re0">android:columnCount</span>=<span class="st0">&quot;2&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;EditText</span></span>
<span class="sc3">      <span class="re0">android:id</span>=<span class="st0">&quot;@+id/city_edit_text&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:ems</span>=<span class="st0">&quot;5&quot;</span></span>
<span class="sc3">      <span class="re0">android:hint</span>=<span class="st0">&quot;@string/city&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_row</span>=<span class="st0">&quot;0&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_column</span>=<span class="st0">&quot;0&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;Spinner</span></span>
<span class="sc3">      <span class="re0">android:id</span>=<span class="st0">&quot;@+id/information_type_spinner&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:entries</span>=<span class="st0">&quot;@array/information_types&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_row</span>=<span class="st0">&quot;1&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_column</span>=<span class="st0">&quot;0&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;Button</span></span>
<span class="sc3">      <span class="re0">android:id</span>=<span class="st0">&quot;@+id/get_weather_forecast_button&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;100dp&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_gravity</span>=<span class="st0">&quot;center&quot;</span></span>
<span class="sc3">      <span class="re0">android:text</span>=<span class="st0">&quot;@string/get_weather_forecast&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_row</span>=<span class="st0">&quot;0&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_rowSpan</span>=<span class="st0">&quot;2&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_column</span>=<span class="st0">&quot;1&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;/GridLayout<span class="re2">&gt;</span></span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;ScrollView</span></span>
<span class="sc3">    <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">    <span class="re0">android:layout_height</span>=<span class="st0">&quot;match_parent&quot;</span><span class="re2">&gt;</span></span>
&nbsp;
    <span class="sc3"><span class="re1">&lt;TextView</span></span>
<span class="sc3">      <span class="re0">android:id</span>=<span class="st0">&quot;@+id/weather_forecast_text_view&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_width</span>=<span class="st0">&quot;match_parent&quot;</span></span>
<span class="sc3">      <span class="re0">android:layout_height</span>=<span class="st0">&quot;wrap_content&quot;</span></span>
<span class="sc3">      <span class="re0">android:singleLine</span>=<span class="st0">&quot;false&quot;</span></span>
<span class="sc3">      <span class="re0">android:maxLines</span>=<span class="st0">&quot;10&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;/ScrollView<span class="re2">&gt;</span></span></span>
&nbsp;
<span class="sc3"><span class="re1">&lt;/LinearLayout<span class="re2">&gt;</span></span></span></pre>
</dd></dl>

<p>
<p><div class="noteimportant">
O aplicație Android care accesează rețeaua trebuie să dețină permisiunea necesară (<code>android.permission.INTERNET</code>), specificată explicit în fișierul <code>AndroidManifest.xml</code>:
</p>
<dl class="file">
<dt><a href="../../../code/eim/colocvii/colocviu02%3Fcodeblock=2" title="Download Snippet" class="mediafile mf_xml">AndroidManifest.xml</a></dt>
<dd><pre class="code file xml"><span class="sc3"><span class="re1">&lt;manifest</span> ...<span class="re2">&gt;</span></span>
  <span class="sc-1">&lt;!-- other elements --&gt;</span>
  <span class="sc3"><span class="re1">&lt;uses-permission</span></span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;android.permission.INTERNET&quot;</span> <span class="re2">/&gt;</span></span>
<span class="sc3"><span class="re1">&lt;/manifest<span class="re2">&gt;</span></span></span></pre>
</dd></dl>

<p>

</div></p>
</p>

<p>
<p><div class="noteimportant">
O aplicație Android care accesează rețeaua va gestiona (cel puțin) două fire de execuție dedicate:
</p>
<ul>
<li class="level1"><div class="li"> <strong>firul de execuție al interfeței grafice</strong>; un control grafic nu va putea fi modificat decât din contextul acestui fir de execuție (în acest sens, se va utiliza metoda <code>post()</code> a elementului respectiv pentru interacțiunea cu utilizatorul sau un obiect de tip <code>Handler</code>);</div>
</li>
<li class="level1"><div class="li"> <strong>firul de execuție pentru comunicație</strong>, necesar astfel încât operațiile care necesită acces la rețea să nu blocheze interacțiunea cu utilizatorul, afectând experiența acestuia; în practică, se vor defini:</div>
<ul>
<li class="level2"><div class="li"> un fir de execuție pentru server (pe care sunt acceptate conexiunile de la clienți);</div>
</li>
<li class="level2"><div class="li"> câte un fir de execuție pentru fiecare comunicație dintre client și server, astfel încât interacțiunea dintre acestea să nu influențeze reponsivitatea serverului și nici comunicația cu ceilalți clienți.</div>
</li>
</ul>
</li>
</ul>

<p>

</div></p>
</p>

<p>
<strong>5.</strong> Implementarea serverului presupune:
</p>

<p>
<strong>a)</strong> un fir de execuție care gestionează solicitările de conexiune de la clienți:
</p>
<ul>
<li class="level1"><div class="li"> se va instanția un obiect de tip <code>ServerSocket</code> care va primi ca parametru portul indicat de utilizator: <pre class="code java"><span class="kw1">try</span> <span class="br0">&#123;</span>
  serverSocket <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+serversocket"><span class="kw3">ServerSocket</span></a><span class="br0">&#40;</span>port<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> se va gestiona un obiect de tip <code>Hashmap</code> în care vor fi reținute informațiile meteorologice cu privire la diferite orașe care au fost interogate anterior, astfel încât acestea să fie furnizate de la nivel local, fără a mai fi necesară conexiunea la distanță (în acest sens trebuie definită și clasa model <code>WeatherForecastInformation</code> care să conțină datele meteorologice disponibile - temperatură, viteza vântului, stare generală, presiune, umiditate - implementând pentru fiecare dintre acestea metode de tip getter și setter): <pre class="code java">data <span class="sy0">=</span> <span class="kw1">new</span> HashMap<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, WeatherForecastInformation<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li">  atâta vreme cât firul de execuție nu este întrerupt (aplicația Android nu a fost distrusă), sunt acceptate conexiuni de la clienți (prin invocarea metodei <code>accept()</code> apelată pe obiectul de tip <code>ServerSocket</code>, aceasta întorcând un obiect de tip <code>Socket</code>), comunicația dintre acestea fiind tratată pe un fir de execuție dedicat: <pre class="code java">@Override
<span class="kw1">public</span> <span class="kw4">void</span> run<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">try</span> <span class="br0">&#123;</span>
    <span class="kw1">while</span> <span class="br0">&#40;</span><span class="sy0">!</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+thread"><span class="kw3">Thread</span></a>.<span class="me1">currentThread</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">isInterrupted</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[SERVER] Waiting for a connection...&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+socket"><span class="kw3">Socket</span></a> socket <span class="sy0">=</span> serverSocket.<span class="me1">accept</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[SERVER] A connection request was received from &quot;</span> <span class="sy0">+</span> socket.<span class="me1">getInetAddress</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;:&quot;</span> <span class="sy0">+</span> socket.<span class="me1">getLocalPort</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      CommunicationThread communicationThread <span class="sy0">=</span> <span class="kw1">new</span> CommunicationThread<span class="br0">&#40;</span><span class="kw1">this</span>, socket<span class="br0">&#41;</span><span class="sy0">;</span>
      communicationThread.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>ClientProtocolException clientProtocolException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> clientProtocolException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      clientProtocolException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
</ul>

<p>
De remarcat faptul că pentru un obiect de tip <code>Socket</code> se poate determina:
</p>
<ul>
<li class="level1"><div class="li"> adresa Internet, furnizată de metoda <code>getInetAddress()</code>;</div>
</li>
<li class="level1"><div class="li"> portul, furnizat de metoda <code>getLocalPort()</code>.</div>
</li>
</ul>

<p>
Pornirea firului de execuție corespunzător serverului va fi realizată pe metoda de callback a obiectului ascultător pentru evenimentul de tip apăsare a butonului aferent din interfața grafică:
</p>

<p>
În prealabil, trebuie să se verifice completarea câmpului text care conține portul pe care vor fi acceptate conexiuni de la clienți.
</p>
<pre class="code java"><span class="kw1">private</span> <span class="kw1">class</span> ConnectButtonClickListener <span class="kw1">implements</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+button"><span class="kw3">Button</span></a>.<span class="me1">OnClickListener</span> <span class="br0">&#123;</span>
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onClick<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+view"><span class="kw3">View</span></a> view<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> serverPort <span class="sy0">=</span> serverPortEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>serverPort <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> serverPort.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>
        getApplicationContext<span class="br0">&#40;</span><span class="br0">&#41;</span>,
        <span class="st0">&quot;Server port should be filled!&quot;</span>,
        Toast.<span class="me1">LENGTH_SHORT</span>
      <span class="br0">&#41;</span>.<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    serverThread <span class="sy0">=</span> <span class="kw1">new</span> ServerThread<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>.<span class="me1">parseInt</span><span class="br0">&#40;</span>serverPort<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>serverThread.<span class="me1">getServerSocket</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      serverThread.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[MAIN ACTIVITY] Could not creat server thread!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="notetip">
Este important ca atunci când aplicația Android este distrusă să se oprească firul de execuție corespunzător serverului, eliberându-se resursele alocate:
</p>
<pre class="code java">@Override
<span class="kw1">protected</span> <span class="kw4">void</span> onDestroy<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>serverThread <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    serverThread.<span class="me1">stopThread</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">super</span>.<span class="me1">onDestroy</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
<pre class="code java"><span class="kw1">public</span> <span class="kw4">void</span> stopThread<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>serverSocket <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    interrupt<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>serverSocket <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        serverSocket.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>

</div></p>
</p>

<p>
<strong>b)</strong> un fir de execuție care gestionează comunicația dintre client și server:
</p>
<ul>
<li class="level1"><div class="li"> se obțin obiectele de tip <code>BufferedReader</code> și <code>PrintWriter</code> (prin apelul metodelor statice din clasa <code>Utilities</code>: <code>getReader()</code> și <code>getWriter()</code>), prin care se vor realiza operațiile de citire și scriere pe canalul de comunicație;</div>
</li>
<li class="level1"><div class="li"> se obține o referință către obiectul gestionat de server ce reține informațiile meteorologice pentru orașele pentru care au fost realizate interogări anterior;</div>
</li>
<li class="level1"><div class="li"> se primesc de la client (prin citire de pe canalul de comunicație) parametrii necesari pentru furnizarea informațiilor meteorologice (oraș și tip de date: temperatură, viteza vântului, starea generală, presiune, umiditate, toate);</div>
</li>
<li class="level1"><div class="li"> în situația în care informațiile meteorologice se găsesc în obiectul gestionat de server, sunt preluate local;</div>
</li>
<li class="level1"><div class="li"> în situația în care informațiile meteorologice nu se găsesc în obiectul gestionat de server, sunt preluate prin interogarea serviciului Internet, la distanță:</div>
<ul>
<li class="level2"><div class="li"> se realizează o cerere de tip <code>POST</code> la adresa Internet <a href="http://www.wunderground.com/cgi-bin/findweather/getForecast" class="urlextern" title="http://www.wunderground.com/cgi-bin/findweather/getForecast"  rel="nofollow">http://www.wunderground.com/cgi-bin/findweather/getForecast</a>; parametrul care trebuie precizat este <code>query</code> și are valoarea orașului pentru care se dorește să se obțină informațiile; acesta se atașează cererii de tip <code>POST</code>, folosind codificarea <code>UTF-8</code>;</div>
</li>
<li class="level2"><div class="li"> alternativ, se poate realiza o cerere de tip <code>GET</code> în care valoarea parametrului este inclusă în cadrul adresei Internet: <a href="https://www.wunderground.com/cgi-bin/findweather/getForecast?query=..." class="urlextern" title="https://www.wunderground.com/cgi-bin/findweather/getForecast?query=..."  rel="nofollow">https://www.wunderground.com/cgi-bin/findweather/getForecast?query=...</a>);</div>
</li>
<li class="level2"><div class="li"> se obține răspunsul sub forma unui șir de caractere, reprezentând codul sursă al paginii Internet; </div>
</li>
<li class="level2"><div class="li"> folosind biblioteca Jsoup, se inspectează documentul în format <abbr title="HyperText Markup Language">HTML</abbr> furnizat pentru a determina locația la care sunt disponibile informațiile necesare <pre class="code html4strict"><span class="sc2">&lt;<a href="http://december.com/html/4/element/script.html"><span class="kw2">script</span></a>&gt;</span>
  wui.asyncCityPage = true;
  wui.bootstrapped.API = &quot;&quot;;
  wui.api_data =
  {
    &quot;response&quot;: {
      &quot;version&quot;: &quot;2.0&quot;,
      &quot;units&quot;: &quot;metric&quot;,
      &quot;location&quot;: {
        &quot;name&quot;: &quot;Bucuresti&quot;,
        &quot;neighborhood&quot;:null,
        &quot;city&quot;: &quot;Bucuresti&quot;,
        &quot;state&quot;: null,
        &quot;state_name&quot;:&quot;Romania&quot;,
        &quot;country&quot;: &quot;RO&quot;,
        &quot;country_iso3166&quot;:null,
        &quot;country_name&quot;:&quot;Romania&quot;,
        &quot;zip&quot;:&quot;00000&quot;,
        &quot;magic&quot;:&quot;11&quot;,
        &quot;wmo&quot;:&quot;15420&quot;,
        &quot;latitude&quot;:44.50000000,
        &quot;longitude&quot;:26.12999916,
        &quot;elevation&quot;:91.00000000,
        &quot;l&quot;: &quot;/q/zmw:00000.11.15420&quot;
      },
      &quot;date&quot;: {
	...
      },
      &quot;current_observation&quot;: {
        &quot;source&quot;: &quot;PWS&quot;,
        &quot;station&quot;: {
          ...		
        },
        &quot;estimated&quot;: null,
        &quot;date&quot;: {
          ...
        },
        &quot;metar&quot;: &quot;AAXX 16161 15420 22997 80502 10201 20109 30072 40180 55008 8807/ 333 55300 0//// 20454&quot;,
        &quot;condition&quot;:&quot;Overcast&quot;,
        &quot;temperature&quot;: 21.5,
        &quot;humidity&quot;:48,
        &quot;wind_speed&quot;:6.9,
        ...,
        &quot;pressure&quot;: 1018,
        ...,
      }
    }
  };
<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/script.html"><span class="kw2">script</span></a>&gt;</span></pre>

<p>
 Se observă faptul că informațiile necesare se regăsesc în cadrul unei etichete de tip <code>&lt;script&gt; … &lt;/script&gt;</code> care conține un obiect denumit <code>wui.api_dat</code> exprimat în format JSON. În acest sens, se obține lista tuturor etichetelor de tip <code>script</code> (se folosește metoda <code>getElementsByTag()</code>), se preia conținutul acestora (prin intermediul metodei <code>data()</code> din cadrul clasei <code>Element</code>) și se verifică dacă se regăsește șirul de caractere <code>wui.api_dat</code>;
</p>
</div>
</li>
<li class="level2"><div class="li"> se inspectează documentul în format JSON pentru a obține informațiile necesare: se obțin, succesiv, obiectele atașate ca valori pentru cheile <code>response</code> → <code>current_observation</code> și ulterior datele meteorologice, regăsite ca valori sub cheile <code>temperature</code>, <code>wind_speed</code>, <code>condition</code>, <code>pressure</code>, <code>humidity</code>;</div>
</li>
<li class="level2"><div class="li"> se construiește un obiect de tipul <code>WeatherForecastInformation</code> folosind informațiile furnizate și se transmite către server pentru ca acesta să fie utilizat ulterior pentru cereri provenite de la alți clienți, vizând același oraș.</div>
</li>
</ul>
</li>
</ul>

<p>
<p><div class="notetip">
Pe server, metodele care gestionează obiectul ce conține informațiile meteorologice legate de orașse trebuie să fie <strong>sincronizate</strong>, astfel încât să nu apară inconsistențe în situația în care acestea sunt accesate concomitent de mai multe fire de execuție:
</p>
<pre class="code java"><span class="kw1">public</span> <span class="kw1">synchronized</span> <span class="kw4">void</span> setData<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> city, WeatherForecastInformation weatherForecastInformation<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">this</span>.<span class="me1">data</span>.<span class="me1">put</span><span class="br0">&#40;</span>city, weatherForecastInformation<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">synchronized</span> HashMap<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, WeatherForecastInformation<span class="sy0">&gt;</span> getData<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">return</span> data<span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>

</div></p>
</p>
<ul>
<li class="level1"><div class="li"> se trimit la client (prin scriere pe canalul de comunicație) informațiile meteorologice solicitate;</div>
</li>
<li class="level1"><div class="li"> se eliberează resursele corespunzătoare canalului de comunicație.</div>
</li>
</ul>
<pre class="code java">@Override
<span class="kw1">public</span> <span class="kw4">void</span> run<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>socket <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a> bufferedReader <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">getReader</span><span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+printwriter"><span class="kw3">PrintWriter</span></a>    printWriter    <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">getWriter</span><span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>bufferedReader <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> printWriter <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Waiting for parameters from client (city / information type)!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> city            <span class="sy0">=</span> bufferedReader.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> informationType <span class="sy0">=</span> bufferedReader.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        HashMap<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, WeatherForecastInformation<span class="sy0">&gt;</span> data <span class="sy0">=</span> serverThread.<span class="me1">getData</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        WeatherForecastInformation weatherForecastInformation <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>city <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>city.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span> informationType <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>informationType.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>data.<span class="me1">containsKey</span><span class="br0">&#40;</span>city<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Getting the information from the cache...&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            weatherForecastInformation <span class="sy0">=</span> data.<span class="me1">get</span><span class="br0">&#40;</span>city<span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
            Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Getting the information from the webservice...&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            HttpClient httpClient <span class="sy0">=</span> <span class="kw1">new</span> DefaultHttpClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            HttpPost httpPost <span class="sy0">=</span> <span class="kw1">new</span> HttpPost<span class="br0">&#40;</span>Constants.<span class="me1">WEB_SERVICE_ADDRESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
            List<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span> params <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">QUERY_ATTRIBUTE</span>, city<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            UrlEncodedFormEntity urlEncodedFormEntity <span class="sy0">=</span> <span class="kw1">new</span> UrlEncodedFormEntity<span class="br0">&#40;</span>params, HTTP.<span class="me1">UTF_8</span><span class="br0">&#41;</span><span class="sy0">;</span>
            httpPost.<span class="me1">setEntity</span><span class="br0">&#40;</span>urlEncodedFormEntity<span class="br0">&#41;</span><span class="sy0">;</span>
            ResponseHandler<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> responseHandler <span class="sy0">=</span> <span class="kw1">new</span> BasicResponseHandler<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> pageSourceCode <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpPost, responseHandler<span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>pageSourceCode <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+document"><span class="kw3">Document</span></a> document <span class="sy0">=</span> Jsoup.<span class="me1">parse</span><span class="br0">&#40;</span>pageSourceCode<span class="br0">&#41;</span><span class="sy0">;</span>
              <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> element <span class="sy0">=</span> document.<span class="me1">child</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
              Elements scripts <span class="sy0">=</span> element.<span class="me1">getElementsByTag</span><span class="br0">&#40;</span>Constants.<span class="me1">SCRIPT_TAG</span><span class="br0">&#41;</span><span class="sy0">;</span>
              <span class="kw1">for</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> script<span class="sy0">:</span> scripts<span class="br0">&#41;</span> <span class="br0">&#123;</span>
                <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> scriptData <span class="sy0">=</span> script.<span class="me1">data</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
                <span class="kw1">if</span> <span class="br0">&#40;</span>scriptData.<span class="me1">contains</span><span class="br0">&#40;</span>Constants.<span class="me1">SEARCH_KEY</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
                  <span class="kw4">int</span> position <span class="sy0">=</span> scriptData.<span class="me1">indexOf</span><span class="br0">&#40;</span>Constants.<span class="me1">SEARCH_KEY</span><span class="br0">&#41;</span> <span class="sy0">+</span> Constants.<span class="me1">SEARCH_KEY</span>.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  scriptData <span class="sy0">=</span> scriptData.<span class="me1">substring</span><span class="br0">&#40;</span>position<span class="br0">&#41;</span><span class="sy0">;</span>
                  JSONObject content <span class="sy0">=</span> <span class="kw1">new</span> JSONObject<span class="br0">&#40;</span>scriptData<span class="br0">&#41;</span><span class="sy0">;</span>
		  JSONObject currentObservation <span class="sy0">=</span> content.<span class="me1">getJSONObject</span><span class="br0">&#40;</span>Constants.<span class="me1">CURRENT_OBSERVATION</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> temperature <span class="sy0">=</span> currentObservation.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">TEMPERATURE</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> windSpeed <span class="sy0">=</span> currentObservation.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">WIND_SPEED</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> condition <span class="sy0">=</span> currentObservation.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">CONDITION</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> pressure <span class="sy0">=</span> currentObservation.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">PRESSURE</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> humidity <span class="sy0">=</span> currentObservation.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">HUMIDITY</span><span class="br0">&#41;</span><span class="sy0">;</span>
                  weatherForecastInformation <span class="sy0">=</span> <span class="kw1">new</span> WeatherForecastInformation<span class="br0">&#40;</span>
                    temperature,
                    windSpeed,
                    condition,
                    pressure,
                    humidity
                  <span class="br0">&#41;</span><span class="sy0">;</span>
                  serverThread.<span class="me1">setData</span><span class="br0">&#40;</span>city, weatherForecastInformation<span class="br0">&#41;</span><span class="sy0">;</span>
                  <span class="kw1">break</span><span class="sy0">;</span>
                <span class="br0">&#125;</span>
              <span class="br0">&#125;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
              Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Error getting the information from the webservice!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
          <span class="br0">&#125;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>weatherForecastInformation <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> result <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">ALL</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">TEMPERATURE</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">getTemperature</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">WIND_SPEED</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">getWindSpeed</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">CONDITION</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">getCondition</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">HUMIDITY</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">getHumidity</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">PRESSURE</span>.<span class="me1">equals</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> weatherForecastInformation.<span class="me1">getPressure</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
              result <span class="sy0">=</span> <span class="st0">&quot;Wrong information type (all / temperature / wind_speed / condition / humidity / pressure)!&quot;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
            printWriter.<span class="me1">println</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
            printWriter.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
            Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Weather Forecast information is null!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
          Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Error receiving parameters from client (city / information type)!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
      <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
        Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] BufferedReader / PrintWriter are null!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      socket.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>JSONException jsonException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] An exception has occurred: &quot;</span> <span class="sy0">+</span> jsonException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        jsonException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
    Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[COMMUNICATION THREAD] Socket is null!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="noteimportant">În cazul în care se folosește Android Studio și este instalat un SDK corespunzător nivelului de <abbr title="Application Programming Interface">API</abbr> 23 în care a fost eliminat suportul pentru biblioteca Apache HTTP Components, este necesar ca în fișierul build.gradle din directorul <code>app</code> al aplicației Android să se precizeze explicit folosirea acesteia (denumirea sa este <code>org.apache.http.legacy</code>).
</p>
<dl class="file">
<dt><a href="../../../code/eim/colocvii/colocviu02%3Fcodeblock=12" title="Download Snippet" class="mediafile mf_gradle">build.gradle</a></dt>
<dd><pre class="code file gradle">...
android {
  compileSdkVersion 23
  buildToolsVersion &quot;23.0.2&quot;
&nbsp;
  defaultConfig {
    applicationId &quot;ro.pub.cs.systems.eim.practicaltest02&quot;
    minSdkVersion 16
    targetSdkVersion 23
    versionCode 1
    versionName &quot;1.0&quot;
  }
&nbsp;
  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
    }
  }
&nbsp;
  useLibrary 'org.apache.http.legacy'
}
...</pre>
</dd></dl>

<p>

</div></p>
</p>

<p>
<strong>6.</strong> Implementarea clientului presupune un fir de execuție pe care sunt realizate următoarele operații:
</p>
<ul>
<li class="level1"><div class="li"> deschiderea unui canal de comunicație folosind parametrii de conexiune la server (adresa Internet, port);</div>
</li>
<li class="level1"><div class="li"> obținerea unor obiecte de tip <code>BufferedReader</code> și <code>PrintWriter</code> (prin apelul metodelor statice din clasa <code>Utilities</code>: <code>getReader()</code> și <code>getWriter()</code>), prin care se vor realiza operațiile de citire și scriere pe canalul de comunicație;</div>
</li>
<li class="level1"><div class="li"> trimiterea la server (prin scriere pe canalul de comunicație) parametrii necesari pentru furnizarea informațiilor meteorologice (oraș și tip de date: temperatură, viteza vântului, starea generală, presiune, umiditate, toate);</div>
</li>
<li class="level1"><div class="li"> primirea de la server (prin citire de pa canalul de comunicație) a liniilor distincte conținând datele meteorologice (cât timp nu se primește <abbr title="End of file">EOF</abbr>, reprezentat printr-o valoare <code>null</code> a șirului de caractere furnizat);</div>
</li>
<li class="level1"><div class="li"> vizualizarea datelor meterologice într-un obiect de tip <code>TextView</code>, din cadrul interfeței grafice; întucât modificarea se face din contextul unui fir de execuție care gestionează comunicația prin rețea, accesul la controlul grafic se face prin intermediul metodei <code>post()</code> care primește ca parametru un obiect anonim de tip <code>Runnable</code> al cărui conținut va fi rulat în contextul firului de execuție principal al aplicației Android;</div>
</li>
<li class="level1"><div class="li"> închiderea canalului de comunicație.</div>
</li>
</ul>
<pre class="code java">@Override
<span class="kw1">public</span> <span class="kw4">void</span> run<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">try</span> <span class="br0">&#123;</span>
    socket <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+socket"><span class="kw3">Socket</span></a><span class="br0">&#40;</span>address, port<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>socket <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[CLIENT THREAD] Could not create socket!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a> bufferedReader <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">getReader</span><span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+printwriter"><span class="kw3">PrintWriter</span></a>    printWriter    <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">getWriter</span><span class="br0">&#40;</span>socket<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>bufferedReader <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> printWriter <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      printWriter.<span class="me1">println</span><span class="br0">&#40;</span>city<span class="br0">&#41;</span><span class="sy0">;</span>
      printWriter.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      printWriter.<span class="me1">println</span><span class="br0">&#40;</span>informationType<span class="br0">&#41;</span><span class="sy0">;</span>
      printWriter.<span class="me1">flush</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> weatherInformation<span class="sy0">;</span>
      <span class="kw1">while</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>weatherInformation <span class="sy0">=</span> bufferedReader.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">final</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> finalizedWeatherInformation <span class="sy0">=</span> weatherInformation<span class="sy0">;</span>
        weatherForecastTextView.<span class="me1">post</span><span class="br0">&#40;</span><span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+runnable"><span class="kw3">Runnable</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          @Override
          <span class="kw1">public</span> <span class="kw4">void</span> run<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            weatherForecastTextView.<span class="me1">append</span><span class="br0">&#40;</span>finalizedWeatherInformation <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[CLIENT THREAD] BufferedReader / PrintWriter are null!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    socket.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[CLIENT THREAD] An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<img src="../../../../_media/eim/colocvii/colocviu02/graphic_interface02.png%3Fw=400&amp;tok=a8d022" class="mediacenter" alt="" width="400" />
</p>

<p>
Pornirea firului de execuție corespunzător clientului va fi realizată pe metoda de callback a obiectului ascultător pentru evenimentul de tip apăsare a butonului aferent din interfața grafică.
</p>

<p>
Verificările care trebuie realizate sunt:
</p>
<ul>
<li class="level1"><div class="li"> completarea câmpurilor text ce conțin parametrii de conexiune la server (adresă Internet, port);</div>
</li>
<li class="level1"><div class="li"> existența unui fir de execuție corespunzător serverului care să ruleze la momentul respectiv;</div>
</li>
<li class="level1"><div class="li"> completarea controalelor grafice ce conțin denumirea orașului și tipul de informație meteorologică ce se dorește a fi solicitată.</div>
</li>
</ul>
<pre class="code java"><span class="kw1">private</span> <span class="kw1">class</span> GetWeatherForecastButtonClickListener <span class="kw1">implements</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+button"><span class="kw3">Button</span></a>.<span class="me1">OnClickListener</span> <span class="br0">&#123;</span>
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onClick<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+view"><span class="kw3">View</span></a> view<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> clientAddress <span class="sy0">=</span> clientAddressEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> clientPort    <span class="sy0">=</span> clientPortEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>clientAddress <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> clientAddress.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">||</span>
      clientPort <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> clientPort.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>
        getApplicationContext<span class="br0">&#40;</span><span class="br0">&#41;</span>,
        <span class="st0">&quot;Client connection parameters should be filled!&quot;</span>,
        Toast.<span class="me1">LENGTH_SHORT</span>
      <span class="br0">&#41;</span>.<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>serverThread <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> <span class="sy0">!</span>serverThread.<span class="me1">isAlive</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;[MAIN ACTIVITY] There is no server to connect to!&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> city <span class="sy0">=</span> cityEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> informationType <span class="sy0">=</span> informationTypeSpinner.<span class="me1">getSelectedItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>city <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> city.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">||</span>
      informationType <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> informationType.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>
        getApplicationContext<span class="br0">&#40;</span><span class="br0">&#41;</span>,
        <span class="st0">&quot;Parameters from client (city / information type) should be filled!&quot;</span>,
        Toast.<span class="me1">LENGTH_SHORT</span>
      <span class="br0">&#41;</span>.<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    weatherForecastTextView.<span class="me1">setText</span><span class="br0">&#40;</span>Constants.<span class="me1">EMPTY_STRING</span><span class="br0">&#41;</span><span class="sy0">;</span>
    clientThread <span class="sy0">=</span> <span class="kw1">new</span> ClientThread<span class="br0">&#40;</span>
      clientAddress,
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>.<span class="me1">parseInt</span><span class="br0">&#40;</span>clientPort<span class="br0">&#41;</span>,
      city,
      informationType,
      weatherForecastTextView<span class="br0">&#41;</span><span class="sy0">;</span>
    clientThread.<span class="me1">start</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
Conexiunea la serverul implementat în cadrul aplicației Android se poate realiza și prin intermediul unei console de pe mașina fizică, folosind utilitarele <code>nc</code> (Linux), respectiv <code>telnet</code> (Windows).
</p>

<p>
Trebuie determinată adresa Internet la care poate fi accesat dispozitivul mobil:
</p>
<ul>
<li class="level1"><div class="li"> dispozitiv fizic: se folosește USB Tethering, iar adresa Internet este indicată de valoarea <em>Default Gateway</em> a rețelei <code>usb0</code> / <code>rndis0</code> - Linux, respectiv Ethernet pe Windows (se rulează comenzile <code>ifconfig</code> pe Linux, <code>ipconfig</code> pe Windows);</div>
</li>
<li class="level1"><div class="li"> dispozitiv virtual:</div>
<ul>
<li class="level2"><div class="li"> Genymotion: adresele Internet sunt alocate de serverul DHCP din cadrul VirtualBox în intervalul <code>192.168.56.101</code> → <code>192.168.56.254</code>;</div>
</li>
<li class="level2"><div class="li"> AVD: se utilizează redirectarea porturilor.</div>
</li>
</ul>
</li>
</ul>
<table class="columns-plugin">
<tr><td class="columns-plugin first">
<pre class="code">student@eim2016:~$ nc 192.168.56.101 5000
Bucuresti
all
temperature: 17.0
wind_speed: 5.0
condition: Clear
pressure: 1015
humidity: 68</pre>
</td><td class="columns-plugin last">
<pre class="code">C:\Users\Eim2016&gt; telnet 192.168.56.101 5000
Bucuresti
all
temperature: 17.0
wind_speed: 5.0
condition: Clear
pressure: 1015
humidity: 68
Connection to host lost.</pre>
</td></tr></table>

<p>
<strong>7.</strong> Pentru încărcarea codului în contextul depozitului din cadrul contului Github personal:
</p>
<ol>
<li class="level1"><div class="li"> se transferă modificările din zona de lucru în zona de lucru în zona de așteptare prin intermediul comenzii <code>git add</code>, indicându-se și fișierele respective (pot fi folosite șabloane pentru a desemna mai multe fișiere);</div>
</li>
<li class="level1"><div class="li"> se consemnează modificările din zona de așteptare în directorul Git prin intermediul comenzii <code>git commit -m</code>, precizându-se și un mesaj sugestiv:</div>
</li>
<li class="level1"><div class="li"> se încarcă modificările la distanță, prin intermediul comenzii <code>git push</code>, care primește ca parametrii:</div>
<ol>
<li class="level2"><div class="li"> sursa (prin eticheta <code>origin</code> se indică depozitul de unde au fost descărcat conținutul);</div>
</li>
<li class="level2"><div class="li"> destinația: ramificația curentă (implicit, aceasta poartă denumirea <code>master</code>).</div>
</li>
</ol>
</li>
</ol>
<pre class="code">student@eim2016:~/PracticalTest02$ git add *
student@eim2016:~/PracticalTest02$ git commit -m &quot;finished tasks for PracticalTest02&quot;
student@eim2016:~/PracticalTest02$ git push origin master</pre>

<p>
În cazul în care este necesar, vor fi configurați parametrii necesari operației de consemnare (numele de utilizator și adresa de poștă electronică):
</p>
<pre class="code">student@eim2016:~/PracticalTest02$ git config --global user.name &quot;Perfect Student&quot;
student@eim2016:~/PracticalTest02$ git config --global user.email perfectstudent@cs.pub.ro</pre>

<p>
<strong>8.</strong> Înregistrarea unui serviciu în cadrul rețelei locale se face prin intermediul unor obiecte <code>NsdServiceInfo</code> (Android NSD) respectiv <code>ServiceInfo</code> (JmDNS). Acestea sunt transmise ca parametrii ai metodelor <code>registerService()</code> din clasele <code>NsdManager</code>, respectiv <code>JmDNS</code>.
</p>

<p>
Aceste obiecte sunt caracterizate prin parametrii de conectare la serviciu:
</p>
<ul>
<li class="level1"><div class="li"> <code>NsdServiceInfo</code> - adresaInternet (metoda <code>setHost()</code>) și port (metoda <code>setPort()</code>);</div>
</li>
<li class="level1"><div class="li"> <code>ServiceInfo</code> - portul, configurat prin intermediul constructorului.</div>
</li>
</ul>

<p>
Se recomandă ca portul să fie furnizat de sistemul de operare, pentru a evita situațiile în care utilizatorul poate specifica un port care este ocupat. În acest sens, se instanțiază un obiect de tip <code>ServerSocket</code> care primește parametrul <code>0</code>, indicându-se astfel faptul că se dorește utilizarea unui port aleator, care poate fi folosit la momentul respectiv. Ulterior, parametrii de conectare pot fi obținuți folosind metodele specifice ale unui astfel de obiect:
</p>
<ul>
<li class="level1"><div class="li"> adresa Internet - <code>getInetAddress()</code>;</div>
</li>
<li class="level1"><div class="li"> port - <code>getLocalPort()</code>.</div>
</li>
</ul>
<pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+serversocket"><span class="kw3">ServerSocket</span></a> serverSocket <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+serversocket"><span class="kw3">ServerSocket</span></a><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">if</span> <span class="br0">&#40;</span>serverSocket <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+inetaddress"><span class="kw3">InetAddress</span></a> inetAddress <span class="sy0">=</span> serverSocket.<span class="me1">getInetAddress</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw4">int</span> port <span class="sy0">=</span> serverSocket.<span class="me1">getLocalPort</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
<strong>9.</strong> Protocolul SIP pornește de la o presupunere optimistă conform căreia atât sursa cât și destinația se găsesc în cadrul aceluiași sistem autonom, astfel încât nu sunt necesare credențiale pentru autentificare. Din acest model, o cerere de tip <code>REGISTER</code> se transmite inițial de către user agent fără aceste informații. În condițiile în care răspunsul furnizat de registration server este <em>Status: 401 Unauthorized</em>, mesajul este retransmis împreună cu informațiile necesare identificării (SIP Authorization ID, Password). Se poate observa că dimensiunile celor două pachete sunt diferite (mesajul fără credențiale 1095 octeți, mesajul cu credențiale 1249 octeți). În cazul în care informațiile de autentificare sunt valide, răspunsul va fi <em>Status: 200 OK</em>.
</p>

<p>
<img src="../../../../_media/eim/laboratoare/laborator09/wireshark01.png%3Fw=800&amp;tok=b08b30" class="mediacenter" alt="" width="800" />
</p>

<p>
<strong>10.</strong> Harta Google este implementată în SDK-ul Android:
</p>
<ul>
<li class="level1"><div class="li"> prin intermediul unei componente grafice de tipul <a href="https://developer.android.com/reference/com/google/android/gms/maps/MapView.html" class="urlextern" title="https://developer.android.com/reference/com/google/android/gms/maps/MapView.html"  rel="nofollow">MapView</a>;</div>
</li>
<li class="level1"><div class="li"> în cadrul unui fragment, de tipul <a href="http://developer.android.com/reference/com/google/android/gms/maps/MapFragment.html" class="urlextern" title="http://developer.android.com/reference/com/google/android/gms/maps/MapFragment.html"  rel="nofollow">MapFragment</a>.</div>
</li>
</ul>

<p>
Referințele către aceste obiecte se obțin în mod obișnuit, prin intermediul metodelor <code>findViewById()</code>, respectiv <code>findFragmentById()</code>.
</p>

<p>
Pe baza controalelor grafice <code>MapView</code> sau <code>MapFragment</code>, se poate obține o instanță a unui obiect <a href="https://developer.android.com/reference/com/google/android/gms/maps/GoogleMap.html" class="urlextern" title="https://developer.android.com/reference/com/google/android/gms/maps/GoogleMap.html"  rel="nofollow">GoogleMap</a>, prin intermediul metodelor <code>getMap()</code>, respectiv <code>getMapAsync()</code>. Se recomandă să se folosească metoda asincronă care garantează faptul că obiectul furnizat este nenul. Metoda de callback <code>onMapReady()</code> a clasei ascultător <code>OnMapReadyCallback</code> nu va fi apelată în situația în care serviciul Google Play Services nu este disponibil pe dispozitivul mobil sau obiectul este distrus imediat după ce a fost creat.
</p>
<pre class="code java"><span class="kw1">if</span> <span class="br0">&#40;</span>googleMap <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="br0">&#40;</span><span class="br0">&#40;</span>MapFragment<span class="br0">&#41;</span>getFragmentManager<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">findFragmentById</span><span class="br0">&#40;</span>R.<span class="me1">id</span>.<span class="me1">google_map</span><span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">getMapAsync</span><span class="br0">&#40;</span><span class="kw1">new</span> OnMapReadyCallback<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> onMapReady<span class="br0">&#40;</span>GoogleMap readyGoogleMap<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      googleMap <span class="sy0">=</span> readyGoogleMap<span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

</div>
<!-- EDIT4 SECTION "Rezolvări" [4145-] --></div>
</body>
</html>
