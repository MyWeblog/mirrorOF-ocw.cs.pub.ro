    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>eim:laboratoare:laborator07</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-04-15T07:14:18+0300"/>
<meta name="keywords" content="eim,laboratoare,laborator07"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=eim:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator07.html"/>
<link rel="canonical" href="../../../../eim/laboratoare/laborator07.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='eim:laboratoare';var JSINFO = {"id":"eim:laboratoare:laborator07","namespace":"eim:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator07.html#laborator_07_invocarea_de_servicii_web_prin_protocolul_http">Laborator 07. Invocarea de Servicii Web prin Protocolul HTTP</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator07.html#protocolul_http">Protocolul HTTP</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator07.html#structura_unei_cereri_http">Structura unei Cereri HTTP</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator07.html#get_vs_post">GET vs. POST</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator07.html#section"></a></div></li>
<li class="level3"><div class="li"><a href="laborator07.html#structura_unui_raspuns_http">Structura unui Răspuns HTTP</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator07.html#mecanisme_pentru_comunicatia_prin_http_in_android">Mecanisme pentru Comunicația prin HTTP în Android</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator07.html#clasa_httpurlconnection">Clasa HttpURLConnection</a></div></li>
<li class="level3"><div class="li"><a href="laborator07.html#apache_http_components">Apache HTTP Components</a></div></li>
<li class="level3"><div class="li"><a href="laborator07.html#volley">Volley</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator07.html#prelucrare_dom_document_object_model">Prelucrare DOM (Document Object Model)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator07.html#exemplu">Exemplu</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator07.html#prelucrare_json_javascript_object_notation_-_optional">Prelucrare JSON (JavaScript Object Notation) - opțional</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator07.html#exemplu1">Exemplu</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator07.html#activitate_de_laborator">Activitate de Laborator</a></div></li>
<li class="level2"><div class="li"><a href="laborator07.html#resurse_utile">Resurse Utile</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_07_invocarea_de_servicii_web_prin_protocolul_http">Laborator 07. Invocarea de Servicii Web prin Protocolul HTTP</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 07. Invocarea de Servicii Web prin Protocolul HTTP" [1-76] -->
<h2 class="sectionedit2" id="protocolul_http">Protocolul HTTP</h2>
<div class="level2">

<p>
De multe ori, funcționalitatea pe care o pun la dispoziție aplicațiile Android este preluată din alte surse, datorită limitărilor impuse de capacitatea de procesare și memorie disponibilă ale unui dispozitiv mobil. O strategie posibilă în acest sens este utilizarea HTTP, pentru interogarea unor servicii web, al căror rezultat este de cele mai multe ori oferit în format JSON sau XML. De asemenea, descărcarea unor resurse se poate face prin inspectarea codului sursă al unor pagini Internet (documente <abbr title="HyperText Markup Language">HTML</abbr>), în urma acestei operații detectându-se locația la care acestea sunt disponibile.
</p>

<p>
<strong>HTTP</strong> (Hypertext Transfer Protocol) este un protocol de comunicație responsabil cu transferul de hipertext (text structurat ce conține legături) dintre un client (de regulă, un navigator) și un server web, interacțiunea dintre acestea (prin intermediul unei conexiuni TCP persistente pe portul 80) fiind reglementată de <a href="http://www.rfc-editor.org/rfc/rfc2616.txt" class="urlextern" title="http://www.rfc-editor.org/rfc/rfc2616.txt"  rel="nofollow">RFC 2616</a>. HTTP este un protocol fără stare, pentru persistența informațiilor între accesări fiind necesar să se utilizeze soluții adiacente (cookie, sesiuni, rescrierea <abbr title="Uniform Resource Locator">URL</abbr>-urilor, câmpuri ascunse).
</p>

<p>
Principalele concepte cu care lucrează acest protocol sunt <em>cererea</em> și <em>răspunsul</em>.
</p>
<ul>
<li class="level1"><div class="li"> <strong>cererea</strong> este transmisă de client către serverul web și reprezintă o solicitare pentru obținerea unor resurse (identificate printr-un <abbr title="Uniform Resource Locator">URL</abbr>); aceasta conține denumirea metodei care va fi utilizată pentru transferul de informații, locația de unde se găsește resursa respectivă și versiunea de protocol;</div>
</li>
<li class="level1"><div class="li"> <strong>răspunsul</strong> este transmis de serverul web către client, ca rezultat al solicitării primite, incluzând și o linie de stare (ce conține un cod care indică dacă starea comenzii) precum și alte informații suplimentare</div>
</li>
</ul>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/functionare_protocol_http.png%3Fw=500&amp;tok=8e89aa" class="mediacenter" alt="" width="500" />
</p>

</div>
<!-- EDIT2 SECTION "Protocolul HTTP" [77-2022] -->
<h3 class="sectionedit3" id="structura_unei_cereri_http">Structura unei Cereri HTTP</h3>
<div class="level3">

<p>
O cerere HTTP conține una sau mai multe linii de text <abbr title="American Standard Code for Information Interchange">ASCII</abbr>, precedate în mod necesar de denumirea metodei specificând operația ce se va realiza asupra conținutului respectiv:
</p>
<div class="table sectionedit4"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>DENUMIRE METODĂ</strong>  </th><th class="col1 centeralign">  <strong>DESCRIERE</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <strong><code>GET</code></strong> </td><td class="col1 leftalign"> descărcarea resursei specificate de pe serverul web pe client; majoritatea cererilor către un server web sunt de acest tip<br/>
<pre class="code">GET /page.html HTTP/1.1
Host: www.server.com
</pre>
</td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>HEAD</code> </td><td class="col1"> obținerea antetului unei pagini Internet, pentru a se verifica parametrii acesteia sau doar pentru a testa corectitudinea unui <abbr title="Uniform Resource Locator">URL</abbr> </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>PUT</code> </td><td class="col1"> încărcarea resursei specificate de pe client pe serverul web (cu suprascrierea acesteia, în cazul în care există deja); trebuie specificate și datele de autentificare, utilizatorul respectiv trebuind să aibă permisiunile necesare pentru o astfel de operașie </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <strong><code>POST</code></strong> </td><td class="col1"> transferul de informații de către client cu privire la resursa specificată, acestea urmând a fi prelucrate de serverul web<br/>
<pre class="code">POST /page.html HTTP/1.1
Host: www.server.com
attribute1=value1&amp;...&amp;attributen=valuen
</pre>
</td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>DELETE</code> </td><td class="col1"> ștergerea resursei specificate de pe serverul web, rezultatul operației depinzând de permisiunile pe care le deține utilizatorul ale cărui date de autentificare au fost transmise în antete </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>TRACE</code> </td><td class="col1"> solicitare de retransmitere a cererii primite de serverul web de la client, pentru a se testa corectitudinea acesteia </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>CONNECT</code> </td><td class="col1"> rezervat pentru o utilizare ulterioară </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>OPTIONS</code> </td><td class="col1"> interogare cu privire la atributele serverului web sau ale unei resurse găzduite de acesta </td>
	</tr>
</table></div>
<!-- EDIT4 TABLE [2243-3686] -->
<p>
<p><div class="noteimportant">Capitalizarea este importantă atunci când se precizează denumirea metodei folosite, făcându-se distincție între minuscule și majuscule.
</div></p>
</p>

<p>
Cel mai frecvent, se utilizează metodele <code>GET</code> (folosită implicit, dacă nu se specifică altfel) și <code>POST</code>.
</p>

</div>

<h4 id="get_vs_post">GET vs. POST</h4>
<div class="level4">

<p>
Deși atât metoda <code>GET</code> cât și metoda <code>POST</code> pot fi utilizate pentru descărcarea conținutului unei pagini Internet, transmițând către serverul web valorile unor anumite atribute, între acestea există anumite diferențe:
</p>
<ul>
<li class="level1"><div class="li"> o cerere <code>GET</code> poate fi reținută în cache, fapt ce nu este valabil și pentru o cerere <code>POST</code>;</div>
</li>
<li class="level1"><div class="li"> o cerere <code>GET</code> rămâne în istoricul aplicației de navigare, fapt ce nu este valabil și pentru o cerere <code>POST</code>;</div>
</li>
<li class="level1"><div class="li"> o cerere <code>GET</code> poate fi reținută printre paginile Internet favorite din cadrul programului de navigare, fapt ce nu este valabil și pentru o cerere <code>POST</code>;</div>
</li>
<li class="level1"><div class="li"> o cerere <code>GET</code> impune unele restricții cu privire la lungimea (maxim 2048 caractere) și la tipul de date (doar caractere <abbr title="American Standard Code for Information Interchange">ASCII</abbr>) transmise (prin <abbr title="Uniform Resource Locator">URL</abbr>), fapt ce nu este valabil și pentru o cerere <code>POST</code>;</div>
</li>
<li class="level1"><div class="li"> o cerere <code>GET</code> nu trebuie folosită atunci când sunt implicate informații critice (acestea fiind vizibile în <abbr title="Uniform Resource Locator">URL</abbr>), fapt ce nu este valabil și pentru o cerere <code>POST</code>;</div>
</li>
<li class="level1"><div class="li"> o cerere <code>GET</code> ar trebui să fie folosită doar pentru obținerea unei resurse, fapt ce nu este valabil și pentru o cerere <code>POST</code>.</div>
</li>
</ul>

</div>
<div class="level3">

<p>
O linie de cerere HTTP poate fi succedată de unele informații suplimentare, reprezentând <strong>antetele de cerere</strong>, acestea având forma <code>atribut:valoare</code>, fiind definite următoarele proprietăți:
</p>
<ul>
<li class="level1"><div class="li"> <code>User-Agent</code> - informații cu privire la browser-ul utilizat și la platforma pe care rulează acesta</div>
</li>
<li class="level1"><div class="li"> informații cu privire la conținutul pe care clientul îl dorește de la serverul web, având capacitatea de a-l procesa; dacă serverul poate alege dintre mai multe resurse pe care le găzduiește, va alege pe cele care respectă constrângerile specificate, altfel întoarce un cod de eroare</div>
<ul>
<li class="level2"><div class="li"> <code>Accept</code> - tipul MIME </div>
</li>
<li class="level2"><div class="li"> <code>Accept-Charset</code> - setul de caractere</div>
</li>
<li class="level2"><div class="li"> <code>Accept-Encoding</code> - mecanismul de codificare</div>
</li>
<li class="level2"><div class="li"> <code>Accept-Language</code> - limba</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>Host</code> (obligatoriu) - denumirea gazdei pe care se găsește resursa (specificată în <abbr title="Uniform Resource Locator">URL</abbr>); necesară întrucât o adresă IP poate fi asociată mai multor nume de <abbr title="Domain Name System">DNS</abbr></div>
</li>
<li class="level1"><div class="li"> <code>Authorization</code> - informații de autentificare în cazul unor operații care necesită drepturi privilegiate</div>
</li>
<li class="level1"><div class="li"> <code>Cookie</code> - transmite un cookie primit anterior</div>
</li>
<li class="level1"><div class="li"> <code>Date</code> - data și ora la care a fost transmisă cererea</div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Structura unei Cereri HTTP" [2023-6343] -->
<h3 class="sectionedit5" id="structura_unui_raspuns_http">Structura unui Răspuns HTTP</h3>
<div class="level3">

<p>
Un răspuns HTTP este format din linia de stare, antetele de răspuns și posibile informații suplimentare, conținând o parte sau toată resursa care a fost solicitată de client de pe serverul web.
</p>

<p>
În cadrul <strong>liniei de stare</strong> este inclus un cod din trei cifre care indică dacă solicitarea a putut fi îndeplinită sau nu (situație în care este indicată și cauza).
</p>
<div class="table sectionedit6"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>FAMILIE DE CODURI</strong>  </th><th class="col1 centeralign">  <strong>SEMNIFICAȚIE</strong>  </th><th class="col2 centeralign">  <strong>DESCRIERE</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1xx </td><td class="col1"> Informație </td><td class="col2"> răspuns provizoriu, constând din linia de stare și alte antete (fără conținut, terminat de o linie vidă), indicând faptul că cererea a fost primită, procesarea sa fiind încă în desfășurare; nu este utilizată în HTTP/1.0 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2xx </td><td class="col1"> Succes </td><td class="col2"> răspuns ce indică faptul că cererea a fost primită, înțeleasă, acceptată și procesată cu succes </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 3xx </td><td class="col1"> Redirectare </td><td class="col2"> răspuns transmis de serverul web ce indică faptul că trebuie realizate acțiuni suplimentare din partea clientului (cu sau fără interacțiunea utilizatorului, în funcție de metoda folosită) pentru ca cererea să poată fi îndeplinită; în cazul în care redirectarea se repetă de mai multe ori, se poate suspecta o buclă infinită </td>
	</tr>
	<tr class="row4">
		<td class="col0"> 4xx </td><td class="col1"> Eroare la client </td><td class="col2"> răspuns transmis de serverul web ce indică faptul că cererea nu a putut fi îndeplinită, datorită unei erori la nivelul clientului; mesajul include și o entitate ce conține o descriere a situației, inclusiv tipul acesteia (permanentă sau temporară) </td>
	</tr>
	<tr class="row5">
		<td class="col0"> 5xx </td><td class="col1"> Eroare la server </td><td class="col2"> cod de răspuns ce indică clientului faptul că cererea nu a putut fi îndeplinită, datorită unei erori la nivelul serverului web; mesajul include și o entitate ce conține o descriere a situației, inclusiv tipul acesteia (permanentă sau temporară) </td>
	</tr>
</table></div>
<!-- EDIT6 TABLE [6763-8156] -->
<p>
Mesajul conține și <strong>antetele de răspuns</strong>, având forma <code>atribut:valoare</code>, fiind definite următoarele proprietăți:
</p>
<ul>
<li class="level1"><div class="li"> <code>Server</code> - informații cu privire la mașina care găzduiește resursa care este transmisă</div>
</li>
<li class="level1"><div class="li"> informații cu privire la proprietățile conținutului care este transmis</div>
<ul>
<li class="level2"><div class="li"> <code>Content-Encoding</code> - mecanismul de codificare</div>
</li>
<li class="level2"><div class="li"> <code>Content-Language</code> - limba</div>
</li>
<li class="level2"><div class="li"> <code>Content-Length</code> - dimensiunea</div>
</li>
<li class="level2"><div class="li"> <code>Content-Type</code> - tipul MIME</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>Last-Modified</code> - ora și data la care pagina Internet a fost modificată</div>
</li>
<li class="level1"><div class="li"> <code>Location</code> - informație prin care serverul web informează clientul de faptul că ar trebui folosit alt <abbr title="Uniform Resource Locator">URL</abbr> (resursa a fost mutată sau trebuie accesată o pagină Internet localizată în funcție de anumite preferințe)</div>
</li>
<li class="level1"><div class="li"> <code>Accept-Ranges</code> - informație referitoare la transmiterea conținutului solicitat în mai multe părți, corespunzătoare unor intervale de octeți</div>
</li>
<li class="level1"><div class="li"> <code>Set-Cookie</code> - transmiterea unui cookie de la serverul web la client, acesta trebuind să fie inclus în antetele ulterioare ale mesajelor schimbate între cele două entități</div>
</li>
</ul>

</div>
<!-- EDIT5 SECTION "Structura unui Răspuns HTTP" [6344-9270] -->
<h2 class="sectionedit7" id="mecanisme_pentru_comunicatia_prin_http_in_android">Mecanisme pentru Comunicația prin HTTP în Android</h2>
<div class="level2">

</div>
<!-- EDIT7 SECTION "Mecanisme pentru Comunicația prin HTTP în Android" [9271-9335] -->
<h3 class="sectionedit8" id="clasa_httpurlconnection">Clasa HttpURLConnection</h3>
<div class="level3">

<p>
În Android, comunicația dintre un server web si un client poate fi gestionată prin intermediul clasei <a href="http://developer.android.com/reference/java/net/HttpURLConnection.html" class="urlextern" title="http://developer.android.com/reference/java/net/HttpURLConnection.html"  rel="nofollow">HttpURLConnection</a>, care pune la dispoziție aceleași funcționalități ca în cazul Java SE.
</p>

<p>
O aplicație ce utilizează această clasă presupune implementarea următoarelor etape:
</p>
<ol>
<li class="level1"><div class="li"> instanțierea unui obiect <a href="http://developer.android.com/reference/java/net/URL.html" class="urlextern" title="http://developer.android.com/reference/java/net/URL.html"  rel="nofollow">URL</a> prin intermediul căruia pot fi obținute informații cu privire la resursa respectivă (protocolul utilizat, mașina pe care se găsește resursa respectivă, portul pe care poate fi accesată, fișierul accesat, referința vizualizată):</div>
<ul>
<li class="level2"><div class="li"> <code>getProtocol()</code> - furnizează protocolul utilizat, în acest caz, <code>http</code>;</div>
</li>
<li class="level2"><div class="li"> <code>getHost()</code> - indică adresa mașinii care găzduiește resursa respectivă;</div>
</li>
<li class="level2"><div class="li"> <code>getPort()</code> - întoarce portul pe care s-a realizat comunicația:</div>
<ul>
<li class="level3"><div class="li"> valoarea -1 este specifică pentru situația în care nu s-a precizat un port în mod explicit;</div>
</li>
<li class="level3"><div class="li"> valoarea 80 este transmisă numai în cazul în care aceata este specificată ca atare în adresa furnizată.</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> <code>getFile()</code> - specifică calea de la care este obținută resursa;</div>
</li>
<li class="level2"><div class="li"> <code>getRef()</code> - precizează referința din cadrul paginii <abbr title="HyperText Markup Language">HTML</abbr> (de regulă, de tip ancoră) care a fost solicitată.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> deschiderea unei conexiuni, printr-un apel al metodei <code>openConnection()</code>; metoda întoarce un obiect de tip <code>URLConnection</code> care poate fi convertit la <code>HttpURLConnection</code> prin care se oferă acces la:</div>
<ul>
<li class="level2"><div class="li"> antetele de cerere: <code>setRequestMethod()</code>, <code>setRequestProperty(String, String)</code>;</div>
</li>
<li class="level2"><div class="li"> antetele de răspuns, inclusiv linia de stare: <code>getResponseCode()</code>, <code>getHeaderFields()</code>, <code>getResponseMessage()</code>;</div>
</li>
<li class="level2"><div class="li"> informații referitoare la mecanismele de gestiune a stării (cookie-uri) - în condițiile în care HTTP este un protocol fără stare; se utilizează clasele <a href="http://developer.android.com/reference/java/net/CookieManager.html" class="urlextern" title="http://developer.android.com/reference/java/net/CookieManager.html"  rel="nofollow">CookieManager</a>, <a href="http://developer.android.com/reference/java/net/CookieHandler.html" class="urlextern" title="http://developer.android.com/reference/java/net/CookieHandler.html"  rel="nofollow">CookieHandler</a>, care gestionează la nivelul întregii mașini virtuale obiectele de tipul <a href="http://developer.android.com/reference/java/net/HttpCookie.html" class="urlextern" title="http://developer.android.com/reference/java/net/HttpCookie.html"  rel="nofollow">HttpCookie</a>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> utilizarea unui flux de intrare / flux de ieșire pentru transferul de informații; se folosesc, obiectele / metodele:</div>
<ul>
<li class="level2"><div class="li"> <code>BufferedInputStream</code> / <code>getInputStream()</code>;</div>
</li>
<li class="level2"><div class="li"> <code>BufferedOutputStream</code> / <code>getOutputStream()</code> - în acest caz, trebuie apelată metoda <code>setDoOutput()</code> cu parametrul <code>true</code>, împreună cu metodele care evită reținerea conținutului într-o zonă tampon (consumând astfel memorie inutilă și având un impact asupra latenței):</div>
<ul>
<li class="level3"><div class="li"> <code>setFixedLengthStreamingMode()</code> - atunci când dimensiunea conținutului este cunoscută în prealabil;</div>
</li>
<li class="level3"><div class="li"> <code>setChunkedStreamingMode()</code> - atunci când dimensiunea conținutului nu este cunoscută</div>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"> închiderea conexiunii, prin intermediul metodei <code>disconnect()</code>, se face de regulă pe clauza <code>finally</code> a unui bloc <code>try-catch</code> pe care sunt gestionate operațiile ce implică comunicația prin rețea; scopul pentru care este utilizată aceasta metodă este dat de posibilitatea de reutilizare a resurselor folosite de conexiune (sockeți TCP), dacă proprietatea <code>http.keepAlive</code> nu specifică altfel.</div>
</li>
</ol>

<p>
<p><div class="noteclassic">Implicit, clasa <code>HttpURLConnection</code> folosește metoda <code>GET</code>. Metoda <code>POST</code> este utilizată numai în situația în care a fost apelată în prealabil metoda <code>setDoOutput(true)</code>.
</p>

<p>
Celelalte metode (<code>OPTIONS</code>, <code>HEAD</code>, <code>PUT</code>, <code>DELETE</code>, <code>TRACE</code>) pot fi utilizate numai în situația în care sunt specificate explicit ca parametru al funcției <code>setRequestMethod()</code>.

</div></p>
</p>
<pre class="code java"><span class="kw1">private</span> <span class="kw1">class</span> WebPageKeywordSearchAsyncTask <span class="kw1">extends</span> AsyncTask<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+void"><span class="kw3">Void</span></a>, String<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> doInBackground<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>... <span class="me1">params</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+httpurlconnection"><span class="kw3">HttpURLConnection</span></a> httpURLConnection <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
    StringBuilder result <span class="sy0">=</span> <span class="kw1">new</span> StringBuilder<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> error <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> webPageAddress <span class="sy0">=</span> params<span class="br0">&#91;</span><span class="nu0">0</span><span class="br0">&#93;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> keyword <span class="sy0">=</span> params<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>webPageAddress <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> webPageAddress.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        error <span class="sy0">=</span> <span class="st0">&quot;Web Page address cannot be empty&quot;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>keyword <span class="sy0">==</span> <span class="kw2">null</span> <span class="sy0">||</span> keyword.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        error <span class="sy0">=</span> <span class="st0">&quot;Keyword cannot be empty&quot;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>error <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> error<span class="sy0">;</span>
      <span class="br0">&#125;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+url"><span class="kw3">URL</span></a> url <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+url"><span class="kw3">URL</span></a><span class="br0">&#40;</span>webPageAddress<span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;Protocol: &quot;</span> <span class="sy0">+</span> url.<span class="me1">getProtocol</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;Host: &quot;</span> <span class="sy0">+</span> url.<span class="me1">getHost</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;Port: &quot;</span> <span class="sy0">+</span> url.<span class="me1">getPort</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;File: &quot;</span> <span class="sy0">+</span> url.<span class="me1">getFile</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;Reference: &quot;</span> <span class="sy0">+</span> url.<span class="me1">getRef</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">+</span> <span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;==========<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+urlconnection"><span class="kw3">URLConnection</span></a> urlConnection <span class="sy0">=</span> url.<span class="me1">openConnection</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>urlConnection <span class="kw1">instanceof</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+httpurlconnection"><span class="kw3">HttpURLConnection</span></a><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        httpURLConnection <span class="sy0">=</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+httpurlconnection"><span class="kw3">HttpURLConnection</span></a><span class="br0">&#41;</span>urlConnection<span class="sy0">;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a> bufferedReader <span class="sy0">=</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">getReader</span><span class="br0">&#40;</span>httpURLConnection<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw4">int</span> currentLineNumber <span class="sy0">=</span> <span class="nu0">0</span>, numberOfOccurrencies <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> currentLineContent<span class="sy0">;</span>
        <span class="kw1">while</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>currentLineContent <span class="sy0">=</span> bufferedReader.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          currentLineNumber<span class="sy0">++;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>currentLineContent.<span class="me1">contains</span><span class="br0">&#40;</span>keyword<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;line: &quot;</span> <span class="sy0">+</span> currentLineNumber <span class="sy0">+</span> <span class="st0">&quot; / &quot;</span> <span class="sy0">+</span> currentLineContent<span class="sy0">+</span><span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            numberOfOccurrencies<span class="sy0">++;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
        result.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;Number of occurrencies: &quot;</span> <span class="sy0">+</span> numberOfOccurrencies<span class="sy0">+</span><span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">return</span> result.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+malformedurlexception"><span class="kw3">MalformedURLException</span></a> malformedURLException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, malformedURLException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        malformedURLException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">finally</span> <span class="br0">&#123;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>httpURLConnection <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        httpURLConnection.<span class="me1">disconnect</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> <span class="kw2">null</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onPostExecute<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> result<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    resultsTextView.<span class="me1">setText</span><span class="br0">&#40;</span>result<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
<span class="br0">&#125;</span></pre>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/01webpagekeywordsearch.png%3Fw=400&amp;tok=aa38da" class="mediacenter" alt="" width="400" />
</p>

<p>
<p><div class="notewarning">Comunicația dintre serverul web și client trebuie să se realizeze pe un fir de execuție separat, în caz contrar fiind generată excepția <code>android.os.NetworkOnMainThreadException</code>.
</div></p>
</p>

<p>
<p><div class="noteimportant">În fișierul <code>AndroidManifest.xml</code> trebuie specificată permisiunea de acces la rețea:<br/>
<code>&lt;uses-permission android:name=“android.permission.INTERNET” /&gt;</code>.
</div></p>
</p>

<p>
O practică curentă este de a verifica codul de răspuns transmis de a accesa fluxul de intrare asociat resursei respective. Astfel, numai în situația în care valoarea întoarsă de metoda <code>getResponseCode()</code> este <code>HttpURLConnection.HTTP_OK</code> se poate continua procesarea conținutului stocat la <abbr title="Uniform Resource Locator">URL</abbr>-ul accesat.
</p>

</div>
<!-- EDIT8 SECTION "Clasa HttpURLConnection" [9336-16353] -->
<h3 class="sectionedit9" id="apache_http_components">Apache HTTP Components</h3>
<div class="level3">

<p>
<a href="https://hc.apache.org/" class="urlextern" title="https://hc.apache.org/"  rel="nofollow">Apache HTTP Components</a> este un proiect open-source, dezvoltat sub licență Apache, punând la dispoziția utilizatorilor o bibliotecă Java pentru accesarea de resurse prin intermediul protocolului HTTP. Funcționalitatea poate fi utilizată în cadrul oricărei mașini virtuale Java și era inclusă și în platforma Android până în <abbr title="Application Programming Interface">API</abbr> Level 23 (Marshmellow) <a href="http://developer.android.com/about/versions/marshmallow/android-6.0-changes.html#behavior-apache-http-client" class="urlextern" title="http://developer.android.com/about/versions/marshmallow/android-6.0-changes.html#behavior-apache-http-client"  rel="nofollow">când a fost exclusă</a>, fiind invocate probleme legate de compatibilitate pentru anumite platforme precum și utilizarea excesivă a rețelei cu impact asupra consumului de energie. În schimb, se recomandă utilizarea clasei HttpURLConnection care asigură compresia datelor (în mod transparent pentru utilizator!) precum și folosirea unui cache. Cu toate acestea, proiectul Apache HTTP Components este în continuă dezvoltare și folosit pe scară largă.
</p>

<p>
Componentele Apache HTTP Components sunt:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://hc.apache.org/httpcomponents-core-ga/index.html" class="urlextern" title="https://hc.apache.org/httpcomponents-core-ga/index.html"  rel="nofollow">HttpCore</a> este un set de componente de transport care pot fi utilizate pentru dezvoltarea de servicii robuste, la nivel de server și client; sunt implementate atât un model blocant pentru operații de intrare/ieșire (bazat pe <code>java.io</code>) cât și un model asincron, bazat pe evenimente (bazat pe <code>java.nio</code>);</div>
</li>
<li class="level1"><div class="li"> <a href="https://hc.apache.org/httpcomponents-client-ga/index.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/index.html"  rel="nofollow">HttpClient</a> este o implementare a unui agent compatibil cu HTTP/1.1 care oferă funcționalități pentru autentificare la nivel de client, pentru gestiunea stării și a conexiunii;</div>
</li>
<li class="level1"><div class="li"> <a href="https://hc.apache.org/httpcomponents-asyncclient-dev/index.html" class="urlextern" title="https://hc.apache.org/httpcomponents-asyncclient-dev/index.html"  rel="nofollow">HttpAsyncClient</a> este un modul complementar destinat situațiilor în care se dorește să se ofere suport pentru un număr mare de conexiuni concurente, parametrii precum nivelul de transfer al datelor nu sunt foarte importante.</div>
</li>
</ul>

<p>
Pentru ca metodele din <abbr title="Application Programming Interface">API</abbr>-ul Apache HTTP Components să poată fi utilizate într-o aplicație Android ce utilizează <abbr title="Application Programming Interface">API</abbr> Level este necesar să se specifice utilizarea bibliotecii corespunzătoare, în fișierul <code>build.gradle</code>:
</p>
<dl class="file">
<dt><a href="../../../code/eim/laboratoare/laborator07%3Fcodeblock=3" title="Download Snippet" class="mediafile mf_gradle">build.gradle</a></dt>
<dd><pre class="code file gradle">...
&nbsp;
android {
  compileSdkVersion 23
  buildToolsVersion &quot;23.0.2&quot;
&nbsp;
  useLibrary 'org.apache.http.legacy'
}
&nbsp;
...</pre>
</dd></dl>

<p>
Conform <abbr title="Application Programming Interface">API</abbr>-ului Apache HTTP Components, conexiunile HTTP sunt gestionate mai ales prin intermediul clasei <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpClient.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/HttpClient.html"  rel="nofollow">HttpClient</a>, care oferă suport complet pentru acest protocol de comunicație. Frecvent, ca implementare a acestei interfețe se utilizează <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/DefaultHttpClient.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/DefaultHttpClient.html"  rel="nofollow">DefaultHttpClient</a>.
</p>

<p>
Un astfel de obiect poate folosit pentru transmiterea unor cereri de tip <code>GET</code> (<a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/methods/HttpGet.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/methods/HttpGet.html"  rel="nofollow">HttpGet</a>) sau <code>POST</code> (<a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/methods/HttpPost.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/methods/HttpPost.html"  rel="nofollow">HttpPost</a>) și prelucrarea răspunsurilor corespunzătoare.
</p>

<p>
Metoda <code>GET</code> este folosită pentru obținerea conținutului unei pagini Internet stocată la o anumită adresă.
</p>

<p>
Pașii care trebuie urmați pentru realizarea unei astfel de cereri HTTP sunt:
</p>
<ol>
<li class="level1"><div class="li"> instanțierea unui obiect de tipul <code>HttpClient</code>;</div>
</li>
<li class="level1"><div class="li"> instanțierea unui obiect de tipul <code>HttpGet</code> având ca parametru adresa serverului web ce conține resursa care se dorește a fi descărcată;</div>
</li>
<li class="level1"><div class="li"> realizarea propriu-zisă a cererii HTTP prin apelul metodei <code>execute()</code> a obiectului <code>HttpClient</code>, ce primește ca parametru obiectul de tip <code>HttpGet</code> (încapsulând tipul metodei folosite și locația care va fi interogată).</div>
</li>
</ol>
<pre class="code java"><span class="kw1">try</span> <span class="br0">&#123;</span>
  HttpClient httpClient <span class="sy0">=</span> <span class="kw1">new</span> DefaultHttpClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  HttpGet httpGet <span class="sy0">=</span> <span class="kw1">new</span> HttpGet<span class="br0">&#40;</span><span class="st0">&quot;http://www.server.com&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  HttpResponse httpGetResponse <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpGet<span class="br0">&#41;</span><span class="sy0">;</span>
  HttpEntity httpGetEntity <span class="sy0">=</span> httpGetResponse.<span class="me1">getEntity</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>httpGetEntity <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>  
    <span class="co1">// do something with the response</span>
    Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, EntityUtils.<span class="me1">toString</span><span class="br0">&#40;</span>httpGetEntity<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>            
<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> exception<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, exception.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    exception.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
Alternativ, poate fi utilizat un obiect de tip <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/ResponseHandler.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/ResponseHandler.html"  rel="nofollow">ResponseHandler</a> (cu implementarea <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/BasicResponseHandler.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/impl/client/BasicResponseHandler.html"  rel="nofollow">BasicResponseHandler</a>) care va fi transmis ca parametru metodei <code>execute()</code>, astfel încât rezultatul acesteia să fie un șir de caractere conținând resursa care se dorește a fi descărcată.
</p>
<pre class="code java"><span class="co1">// ...</span>
ResponseHandler<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> responseHandler <span class="sy0">=</span> <span class="kw1">new</span> BasicResponseHandler<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> content <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpGet, responseHandler<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// ...</span></pre>

<p>
În situația în care se dorește transmiterea de parametri către serverul web, aceștia trebuie incluși în <abbr title="Uniform Resource Locator">URL</abbr> (în clar), fără a se depăși limita de 2048 de caractere și folosind numai caractere <abbr title="American Standard Code for Information Interchange">ASCII</abbr>:
</p>
<pre class="code java"><span class="co1">// ...</span>
HttpGet httpGet <span class="sy0">=</span> <span class="kw1">new</span> HttpGet<span class="br0">&#40;</span><span class="st0">&quot;http://www.server.com?attribute1=value1&amp;...&amp;attributen=valuen&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// ...</span></pre>

<p>
Metoda <code>POST</code> este folosită atunci când se dorește generarea unui conținut de către serverul web pe baza unor informații transmise de client. Aceste date - având forma unei liste de tip (atribut, valoare) - vor fi incluse în conținutul mesajului în loc de a fi integrate în cadrul <abbr title="Uniform Resource Locator">URL</abbr>-ului.
</p>

<p>
Pașii care trebuie urmați pentru realizarea unei astfel de cereri HTTP sunt:
</p>
<ol>
<li class="level1"><div class="li"> instanțierea unui obiect de tipul <code>HttpClient</code>;</div>
</li>
<li class="level1"><div class="li"> instanțierea unui obiect de tipul <code>HttpPost</code> având ca parametru adresa serverului web ce conține resursa care se dorește a fi descărcată;</div>
</li>
<li class="level1"><div class="li"> <strong>definirea unei liste de perechi de tip (atribut, valoare) (de tip <code>List&lt;NameValuePair&gt;</code>) care vor conține informațiile transmise de client pe baza cărora serverul web va genera conținutul</strong>;</div>
</li>
<li class="level1"><div class="li"> <strong>atașarea datelor respective la obiectul de tip <code>HttpPost</code> (apelând metoda <code>setEntity()</code>) prin intermediul unei entități <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/entity/UrlEncodedFormEntity.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/entity/UrlEncodedFormEntity.html"  rel="nofollow">UrlEncodedFormEntity</a> care primește ca parametru informațiile ce trebuie transmise și mecanismul de codificare a datelor</strong>;</div>
</li>
<li class="level1"><div class="li"> realizarea propriu-zisă a cererii HTTP prin apelul metodei <code>execute()</code> a obiectului <code>HttpClient</code>, ce primește ca parametru obiectul de tip <code>HttpPost</code> (încapsulând tipul metodei folosite, datele care se doresc a fi transmise și locația care va fi interogată).</div>
</li>
</ol>
<pre class="code java"><span class="kw1">try</span> <span class="br0">&#123;</span>
  HttpClient httpClient <span class="sy0">=</span> <span class="kw1">new</span> DefaultHttpClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>        
  HttpPost httpPost <span class="sy0">=</span> <span class="kw1">new</span> HttpPost<span class="br0">&#40;</span><span class="st0">&quot;http://www.server.com&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  List<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span> params <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>        
  params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span><span class="st0">&quot;attribute1&quot;</span>, <span class="st0">&quot;value1&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// ...</span>
  params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span><span class="st0">&quot;attributen&quot;</span>, <span class="st0">&quot;valuen&quot;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  UrlEncodedFormEntity urlEncodedFormEntity <span class="sy0">=</span> <span class="kw1">new</span> UrlEncodedFormEntity<span class="br0">&#40;</span>params, HTTP.<span class="me1">UTF_8</span><span class="br0">&#41;</span><span class="sy0">;</span>
  httpPost.<span class="me1">setEntity</span><span class="br0">&#40;</span>urlEncodedFormEntity<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  HttpResponse httpPostResponse <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpPost<span class="br0">&#41;</span><span class="sy0">;</span>  
  HttpEntity httpPostEntity <span class="sy0">=</span> httpPostResponse.<span class="me1">getEntity</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>  
  <span class="kw1">if</span> <span class="br0">&#40;</span>httpPostEntity <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// do something with the response</span>
    Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, EntityUtils.<span class="me1">toString</span><span class="br0">&#40;</span>httpPostEntity<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> exception<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, exception.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    exception.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
Prelucrarea unui răspuns HTTP se poate realiza:
</p>
<ul>
<li class="level1"><div class="li"> prin prelucrarea obiectului de tip <a href="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/entity/UrlEncodedFormEntity.html" class="urlextern" title="https://hc.apache.org/httpcomponents-client-ga/httpclient/apidocs/org/apache/http/client/entity/UrlEncodedFormEntity.html"  rel="nofollow">HttpEntity</a>, utilizând fluxuri de intrare/ieșire:<br/>
<pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a> bufferedReader <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
StringBuilder result <span class="sy0">=</span> <span class="kw1">new</span> StringBuilder<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">try</span> <span class="br0">&#123;</span>
  <span class="co1">// ...</span>
  bufferedReader <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+bufferedreader"><span class="kw3">BufferedReader</span></a><span class="br0">&#40;</span><span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+inputstreamreader"><span class="kw3">InputStreamReader</span></a><span class="br0">&#40;</span>httpEntity.<span class="me1">getContent</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw4">int</span> currentLineNumber <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> currentLineContent<span class="sy0">;</span>
  <span class="kw1">while</span> <span class="br0">&#40;</span><span class="br0">&#40;</span>currentLineContent <span class="sy0">=</span> bufferedReader.<span class="me1">readLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    currentLineNumber<span class="sy0">++;</span>
    result.<span class="me1">append</span><span class="br0">&#40;</span>currentLineNumber<span class="br0">&#41;</span>.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;: &quot;</span><span class="br0">&#41;</span>.<span class="me1">append</span><span class="br0">&#40;</span>currentLineContent<span class="br0">&#41;</span>.<span class="me1">append</span><span class="br0">&#40;</span><span class="st0">&quot;<span class="es0">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, result.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+exception"><span class="kw3">Exception</span></a> exception<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, exception.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    exception.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span> <span class="kw1">finally</span> <span class="br0">&#123;</span>
  <span class="kw1">if</span><span class="br0">&#40;</span>bufferedReader <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      bufferedReader.<span class="me1">close</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, exception.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> utilizând un obiect de tip <code>ResponseHandler</code>, ce furnizează conținutul resursei solicitate, transmis ca parametru al metodei <code>execute()</code> a clasei <code>HttpClient</code> (pe lângă obiectul <code>HttpGet|HttpPost</code>)</div>
</li>
</ul>

</div>
<!-- EDIT9 SECTION "Apache HTTP Components" [16354-25573] -->
<h3 class="sectionedit10" id="volley">Volley</h3>
<div class="level3">

<p>
<a href="http://developer.android.com/training/volley/index.html" class="urlextern" title="http://developer.android.com/training/volley/index.html"  rel="nofollow">Volley</a> este o bibliotecă open-source (disponibilă prin intermediul Android Open-Source Project) ce oferă facilități pentru interogarea de resurse disponibile prin intermediul protocolului HTTP.
</p>

<p>
Câteva dintre facilitățile puse la dispoziție de această platformă sunt:
</p>
<ol>
<li class="level1"><div class="li"> gestiune automată a cererilor (implementare sistem de priorități, posibilitate de manipulare a cererilor concurente, funcționalitate pentru anulare a unei cereri transmise anterior);</div>
</li>
<li class="level1"><div class="li"> utilizarea transparentă a unui sistem de caching implementat atât în memorie cât și pe discul local;</div>
</li>
<li class="level1"><div class="li"> posibilitatea de implementare a unor mecanisme specifice pentru retransmitere;</div>
</li>
<li class="level1"><div class="li"> implementarea de operații de tip RPC (Remote Procedure Call) executate asincron pentru popularea conținutului unor elemente din interfața grafică;</div>
</li>
<li class="level1"><div class="li"> utilitare pentru depanare.</div>
</li>
</ol>

<p>
Volley nu este adecvat pentru operații de intrare / ieșire intensive tocmai datorită sistemului de caching, conținutul resurselor solicitate fiind menținut în memorie în vederea realizării operației de procesare a acestuia.
</p>

<p>
Pentru utilizarea bibliotecii Volley este necesar să se realizeze următoarele operații:
</p>
<ol>
<li class="level1"><div class="li"> descărcarea codului sursă de la depozitul unde este întreținută <pre class="code">student@eim2016:~$ git clone https://android.googlesource.com/platform/frameworks/volley</pre>
</div>
</li>
<li class="level1"><div class="li"> referirea proiectului ca bibliotecă în Android Studio</div>
<ul>
<li class="level2"><div class="li"> <em>File</em> → <em>New</em> → <em>Import Module…</em> <img src="../../../../_media/eim/laboratoare/laborator07/02volleyandroidstudio.png" class="mediacenter" alt="" /></div>
</li>
<li class="level2"><div class="li"> indicarea locației la care au fost descărcate sursele în prelabil și o denumire a proiectului (tipic, <code>:volley</code>) sub care va fi referit </div>
</li>
<li class="level2"><div class="li"> specificarea dependenței față de acest proiect precum și faptul că este necesar ca acesta să fie compilat <dl class="file">
<dt><a href="../../../code/eim/laboratoare/laborator07%3Fcodeblock=10" title="Download Snippet" class="mediafile mf_gradle">build.gradle</a></dt>
<dd><pre class="code file gradle">...
dependencies {
  compile fileTree(dir: 'libs', include: ['*.jar'])
  testCompile 'junit:junit:4.12'
  compile 'com.android.support:appcompat-v7:23.1.1'
  compile 'com.android.support:design:23.1.1'
  compile project(':volley')
}</pre>
</dd></dl>
</div>
</li>
<li class="level2"><div class="li"> dacă pentru Volley se folosește <abbr title="Application Programming Interface">API</abbr> Level 23, este necesar să se utilizeze biblioteca <code>org.apache.http.legacy</code> întrucât implementarea sa utilizează Apache HTTP Components. <dl class="file">
<dt><a href="../../../code/eim/laboratoare/laborator07%3Fcodeblock=11" title="Download Snippet" class="mediafile mf_gradle">build.gradle</a></dt>
<dd><pre class="code file gradle">android {
  ...
  useLibrary 'org.apache.http.legacy'
  ...
}</pre>
</dd></dl>
</div>
</li>
</ul>
</li>
</ol>

<p>
Volley gestionează o structură de date <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/RequestQueue.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/RequestQueue.java"  rel="nofollow">RequestQueue</a> care are rolul de a controla modul în care sunt tratate cererile. Aceasta distribuie cererile care trebuie procesate concurent către firele de execuție care se ocupă de comunicația prin rețea, realizând de asemenea interogarea informațiilor care se regăsest în cache. Există două moduri în care poate fi construit un obiect de tip <code>RequestQueue</code>:
</p>
<ul>
<li class="level1"><div class="li"> <code>Volley.newRequestQueue(Context)</code> - construiește o coadă de cereri folosind implementările standard pentru implementarea mecanismului de cache și a comunicației prin rețea:</div>
<ol>
<li class="level2"><div class="li"> <code>DiskBasedCache</code>: pentru fiecare răspuns care a fost solicitat prin intermediul unei cereri se construiește un fișier dedicat, căruia îi corespunde un index stocat în memorie;</div>
</li>
<li class="level2"><div class="li"> <code>BasicNetwork</code>: implementează funcționalitate de transport folosind un client HTTP (tipic, un obiect <code>HttpURLConnection</code>);</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> <code>Volley.newRequestQueue(Cache, Network)</code> permite utilizarea unui mecanism de cache și a unei modalități de transmisie prin rețea ai căror comportament și parametri sunt definiți de utilizator.</div>
</li>
</ul>

<p>
O coadă de cereri implementează următoarele metode:
</p>
<ul>
<li class="level1"><div class="li"> <code>add()</code> - transmite o cerere care este inițial verificată de firul de execuție care verifică cache-ul astfel încât dacă răspunsul există stocat, va fi furnizat fără a se mai realiza comunicația prin reșea; în caz contrar, el va fi plasat în coada gestionată de firele de execuție responsabile de comunicația prin rețea, acesta fiind preluat în momentul în care unul dintre acestea devine disponibil;</div>
</li>
<li class="level1"><div class="li"> <code>cancel()</code> - anulează o cerere care a fost transmisă anterior, împiedicând să se obțină un răspuns pe baza sa (metoda este invocată pe obiectul <code>Request</code>);</div>
</li>
<li class="level1"><div class="li"> <code>cancelAll()</code> - anulează toate cererile care au atașată o anumită etichetă, specificată prin intermediul metodei <code>setTag()</code>; o astfel de abordare poate fi utilă atunci când o activitate nu mai este vizibilă (pe metoda <code>onStop()</code>) astfel încât să nu se mai proceseze răspunsuri care nu pot fi afișate; în acest fel, utilizatorul este scutit să verifice dacă instanța activității există sau nu pe metodele de callback apelate în mod automat în momentul în care resursa solicitată devine disponibilă sau în momentul în care s-a produs o excepție.</div>
</li>
</ul>

<p>
Este recomandat ca la nivelul unei aplicații Android care utilizează comunicația prin rețea folosind protocolul HTTP să se utilizeze o singură instanță a unui obiect de tip <code>RequestQueue</code> a cărui durată de viață se întinde pe întreaga perioadă de execuție. Abordarea cea mai adecvată este utilizarea unei clase Singleton care conține un obiect de tip <code>RequestQueue</code> precum și alte funcționalități Volley, dacă este necesar.
</p>
<dl class="file">
<dt><a href="../../../code/eim/laboratoare/laborator07%3Fcodeblock=12" title="Download Snippet" class="mediafile mf_java">VolleyController.java</a></dt>
<dd><pre class="code file java"><span class="kw1">import</span> <span class="co2">android.content.Context</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">import</span> <span class="co2">com.android.volley.Request</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">com.android.volley.RequestQueue</span><span class="sy0">;</span>
<span class="kw1">import</span> <span class="co2">com.android.volley.toolbox.Volley</span><span class="sy0">;</span>
&nbsp;
<span class="kw1">public</span> <span class="kw1">class</span> VolleyController <span class="br0">&#123;</span>
&nbsp;
  <span class="kw1">private</span> <span class="kw1">static</span> VolleyController instance<span class="sy0">;</span>
  <span class="kw1">private</span> <span class="kw1">static</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context<span class="sy0">;</span>
  <span class="kw1">private</span> RequestQueue requestQueue<span class="sy0">;</span>
&nbsp;
  <span class="kw1">private</span> VolleyController<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">this</span>.<span class="me1">context</span> <span class="sy0">=</span> context<span class="sy0">;</span>
    <span class="kw1">this</span>.<span class="me1">requestQueue</span> <span class="sy0">=</span> getRequestQueue<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">synchronized</span> VolleyController getInstance<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>instance <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      instance <span class="sy0">=</span> <span class="kw1">new</span> VolleyController<span class="br0">&#40;</span>context<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> instance<span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">public</span> RequestQueue getRequestQueue<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>requestQueue <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      requestQueue <span class="sy0">=</span> Volley.<span class="me1">newRequestQueue</span><span class="br0">&#40;</span>context.<span class="me1">getApplicationContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> requestQueue<span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">public</span> <span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="kw4">void</span> addToRequestQueue<span class="br0">&#40;</span>Request<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> request<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    getRequestQueue<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">add</span><span class="br0">&#40;</span>request<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
<p><div class="noteimportant">
Contextul transmis ca argument metodei <code>newRequestQueue()</code> trebuie să se refere la contextul aplicației, de accea se utilizează metoda <code>getApplicationContext()</code>.

</div></p>
</p>

<p>
Volley folosește mai multe fire de execuție:
</p>
<ol>
<li class="level1"><div class="li"> firul de execuție principal (al interfeței grafice), prin intermediul căruia este trimisă o cerere și pe care este primit răspunsul (pentru a fi vizualizat, de regulă, în cadrul interfeței grafice);</div>
</li>
<li class="level1"><div class="li"> firul de execuție responsabil cu implementarea mecanismului de caching, care verifică dacă există un răspuns pentru cerere, astfel încât să nu mai fie necesară comunicația prin rețea; în momentul în care este disponibil un răspuns pentru o cerere, aceasta este indexată tot de acest fir de execuție;</div>
</li>
<li class="level1"><div class="li"> mai multe fire de execuție care realizează comunicația prin rețea, care trimit o cerere și primesc un răspuns pe care îl procesează (operațiile de parsare sau codificare/decodificare necesită resurse și o perioadă de timp considerabilă).</div>
</li>
</ol>

<p>
O utilizare tipică Volley (algoritmul pe care îl utilizează această platformă) este următoarea:
</p>
<ol>
<li class="level1"><div class="li"> firul de execuție principal plasează o cerere în coadă</div>
</li>
<li class="level1"><div class="li"> firul de execuție responsabil cu implementarea mecanismului de caching verifică dacă există un răspuns pentru cerere</div>
<ol>
<li class="level2"><div class="li"> dacă răspunsul pentru cerere se află în cache</div>
<ol>
<li class="level3"><div class="li"> se citește răspunsul din cache</div>
</li>
<li class="level3"><div class="li"> se scrie rezultatul către firul de execuție principal</div>
</li>
</ol>
</li>
<li class="level2"><div class="li"> dacă răspunsul pentru cerere NU se află în cache</div>
<ol>
<li class="level3"><div class="li"> se transmite cerere în coadă</div>
</li>
<li class="level3"><div class="li"> un fir de execuție care realizează comunicația prin rețea trimite cererea, atunci când devine disponibil, preluând răspunsul</div>
<ol>
<li class="level4"><div class="li"> răspunsul este stocat în cache, după ce poate suferi procesări ulterioare (parsare, codificare/decodificare)</div>
</li>
<li class="level4"><div class="li"> se scrie rezultatul către firul de execuție principal</div>
</li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol>

<p>
Volley definește mai multe tipuri de cerere standard, în funcție de tipul de date pe care îl are resursa care va fi accesată prin intermediul protocolului HTTP:
</p>
<ol>
<li class="level1"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/StringRequest.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/StringRequest.java"  rel="nofollow">StringRequest</a> furnizează un rezultat de tip șir de caractere, în orice format, folosind un mecanism de codificare;</div>
</li>
<li class="level1"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/ImageRequest.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/ImageRequest.java"  rel="nofollow">ImageRequest</a> întoarce o resursă de tip imagine, disponibilă la o anumită locație (<abbr title="Uniform Resource Locator">URL</abbr>), aceasta fiind transmisă sub formă de bitmap decodificat (și posibil redimensionat, dacă se solicită acest lucru); operațiile costisitoare sunt realizate de firele de execuție responsabile de comunicația prin rețea;</div>
<ol>
<li class="level2"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/ImageLoader.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/ImageLoader.java"  rel="nofollow">ImageLoader</a> oferă funcționalitatea de gestiune a cache-ului, care este stocat în memorie (dacă s-ar fi utilizat discul local, ar fi existat un impact asupra firului de execuție principal), transmițând mai multe resurse la un moment dat;</div>
</li>
<li class="level2"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/NetworkImageView.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/NetworkImageView.java"  rel="nofollow">NetworkImageView</a> reprezintă un tip de element al interfeței grafice, specializat pentru resurse de tip imagine disponibilă la o locație la distanță, accesibilă prin intermediul comunicației în rețea.</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonRequest.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonRequest.java"  rel="nofollow">JsonRequest</a> suportă două implementări:</div>
<ol>
<li class="level2"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonObjectRequest.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonObjectRequest.java"  rel="nofollow">JsonObjectRequest</a></div>
</li>
<li class="level2"><div class="li"> <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonArrayRequest.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/toolbox/JsonArrayRequest.java"  rel="nofollow">JsonArrayRequest</a></div>
</li>
</ol>
</li>
</ol>

<p>
În situația în care se dorește implementarea unui tip de cerere definită de utilizator, trebuie să se respecte câteva condiții:
</p>
<ul>
<li class="level1"><div class="li"> clasa trebuie să fie derivată din <a href="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/Request.java" class="urlextern" title="https://android.googlesource.com/platform/frameworks/volley/+/master/src/main/java/com/android/volley/Request.java"  rel="nofollow">Request&lt;T&gt;</a>;</div>
</li>
<li class="level1"><div class="li"> clasa trebuie să implementeze metodele:</div>
<ul>
<li class="level2"><div class="li"> <code>parseNetworkResponse(NetworkResponse)</code> care construiește rezultatul (<code>Response.success()</code>, respectiv <code>Response.error()</code>) în funcție de răspunsul primit;</div>
</li>
<li class="level2"><div class="li"> <code>deliverResponse(T)</code> care apelează metoda de callback (<code>onResponse(T)</code>) atunci când răspunsul este disponibil.</div>
</li>
</ul>
</li>
</ul>
<dl class="file">
<dt><a href="../../../code/eim/laboratoare/laborator07%3Fcodeblock=13" title="Download Snippet" class="mediafile mf_java">CustomJSONRequest.java</a></dt>
<dd><pre class="code file java"><span class="kw1">public</span> <span class="kw1">class</span> CustomRequest<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="kw1">extends</span> Request<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp;
  <span class="kw1">private</span> Map<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, String<span class="sy0">&gt;</span> params<span class="sy0">;</span>
  <span class="kw1">private</span> Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> responseListener<span class="sy0">;</span>
  <span class="kw1">private</span> Response.<span class="me1">ErrorListener</span> errorListener<span class="sy0">;</span>
  <span class="kw1">private</span> Class<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> classType<span class="sy0">;</span>
&nbsp;
  <span class="kw1">public</span> CustomRequest<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> url, Map<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, String<span class="sy0">&gt;</span> params, Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> responseListener, Response.<span class="me1">ErrorListener</span> errorListener, Class<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> classType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">this</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+method"><span class="kw3">Method</span></a>.<span class="me1">GET</span>, url, params, responseListener, errorListener, classType<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="kw1">public</span> CustomRequest<span class="br0">&#40;</span><span class="kw4">int</span> method, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> url, Map<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, String<span class="sy0">&gt;</span> params, Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> responseListener, Response.<span class="me1">ErrorListener</span> errorListener, Class<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> classType<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">super</span><span class="br0">&#40;</span>method, url, errorListener<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">this</span>.<span class="me1">params</span> <span class="sy0">=</span> params<span class="sy0">;</span>
    <span class="kw1">this</span>.<span class="me1">responseListener</span> <span class="sy0">=</span> responseListener<span class="sy0">;</span>
    <span class="kw1">this</span>.<span class="me1">errorListener</span> <span class="sy0">=</span> errorListener<span class="sy0">;</span>
    <span class="kw1">this</span>.<span class="me1">classType</span> <span class="sy0">=</span> classType<span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> Map<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, String<span class="sy0">&gt;</span> getParams<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="kw1">throws</span> AuthFailureError <span class="br0">&#123;</span>
    <span class="kw1">return</span> params<span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> Response<span class="sy0">&lt;</span>T<span class="sy0">&gt;</span> parseNetworkResponse<span class="br0">&#40;</span>NetworkResponse networkResponse<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> response <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a><span class="br0">&#40;</span>networkResponse.<span class="me1">data</span>, HttpHeaderParser.<span class="me1">parseCharset</span><span class="br0">&#40;</span>networkResponse.<span class="me1">headers</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>classType.<span class="me1">equals</span><span class="br0">&#40;</span>JSONObject.<span class="kw1">class</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> Response.<span class="me1">success</span><span class="br0">&#40;</span><span class="br0">&#40;</span>T<span class="br0">&#41;</span><span class="kw1">new</span> JSONObject<span class="br0">&#40;</span>response<span class="br0">&#41;</span>, HttpHeaderParser.<span class="me1">parseCacheHeaders</span><span class="br0">&#40;</span>networkResponse<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>classType.<span class="me1">equals</span><span class="br0">&#40;</span>JSONArray.<span class="kw1">class</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">return</span> Response.<span class="me1">success</span><span class="br0">&#40;</span><span class="br0">&#40;</span>T<span class="br0">&#41;</span><span class="kw1">new</span> JSONArray<span class="br0">&#40;</span>response<span class="br0">&#41;</span>, HttpHeaderParser.<span class="me1">parseCacheHeaders</span><span class="br0">&#40;</span>networkResponse<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      <span class="kw1">return</span> <span class="kw2">null</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+unsupportedencodingexception"><span class="kw3">UnsupportedEncodingException</span></a> unsupportedEncodingException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">return</span> Response.<span class="me1">error</span><span class="br0">&#40;</span><span class="kw1">new</span> ParseError<span class="br0">&#40;</span>unsupportedEncodingException<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>JSONException jsonException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">return</span> Response.<span class="me1">error</span><span class="br0">&#40;</span><span class="kw1">new</span> ParseError<span class="br0">&#40;</span>jsonException<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> <span class="kw4">void</span> deliverResponse<span class="br0">&#40;</span>T jsonObject<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    responseListener.<span class="me1">onResponse</span><span class="br0">&#40;</span>jsonObject<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> deliverError<span class="br0">&#40;</span>VolleyError volleyError<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    errorListener.<span class="me1">onErrorResponse</span><span class="br0">&#40;</span>volleyError<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
Pentru definirea unui obiect de tip <code>Request</code> este necesar să se precizeze următoarele elemente:
</p>
<ul>
<li class="level1"><div class="li"> metoda folosită pentru transmiterea cererii, definită de <code>Request.Method</code>;</div>
</li>
<li class="level1"><div class="li"> locația (<abbr title="Uniform Resource Locator">URL</abbr>-ul) la care se găsește resursa care se dorește să fie accesată prin protocolul HTTP;</div>
</li>
<li class="level1"><div class="li"> parametrii cererii;</div>
</li>
<li class="level1"><div class="li"> metodele de callback</div>
<ul>
<li class="level2"><div class="li"> <code>Response.Listener&lt;T&gt;</code>:</div>
<ul>
<li class="level3"><div class="li"> invocată în mod automat în situația în care răspunsul este disponibil;</div>
</li>
<li class="level3"><div class="li"> trebuie să implementeze metoda <code>onResponse(T)</code>;</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> <code>ErrorListener</code>:</div>
<ul>
<li class="level3"><div class="li"> invocată în mod automat în situația în care s-a produs o eroare;</div>
</li>
<li class="level3"><div class="li"> trebuie să implementeze metoda <code>onErrorResponse(VolleyError)</code>.</div>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="code java">Map<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, String<span class="sy0">&gt;</span> parameters <span class="sy0">=</span> <span class="kw1">new</span> HashMap<span class="sy0">&lt;&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
parameters.<span class="me1">put</span><span class="br0">&#40;</span>Constants.<span class="me1">USERNAME_ATTRIBUTE</span>, senderUsername<span class="br0">&#41;</span><span class="sy0">;</span>
CustomRequest<span class="sy0">&lt;</span>JSONArray<span class="sy0">&gt;</span> customRequest <span class="sy0">=</span> <span class="kw1">new</span> CustomRequest<span class="br0">&#40;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+request"><span class="kw3">Request</span></a>.<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+method"><span class="kw3">Method</span></a>.<span class="me1">POST</span>,
  Constants.<span class="me1">USER_LIST_WEB_SERVICE_ADDRESS</span>,
  parameters,
  <span class="kw1">new</span> Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>JSONArray<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> onResponse<span class="br0">&#40;</span>JSONArray response<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">try</span> <span class="br0">&#123;</span>
        <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> position <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> position <span class="sy0">&lt;</span> response.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> position<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          JSONObject user <span class="sy0">=</span> response.<span class="me1">getJSONObject</span><span class="br0">&#40;</span>position<span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw1">final</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> recipientId <span class="sy0">=</span> user.<span class="me1">get</span><span class="br0">&#40;</span>Constants.<span class="me1">USER_ID_ATTRIBUTE</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw1">final</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> recipientUsername <span class="sy0">=</span> user.<span class="me1">get</span><span class="br0">&#40;</span>Constants.<span class="me1">USERNAME_ATTRIBUTE</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          contact <span class="sy0">=</span> <span class="br0">&#40;</span>RelativeLayout<span class="br0">&#41;</span>inflater.<span class="me1">inflate</span><span class="br0">&#40;</span>R.<span class="me1">layout</span>.<span class="me1">contact</span>, <span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
          TextView usernameTextView <span class="sy0">=</span> <span class="br0">&#40;</span>TextView<span class="br0">&#41;</span>contact.<span class="me1">findViewById</span><span class="br0">&#40;</span>R.<span class="me1">id</span>.<span class="me1">username_text_view</span><span class="br0">&#41;</span><span class="sy0">;</span>
          usernameTextView.<span class="me1">setText</span><span class="br0">&#40;</span>recipientUsername<span class="br0">&#41;</span><span class="sy0">;</span>
          <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+button"><span class="kw3">Button</span></a> writeMessageButton <span class="sy0">=</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+button"><span class="kw3">Button</span></a><span class="br0">&#41;</span>contact.<span class="me1">findViewById</span><span class="br0">&#40;</span>R.<span class="me1">id</span>.<span class="me1">write_message_button</span><span class="br0">&#41;</span><span class="sy0">;</span>
          contactsList.<span class="me1">addView</span><span class="br0">&#40;</span>contact<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
      <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>JSONException jsonException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, jsonException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          jsonException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>,
  <span class="kw1">new</span> Response.<span class="me1">ErrorListener</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> onErrorResponse<span class="br0">&#40;</span>VolleyError volleyError<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Snackbar.<span class="me1">make</span><span class="br0">&#40;</span>contactsTextView, getResources<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getString</span><span class="br0">&#40;</span>R.<span class="me1">string</span>.<span class="me1">an_error_has_occurred</span><span class="br0">&#41;</span>, Snackbar.<span class="me1">LENGTH_LONG</span><span class="br0">&#41;</span>
              .<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>,
  JSONArray.<span class="kw1">class</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
VolleyController.<span class="me1">getInstance</span><span class="br0">&#40;</span>getActivity<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getApplicationContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">addToRequestQueue</span><span class="br0">&#40;</span>customRequest<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<!-- EDIT10 SECTION "Volley" [25574-40958] -->
<h2 class="sectionedit11" id="prelucrare_dom_document_object_model">Prelucrare DOM (Document Object Model)</h2>
<div class="level2">

<p>
Documentele <abbr title="HyperText Markup Language">HTML</abbr> au o structură arborescentă, având drept rădăcină un document al cărui copil este o ierarhie de elemente, fiecare dintre acestea fiind reprezentate de o etichetă.
</p>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/ierarhie_document_html.png%3Fw=900&amp;tok=a3511b" class="mediacenter" alt="" width="900" />
</p>

<p>
Fiecare element poate conține mai multe atribute (fiecare dintre acestea având o valoare asociată), putând încorpora și o valoare.
</p>

<p>
<code>&lt;TipElement atribut1=“valoare1” … atributn=“valoaren”&gt; valoare &lt;/TipElement&gt;</code>
</p>

<p>
Nu este însă obligatoriu ca elementul să conțină nici atribute și nici valoare, putând avea și o structură care nu le include:
</p>

<p>
<code>&lt;TipElement /&gt;</code>
</p>

<p>
O soluție pentru parsarea unui document <abbr title="HyperText Markup Language">HTML</abbr> este reprezentată de biblioteca <a href="http://jsoup.org/packages/jsoup-1.8.2.jar" class="urlextern" title="http://jsoup.org/packages/jsoup-1.8.2.jar"  rel="nofollow">Jsoup</a>.
</p>

<p>
<p><div class="noteimportant">Biblioteca <code>jsoup-1.8.2.jar</code> trebuie plasată în directorul <code>libs</code> al proiectului Android și adăugată la calea pentru compilare (<em>Build Path</em> → <em>Add to Build Path…</em>).
</div></p>
</p>

<p>
Prin intermediul metodei statice <a href="http://jsoup.org/apidocs/org/jsoup/Jsoup.html#parse(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/Jsoup.html#parse(java.lang.String)"  rel="nofollow">parse()</a> ce primește ca parametru conținutul resursei care se dorește a fi analizată (codul sursă al paginii <abbr title="HyperText Markup Language">HTML</abbr>), se obține un obiect <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html"  rel="nofollow">Document</a>, care permite parcurgerea ierarhiei de elemente.
</p>

<p>
Pentru un obiect de tipul <code>org.jsoup.nodes.Document</code>, pot fi obținute secțiunile componente <code>&lt;head&gt;</code> și <code>&lt;meta&gt;</code> prin intermediul metodelor <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html#head()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html#head()"  rel="nofollow">head()</a>, respectiv <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html#body()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Document.html#body()"  rel="nofollow">body()</a>.
</p>

<p>
Fiecare etichetă din codul sursă corespunzător unei pagini <abbr title="HyperText Markup Language">HTML</abbr> este reprezentat de un obiect <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html"  rel="nofollow">Element</a>, prin intermediul căruia pot fi accesate toate atributele și valorile asociate acestora.
</p>

<p>
<p><div class="noteclassic">Inclusiv nodul rădăcină (de tip <code>org.jsoup.nodes.Document</code>) este derivat din <code>org.jsoup.nodes.Element</code>.
</div></p>
</p>

<p>
Pentru un element, pot fi realizate următoarele operații:
</p>
<ul>
<li class="level1"><div class="li"> obținerea (listei) unor elemente componente:</div>
<ul>
<li class="level2"><div class="li"> deținând un anumit identificator - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementById(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementById(java.lang.String)"  rel="nofollow">getElementById(String id)</a>;</div>
</li>
<li class="level2"><div class="li"> care au o anumită etichetă - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByTag(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByTag(java.lang.String)"  rel="nofollow">getElementsByTag(String tag)</a>;</div>
</li>
<li class="level2"><div class="li"> ce fac parte din cadrul unei clase - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByClass(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByClass(java.lang.String)"  rel="nofollow">getElementsByClass(String className)</a>;</div>
</li>
<li class="level2"><div class="li"> în funcție de o proprietate:</div>
<ul>
<li class="level3"><div class="li"> pentru care se precizează atributul</div>
<ul>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttribute(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttribute(java.lang.String)"  rel="nofollow">getElementsByAttribute(String key)</a>; </div>
</li>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeStarting(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeStarting(java.lang.String)"  rel="nofollow">getElementsByAttributeStarting(String keyPrefix)</a>;</div>
</li>
</ul>
</li>
<li class="level3"><div class="li"> pentru care se precizează valoarea</div>
<ul>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueStarting(java.lang.String, java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueStarting(java.lang.String, java.lang.String)"  rel="nofollow">getElementsByAttributeValueStarting(String key, String valuePrefix)</a></div>
</li>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueContaining(java.lang.String, java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueContaining(java.lang.String, java.lang.String)"  rel="nofollow">getElementsByAttributeValueContaining(String key, String match)</a></div>
</li>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueEnding(java.lang.String, java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueEnding(java.lang.String, java.lang.String)"  rel="nofollow">getElementsByAttributeValueEnding(String key, String valueSuffix)</a></div>
</li>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueMatching(java.lang.String, java.util.regex.Pattern)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueMatching(java.lang.String, java.util.regex.Pattern)"  rel="nofollow">getElementsByAttributeValueMatching(String key, Pattern pattern)</a></div>
</li>
<li class="level4"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueMatching(java.lang.String, java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValueMatching(java.lang.String, java.lang.String)"  rel="nofollow">getElementsByAttributeValueMatching(String key, String regex)</a>;</div>
</li>
</ul>
</li>
<li class="level3"><div class="li"> pentru care se precizează atât atributul cât și valoarea - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValue(java.lang.String, java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValue(java.lang.String, java.lang.String)"  rel="nofollow">getElementsByAttributeValue(String key, String value)</a>.</div>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"> navigare în cadrul ierarhiei de elemente:</div>
<ul>
<li class="level2"><div class="li"> obținerea elementului părinte: <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#parent()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#parent()"  rel="nofollow">parent()</a>; în situația în care se dorește obținerea tuturor elementelor părinte (până la rădăcină), se poate folosi metoda <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#parents()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#parents()"  rel="nofollow">parents()</a>;</div>
</li>
<li class="level2"><div class="li"> obținerea elementelor copii: <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#children()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#children()"  rel="nofollow">children()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#child(int)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#child(int)"  rel="nofollow">child(int index)</a> - numerotarea făcându-se în acest caz începând cu 0.</div>
</li>
<li class="level2"><div class="li"> obținerea elementelor de pe același nivel: <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#siblingElements()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#siblingElements()"  rel="nofollow">siblingElements()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#firstElementSibling()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#firstElementSibling()"  rel="nofollow">firstElementSibling()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#lastElementSibling()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#lastElementSibling()"  rel="nofollow">lastElementSibling()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#nextElementSibling()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#nextElementSibling()"  rel="nofollow">nextElementSibling()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#previousElementSibling()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#previousElementSibling()"  rel="nofollow">previousElementSibling()</a>;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> investigarea unor informații cu privire la proprietăți:</div>
<ul>
<li class="level2"><div class="li"> identificatorul - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#id()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#id()"  rel="nofollow">id()</a>;</div>
</li>
<li class="level2"><div class="li"> eticheta - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#tag()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#tag()"  rel="nofollow">tag()</a>, <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#tagName()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#tagName()"  rel="nofollow">tagName()</a>;</div>
</li>
<li class="level2"><div class="li"> clasa / clasele - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#className()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#className()"  rel="nofollow">className()</a> / <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#classNames()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#classNames()"  rel="nofollow">classNames()</a>;</div>
</li>
<li class="level2"><div class="li"> atribut:</div>
<ul>
<li class="level3"><div class="li"> lista tuturor atributelor - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/TextNode.html#attributes()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/TextNode.html#attributes()"  rel="nofollow">attributes()</a>;</div>
</li>
<li class="level3"><div class="li"> valoarea asociată unui anumit atribut - <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#attr(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#attr(java.lang.String)"  rel="nofollow">attribute(String attributeKey)</a>;</div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> textul conținut, din care sunt eliminate caracterele albe, acesta fiind totodată normalizat: <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#text()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#text()"  rel="nofollow">text()</a>;</div>
</li>
<li class="level2"><div class="li"> datele, pentru etichetele <code>&lt;script&gt;</code>, respectiv <code>&lt;style&gt;</code> - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#data()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#data()"  rel="nofollow">data()</a>.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> actualizarea codului sursă corespunzător paginii <abbr title="HyperText Markup Language">HTML</abbr>:</div>
<ul>
<li class="level2"><div class="li"> înainte de element:</div>
<ul>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prepend(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prepend(java.lang.String)"  rel="nofollow">prepend(String html)</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependText(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependText(java.lang.String)"  rel="nofollow">prependText(String text)</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependElement(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependElement(java.lang.String)"  rel="nofollow">prependElement(String tagName)</a></div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> după element:</div>
<ul>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#append(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#append(java.lang.String)"  rel="nofollow">append(String html)</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendText(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendText(java.lang.String)"  rel="nofollow">appendText(String text)</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendElement(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendElement(java.lang.String)"  rel="nofollow">appendElement(String tagName)</a></div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> lista copiilor unui element:</div>
<ul>
<li class="level3"><div class="li"> înainte - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependChild(org.jsoup.nodes.Node)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#prependChild(org.jsoup.nodes.Node)"  rel="nofollow">prependChild(Node child)</a></div>
</li>
<li class="level3"><div class="li"> după - <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendChild(org.jsoup.nodes.Node)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#appendChild(org.jsoup.nodes.Node)"  rel="nofollow">appendChild(Node child)</a></div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> prin specificarea conținutului său <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#html(java.lang.String)" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#html(java.lang.String)"  rel="nofollow">html(String html)</a></div>
</li>
</ul>
</li>
</ul>

<p>
Unele dintre metode ce furnizează liste de elemente întorc rezultate de tipul <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/select/Elements.html"  rel="nofollow">Elements</a>, care nu este altceva decât un vector de elemente (fiind derivat din <code>ArrayList&lt;Element&gt;</code>), ce poate fi iterat (prin intermediul metodei <a href="http://docs.oracle.com/javase/1.5.0/docs/api/java/util/List.html#iterator()" class="urlextern" title="http://docs.oracle.com/javase/1.5.0/docs/api/java/util/List.html#iterator()"  rel="nofollow">iterator()</a>). De asemenea, pot fi obținute referințe către primul, respectiv ultimul element din listă prin intermediul metodelor <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#first()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#first()"  rel="nofollow">first()</a>, respectiv <a href="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#last()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/select/Elements.html#last()"  rel="nofollow">last()</a>.
</p>

</div>
<!-- EDIT11 SECTION "Prelucrare DOM (Document Object Model)" [40959-49637] -->
<h3 class="sectionedit12" id="exemplu">Exemplu</h3>
<div class="level3">

<p>
Se dorește listarea disciplinelor pentru care materialele didactice sunt disponibile pe platforma <a href="../../../../../courses.1.html" class="urlextern" title="http://ocw.cs.pub.ro/courses"  rel="nofollow">Open CourseWare</a>, vizualizându-se, pentru fiecare dintre acestea, pictograma asociată și denumirea disciplinei de învățământ.
</p>

<p>
În acest sens, se obține codul sursă al paginii <abbr title="HyperText Markup Language">HTML</abbr> corespunzător, inspectându-se elementele care conțin informațiile care se doresc a fi afișate:
</p>
<ul>
<li class="level1"><div class="li"> adresa la care este stocată pictograma fiecărei discipline este conținută într-un element <code>&lt;img&gt;</code> care are specific atributul <code>class</code> având valoarea <code>mediaright</code>, accesarea ei putând fi realizată prin intermediul proprietății <code>src</code>;</div>
</li>
<li class="level1"><div class="li"> denumirea cursului este afișată folosind caractere îngroșate, fiind încapsulată în cadrul elementului <code>&lt;strong&gt;</code> … <code>&lt;/strong&gt;</code>.</div>
</li>
</ul>

<p>
Conținutul paginii Internet, sub forma unui obiect <code>org.jsoup.nodes.Element</code>, se obține prin apelul metodei statice <code>parse()</code> din clasa <code>org.jsoup.Jsoup</code> pe șirul de caractere ce conține codul sursă, după care elementul rădăcină (<code>&lt;html&gt;</code>) este accesat ca fiind unicul descendent direct: 
</p>
<pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> htmlTag <span class="sy0">=</span> Jsoup.<span class="me1">parse</span><span class="br0">&#40;</span>pageSourceCode<span class="br0">&#41;</span>.<span class="me1">child</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Lista tuturor elementelor care conțin adresele la care sunt găzduite pictogramele disciplinelor de învâțământ se obține printr-o filtrare, dorindu-se reținerea acelor etichete pentru care atributul <code>class</code> are valoarea <code>mediaright</code>. Colecția astfel generată este iterată element cu element, obținându-se apoi valoarea atributului <code>src</code>. După ce se cunoaște adresa Internet la care se găsește imaginea respectivă, se descarcă fluxul de intrare asociat, acesta fiind decodificat într-un obiect <code>Bitmap</code> (după ce sunt realizate și alte operații, cum ar fi scalarea și aplicarea transparenței).
</p>
<pre class="code java">Elements imgTagsClassMediaright <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">CLASS_ATTRIBUTE</span>, Constants.<span class="me1">MEDIARIGHT_VALUE</span><span class="br0">&#41;</span><span class="sy0">;</span>
Iterator<span class="sy0">&lt;</span>Element<span class="sy0">&gt;</span> logoIterator <span class="sy0">=</span> imgTagsClassMediaright.<span class="me1">iterator</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">while</span> <span class="br0">&#40;</span>logoIterator.<span class="me1">hasNext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> imgTagClassMediaRight <span class="sy0">=</span> logoIterator.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> logoAddress <span class="sy0">=</span> Constants.<span class="me1">OCW_BASE_INTERNET_ADDRESS</span> <span class="sy0">+</span> imgTagClassMediaRight.<span class="me1">attr</span><span class="br0">&#40;</span>Constants.<span class="me1">SRC_ATTRIBUTE</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>

<p>
Lista tuturor denumirilor aferente obiectelor de studiu poate fi accesată tot printr-o filtrare, menținându-se doar etichetele de tipul <code>&lt;strong&gt;</code> … <code>&lt;/strong&gt;</code>. Pentru fiecare dintre acestea se preia textul propriu pe care îl conțin.
</p>
<pre class="code java">Elements strongTags <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByTag</span><span class="br0">&#40;</span>Constants.<span class="me1">STRONG_TAG</span><span class="br0">&#41;</span><span class="sy0">;</span>
Iterator<span class="sy0">&lt;</span>Element<span class="sy0">&gt;</span> nameIterator <span class="sy0">=</span> strongTags.<span class="me1">iterator</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">while</span> <span class="br0">&#40;</span>nameIterator.<span class="me1">hasNext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> strongTag <span class="sy0">=</span> nameIterator.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> name <span class="sy0">=</span> strongTag.<span class="me1">ownText</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>

<p>
Informațiile astfel obținute vor fi stocate într-un obiect de tip adaptor asociat unei liste în cadrul căreia vor fi afișate.
</p>

<p>
Ca în cazul altor operații care implică procesări prin rețea și actualizarea controalelor grafice pe baza datelor care au fost procesate în acest mod, trebuie respectate următoarele reguli:
</p>
<ul>
<li class="level1"><div class="li"> comunicația prin rețea se face pe un fir de execuție separat;</div>
</li>
<li class="level1"><div class="li"> accesul la elementele din interfața grafică este permisă numai din contextul firului de execuție dedicat, cel care este proprietarul acestora.</div>
</li>
</ul>
<pre class="code java"><span class="kw1">private</span> <span class="kw1">class</span> OCWCoursesDisplayerAsyncTask <span class="kw1">extends</span> AsyncTask<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+void"><span class="kw3">Void</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+void"><span class="kw3">Void</span></a>, List<span class="sy0">&lt;</span>OCWCourseInformation<span class="sy0">&gt;&gt;</span> <span class="br0">&#123;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> List<span class="sy0">&lt;</span>OCWCourseInformation<span class="sy0">&gt;</span> doInBackground<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+void"><span class="kw3">Void</span></a>... <span class="me1">params</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    HttpClient httpClient <span class="sy0">=</span> <span class="kw1">new</span> DefaultHttpClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    HttpGet httpGet <span class="sy0">=</span> <span class="kw1">new</span> HttpGet<span class="br0">&#40;</span>Constants.<span class="me1">OCW_BASE_INTERNET_ADDRESS</span> <span class="sy0">+</span> Constants.<span class="me1">OCW_REFFERRENCE_INTERNET_ADDRESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
    ResponseHandler<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> responseHandler <span class="sy0">=</span> <span class="kw1">new</span> BasicResponseHandler<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    List<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> logoAddressesList <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">int</span> logoAddressesListSize <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    List<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> coursesNameList <span class="sy0">=</span> <span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+arraylist"><span class="kw3">ArrayList</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">int</span> coursesNameListSize <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    List<span class="sy0">&lt;</span>OCWCourseInformation<span class="sy0">&gt;</span> ocwCourseInformationList <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw4">int</span> courseInformationListSize <span class="sy0">=</span> <span class="sy0">-</span><span class="nu0">1</span><span class="sy0">;</span>
    <span class="kw1">try</span> <span class="br0">&#123;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> pageSourceCode <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpGet, responseHandler<span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+document"><span class="kw3">Document</span></a> document <span class="sy0">=</span> Jsoup.<span class="me1">parse</span><span class="br0">&#40;</span>pageSourceCode<span class="br0">&#41;</span><span class="sy0">;</span>
      <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> htmlTag <span class="sy0">=</span> document.<span class="me1">child</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span>
      Elements imgTagsClassMediaRight <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">CLASS_ATTRIBUTE</span>, Constants.<span class="me1">MEDIA_RIGHT_VALUE</span><span class="br0">&#41;</span><span class="sy0">;</span>
      Iterator<span class="sy0">&lt;</span>Element<span class="sy0">&gt;</span> logoIterator <span class="sy0">=</span> imgTagsClassMediaRight.<span class="me1">iterator</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">while</span> <span class="br0">&#40;</span>logoIterator.<span class="me1">hasNext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> imgTagClassMediaRight <span class="sy0">=</span> logoIterator.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        logoAddressesList.<span class="me1">add</span><span class="br0">&#40;</span>Constants.<span class="me1">OCW_BASE_INTERNET_ADDRESS</span> <span class="sy0">+</span> imgTagClassMediaRight.<span class="me1">attr</span><span class="br0">&#40;</span>Constants.<span class="me1">SRC_ATTRIBUTE</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      Elements strongTags <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByTag</span><span class="br0">&#40;</span>Constants.<span class="me1">STRONG_TAG</span><span class="br0">&#41;</span><span class="sy0">;</span>
      Iterator<span class="sy0">&lt;</span>Element<span class="sy0">&gt;</span> nameIterator <span class="sy0">=</span> strongTags.<span class="me1">iterator</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">while</span> <span class="br0">&#40;</span>nameIterator.<span class="me1">hasNext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> strongTag <span class="sy0">=</span> nameIterator.<span class="me1">next</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        coursesNameList.<span class="me1">add</span><span class="br0">&#40;</span>strongTag.<span class="me1">ownText</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
      logoAddressesListSize <span class="sy0">=</span> logoAddressesList.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      coursesNameListSize <span class="sy0">=</span> coursesNameList.<span class="me1">size</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>logoAddressesListSize <span class="sy0">==</span> coursesNameListSize<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        courseInformationListSize <span class="sy0">=</span> logoAddressesListSize<span class="sy0">;</span> <span class="co1">// = coursesNameListSize</span>
        <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> index <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> index <span class="sy0">&lt;</span> courseInformationListSize<span class="sy0">;</span> index<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          OCWCourseInformation ocwCourseInformation <span class="sy0">=</span> <span class="kw1">new</span> OCWCourseInformation<span class="br0">&#40;</span>logoAddressesList.<span class="me1">get</span><span class="br0">&#40;</span>index<span class="br0">&#41;</span>, coursesNameList.<span class="me1">get</span><span class="br0">&#40;</span>index<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          ocwCourseInformationList.<span class="me1">add</span><span class="br0">&#40;</span>ocwCourseInformation<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
        <span class="kw1">return</span> ocwCourseInformationList<span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span>ClientProtocolException clientProtocolException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, clientProtocolException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        clientProtocolException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> <span class="kw2">null</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onPostExecute<span class="br0">&#40;</span>List<span class="sy0">&lt;</span>OCWCourseInformation<span class="sy0">&gt;</span> ocwCourseInformationList<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw1">final</span> OCWCourseInformation ocwCourseInformation<span class="sy0">:</span> ocwCourseInformationList<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      ImageRequest profilePhotoRequest <span class="sy0">=</span> <span class="kw1">new</span> ImageRequest<span class="br0">&#40;</span>
        ocwCourseInformation.<span class="me1">getLogoLocation</span><span class="br0">&#40;</span><span class="br0">&#41;</span>,
        <span class="kw1">new</span> Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>Bitmap<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          @Override
          <span class="kw1">public</span> <span class="kw4">void</span> onResponse<span class="br0">&#40;</span>Bitmap bitmap<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            ocwCourseContentList.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> OCWCourseContent<span class="br0">&#40;</span>bitmap, ocwCourseInformation.<span class="me1">getName</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            ocwCourseListAdapter.<span class="me1">notifyDataSetChanged</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>,
        Constants.<span class="me1">LOGO_WIDTH</span>,
        Constants.<span class="me1">LOGO_HEIGHT</span>,
        <span class="kw2">null</span>,
        Bitmap.<span class="me1">Config</span>.<span class="me1">RGB_565</span>,
        <span class="kw1">new</span> Response.<span class="me1">ErrorListener</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          <span class="kw1">public</span> <span class="kw4">void</span> onErrorResponse<span class="br0">&#40;</span>VolleyError volleyError<span class="br0">&#41;</span> <span class="br0">&#123;</span>
            Log.<span class="me1">d</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, volleyError.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
              Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>ocwCoursesListView.<span class="me1">getContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, ocwCoursesListView.<span class="me1">getResources</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getString</span><span class="br0">&#40;</span>R.<span class="me1">string</span>.<span class="me1">an_error_has_occurred</span><span class="br0">&#41;</span>, Toast.<span class="me1">LENGTH_LONG</span><span class="br0">&#41;</span>
                   .<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="br0">&#125;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
      <span class="br0">&#41;</span><span class="sy0">;</span>
      VolleyController.<span class="me1">getInstance</span><span class="br0">&#40;</span>ocwCoursesListView.<span class="me1">getContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">addToRequestQueue</span><span class="br0">&#40;</span>profilePhotoRequest<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/03ocwcoursesdisplayer.png%3Fw=400&amp;tok=58fd31" class="mediacenter" alt="" width="400" />
</p>

</div>
<!-- EDIT12 SECTION "Exemplu" [49638-56944] -->
<h2 class="sectionedit13" id="prelucrare_json_javascript_object_notation_-_optional">Prelucrare JSON (JavaScript Object Notation) - opțional</h2>
<div class="level2">

<p>
Unele servicii web folosesc <a href="http://en.wikipedia.org/wiki/JSON" class="urlextern" title="http://en.wikipedia.org/wiki/JSON"  rel="nofollow">formatul JSON</a> pentru transferul de date întrucât, spre diferență de XML care implică numeroase informații suplimentare, acesta optimizează cantitatea de date implicate. De asemenea, este foarte ușor pentru un utilizator uman să prelucreze informațiile reprezentate într-un astfel de format.
</p>

<p>
Acest mecanism de reprezentare a datelor a fost utilizat inițial în JavaScript, unde acesta descria literali sau obiecte anonime, folosite o singură dată (fără posibilitatea de a fi reutilizate), informațiile fiind transmise prin intermediul unor șiruri de caractere. Ulterior, a fost preliat pe scară largă.
</p>

<p>
În principiu, informațiile reprezentate în format JSON au structura unei colecții de perechi de tip (cheie, valoare), fiecare dintre acestea fiind grupate într-o listă de obiecte ordonate. Nu se folosesc denumiri de etichete, utilizându-se doar caracterele <code>”</code>, <code>,</code>, <code>{</code>, <code>}</code>, <code>[</code> și <code>]</code>.
</p>
<pre class="code json">[
  {
    &quot;attribute1&quot;: &quot;value11&quot;,
    &quot;attribute2&quot;: &quot;value12&quot;,
    ...,
    &quot;attributen&quot;: &quot;value1n&quot;
  },
  {
    &quot;attribute1&quot;: &quot;value21&quot;,
    &quot;attribute2&quot;: &quot;value22&quot;,
    ...,
    &quot;attributen&quot;: &quot;value2n&quot;
  },
  ...
  {
    &quot;attribute1&quot;: &quot;valuem1&quot;,
    &quot;attribute2&quot;: &quot;valuem2&quot;,
    ...,
    &quot;attributen&quot;: &quot;valuemn&quot;
  }  
]</pre>

<p>
În Android este suportat formatul JSON strict, așa cum este descris pe <a href="http://json.org/" class="urlextern" title="http://json.org/"  rel="nofollow">http://json.org/</a>:
</p>
<ul>
<li class="level1"><div class="li"> denumirile de atribute trebuie să se găsească între ghilimele;</div>
</li>
<li class="level1"><div class="li"> valorile de tip șir de caractere trebuie să se găsească între ghilimele (nu sunt permise apostroafele în acest caz).</div>
</li>
</ul>

<p>
Potrivit <a href="https://www.ietf.org/rfc/rfc4627.txt" class="urlextern" title="https://www.ietf.org/rfc/rfc4627.txt"  rel="nofollow">RFC 4627</a>, tipul MIME al documentelor reprezentate în format JSON treuie să fie în mod necesar <code>application/json</code>.
</p>

<p>
Există <a href="http://www.programmableweb.com/category/all/apis?data_format=21173" class="urlextern" title="http://www.programmableweb.com/category/all/apis?data_format=21173"  rel="nofollow">numeroase servicii web</a> care își expun funcționalitatea prin intermediul unor documente JSON:
</p>
<ul>
<li class="level1"><div class="li"> <a href="https://developers.google.com/custom-search/json-api/v1/overview?csw=1" class="urlextern" title="https://developers.google.com/custom-search/json-api/v1/overview?csw=1"  rel="nofollow">Google</a>;</div>
</li>
<li class="level1"><div class="li"> <a href="https://developer.yahoo.com/" class="urlextern" title="https://developer.yahoo.com/"  rel="nofollow">Yahoo</a>;</div>
</li>
<li class="level1"><div class="li"> <a href="http://www.geonames.org/export/web-services.html" class="urlextern" title="http://www.geonames.org/export/web-services.html"  rel="nofollow">Geonames</a>;</div>
</li>
<li class="level1"><div class="li"> <a href="https://dev.twitter.com/" class="urlextern" title="https://dev.twitter.com/"  rel="nofollow">Twitter</a>;</div>
</li>
<li class="level1"><div class="li"> <a href="https://www.flickr.com/services/api/" class="urlextern" title="https://www.flickr.com/services/api/"  rel="nofollow">Flickr</a>.</div>
</li>
</ul>

<p>
În Android, prelucrarea documentelor reprezentate în format JSON este realizată prin intermediul clasei <a href="http://developer.android.com/reference/org/json/JSONObject.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html"  rel="nofollow">JSONObject</a> care a fost integrată parțial (cu unele funcționalități lipsă), fără a se specifica clar versiunea care este utilizată.
</p>

<p>
Un document JSON poate fi construit în mai multe moduri:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28%29"  rel="nofollow">JSONObject()</a> - construiește un obiect JSON vid, care nu conține nici o asociere (atribut, valoare);</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28java.util.Map%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28java.util.Map%29"  rel="nofollow">JSONObject(Map copyFrom)</a> - contruiește un obiect JSON pe baza unor asocieri prealabile; o astfel de metodă este utilizată mai ales în situația în care se dorește să se transmită informații către un serviciu web;</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28java.lang.String%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28java.lang.String%29"  rel="nofollow">JSONObject(String json)</a> - construiește un obiect JSON prin parsarea unui șir de caractere; o astfel de metodă este utilizată mai ales în situația în care sunt primite informații de la un serviciu web, care trebuie să fie prelucrate;</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28org.json.JSONTokener%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28org.json.JSONTokener%29"  rel="nofollow">JSONObject(JSONTokener readFrom)</a> - construiește un obiect JSON pe baza valorii următoare disponibile în cadrul unui obiect <a href="http://developer.android.com/reference/org/json/JSONTokener.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONTokener.html"  rel="nofollow">JSONTokener</a>;</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28org.json.JSONObject,%20java.lang.String[]%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#JSONObject%28org.json.JSONObject,%20java.lang.String[]%29"  rel="nofollow">JSONObject(JSONObject copyFrom, String[] names)</a> - construiește un obiect JSON prin filtrarea asocierilor existente într-un obiect <code>JSONObject</code>, pe baza unor denumiri de atribute existente.</div>
</li>
</ul>

<p>
De regulă, metodele care operează cu obiecte JSON pot genera excepția <a href="http://developer.android.com/reference/org/json/JSONException.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONException.html"  rel="nofollow">JSONException</a> în situația în care sunt întâlnite documente care nu sunt bine formate.
</p>

<p>
<p><div class="notewarning">În Android nu este implementată metoda <code>JSONObject(Bean bean)</code> care permite construirea unui obiect JSON pe baza unei componente Java Bean.
</div></p>
</p>

<p>
Gestiunea obiectelor JSON se face:
</p>
<ul>
<li class="level1"><div class="li"> pentru citire, prin intermediul metodelor de tip <a href="http://developer.android.com/reference/org/json/JSONObject.html#get%28java.lang.String%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#get%28java.lang.String%29"  rel="nofollow">get(String name)</a>, care furnizează un obiect generic (de tip <code>Object</code>), aceasta fiind supraîncărcată și pentru tipurile <code>boolean</code>, <code>double</code>, <code>int</code>, <code>long</code>, <code>String</code>, <code>JSONObject</code>, <code>JSONArray</code>;</div>
</li>
<li class="level1"><div class="li"> pentru scriere, prin intermediul metodelor de tip <a href="http://developer.android.com/reference/org/json/JSONObject.html#put%28java.lang.String,%20java.lang.Object%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#put%28java.lang.String,%20java.lang.Object%29"  rel="nofollow">put(String name, Object value)</a>, care furnizeză un rezultat de tip <code>JSONObject</code>, existând și implementări specifice pentru tipurile <code>boolean</code>, <code>double</code>, <code>int</code>, <code>long</code>.</div>
</li>
</ul>

<p>
Verificarea faptului că un document JSON deține un anumit atribut se face prin invocarea metodei <a href="http://developer.android.com/reference/org/json/JSONObject.html#has%28java.lang.String%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#has%28java.lang.String%29"  rel="nofollow">has(String name)</a>. Funcționalitatea inversă este furnizată de metoda <a href="http://developer.android.com/reference/org/json/JSONObject.html#isNull%28java.lang.String%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#isNull%28java.lang.String%29"  rel="nofollow">isNull(String name)</a>, aceasta verificând și dacă valoarea asociată atributului respectiv este <code>null</code>.
</p>

<p>
Dimensiunea unui obiect <code>JSONObject</code>, reprezentat sub forma numărului de asocieri de tip (cheie, valoare) este furnizat de metoda <a href="http://developer.android.com/reference/org/json/JSONObject.html#length%28%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#length%28%29"  rel="nofollow">length()</a>.
</p>

<p>
Reprezentarea unui obiect JSON sub forma unui șir de caractere poate fi obținută prin intermediul metodelor:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#toString%28%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#toString%28%29"  rel="nofollow">toString()</a> - formă compactă;</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#toString%28%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#toString%28%29"  rel="nofollow">toString(int indentSpaces)</a> - formă utilizată în scop de depanare.</div>
</li>
</ul>

<p>
Unele metode furnizează vectori de obiecte JSON, reprezentate de clasa <a href="http://developer.android.com/reference/org/json/JSONArray.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONArray.html"  rel="nofollow">JSONArray</a>, în care accesul la obiecte se face indexat, începând cu 0:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#names%28%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#names%28%29"  rel="nofollow">names()</a> - lista numelor dintr-un obiect JSON;</div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/reference/org/json/JSONObject.html#toJSONArray%28org.json.JSONArray%29" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html#toJSONArray%28org.json.JSONArray%29"  rel="nofollow">toJSONArray(JSONArray names)</a> - lista valorilor asociate unor atribute dintr-un vector de obiecte JSON.</div>
</li>
</ul>

</div>
<!-- EDIT13 SECTION "Prelucrare JSON (JavaScript Object Notation) - opțional" [56945-63951] -->
<h3 class="sectionedit14" id="exemplu1">Exemplu</h3>
<div class="level3">

<p>
Se dorește să se implementeze o aplicație Android care să afișeze informații cu privire la cutremurele care s-au produs într-un anumit areal geografic (desemnat prin coordonatele nord, sud, est, vest) pe baza rezultatelor furnizate de serviciul web <a href="http://api.geonames.org/earthquakesJSON" class="urlextern" title="http://api.geonames.org/earthquakesJSON"  rel="nofollow">Geonames Earthquakes</a>.
</p>

<p>
Detaliile care se doresc a fi vizualizate pentru fiecare cutremur în parte sunt:
</p>
<ul>
<li class="level1"><div class="li"> așezarea geografică (latitudinea și longitudinea);</div>
</li>
<li class="level1"><div class="li"> magnitudinea;</div>
</li>
<li class="level1"><div class="li"> adâncimea la care a avut loc;</div>
</li>
<li class="level1"><div class="li"> sursa informației;</div>
</li>
<li class="level1"><div class="li"> data și ora la care s-a înregistrat.</div>
</li>
</ul>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/04earthquakelister.png%3Fw=400&amp;tok=f4261d" class="mediacenter" alt="" width="400" />
</p>

<p>
Adresa Internet la care este disponibil rezultatul în format JSON trebuie să specifice în mod necesar informațiile cu privire la coordonatele punctelor cardinale, precum și cu privire la numele de utilizator:
</p>
<ul>
<li class="level1"><div class="li"> <code>north</code>, <code>south</code>, <code>east</code>, <code>west</code> - valoarea coordonatelor corespunzătoare punctelor cardinale, exprimate ca numere reale, cu semn;</div>
</li>
<li class="level1"><div class="li"> <code>username</code> - denumirea utilizatorului care deține drepturi de acces asupra acestui serviciu web (în cazul de față, <code>pdsd</code>).</div>
</li>
</ul>

<p>
<strong>Exemplu</strong>. O adresă Internet de la care pot fi accesate rezultate în format JSON este: <a href="http://api.geonames.org/earthquakesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=eim2016" class="urlextern" title="http://api.geonames.org/earthquakesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=eim2016"  rel="nofollow">http://api.geonames.org/earthquakesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=eim2016</a>.
</p>

<p>
Rezultatele sunt furnizate în următorul format:
</p>
<pre class="code json">{
  &quot;earthquakes&quot;:[
                  {
                    &quot;eqid&quot;:&quot;c0001xgp&quot;,
                    &quot;magnitude&quot;:8.8,
                    &quot;lng&quot;:142.369,
                    &quot;src&quot;:&quot;us&quot;,
                    &quot;datetime&quot;:&quot;2011-03-11 04:46:23&quot;,
                    &quot;depth&quot;:24.4,
                    &quot;lat&quot;:38.322
                  },
                  {
                    &quot;eqid&quot;:&quot;c000905e&quot;,
                    &quot;magnitude&quot;:8.6,
                    &quot;lng&quot;:93.0632,
                    &quot;src&quot;:&quot;us&quot;,
                    &quot;datetime&quot;:&quot;2012-04-11 06:38:37&quot;,
                    &quot;depth&quot;:22.9,
                    &quot;lat&quot;:2.311
                  },
                  ...
                ]
}</pre>

<p>
Astfel, informațiile care trebuie preluate din rezultat sunt:
</p>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  atribut JSON  </th><th class="col1 centeralign">  tip de date  </th><th class="col2 centeralign">  detaliu  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>lat</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> latitudine </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>lng</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> longitudine </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>magnitude</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> magnitudinea </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>depth</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> adâncimea </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>src</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> sursa informației </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>datetime</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> data și ora la care s-au înregistrat datele </td>
	</tr>
</table></div>
<!-- EDIT15 TABLE [66124-66457] -->
<p>
Prin urmare, pașii care trebuie urmați pentru implementarea funcționalității sunt:
</p>
<ol>
<li class="level1"><div class="li"> construirea <abbr title="Uniform Resource Locator">URL</abbr>-ului, prin atașarea informațiilor preluate de la utilizator (coordonatele punctelor cardinale);</div>
</li>
<li class="level1"><div class="li"> execuția unei cereri HTTP;</div>
</li>
<li class="level1"><div class="li"> parsarea documentului JSON corespunzător răspunsului HTTP; <pre class="code java"><span class="kw1">final</span> ArrayList<span class="sy0">&lt;</span>EarthquakeInformation<span class="sy0">&gt;</span> earthquakeInformationList <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>EarthquakeInformation<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
JSONObject result <span class="sy0">=</span> <span class="kw1">new</span> JSONObject<span class="br0">&#40;</span>content<span class="br0">&#41;</span><span class="sy0">;</span>
JSONArray jsonArray <span class="sy0">=</span> result.<span class="me1">getJSONArray</span><span class="br0">&#40;</span>Constants.<span class="me1">EARTHQUAKES</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> k <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> k <span class="sy0">&lt;</span> jsonArray.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> k<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  JSONObject jsonObject <span class="sy0">=</span> jsonArray.<span class="me1">getJSONObject</span><span class="br0">&#40;</span>k<span class="br0">&#41;</span><span class="sy0">;</span>
  earthquakeInformationList.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> EarthquakeInformation<span class="br0">&#40;</span>
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">LATITUDE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">LONGITUDE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">MAGNITUDE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">DEPTH</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">SOURCE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">DATETIME</span><span class="br0">&#41;</span>
  <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> atașarea informațiilor obținute în cadrul unui control grafic de tip listă.</div>
</li>
</ol>

</div>
<!-- EDIT14 SECTION "Exemplu" [63952-67525] -->
<h2 class="sectionedit16" id="activitate_de_laborator">Activitate de Laborator</h2>
<div class="level2">

<p>
<strong>1.</strong> În contul Github personal, să se creeze un depozit denumit &#039;Laborator07&#039;. Inițial, acesta trebuie să fie gol (nu trebuie să bifați nici adăugarea unui fișier <code>README.md</code>, nici a fișierului <code>.gitignore</code> sau a a fișierului <code>LICENSE</code>).
</p>

<p>
<strong>2.</strong> Să se cloneze în directorul de pe discul local conținutul depozitului la distanță de la <a href="https://www.github.com/eim2016/Laborator07" class="urlextern" title="https://www.github.com/eim2016/Laborator07"  rel="nofollow">https://www.github.com/eim2016/Laborator07</a>. 
</p>

<p>
În urma acestei operații, directorul Laborator07 va trebui să se conțină directoarele <code>labtasks</code>, <code>samples</code> și <code>solutions</code>. 
</p>
<pre class="code">student@eim2016:~$ git clone https://www.github.com/eim2016/Laborator07</pre>

<p>
<strong>3.</strong> Să se încarce conținutul descărcat în cadrul depozitului &#039;Laborator07&#039; de pe contul Github personal. 
</p>
<pre class="code">student@eim2016:~$ cd Laborator07
student@eim2016:~/Laborator07$ git remote add Laborator07_perfectstudent https://github.com/perfectstudent/Laborator07
student@eim2016:~/Laborator07$ git push Laborator07_perfectstudent master</pre>

<p>
<strong>4.</strong> Să se importe în mediul integrat de dezvoltare preferat (Android Studio / Eclipse) proiectul <code>CalculatorWebService</code> din directorul <code>labtasks</code>.
</p>

<p>
Se cere să se implementeze un calculator, care suportă operațiile de adunare/scădere/înmulțire/împărțire a două numere reale, pe baza rezultatului furnizat de un serviciu web, accesibil prin HTTP, la adresele Internet specificate în interfața <code>Constants</code>, pentru fiecare dintre metodele suportate pentru transmiterea informațiilor:
</p>
<ul>
<li class="level1"><div class="li"> <code>GET</code>: <code>Constants.GET_WEB_SERVICE_ADDDRESS</code></div>
</li>
<li class="level1"><div class="li"> <code>POST</code>: <code>Constants.POST_WEB_SERVICE_ADDRESS</code></div>
</li>
</ul>

<p>
Cele două numere reale sunt specificate în cadrul unor câmpuri text. În situația în care unul dintre acestea nu este precizat, se va afișa un mesaj de eroare corespunzător.
</p>

<p>
Operația care se dorește a fi efectuată precum și metoda prin care vor fi transmise informațiile către serviciul web vor putea fi selectate prin intermediul unor liste.
</p>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/05calculatorwebservice.png%3Fw=400&amp;tok=c55327" class="mediacenter" alt="" width="400" />
</p>

<p>
Parametrii ce trebuie incluși în cadrul cererii HTTP sunt:
</p>
<pre class="code">operation = addition|substraction|multiplication|division
operator1 = număr real
operator2 = număr real</pre>

<p>
Exemple:
</p>
<ul>
<li class="level1"><div class="li"> <code>GET</code><br/>
<pre class="code java">HttpGet httpGet <span class="sy0">=</span> <span class="kw1">new</span> HttpGet<span class="br0">&#40;</span>Constants.<span class="me1">GET_WEB_SERVICE_ADDRESS</span>
                              <span class="sy0">+</span> <span class="st0">&quot;?&quot;</span> <span class="sy0">+</span> Constants.<span class="me1">OPERATION_ATTRIBUTE</span> <span class="sy0">+</span> <span class="st0">&quot;=&quot;</span> <span class="sy0">+</span> operationsSpinner.<span class="me1">getSelectedItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
                              <span class="sy0">+</span> <span class="st0">&quot;&amp;&quot;</span> <span class="sy0">+</span> Constants.<span class="me1">OPERATOR1_ATTRIBUTE</span> <span class="sy0">+</span> <span class="st0">&quot;=&quot;</span> <span class="sy0">+</span> operator1
                              <span class="sy0">+</span> <span class="st0">&quot;&amp;&quot;</span> <span class="sy0">+</span> Constants.<span class="me1">OPERATOR2_ATTRIBUTE</span> <span class="sy0">+</span> <span class="st0">&quot;=&quot;</span> <span class="sy0">+</span> operator2<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> <code>POST</code><br/>
<pre class="code java">HttpPost httpPost <span class="sy0">=</span> <span class="kw1">new</span> HttpPost<span class="br0">&#40;</span>Constants.<span class="me1">POST_WEB_SERVICE_ADDRESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
List<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span> params <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>        
params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">OPERATION_ATTRIBUTE</span>, operationsSpinner.<span class="me1">getSelectedItem</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">OPERATOR1_ATTRIBUTE</span>, operator1<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
params.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">OPERATOR2_ATTRIBUTE</span>, operator2<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">try</span> <span class="br0">&#123;</span>
  UrlEncodedFormEntity urlEncodedFormEntity <span class="sy0">=</span> <span class="kw1">new</span> UrlEncodedFormEntity<span class="br0">&#40;</span>params, HTTP.<span class="me1">UTF_8</span><span class="br0">&#41;</span><span class="sy0">;</span>
  httpPost.<span class="me1">setEntity</span><span class="br0">&#40;</span>urlEncodedFormEntity<span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+unsupportedencodingexception"><span class="kw3">UnsupportedEncodingException</span></a> unsupportedEncodingException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, unsupportedEncodingException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    unsupportedEncodingException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>						
<span class="br0">&#125;</span></pre>
</div>
</li>
</ul>

<p>
În cadrul unui câmp text va putea fi vizualizat răspunsul HTTP furnizat de serviciul web.
</p>

<p>
<strong>5.</strong>  Să se importe în mediul integrat de dezvoltare preferat (Android Studio / Eclipse) proiectul <code>XkcdCartoonDisplayer</code> din directorul <code>labtasks</code>.
</p>

<p>
Se cere să se implementeze o aplicație Android care afișează, într-un control grafic de tip <code>ImageView</code>, cea mai recentă caricatură de pe pagina Internet <a href="http://www.xkcd.com" class="urlextern" title="http://www.xkcd.com"  rel="nofollow">xkcd</a>. De asemenea, va putea fi vizualizat titlul acestei caricaturi, adresa Internet la care aceasta poate fi accesată precum și butoane de legătură către caricatura precedentă, respectiv caricatura următoare (în situația în care aceasta există).
</p>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/06xkcdcartoondisplayer.png%3Fw=400&amp;tok=460195" class="mediacenter" alt="" width="400" />
</p>

<p>
Pentru realizarea aplicației, vor trebui urmați următorii pași:
</p>
<ul>
<li class="level1"><div class="li"> obținerea documentului html ce descrie conținutul paginii Internet solicitate; <pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+document"><span class="kw3">Document</span></a> document <span class="sy0">=</span> Jsoup.<span class="me1">parse</span><span class="br0">&#40;</span>pageSourceCode<span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> htmlTag <span class="sy0">=</span> document.<span class="me1">child</span><span class="br0">&#40;</span><span class="nu0">0</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> obținerea titlului caricaturii (se poate realiza o căutare după eticheta <code>&lt;div&gt;</code> care deține un atribut <code>id</code> cu valoarea <code>ctitle</code>, folosind metoda <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValue%28java.lang.String,%20java.lang.String%29" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByAttributeValue%28java.lang.String,%20java.lang.String%29"  rel="nofollow">getElementsByAttributeValue()</a>); ulterior, se va prelua conținutul acestei etichete prin intermediul metodei <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#ownText()" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#ownText()"  rel="nofollow">ownText()</a>: <pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> divTagIdCtitle <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">ID_ATTRIBUTE</span>, Constants.<span class="me1">CTITLE_VALUE</span><span class="br0">&#41;</span>.<span class="me1">first</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
xkcdCartoonInformation.<span class="me1">setCartoonTitle</span><span class="br0">&#40;</span>divTagIdCtitle.<span class="me1">ownText</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> obținerea <abbr title="Uniform Resource Locator">URL</abbr>-ului imaginii care trebuie afișată (se poate realiza o căutare după eticheta <code>&lt;div&gt;</code> care deține un atribut <code>id</code> cu valoarea <code>comic</code>, folosind metoda <code>getElementsByAttributeValue()</code>); aceasta conține la rândul ei un element <code>&lt;img&gt;</code> care poate fi accesat prin intermediul metodei <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByTag%28java.lang.String%29" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#getElementsByTag%28java.lang.String%29"  rel="nofollow">getElementsByTag()</a>; adresa Internet a caricaturii este reprezentată de valoarea atributului <code>src</code>, furnizată de metoda <a href="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#attr%28java.lang.String,%20java.lang.String%29" class="urlextern" title="http://jsoup.org/apidocs/org/jsoup/nodes/Element.html#attr%28java.lang.String,%20java.lang.String%29"  rel="nofollow">attr()</a>: <pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> divTagIdComic <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">ID_ATTRIBUTE</span>, Constants.<span class="me1">COMIC_VALUE</span><span class="br0">&#41;</span>.<span class="me1">first</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> cartoonInternetAddress <span class="sy0">=</span> divTagIdComic.<span class="me1">getElementsByTag</span><span class="br0">&#40;</span>Constants.<span class="me1">IMG_TAG</span><span class="br0">&#41;</span>.<span class="me1">attr</span><span class="br0">&#40;</span>Constants.<span class="me1">SRC_ATTRIBUTE</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> obținerea caricaturii, pe baza adresei Internet la care este găzduită, se face prin fluxul de intrare corespunzător entității HTTP, care va fi decodificat prin intermediul metodei <a href="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeStream(java.io.InputStream)" class="urlextern" title="http://developer.android.com/reference/android/graphics/BitmapFactory.html#decodeStream(java.io.InputStream)"  rel="nofollow">BitmapFactory.decodeStream()</a>, care întoarce un obiect de tip <a href="http://developer.android.com/reference/android/graphics/Bitmap.html" class="urlextern" title="http://developer.android.com/reference/android/graphics/Bitmap.html"  rel="nofollow">Bitmap</a>; asocierea unui astfel de obiect ca sursă a unui control grafic ce tip <code>ImageView</code> se face prin intermediul metodei <a href="http://developer.android.com/reference/android/widget/ImageView.html#setImageBitmap(android.graphics.Bitmap)" class="urlextern" title="http://developer.android.com/reference/android/widget/ImageView.html#setImageBitmap(android.graphics.Bitmap)"  rel="nofollow">setImageBitmap()</a>; alternativ, se poate folosi biblioteca open-source Volley, care pune la dispoziție un obiect specializat pentru descărcarea de imagini și încărcarea acestora în controalele din cadrul interfeței grafice (<code>ImageRequest</code>): <pre class="code java">ImageRequest cartoonRequest <span class="sy0">=</span> <span class="kw1">new</span> ImageRequest<span class="br0">&#40;</span>
  cartoonUrl,
  <span class="kw1">new</span> Response.<span class="me1">Listener</span><span class="sy0">&lt;</span>Bitmap<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    @Override
    <span class="kw1">public</span> <span class="kw4">void</span> onResponse<span class="br0">&#40;</span>Bitmap bitmap<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      xkcdCartoonImageView.<span class="me1">setImageBitmap</span><span class="br0">&#40;</span>bitmap<span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>,
  <span class="nu0">0</span>,
  <span class="nu0">0</span>,
  <span class="kw2">null</span>,
  Bitmap.<span class="me1">Config</span>.<span class="me1">RGB_565</span>,
  <span class="kw1">new</span> Response.<span class="me1">ErrorListener</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">public</span> <span class="kw4">void</span> onErrorResponse<span class="br0">&#40;</span>VolleyError volleyError<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">d</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, volleyError.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        Toast.<span class="me1">makeText</span><span class="br0">&#40;</span>xkcdCartoonTitleTextView.<span class="me1">getContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, xkcdCartoonTitleTextView.<span class="me1">getResources</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getString</span><span class="br0">&#40;</span>R.<span class="me1">string</span>.<span class="me1">an_error_has_occurred</span><span class="br0">&#41;</span>, Toast.<span class="me1">LENGTH_LONG</span><span class="br0">&#41;</span>
             .<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#41;</span><span class="sy0">;</span>
VolleyController.<span class="me1">getInstance</span><span class="br0">&#40;</span>xkcdCartoonImageView.<span class="me1">getContext</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">addToRequestQueue</span><span class="br0">&#40;</span>cartoonRequest<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> obținerea adreselor Internet corespunzătoare caricaturilor anterioară, respectiv următoare, care vor fi asociate obiectului ascultător ce tratează evenimentul de tip apăsare al butonului aferent; se poate realiza o căutare după eticheta <code>&lt;a&gt;</code> care deține un atribut <code>rel</code> cu valoarea <code>prev</code>, respectiv <code>next</code>, folosind metoda <code>getElementsByAttributeValue()</code>); <abbr title="Uniform Resource Locator">URL</abbr>-ul reprezintă valoarea atributului <code>href</code>, furnizată de metoda <code>attr</code>: <pre class="code java"><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> aTagRelPrev <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">REL_ATTRIBUTE</span>, Constants.<span class="me1">PREVIOUS_VALUE</span><span class="br0">&#41;</span>.<span class="me1">first</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> previousCartoonInternetAddress <span class="sy0">=</span> Constants.<span class="me1">XKCD_INTERNET_ADDRESS</span> <span class="sy0">+</span> aTagRelPrev.<span class="me1">attr</span><span class="br0">&#40;</span>Constants.<span class="me1">HREF_ATTRIBUTE</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+element"><span class="kw3">Element</span></a> aTagRelNext <span class="sy0">=</span> htmlTag.<span class="me1">getElementsByAttributeValue</span><span class="br0">&#40;</span>Constants.<span class="me1">REL_ATTRIBUTE</span>, Constants.<span class="me1">NEXT_VALUE</span><span class="br0">&#41;</span>.<span class="me1">first</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> nextCartoonInternetAddress <span class="sy0">=</span> Constants.<span class="me1">XKCD_INTERNET_ADDRESS</span> <span class="sy0">+</span> aTagRelNext.<span class="me1">attr</span><span class="br0">&#40;</span>Constants.<span class="me1">HREF_ATTRIBUTE</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>
</li>
</ul>

<p>
Structura documentului html care va trebui analizat pentru implementarea funcționalității este (poate fi accesat și din navigator, prin vizualizarea codului sursă al paginii Internet respective):
</p>
<pre class="code html4strict"><span class="sc2">&lt;<a href="http://december.com/html/4/element/div.html"><span class="kw2">div</span></a> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;ctitle&quot;</span>&gt;</span>Code Quality<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/div.html"><span class="kw2">div</span></a>&gt;</span>
<span class="sc2">&lt;<a href="http://december.com/html/4/element/ul.html"><span class="kw2">ul</span></a> <span class="kw3">class</span><span class="sy0">=</span><span class="st0">&quot;comicNav&quot;</span>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;/1/&quot;</span>&gt;</span>|<span class="sc1">&amp;lt;</span><span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">rel</span><span class="sy0">=</span><span class="st0">&quot;prev&quot;</span> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;/1512/&quot;</span> <span class="kw3">accesskey</span><span class="sy0">=</span><span class="st0">&quot;p&quot;</span>&gt;</span><span class="sc1">&amp;lt;</span> Prev<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;//c.xkcd.com/random/comic/&quot;</span>&gt;</span>Random<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">rel</span><span class="sy0">=</span><span class="st0">&quot;next&quot;</span> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;#&quot;</span> <span class="kw3">accesskey</span><span class="sy0">=</span><span class="st0">&quot;n&quot;</span>&gt;</span>Next <span class="sc1">&amp;gt;</span><span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;&lt;<a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a> <span class="kw3">href</span><span class="sy0">=</span><span class="st0">&quot;/&quot;</span>&gt;</span><span class="sc1">&amp;gt;</span>|<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/a.html"><span class="kw2">a</span></a>&gt;&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/li.html"><span class="kw2">li</span></a>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/ul.html"><span class="kw2">ul</span></a>&gt;</span>
<span class="sc2">&lt;<a href="http://december.com/html/4/element/div.html"><span class="kw2">div</span></a> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;comic&quot;</span>&gt;</span>
  <span class="sc2">&lt;<a href="http://december.com/html/4/element/img.html"><span class="kw2">img</span></a> <span class="kw3">src</span><span class="sy0">=</span><span class="st0">&quot;//imgs.xkcd.com/comics/code_quality.png&quot;</span> <span class="kw3">title</span><span class="sy0">=</span><span class="st0">&quot;I honestly didn&amp;#39;t think you could even USE emoji in variable names. Or that there were so many different crying ones.&quot;</span> <span class="kw3">alt</span><span class="sy0">=</span><span class="st0">&quot;Code Quality&quot;</span> <span class="sy0">/</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><a href="http://december.com/html/4/element/div.html"><span class="kw2">div</span></a>&gt;</span></pre>

<p>
Operația de descărcare a imaginii prin HTTP trebuie să se realizeze pe un fir de execuție separat.
</p>

<p>
O alternativă o reprezintă definirea unei clase derivate din <code>AsyncTask</code>, ce permite execuția unor metode ce implică comunicație prin rețea în mod asincron. Totuși, rularea sa este întreruptă în momentul în care activitatea care l-a lansat în execuție este distrus, astfel încât optarea pentru o astfel de soluție trebuie să se facă în momentul în care operațiile realizate în fundal nu durează o perioadă de timp prea mare.
</p>
<pre class="code java"><span class="kw1">private</span> <span class="kw1">class</span> XKCDCartoonDisplayerAsyncTask <span class="kw1">extends</span> AsyncTask<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+void"><span class="kw3">Void</span></a>, XKCDCartoonInformation<span class="sy0">&gt;</span> <span class="br0">&#123;</span>
&nbsp;
  @Override    
  <span class="kw1">protected</span> XKCDCartoonInformation doInBackground<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a>... <span class="me1">urls</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// get the html document corresponding to the xkcd.com website</span>
    <span class="co1">// parse the document in order to obtain the needed information</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> <span class="kw4">void</span> onPostExecute<span class="br0">&#40;</span>XKCDCartoonInformation xkcdCartoonInformation<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// get references to the needed information</span>
    <span class="co1">// map the information to the corresponding widget </span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
În metoda <code>doInBackground()</code> se plasează operațiile care trebuie realizate asincron, acestea fiind executate pe un fir de execuție separat (pot fi apelate aici metodele care implică comunicația prin rețea).
</p>

<p>
Metoda <code>onPostExecute()</code> va fi invocată în momentul în care procesarea asincronă a fost completată, primind ca parametru rezultatul furnizat de aceasta. Execuția sa este realizată pe firul de execuție al interfeței grafice, astfel încât din contextul acestei metode pot fi accesate controalele grafice al căror conținut trebuie să fie actualizat.
</p>

<p>
Lansarea în execuție a unui obiect de tip <code>AsyncTask</code> se realizează printr-un apel al metodei <code>execute()</code>:
</p>
<pre class="code java"><span class="kw1">new</span> XKCDCartoonDisplayerAsyncTask<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">execute</span><span class="br0">&#40;</span>Constants.<span class="me1">XKCD_INTERNET_ADDRESS</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
<strong>6.</strong> Să se importe în mediul integrat de dezvoltare preferat (Android Studio / Eclipse) proiectul <code>GoogleSearcher</code> din directorul <code>labtasks</code>.
</p>

<p>
Se cere să se implementeze o aplicație Android care să realizeze o căutare folosind motorul <a href="http://www.google.com" class="urlextern" title="http://www.google.com"  rel="nofollow">Google</a>, rezultatul fiind expus printr-un control grafic de tip <a href="http://developer.android.com/reference/android/webkit/WebView.html" class="urlextern" title="http://developer.android.com/reference/android/webkit/WebView.html"  rel="nofollow">WebView</a>.
</p>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/07googlesearcher.png%3Fw=400&amp;tok=accf2e" class="mediacenter" alt="" width="400" />
</p>

<p>
În situația în care șirul de caractere după care se realizează căutarea conține mai multe cuvinte (având drept delimitator caracterul spațiu), acestea vor fi legate prin intermediul caracterului <code>+</code>.
</p>

<p>
Adresa Internet care conține rezultatele căutării după anumite cuvinte cheie este formată din:
</p>
<ul>
<li class="level1"><div class="li"> <abbr title="Uniform Resource Locator">URL</abbr>-ul de bază: <a href="http://www.google.com/" class="urlextern" title="http://www.google.com/"  rel="nofollow">http://www.google.com/</a></div>
</li>
<li class="level1"><div class="li"> lista cuvintelor cheie după care se realizează căutarea: search?q=cuvant_cheie<sub>1</sub>+cuvant_cheie<sub>2</sub>+…+cuvant_cheie<sub>n</sub></div>
</li>
</ul>

<p>
<strong>Exemplu</strong>
</p>

<p>
În situația în care se dorește să se caute după șirul de caractere <code>“android developers”</code>, adresa Internet la care se găsesc rezultatele căutării este: <a href="http://www.google.ro/search?q=android+developers" class="urlextern" title="http://www.google.ro/search?q=android+developers"  rel="nofollow">http://www.google.ro/search?q=android+developers</a>.
</p>

<p>
Încărcarea conținutului unei pagini Internet în cadrul controlului grafic de tip <code>WebView</code> se face prin intermediul metodei <a href="http://developer.android.com/reference/android/webkit/WebView.html#loadDataWithBaseURL(java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.String)" class="urlextern" title="http://developer.android.com/reference/android/webkit/WebView.html#loadDataWithBaseURL(java.lang.String, java.lang.String, java.lang.String, java.lang.String, java.lang.String)"  rel="nofollow">loadDataWithBaseURL</a> care primește ca parametrii:
</p>
<ul>
<li class="level1"><div class="li"> <abbr title="Uniform Resource Locator">URL</abbr>-ul de bază, față de care vor fi rezolvate adresele relative;</div>
</li>
<li class="level1"><div class="li"> conținutul documentului <abbr title="HyperText Markup Language">HTML</abbr>;</div>
</li>
<li class="level1"><div class="li"> tipul MIME al documentului: de regulă, se folosește <code>text/html</code>;</div>
</li>
<li class="level1"><div class="li"> codificarea utilizată: uzual, se poate utiliza <code>UTF-8</code>;</div>
</li>
<li class="level1"><div class="li"> istoricul anterior la care se va raporta vizualizarea paginii Internet curente (trebuie să aibă valoarea unei adrese valide; dacă se specifică valoarea <code>null</code>, valoarea sa va fi <code>about:blank</code>).</div>
</li>
</ul>
<pre class="code java">googleResultsWebView.<span class="me1">loadDataWithBaseURL</span><span class="br0">&#40;</span><span class="st0">&quot;http://www.google.com&quot;</span>, content, <span class="st0">&quot;text/html&quot;</span>, <span class="st0">&quot;UTF-8&quot;</span>, <span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
<strong>7.</strong> (opțional) Să se importe în mediul integrat de dezvoltare preferat (Android Studio / Eclipse) proiectul <code>LandmarkLister</code> din directorul <code>labtasks</code>.
</p>

<p>
Se cere să se implementeze o aplicație Android care să afișeze informații cu privire la obiectivele turistice dintr-un areal geografic (desemnat prin coordonatele nord, sud, est, vest) pe baza rezultatelor furnizate de serviciul web <a href="http://http://api.geonames.org/citiesJSON" class="urlextern" title="http://http://api.geonames.org/citiesJSON"  rel="nofollow">Geonames Paces</a>.
</p>

<p>
Detaliile care se doresc a fi vizualizate pentru fiecare obiectiv turistic în parte sunt:
</p>
<ul>
<li class="level1"><div class="li"> așezarea geografică (latitudinea și longitudinea);</div>
</li>
<li class="level1"><div class="li"> denumirea toponimului (de regulă, localitatea în care se găsește);</div>
</li>
<li class="level1"><div class="li"> populația;</div>
</li>
<li class="level1"><div class="li"> descrierea localității în care poate fi vizitat;</div>
</li>
<li class="level1"><div class="li"> numele obiectivului;</div>
</li>
<li class="level1"><div class="li"> adresa paginii Internet la care pot fi consultate informații suplimentare, pe Wikipedia;</div>
</li>
<li class="level1"><div class="li"> codul de țară.</div>
</li>
</ul>

<p>
<img src="../../../../_media/eim/laboratoare/laborator07/08landmarklister.png%3Fw=400&amp;tok=5e4f8a" class="mediacenter" alt="" width="400" />
</p>

<p>
Adresa Internet la care este disponibil rezultatul în format JSON conține informații cu privire la coordonatele punctelor cardinale, precum și cu privire la numele de utilizator:
</p>
<ul>
<li class="level1"><div class="li"> <code>north</code>, <code>south</code>, <code>east</code>, <code>west</code> - valoarea coordonatelor corespunzătoare punctelor cardinale, exprimate ca numere reale, cu semn;</div>
</li>
<li class="level1"><div class="li"> <code>username</code> - denumirea utilizatorului care deține drepturi de acces asupra acestui serviciu web (în cazul de față, <code>pdsd</code>).</div>
</li>
</ul>

<p>
<strong>Exemplu</strong>. O adresă Internet de la care pot fi accesate rezultate în format JSON este: <a href="http://api.geonames.org/citiesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=pdsd" class="urlextern" title="http://api.geonames.org/citiesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=pdsd"  rel="nofollow">http://api.geonames.org/citiesJSON?north=44.1&amp;south=-9.9&amp;east=-22.4&amp;west=55.2&amp;username=pdsd</a>.
</p>

<p>
Rezultatele sunt furnizate în următorul format:
</p>
<pre class="code json">{
  &quot;geonames&quot;:[
               {
                 &quot;fcodeName&quot;:&quot;capital of a political entity&quot;,
                 &quot;toponymName&quot;:&quot;Mexico City&quot;,
                 &quot;countrycode&quot;:&quot;MX&quot;,
                 &quot;fcl&quot;:&quot;P&quot;,
                 &quot;fclName&quot;:&quot;city, village,...&quot;,
                 &quot;name&quot;:&quot;Mexiko-Stadt&quot;,
                 &quot;wikipedia&quot;:&quot;en.wikipedia.org/wiki/Mexico_City&quot;,
                 &quot;lng&quot;:-99.12766456604,
                 &quot;fcode&quot;:&quot;PPLC&quot;,
                 &quot;geonameId&quot;:3530597,
                 &quot;lat&quot;:19.428472427036,
                 &quot;population&quot;:12294193
               },
               {
                 &quot;fcodeName&quot;:&quot;capital of a political entity&quot;,
                 &quot;toponymName&quot;:&quot;Beijing&quot;,
                 &quot;countrycode&quot;:&quot;CN&quot;,
                 &quot;fcl&quot;:&quot;P&quot;,
                 &quot;fclName&quot;:&quot;city, village,...&quot;,
                 &quot;name&quot;:&quot;Peking&quot;,
                 &quot;wikipedia&quot;:&quot;en.wikipedia.org/wiki/Beijing&quot;,
                 &quot;lng&quot;:116.397228240967,
                 &quot;fcode&quot;:&quot;PPLC&quot;,
                 &quot;geonameId&quot;:1816670,
                 &quot;lat&quot;:39.9074977414405,
                 &quot;population&quot;:1171662
               },
               ...
             ]
}</pre>

<p>
Astfel, informațiile care trebuie preluate din rezultat sunt:
</p>
<div class="table sectionedit17"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  atribut JSON  </th><th class="col1 centeralign">  tip de date  </th><th class="col2 centeralign">  detaliu  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>lat</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> latitudine </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>lng</code> </td><td class="col1"> <code>double</code> </td><td class="col2"> longitudine </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>toponymName</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> denumirea toponimului </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>population</code> </td><td class="col1"> <code>long</code> </td><td class="col2"> populație </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>fcodeName</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> descriere localitate </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>name</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> nume obiectiv turistic </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>wikipedia</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> adresa paginii Internet pe care pot fi regăsite informații suplimentare, pe Wikipedia </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>countrycode</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> codul de țară </td>
	</tr>
</table></div>
<!-- EDIT17 TABLE [83977-84477] -->
<p>
Prin urmare, pașii care trebuie urmați pentru implementarea funcționalității sunt:
</p>
<ol>
<li class="level1"><div class="li"> construirea <abbr title="Uniform Resource Locator">URL</abbr>-ului, prin atașarea informațiilor preluate de la utilizator (coordonatele punctelor cardinale);</div>
</li>
<li class="level1"><div class="li"> execuția unei cereri HTTP;</div>
</li>
<li class="level1"><div class="li"> parsarea documentului JSON corespunzător răspunsului HTTP; <pre class="code java"><span class="kw1">final</span> ArrayList<span class="sy0">&lt;</span>LandmarkInformation<span class="sy0">&gt;</span> landMarkInformationList <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>LandmarkInformation<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
JSONObject result <span class="sy0">=</span> <span class="kw1">new</span> JSONObject<span class="br0">&#40;</span>content<span class="br0">&#41;</span><span class="sy0">;</span>
JSONArray jsonArray <span class="sy0">=</span> result.<span class="me1">getJSONArray</span><span class="br0">&#40;</span>Constants.<span class="me1">GEONAMES</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="kw1">for</span> <span class="br0">&#40;</span><span class="kw4">int</span> k <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> k <span class="sy0">&lt;</span> jsonArray.<span class="me1">length</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span> k<span class="sy0">++</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  JSONObject jsonObject <span class="sy0">=</span> jsonArray.<span class="me1">getJSONObject</span><span class="br0">&#40;</span>k<span class="br0">&#41;</span><span class="sy0">;</span>
  landMarkInformationList.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> LandmarkInformation<span class="br0">&#40;</span>
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">LATITUDE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getDouble</span><span class="br0">&#40;</span>Constants.<span class="me1">LONGITUDE</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">TOPONYM_NAME</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getLong</span><span class="br0">&#40;</span>Constants.<span class="me1">POPULATION</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">FCODE_NAME</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">NAME</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">WIKIPEDIA_WEB_PAGE_ADDRESS</span><span class="br0">&#41;</span>,
    jsonObject.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">COUNTRY_CODE</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>
</li>
<li class="level1"><div class="li"> atașarea informațiilor obținute în cadrul unui control grafic de tip listă.</div>
</li>
</ol>

<p>
<strong>8.</strong>  Să se încarce modificările realizate în cadrul depozitului &#039;Laborator07&#039; de pe contul Github personal, folosind un mesaj sugestiv. 
</p>
<pre class="code">student@eim2016:~/Laborator07$ git add *
student@eim2016:~/Laborator07$ git commit -m &quot;implemented taks for laboratory 07&quot;
student@eim2016:~/Laborator07$ git push Laborator07_perfectstudent master</pre>

</div>
<!-- EDIT16 SECTION "Activitate de Laborator" [67526-86005] -->
<h2 class="sectionedit18" id="resurse_utile">Resurse Utile</h2>
<div class="level2">

<p>
<a href="http://www.amazon.com/Computer-Networks-Edition-Andrew-Tanenbaum/dp/0132126958" class="urlextern" title="http://www.amazon.com/Computer-Networks-Edition-Andrew-Tanenbaum/dp/0132126958"  rel="nofollow">Andrew S. TANENBAUM, David J. WETHERALL, Computer Networks, 5th Edition, Pearson Education, 2011</a> - secțiunea 7.3.4, <em>HTTP - The HyperText Transfer Protocol</em>, pp. 683-692<br/>

<a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes" class="urlextern" title="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes"  rel="nofollow">List of HTTP Status Codes</a><br/>

<a href="http://www.bignerdranch.com/we-write/android-programming/" class="urlextern" title="http://www.bignerdranch.com/we-write/android-programming/"  rel="nofollow">Bill PHILLIPS, Brian HARDY, Android Programming. The Big Nerd Ranch Guide, Pearson Technology Group, 2013</a> - capitolul 26, <em>HTTP &amp; Background Tasks</em><br/>

<a href="http://books.google.ro/books/about/The_Android_Developer_s_Cookbook.html?id=Y4JR2yI2Fo0C&amp;redir_esc=y" class="urlextern" title="http://books.google.ro/books/about/The_Android_Developer_s_Cookbook.html?id=Y4JR2yI2Fo0C&amp;redir_esc=y"  rel="nofollow">Ronan SCHWARZ, Phil DUTSON, James STEELE, Nelson TO, Android Developer&#039;s Cookbook, Building Applications with the Android SDK, 2nd Edition, Addison Wesley, 2013</a> - capitolul 10 - <em>Networking</em>, secțiunea <em>Using web content</em><br/>

<a href="http://eu.wiley.com/WileyCDA/WileyTitle/productCd-1118199545.html" class="urlextern" title="http://eu.wiley.com/WileyCDA/WileyTitle/productCd-1118199545.html"  rel="nofollow">Wei Meng LEE, Beginning Android 4 Application Development, Wiley, 2012</a> - capitolul 10, <em>Networking</em>, secțiunile <em>How to connect to the web using HTTP</em>, <em>How to consume JSON web services</em><br/>

<a href="http://www.apress.com/9781430239307" class="urlextern" title="http://www.apress.com/9781430239307"  rel="nofollow">Satya KOMATINENI, Dave MACLEAN, Pro Android 4, Apress, 2012</a> - capitolul 15, <em>Building and Consuming Services</em><br/>

<a href="http://www.coreservlets.com/android-tutorial" class="urlextern" title="http://www.coreservlets.com/android-tutorial"  rel="nofollow">Android Programming Tutorials - Core Servlets</a> - secțiunea <em>Networking II - HTTP and JSON Techniques</em><br/>

<a href="http://android.rosedu.org/wiki/laborator-07-servicii-de-retea#request-uri-http" class="urlextern" title="http://android.rosedu.org/wiki/laborator-07-servicii-de-retea#request-uri-http"  rel="nofollow">Dezvoltarea aplicațiilor pentru Android</a> - partea I, <em>Request-uri HTTP</em><br/>

<a href="http://developer.android.com/reference/java/net/HttpURLConnection.html" class="urlextern" title="http://developer.android.com/reference/java/net/HttpURLConnection.html"  rel="nofollow">HttpURLConnection</a><br/>

<a href="http://hc.apache.org/httpcomponents-client-4.4.x/index.html" class="urlextern" title="http://hc.apache.org/httpcomponents-client-4.4.x/index.html"  rel="nofollow">Apache Http Components</a><br/>

<a href="http://developer.android.com/reference/org/apache/http/client/HttpClient.html" class="urlextern" title="http://developer.android.com/reference/org/apache/http/client/HttpClient.html"  rel="nofollow">HttpClient</a>, <a href="http://developer.android.com/reference/org/apache/http/client/methods/HttpGet.html" class="urlextern" title="http://developer.android.com/reference/org/apache/http/client/methods/HttpGet.html"  rel="nofollow">HttpGet</a>, <a href="http://developer.android.com/reference/org/apache/http/client/methods/HttpPost.html" class="urlextern" title="http://developer.android.com/reference/org/apache/http/client/methods/HttpPost.html"  rel="nofollow">HttpPost</a><br/>

<a href="http://jsoup.org/" class="urlextern" title="http://jsoup.org/"  rel="nofollow">Jsoup</a><br/>

<a href="http://en.wikipedia.org/wiki/JSON" class="urlextern" title="http://en.wikipedia.org/wiki/JSON"  rel="nofollow">Formatul JSON</a><br/>

<a href="http://developer.android.com/reference/org/json/JSONObject.html" class="urlextern" title="http://developer.android.com/reference/org/json/JSONObject.html"  rel="nofollow">JSONObject</a>
</p>

</div>
<!-- EDIT18 SECTION "Resurse Utile" [86006-] --></div>
</body>
</html>
