    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>uso-ac:laboratoare:laborator-04</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-10-31T13:31:45+0200"/>
<meta name="keywords" content="uso-ac,laboratoare,laborator-04"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=uso-ac:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="laborator-04.html"/>
<link rel="canonical" href="../../../../uso-ac/laboratoare/laborator-04.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='uso-ac:laboratoare';var JSINFO = {"id":"uso-ac:laboratoare:laborator-04","namespace":"uso-ac:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-04.html#laborator_04_-_utilizatori_si_procese">Laborator 04 - Utilizatori și procese</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-04.html#cheatsheet_utilizatori">Cheatsheet utilizatori</a></div></li>
<li class="level2"><div class="li"><a href="laborator-04.html#cheatsheet_procese">Cheatsheet procese</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#foreground_and_background_procese">Foreground and background procese</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#starile_unui_proces">Stările unui proces</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-04.html#suport_laborator">Suport laborator</a></div></li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-04.html#demo">Demo</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-04.html#utilizatori">Utilizatori</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#utiliatori_privilegiati_si_neprivilegiati_id_finger_whoami">[1] Utiliatori privilegiați si neprivilegiați (id, finger, whoami)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#schimbarea_utilizatorului_curent_su">[2] Schimbarea utilizatorului curent (su)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#drepturi_pentru_anumite_comenzi_sudo">[3] Drepturi pentru anumite comenzi (sudo)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#schimbarea_parolei_passwd">[4] Schimbarea parolei (passwd)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#gestiunea_utilizatorilor_adduserdeluser">[5] Gestiunea utilizatorilor (adduser/deluser)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#de_retinut">[6] De reținut!</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-04.html#procese">Procese</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#vizualizarea_proceselor_din_sistem_ps_pstree_top_htop">[1] Vizualizarea proceselor din sistem (ps, pstree, top, htop)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#foreground_background_fg_bg_jobs">[2] Foreground &amp; Background (&amp;, fg, bg, jobs)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#semnale_kill">[3] Semnale (kill)</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-04.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-04.html#pregatire_setup_laborator_05p">[0] Pregătire setup laborator (0.5p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-04.html#utilizatori1">Utilizatori</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#adaugarea_de_noi_utilizatori_si_de_grupuri_2p">[1] Adăugarea de noi utilizatori și de grupuri (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#schimbarea_homedir-ului_altui_utilizator_1p">[2] Schimbarea homedir-ului altui utilizator (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#a_drepturi_de_sudo_pentru_un_utilizator_1p">[3a] Drepturi de sudo pentru un utilizator (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#b_drepturi_de_sudo_pentru_un_grup_1p">[3b] Drepturi de sudo pentru un grup (1p)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-04.html#procese1">Procese</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-04.html#lucrul_cu_procese_in_backgroudforeground_2p">[4] Lucrul cu procese în backgroud/foreground (2p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#terminarea_unui_set_de_procese_15p">[5] Terminarea unui set de procese (1.5p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#terminarea_fortata_a_unui_proces_1p">[6] Terminarea forțată a unui proces (1p)</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#bonus_1_resurse_ocupate_de_un_proces_1_karma_wouso">[BONUS #1] Resurse ocupate de un proces [1 karma WoUSO]</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#bonus_2_procese_detasate_de_terminal_1_karma_wouso">[BONUS #2] Procese detașate de terminal [1 Karma WoUSO]</a></div></li>
<li class="level3"><div class="li"><a href="laborator-04.html#bonus_3_trimiterea_de_semnale_unui_proces_1_karma_wouso">[BONUS #3]  Trimiterea de semnale unui proces [1 karma WoUSO]</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-04.html#sumar_cuvinte_cheie">Sumar. Cuvinte cheie</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="laborator_04_-_utilizatori_si_procese">Laborator 04 - Utilizatori și procese</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Laborator 04 - Utilizatori și procese" [1-54] -->
<h2 class="sectionedit2" id="cheatsheet_utilizatori">Cheatsheet utilizatori</h2>
<div class="level2">
<div class="table sectionedit3"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Comandă  </th><th class="col1 leftalign"> Descriere scurtă       </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong><code>sudo</code></strong>     </td><td class="col1"> execută o comandă cu drepturi de utilizator privilegiat </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong><code>su</code></strong>       </td><td class="col1 leftalign"> schimbă utilizatorul cu care suntem autentificați       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <strong><code>id</code></strong>       </td><td class="col1"> afișează id-ul și grupurile din care face parte un utilizator </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong><code>finger</code></strong>   </td><td class="col1"> afișează un sumar despre un anumit utilizator </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <strong><code>whoami</code></strong>   </td><td class="col1"> afișează utilizatorul curent (cu care suntem autentificați) </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> <strong><code>who</code></strong>      </td><td class="col1"> lista de utilizatori autentificați la un moment dat </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <strong><code>passwd</code></strong>   </td><td class="col1"> schimbă parola unui utilizator </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> <strong><code>adduser</code></strong>  </td><td class="col1"> adaugă un utilizator </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> <strong><code>deluser</code></strong>  </td><td class="col1"> șterge un utilizator </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> <strong><code>usermod</code></strong>  </td><td class="col1"> modifică informații despre un utilizar (exemplu: grupul din care face parte) </td>
	</tr>
	<tr class="row11">
		<td class="col0"> <strong><code>addgroup</code></strong> </td><td class="col1"> adaugă un grup de utilizatori </td>
	</tr>
	<tr class="row12">
		<td class="col0"> <strong><code>delgroup</code></strong> </td><td class="col1"> șterge un grup de utilizatori </td>
	</tr>
</table></div>
<!-- EDIT3 TABLE [91-969] -->
</div>
<!-- EDIT2 SECTION "Cheatsheet utilizatori" [55-969] -->
<h2 class="sectionedit4" id="cheatsheet_procese">Cheatsheet procese</h2>
<div class="level2">
<div class="table sectionedit5"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Comandă  </th><th class="col1 leftalign"> Descriere scurtă  </th><td class="col2"></td>
	</tr>
	<tr class="row1">
		<td class="col0"> <strong><code>ps</code></strong> </td><td class="col1 leftalign"> snapshot al proceselor curente                                             </td><td class="col2"></td>
	</tr>
	<tr class="row2">
		<td class="col0"> <strong><code>pgrep</code></strong> </td><td class="col1"> Afișează PID-ul proceselor cu nume dat ca argument. Se pot folosi opțiuni pentru filtrare (exemplu: după numele utilizatorului care a deschis respectivul proces) </td><td class="col2"></td>
	</tr>
	<tr class="row3">
		<td class="col0"> <strong><code>top</code></strong> </td><td class="col1"> utilitar echivalent lui Windows Task Manager, in Linux. Există și <strong><code>htop</code></strong>, mai avansat și cu mai multe posibilități </td><td class="col2"></td>
	</tr>
	<tr class="row4">
		<td class="col0"> <strong><code>pstree</code></strong> </td><td class="col1 leftalign"> ierarhia de procese                                             </td><td class="col2 leftalign">                                          </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <strong><code>kill</code></strong> </td><td class="col1"> trimite un semnal unui proces. Folosind comanda <strong><code>kill -l</code></strong> putem vedea semnalele care pot fi trimise </td><td class="col2"></td>
	</tr>
	<tr class="row6">
		<td class="col0"> <strong><code>killall</code></strong> </td><td class="col1"> omoară toate procesele cu același nume </td><td class="col2"></td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> <strong><code>pkill</code></strong>  </td><td class="col1 leftalign"> caută un proces după nume și îi transmite un semnal             </td><td class="col2"></td>
	</tr>
	<tr class="row8">
		<td class="col0"> <strong><code>jobs</code></strong> </td><td class="col1"> afișează procesele pornite în background </td><td class="col2"></td>
	</tr>
</table></div>
<!-- EDIT5 TABLE [1002-1926] -->
</div>
<!-- EDIT4 SECTION "Cheatsheet procese" [970-1927] -->
<h3 class="sectionedit6" id="foreground_and_background_procese">Foreground and background procese</h3>
<div class="level3">

<p>
<a href="../../../../_detail/uso/laboratoare/foreback.gif%3Fid=uso-ac%253Alaboratoare%253Alaborator-04.html" class="media" title="uso:laboratoare:foreback.gif"><img src="../../../../_media/uso/laboratoare/foreback.gif" class="media" alt="" /></a>
</p>

</div>
<!-- EDIT6 SECTION "Foreground and background procese" [1928-2008] -->
<h3 class="sectionedit7" id="starile_unui_proces">Stările unui proces</h3>
<div class="level3">

<p>
<a href="../../../../_detail/uso/laboratoare/process-states.png%3Fid=uso-ac%253Alaboratoare%253Alaborator-04.html" class="media" title="uso:laboratoare:process-states.png"><img src="../../../../_media/uso/laboratoare/process-states.png%3Fw=600&amp;tok=981eaf" class="media" alt="" width="600" /></a>
</p>

</div>
<!-- EDIT7 SECTION "Stările unui proces" [2009-2090] -->
<h2 class="sectionedit8" id="suport_laborator">Suport laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA53" class="urlextern" title="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA53"  rel="nofollow"> 3. Gestiunea pachetelor și utilizatorilor</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA111" class="urlextern" title="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA111"  rel="nofollow">5. Procese</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://cb.vu/unixtoolbox.xhtml#processes" class="urlextern" title="http://cb.vu/unixtoolbox.xhtml#processes"  rel="nofollow">Unix Toolbox - Processes</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://xkcd.com/619/" class="urlextern" title="http://xkcd.com/619/"  rel="nofollow">Support for more than 1024 CPUs</a></div>
</li>
</ul>

</div>
<!-- EDIT8 SECTION "Suport laborator" [2091-2436] -->
<h1 class="sectionedit9" id="demo">Demo</h1>
<div class="level1">

</div>
<!-- EDIT9 SECTION "Demo" [2437-2456] -->
<h2 class="sectionedit10" id="utilizatori">Utilizatori</h2>
<div class="level2">

</div>
<!-- EDIT10 SECTION "Utilizatori" [2457-2481] -->
<h3 class="sectionedit11" id="utiliatori_privilegiati_si_neprivilegiati_id_finger_whoami">[1] Utiliatori privilegiați si neprivilegiați (id, finger, whoami)</h3>
<div class="level3">

<p>
În general, pe un sistem Linux, sunt două ierarhii de utilizatori:
</p>
<ul>
<li class="level1"><div class="li"> neprivilegiați  - nu pot modifica starea sistemului, nu pot realiza modificări ce afectează alți utilizatori</div>
</li>
<li class="level1"><div class="li"> privilegiați - spre exemplu utilizatorul <code>root</code></div>
</li>
</ul>

<p>
Utilizatorul root este prezent, în general, pe orice sistem Linux, rolul său fiind de administrare și gestionarea celorlalți utilizatori.
</p>

<p>
<p><div class="notewarning">
Nu este recomandat să folosiți sistemul folosind acest utilizator decât pentru strictul necesar. De multe ori este suficientă utilizarea comenzii <code>sudo</code>.

</div></p>
</p>

</div>
<!-- EDIT11 SECTION "[1] Utiliatori privilegiați si neprivilegiați (id, finger, whoami)" [2482-5186] -->
<h3 class="sectionedit12" id="schimbarea_utilizatorului_curent_su">[2] Schimbarea utilizatorului curent (su)</h3>
<div class="level3">

<p>
Câteodată este necesar să schimbăm utilizatorul cu care suntem autentificați într-un altul (de exemplu în <code>root</code> pentru a realiza un task administrativ). Pentru aceasta folosim comanda <code>su</code> (switch user). Haideți să vedem cum o folosim.
</p>

</div>
<!-- EDIT12 SECTION "[2] Schimbarea utilizatorului curent (su)" [5187-6373] -->
<h3 class="sectionedit13" id="drepturi_pentru_anumite_comenzi_sudo">[3] Drepturi pentru anumite comenzi (sudo)</h3>
<div class="level3">

<p>
Să presupunem că pe un sistem avem 100 de utilizatori și vrem ca toți să aibă drepturile necesare instalării de noi pachete, dar să nu poată adăuga/șterge alți utilizatori. Pe lângă faptul că ar fi foarte foarte nesigur ca 100 de persoane să știe parola contului de <code>root</code>, ar trebui să ne bazăm pe încrederea că ei nu vor face altceva decât să instaleze pachete. Soluția acestei probleme este comanda <code>sudo</code>.
</p>

</div>
<!-- EDIT13 SECTION "[3] Drepturi pentru anumite comenzi (sudo)" [6374-8762] -->
<h3 class="sectionedit14" id="schimbarea_parolei_passwd">[4] Schimbarea parolei (passwd)</h3>
<div class="level3">

<p>
Pentru a schimba parola utilizatorului curent folosim comanda <code>passwd</code>, fără argumente. De asemenea, dacă dorim schimbarea parolei altui utilizator, îi putem oferi comenzii <code>passwd</code> numele acestuia ca parametru. Mai departe vom vedea un exemplu de cum facem acest lucru.
</p>

</div>
<!-- EDIT14 SECTION "[4] Schimbarea parolei (passwd)" [8763-9553] -->
<h3 class="sectionedit15" id="gestiunea_utilizatorilor_adduserdeluser">[5] Gestiunea utilizatorilor (adduser/deluser)</h3>
<div class="level3">

<p>
Acum că știm cum vedem informații despre un utilizator, cum schimbăm o parolă sau cum schimbăm utilizatorul curent, hai să vedem cum adăugăm utilizatori noi sau cum ștergem un utilizator dintre cei existenți. Pentru aceasta vom folosi comenzile <code>adduser</code>
și <code>deluser</code>.
</p>

<p>
<p><div class="noteimportant">
Cele două comenzi sunt de fapt niște scripturi <code>wrapper</code> scrise în <a href="https://www.perl.org" class="urlextern" title="https://www.perl.org"  rel="nofollow">Perl</a> prezente, în general, numai pe distribuții bazate pe <a href="http://www.debian.org" class="urlextern" title="http://www.debian.org"  rel="nofollow">Debian</a> (cum ar fi Ubuntu). Comenzile pe care le apelează ele în spate sunt <code>useradd</code> și <code>userdel</code>.

</div></p>
</p>

</div>
<!-- EDIT15 SECTION "[5] Gestiunea utilizatorilor (adduser/deluser)" [9554-11377] -->
<h3 class="sectionedit16" id="de_retinut">[6] De reținut!</h3>
<div class="level3">

<p>
<p><div class="noteimportant">
La orice moment de timp, așa cum te uiți în oglinda retrovizoare a unei mașini și știi mereu ce ai în spate, trebuie să știi trei lucruri, mai ales în contextul folosirii mașinilor virtuale:
</p>
<ul>
<li class="level1"><div class="li"> care este hostname-ul (pe ce sistem te afli). Comenzi utile: <code>cat /etc/hostname</code>, <code>hostname</code></div>
</li>
<li class="level1"><div class="li"> care este username-ul (cu ce utilizator ești autentificat): <code>whoami</code>, <code>id</code> (fără parametrii), </div>
</li>
<li class="level1"><div class="li"> care este working directory-ul (în ce director lucrezi): <code>pwd</code></div>
</li>
</ul>

<p>
Toate informațiile de mai sus se găsesc în prompt-ul terminalului: <code><strong>username@hostname:working-directory</strong></code>.

</div></p>
</p>

<p>
<p><div class="notetip">E important să reținem că urmărirea prompt-ului este o convenție. Acesta poate fi schimbat foare ușor folosind <code>bashrc</code>. Detalii puteți găsi <a href="http://www.cyberciti.biz/tips/howto-linux-unix-bash-shell-setup-prompt.html" class="urlextern" title="http://www.cyberciti.biz/tips/howto-linux-unix-bash-shell-setup-prompt.html"  rel="nofollow">pe cyberciti</a>. 
</div></p>
</p>

</div>
<!-- EDIT16 SECTION "[6] De reținut!" [11378-12291] -->
<h2 class="sectionedit17" id="procese">Procese</h2>
<div class="level2">

</div>
<!-- EDIT17 SECTION "Procese" [12292-12312] -->
<h3 class="sectionedit18" id="vizualizarea_proceselor_din_sistem_ps_pstree_top_htop">[1] Vizualizarea proceselor din sistem (ps, pstree, top, htop)</h3>
<div class="level3">

<p>
Ierarhia de procese în formă arborescentă putem vizualiza folosind <code>pstree</code> (similar cu <code>tree</code> de  la sistemul de fișiere)
</p>

<p>
Folosind <code>ps</code> fără nici un parametru vizualizăm procesele din shell-ul curent asociate utilizatorului curent. Tot cu <code>ps</code> putem vizualiza un <code>snapshot</code> al tuturor proceselor. Aceasta se poate obține folosind două variante ale comenzii:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">ps</span> aux
<span class="co4">student@midgard:~$ </span><span class="kw2">ps</span> <span class="re5">-ef</span></pre>

<p>
Un utilitar echivalent lui Windows Task Manager pentru vizualizarea în timp real a proceselor care rulează, în linie de comandă, este <code>htop</code>. 
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span>htop</pre>

</div>
<!-- EDIT18 SECTION "[1] Vizualizarea proceselor din sistem (ps, pstree, top, htop)" [12313-13743] -->
<h3 class="sectionedit19" id="foreground_background_fg_bg_jobs">[2] Foreground &amp; Background (&amp;, fg, bg, jobs)</h3>
<div class="level3">

<p>
Porniți un proces <code>sleep 1000</code> (nu face nimic, e deschis, în starea <code>sleep</code> timp de 1000 de secunde). Haideți să le transmitem niște semnale prin combinații de taste, să vedem ce observăm în Bash. De exemplu:
</p>
<div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Taste     </th><th class="col1 leftalign"> Semnificație                                              </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong><code>Ctrl+C</code></strong>     </td><td class="col1 leftalign"> trimite <code>SIGINT</code>                           </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong><code>Ctrl+Z</code></strong>     </td><td class="col1 leftalign"> trimite <code>SIGSTOP</code>       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <strong><code>Ctrl+\</code></strong>    </td><td class="col1 leftalign"> trimite <code>SIGQUIT</code>   </td>
	</tr>
</table></div>
<!-- EDIT20 TABLE [14024-14265] --><pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">sleep</span> <span class="nu0">1000</span>
^Z
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+  Stopped                 <span class="kw2">sleep</span> <span class="nu0">1000</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">bg</span>
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+ <span class="kw2">sleep</span> <span class="nu0">1000</span> <span class="sy0">&amp;</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">jobs</span>
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>-  Running                 <span class="kw2">sleep</span> <span class="nu0">1000</span> <span class="sy0">&amp;</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">fg</span> <span class="nu0">1</span>
<span class="kw2">sleep</span> <span class="nu0">1000</span>
^C
<span class="co4">student@midgard:~$ </span>
<span class="co4">student@midgard:~$ </span><span class="kw2">ps</span>
  PID TTY          TIME CMD
<span class="nu0">13038</span> pts<span class="sy0">/</span><span class="nu0">0</span>    00:00:00 <span class="kw2">bash</span>
<span class="nu0">16827</span> pts<span class="sy0">/</span><span class="nu0">0</span>    00:00:00 <span class="kw2">ps</span></pre>

<p>
Creăm un proces care va rula mult timp (căutăm să aflăm dimensiunea tuturor fișierelor), apoi aducem în starea <code>stopped</code>, apoi în <code>running</code>, apoi ar trebui să apară și un Exit când termină. Cu <code>jobs</code> putem afla procesele <code>running</code> din fundal. Detalii aflați din <code>help jobs</code> <img src="../../../../lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">sudo</span> <span class="kw2">du</span> <span class="re5">-hs</span> <span class="sy0">/</span>
<span class="br0">&#91;</span><span class="kw2">sudo</span><span class="br0">&#93;</span> password <span class="kw1">for</span> student:
^Z
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+  Stopped                 <span class="kw2">sudo</span> <span class="kw2">du</span> <span class="re5">-hs</span> <span class="sy0">/</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">bg</span>
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+ <span class="kw2">sudo</span> <span class="kw2">du</span> <span class="re5">-hs</span> <span class="sy0">/</span> <span class="sy0">&amp;</span>
<span class="co4">student@midgard:~$ </span><span class="kw3">jobs</span>
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+  Running                 <span class="kw2">sudo</span> <span class="kw2">du</span> <span class="re5">-hs</span> <span class="sy0">/</span>
<span class="co4">student@midgard:~$ </span>3.4G   <span class="sy0">/</span>
<span class="br0">&#91;</span><span class="nu0">1</span><span class="br0">&#93;</span>+  Exit <span class="nu0">1</span>                  <span class="kw2">sudo</span> <span class="kw2">du</span> <span class="re5">-hs</span> <span class="sy0">/</span></pre>

</div>
<!-- EDIT19 SECTION "[2] Foreground & Background (&, fg, bg, jobs)" [13744-15976] -->
<h3 class="sectionedit21" id="semnale_kill">[3] Semnale (kill)</h3>
<div class="level3">

<p>
Un utilizator poate trimite un semnal unui proces folosind comanda <code>kill</code>! Este foarte important să înțelegem că <em class="u">nu</em> este scopul principal omorârea de procese folosind <code>kill</code>. O listă a tuturor semnalelor posibile ce pot fi trimise aflăm prin
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="re5">-l</span>   </pre>

<p>
Noi ne vom concentra pe distrugerea proceselor, în următorul demo. 
</p>

<p>
Haideți să pornim un proces, în fundal, care caută toate fișierele în <code>/</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">find</span> <span class="sy0">/</span> <span class="re5">-name</span> <span class="st_h">'*'</span> <span class="sy0">&amp;</span></pre>

<p>
Deschidem un alt terminal. Căutăm identificatorul procesului anterior. Nu folosi <code>top</code>, care e interactiv și ne afișază toate procesele în timp real, pentru că ne interesează doar procesul sau procesele de <code>find</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span>pgrep <span class="kw2">find</span>
<span class="nu0">2628</span></pre>

<p>
Pe sistemele voastre va varia PID-ul (Process ID). 
</p>

<p>
Ne dăm seama că procesul consumă resurse (operații pe hard disk) inutile. Dorim să îl terminăm:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="nu0">2628</span></pre>

<p>
Implicit, kill trimite semnalul <code>15) SIGTERM</code>: acesta se asigură că toate resursele folosite de proces (cum fișiere deschise) sunt închise corect și abia apoi e închisă aplicația (e omorât procesul). Semnalul <code>9) SIGKILL</code> e preocupat în principal de închiderea aplicației direct. Comanda de mai sus e similară cu 
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="re5">-15</span> <span class="nu0">2628</span></pre>

<p>
Repornim procesul <code>find</code>. De data asta folosim o comandă care nu implică determinarea PID-ului:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span>pkill <span class="kw2">find</span></pre>

<p>
Instalați pe sistemele voastre <code>chromium-browser</code>, dacă acesta nu e deja instalat. Deschideți browserul și 10 tab-uri în care să intrați pe diverse site-uri. Deteminați PID-urile tutror proceselor pornite de chromium-browser
</p>

<p>
Dorim să omorâm toate aceste procese. Pentru aceasta putem folosi în loc de <code>kill PID1 PID2 … PID_N</code> putem folosi mai eficient:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">killall</span> chromium-browser</pre>

<p>
Ce s-a întâmplat cu site-urile care erau deschise?
</p>

</div>
<!-- EDIT21 SECTION "[3] Semnale (kill)" [15977-20040] -->
<h1 class="sectionedit22" id="exercitii">Exerciții</h1>
<div class="level1">

</div>
<!-- EDIT22 SECTION "Exerciții" [20041-20066] -->
<h2 class="sectionedit23" id="pregatire_setup_laborator_05p">[0] Pregătire setup laborator (0.5p)</h2>
<div class="level2">

<p>
Pentru a descărca fișierele necesare acestui laborator deschidem un terminal (folosim combinația de taste <code><strong>Alt+Ctrl+t</strong></code>) și clonăm repository-ului oficial uso. 
</p>

<p>
<p><div class="noteimportant">Ne asigurăm că suntem în <code>/home/student</code>
</div></p>
</p>

<p>
Folosim comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">git clone</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>systems-cs-pub-ro<span class="sy0">/</span>uso</pre>

<p>
În directorul <code>/home/student/uso/lab04</code> găsim fișierele necesare pentru laboratorul 4.
</p>

<p>
<p><div class="notetip">Recomandăm rezolvarea exercițiilor pe mașina virtuală USO pe care o veți avea și la teme și la testul practic. Informații pas cu pas despre importul și pornirea acesteia se află în secțiunea <a href="../../../../uso/resurse/mv.html" class="wikilink1" title="uso:resurse:mv">Mașina virtuală</a>.
</p>

<p>
Pentru acest laborator putem porni la lucru cu mașina cu interfață grafică, aceasta se află în <code>/mnt/unfrozen</code>. Drept urmare importăm fișierul <code>/mnt/unfrozen/uso_2016_2017_gnome.ova</code>
</p>

<p>

</div></p>
</p>

</div>
<!-- EDIT23 SECTION "[0] Pregătire setup laborator (0.5p)" [20067-21019] -->
<h2 class="sectionedit24" id="utilizatori1">Utilizatori</h2>
<div class="level2">

</div>
<!-- EDIT24 SECTION "Utilizatori" [21020-21046] -->
<h3 class="sectionedit25" id="adaugarea_de_noi_utilizatori_si_de_grupuri_2p">[1] Adăugarea de noi utilizatori și de grupuri (2p)</h3>
<div class="level3">

<p>
Ca administratori ai infrastructurii IT a școlii de care răspundeți ați primit <a href="https://docs.google.com/spreadsheets/d/15LxIrhz0JTdLgWJqyHwj4hfVOg_uW6TyRnUbKqEtB8Y/edit#gid=0" class="urlextern" title="https://docs.google.com/spreadsheets/d/15LxIrhz0JTdLgWJqyHwj4hfVOg_uW6TyRnUbKqEtB8Y/edit#gid=0"  rel="nofollow">următorul excel</a> cu nume de utilizatori și grupuri din care trebuie să facă parte, conform cu politica școlii. 
</p>

<p>
Sarcina voastră este să adăugați în sistem grupurile și apoi utilizatorii, utilizatorii să îi înscrieți în grupuri conform cu excelul primit. 
</p>

<p>
De asemenea, trebuie să configurați următoarele parole:
</p>
<ul>
<li class="level1"><div class="li"> Studenții vor avea parola <code>student</code></div>
</li>
<li class="level1"><div class="li"> Profesorii vor avea parola <code>profesor007</code></div>
</li>
<li class="level1"><div class="li"> Adminii vor avea parola <code>admin1234</code></div>
</li>
</ul>

<p>
Pentru cei care sunt în mai multe grupuri simultan alegeți parola mai dificilă (să conțină cifre diferite). 
</p>

<p>
<p><div class="noteclassic">Pentru <strong>verificarea</strong> adăugării utilizatorilor în sistem trebuie să inspectăm fișierele: <code>/etc/passwd</code> și pentru grupuri <code>/etc/group</code>. De asemenea, pentru a vedea grupurile din care face parte un anumit utilizator (să zicem <code>dan</code>) și totodată existența sa în sistem mai putem folosi comanda:
</p>
<pre class="code bash"><span class="co4">student@uso~$ </span><span class="kw2">id</span> dan</pre>

<p>
De asemenea, pentru a nu cauta in fisierele <code>/etc/passwd</code> sau <code>/etc/group</code> putem folosi comanda <a href="http://man7.org/linux/man-pages/man1/getent.1.html" class="urlextern" title="http://man7.org/linux/man-pages/man1/getent.1.html"  rel="nofollow">getent</a> ca mai jos pentru verificarea direct a setarilor pentru un user sau un grup:
</p>
<pre class="code bash">student<span class="sy0">@</span>uso~$ <span class="kw2">getent</span> <span class="kw2">passwd</span> dan
dan:x:<span class="nu0">1003</span>:<span class="nu0">1003</span>:Dan:<span class="sy0">/</span>home<span class="sy0">/</span>public<span class="sy0">/</span>dan:<span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw2">bash</span>
student<span class="sy0">@</span>uso~$ <span class="kw2">getent</span> group gdm
gdm:x:<span class="nu0">42</span>:</pre>

<p>

</div></p>
</p>

</div>
<!-- EDIT25 SECTION "[1] Adăugarea de noi utilizatori și de grupuri (2p)" [21047-23984] -->
<h3 class="sectionedit26" id="schimbarea_homedir-ului_altui_utilizator_1p">[2] Schimbarea homedir-ului altui utilizator (1p)</h3>
<div class="level3">

<p>
Configurați sistemul astfel încât home directory-ul utilizatorului <code>dan</code> în loc de <code>/home/dan</code> să fie <code>/home/public/dan</code>. Creați directorul dacă acesta nu există. 
</p>

<p>
Indicație: Folosim <a href="http://linux.die.net/man/8/usermod" class="urlextern" title="http://linux.die.net/man/8/usermod"  rel="nofollow">usermod (modify a user account)</a>. Căutați după <code>new login directory</code>.   
</p>

<p>
<strong>Pentru verificare</strong> : Apăsați <code>Ctrl+D</code> pentru a reveni la terminalul în care erați autentificați ca <code>student</code> după care încercați comanda <code>su - dan</code>. Dați <code>pwd</code> și verificați că homedir-ul acestuia e cel configurat cu <code>usermod</code>. Alt mod de a verifica este inspectarea fișierului <code>/etc/passwd</code> și căutând linia care conține <code>dan</code>. 
</p>

<p>
<p><div class="notetip">Pentru a ne autentifica cu un anumit utilizator și a ne muta în homedir-ul lui folosim  <code>su - dan</code> in loc de simplu <code>su dan</code>
</div></p>
</p>

</div>
<!-- EDIT26 SECTION "[2] Schimbarea homedir-ului altui utilizator (1p)" [23985-24955] -->
<h3 class="sectionedit27" id="a_drepturi_de_sudo_pentru_un_utilizator_1p">[3a] Drepturi de sudo pentru un utilizator (1p)</h3>
<div class="level3">

<p>
Suntem autentificați ca utilizatorul <code>corina</code> și vrem să instalăm un pachet. Observăm totuși că nu avem permisiuni.
</p>
<pre class="code bash"><span class="co4">corina@midgard:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> <span class="kw2">tree</span>
<span class="br0">&#91;</span><span class="kw2">sudo</span><span class="br0">&#93;</span> password <span class="kw1">for</span> corina: 
corina is not <span class="kw1">in</span> the sudoers file.  This incident will be reported.</pre>

<p>
<p><div class="notetip">
Pentru a acorda <em>drepturi de sudo</em> unui utilizator se folosește comanda <code>visudo</code>. Reveniți la shellul utilizatorului <code>student</code> (<code>Ctrl+D</code>) și tastați comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">sudo</span> visudo</pre>

<p>

</div></p>
</p>

<p>
Dați drepturi utilizatorului <code>corina</code> de a instala pachete in sistem, fără a i se cere parola. Puteți vedea un exemplu de configurație pe <a href="http://askubuntu.com/questions/139723/sudo-does-not-ask-for-password" class="urlextern" title="http://askubuntu.com/questions/139723/sudo-does-not-ask-for-password"  rel="nofollow">askubuntu</a>. 
</p>

<p>
<p><div class="noteclassic"><strong>Verificare:</strong> Reautentificați-vă drept <code>corina</code> și încercați din nou să rulați o comandă de instalare de pachete în sistem folosind <code>sudo</code>.
</div></p>
</p>

</div>
<!-- EDIT27 SECTION "[3a] Drepturi de sudo pentru un utilizator (1p)" [24956-26585] -->
<h3 class="sectionedit28" id="b_drepturi_de_sudo_pentru_un_grup_1p">[3b] Drepturi de sudo pentru un grup (1p)</h3>
<div class="level3">

<p>
În același mod configurați sistemul astfel încât utilizatorii din grupul <code>profesor</code> să aibă drepturi depline de <code>sudo</code> în sistem. 
</p>

<p>
Autentificați-vă în sistem ca <code>geo</code> și ca <code>răzvan</code> și <strong>verificați</strong> că funcționează comanda:
</p>
<pre class="code bash"><span class="co4">geo@uso:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> rig</pre>

<p>
Asigurați-vă că nu apare eroarea (dacă apare înseamnă că ați greșit configurația din <code>visudo</code>): 
</p>
<pre class="code bash"><span class="br0">&#40;</span>...<span class="br0">&#41;</span>
geo is not <span class="kw1">in</span> the sudoers file. This incident will be reported.
<span class="br0">&#40;</span>...<span class="br0">&#41;</span></pre>

</div>
<!-- EDIT28 SECTION "[3b] Drepturi de sudo pentru un grup (1p)" [26586-27510] -->
<h2 class="sectionedit29" id="procese1">Procese</h2>
<div class="level2">

</div>
<!-- EDIT29 SECTION "Procese" [27511-27532] -->
<h3 class="sectionedit30" id="lucrul_cu_procese_in_backgroudforeground_2p">[4] Lucrul cu procese în backgroud/foreground (2p)</h3>
<div class="level3">

<p>
Mergeți în directorul <code>/home/student/uso/lab04</code> și rulați scriptul <code>bg-proc.sh</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw3">cd</span> uso<span class="sy0">/</span>lab04
<span class="co4">student@midgard:~$ </span>.<span class="sy0">/</span>bg-proc.sh 
Tick<span class="sy0">!</span>
Tock<span class="sy0">!</span>
Tick<span class="sy0">!</span>
...</pre>

<p>
Observăm că procesul rulează la infinit și afișează pe ecran un mesaj din secundă în secundă. Încercăm să rulăm o comandă simplă, spre exemplu <code>ls</code>, dar vedem că ea este ignorată. Acest lucru se datorează faptului că procesul nostru se află în <strong>foreground</strong>, așa că tot ce tastăm noi se duce practic ca input pentru respectivul proces. Căutați în cheatsheet o combinație de taste ce trimite procesul nostru în <strong>background</strong>.
</p>

<p>
Verificăm că procesul există încă. Pentru aceasta tastați comanda <code>ps</code>. Dorim acum să repornim procesul, dar nu mai vrem să fie tot în <strong>foreground</strong>, ci vrem să avem access și la shell în acest timp. Pentru aceasta folosim comanda <code>bg</code>. Observați că imediat după ce o tastăm au reînceput să apară mesajele pe ecran. Tastați iarăși comanda <code>ls</code> și vedem că de data aceasta ea funcționează <em>aproape</em> așa cum ne așteptăm. Afișează fișierele și directoarele din directorul curent, dar în același timp sunt afișate și mesajele periodice ale procesului nostru.
</p>

<p>
<p><div class="notetip">
Fenomenul de mai sus se produce datorită faptului că terminalul nostru este legat la <em>ieșirea</em> (<strong>stdout</strong>) a două procese, <code>ls</code> și <code>bg-proc.sh</code>. Mai multe detalii despre cele 3 intrări/ieșiri standard ale unui proces puteți găsi <a href="http://en.wikipedia.org/wiki/Standard_streams" class="urlextern" title="http://en.wikipedia.org/wiki/Standard_streams"  rel="nofollow">aici</a>.

</div></p>
</p>

</div>
<!-- EDIT30 SECTION "[4] Lucrul cu procese în backgroud/foreground (2p)" [27533-29676] -->
<h3 class="sectionedit31" id="terminarea_unui_set_de_procese_15p">[5] Terminarea unui set de procese (1.5p)</h3>
<div class="level3">

<p>
Deschideți atât browser-ul Firefox, cât și browser-ul Chromium. Deschideți câte 5 tab-uri în fiecare browser. Folosind <a href="http://linux.die.net/man/1/ps" class="urlextern" title="http://linux.die.net/man/1/ps"  rel="nofollow">ps</a>, sau mai util <a href="http://linux.die.net/man/1/pgrep" class="urlextern" title="http://linux.die.net/man/1/pgrep"  rel="nofollow">pgrep</a>, identificați PID-urile proceselor deschise de cele două browsere. 
</p>

<p>
Folosind <a href="http://linux.die.net/man/1/htop" class="urlextern" title="http://linux.die.net/man/1/htop"  rel="nofollow">htop</a> monitorizați consumul de resurse al acestor procese (e.g. CPU percent usage, RAM usage). 
</p>

<p>
Ce se va întâmpla la rularea următoarei comenzi? Vom pierde toată sesiunea din Firefox?
</p>
<pre class="code bash">pkill <span class="re5">-f</span> firefox</pre>

<p>
Folosind PID-urile identificate anterior, trimiteți semnalul <code>SIGINT (2)</code> procesului <code>chrome</code> cu cel mai mare PID. Pierdem toată sesiunea în acest caz? Dar dacă rulăm comanda de mai jos, similar cu cea trimisă lui Firefox?
</p>
<pre class="code bash">pkill chromium</pre>

<p>
Despre <a href="http://linux.die.net/man/1/pkill" class="urlextern" title="http://linux.die.net/man/1/pkill"  rel="nofollow">pkill</a> puteți citi și în <a href="http://www.thegeekstuff.com/2009/12/4-ways-to-kill-a-process-kill-killall-pkill-xkill/" class="urlextern" title="http://www.thegeekstuff.com/2009/12/4-ways-to-kill-a-process-kill-killall-pkill-xkill/"  rel="nofollow">acest articol</a>.
</p>

<p>
Despre monitorizarea proceselor și trimiterea semnalelor recomandăm <a href="http://www.cyberciti.biz/faq/kill-process-in-linux-or-terminate-a-process-in-unix-or-linux-systems/" class="urlextern" title="http://www.cyberciti.biz/faq/kill-process-in-linux-or-terminate-a-process-in-unix-or-linux-systems/"  rel="nofollow">acest articol</a>.  
</p>

</div>
<!-- EDIT31 SECTION "[5] Terminarea unui set de procese (1.5p)" [29677-30934] -->
<h3 class="sectionedit32" id="terminarea_fortata_a_unui_proces_1p">[6] Terminarea forțată a unui proces (1p)</h3>
<div class="level3">

<p>
Mergeți în directorul <code>/home/student/uso/lab04</code> și rulați scriptul <code>it-s-a-trap.sh</code>. Eram obișnuiți ca atunci când avem un proces în <strong>foreground</strong> să-l putem opri cu combinația de taste <code>Ctrl+C</code>, însă observăm că acest lucru nu mai funcționează în cazul procesului nostru.
</p>
<pre class="code bash">student<span class="sy0">@</span>midgard:~<span class="sy0">/</span>uso<span class="sy0">/</span>lab04$ .<span class="sy0">/</span>it-s-a-trap.sh 
Still running . . . 
Still running . . . 
^CIT<span class="st_h">'s A TRAP!
Still running . . . 
^CIT'</span>s A TRAP<span class="sy0">!</span>
...</pre>

<p>
Porniți un alt terminal și aflați PID-ul procesului folosind comanda <code>ps</code>. După ce l-ați aflat, haideți să încercăm să-l omorâm așa cum am făcut cu celălalt proces la exercițiul precedent.
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">ps</span> U student
  PID TTY      STAT   TIME COMMAND
 <span class="nu0">1545</span> ?        Sl     <span class="nu0">0</span>:00 <span class="sy0">/</span>usr<span class="sy0">/</span>bin<span class="sy0">/</span>gnome-keyring-daemon <span class="re5">--daemonize</span> <span class="re5">--login</span>
 <span class="nu0">12361</span> pts<span class="sy0">/</span><span class="nu0">25</span>   S+     <span class="nu0">0</span>:00 <span class="sy0">/</span>bin<span class="sy0">/</span><span class="kw2">bash</span> .<span class="sy0">/</span>it-s-a-trap.sh
<span class="nu0">12371</span> pts<span class="sy0">/</span><span class="nu0">25</span>   S+     <span class="nu0">0</span>:00 <span class="kw2">sleep</span> <span class="nu0">3</span>
<span class="nu0">12372</span> pts<span class="sy0">/</span><span class="nu0">26</span>   R+     <span class="nu0">0</span>:00 <span class="kw2">ps</span> U student
<span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="nu0">12361</span></pre>

<p>
încercați să-i trimiteți diferite semnale, de exemplu <code>SIGTERM</code>, <code>SIGINT</code>, <code>SIGQUIT</code> și observați ce se întâmplă. Cum reacționează procesul la ele?
</p>

<p>
Pentru a afișa lista de semnale disponibile folosim comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="re5">-l</span>
 <span class="nu0">1</span><span class="br0">&#41;</span> SIGHUP	 <span class="nu0">2</span><span class="br0">&#41;</span> SIGINT	 <span class="nu0">3</span><span class="br0">&#41;</span> SIGQUIT	 <span class="nu0">4</span><span class="br0">&#41;</span> SIGILL	 <span class="nu0">5</span><span class="br0">&#41;</span> SIGTRAP
 <span class="nu0">6</span><span class="br0">&#41;</span> SIGABRT	 <span class="nu0">7</span><span class="br0">&#41;</span> SIGBUS	 <span class="nu0">8</span><span class="br0">&#41;</span> SIGFPE	 <span class="nu0">9</span><span class="br0">&#41;</span> SIGKILL	<span class="nu0">10</span><span class="br0">&#41;</span> SIGUSR1
<span class="nu0">11</span><span class="br0">&#41;</span> SIGSEGV	<span class="nu0">12</span><span class="br0">&#41;</span> SIGUSR2	<span class="nu0">13</span><span class="br0">&#41;</span> SIGPIPE	<span class="nu0">14</span><span class="br0">&#41;</span> SIGALRM	<span class="nu0">15</span><span class="br0">&#41;</span> SIGTERM
<span class="nu0">16</span><span class="br0">&#41;</span> SIGSTKFLT	<span class="nu0">17</span><span class="br0">&#41;</span> SIGCHLD	<span class="nu0">18</span><span class="br0">&#41;</span> SIGCONT	<span class="nu0">19</span><span class="br0">&#41;</span> SIGSTOP	<span class="nu0">20</span><span class="br0">&#41;</span> SIGTSTP
<span class="nu0">21</span><span class="br0">&#41;</span> SIGTTIN	<span class="nu0">22</span><span class="br0">&#41;</span> SIGTTOU	<span class="nu0">23</span><span class="br0">&#41;</span> SIGURG	<span class="nu0">24</span><span class="br0">&#41;</span> SIGXCPU	<span class="nu0">25</span><span class="br0">&#41;</span> SIGXFSZ
<span class="nu0">26</span><span class="br0">&#41;</span> SIGVTALRM	<span class="nu0">27</span><span class="br0">&#41;</span> SIGPROF	<span class="nu0">28</span><span class="br0">&#41;</span> SIGWINCH	<span class="nu0">29</span><span class="br0">&#41;</span> SIGIO	<span class="nu0">30</span><span class="br0">&#41;</span> SIGPWR</pre>
<table class="columns-plugin" style="width:50%">
<tr><td class="columns-plugin first" style="width:50%;">
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="re5">-SIGTERM</span> <span class="nu0">12361</span>
<span class="co4">student@midgard:~$ </span><span class="kw2">kill</span> <span class="re5">-SIGINT</span> <span class="nu0">12361</span></pre>
</td><td class="columns-plugin last">
<pre class="code bash">student<span class="sy0">@</span>midgard:~<span class="sy0">/</span>uso<span class="sy0">/</span>lab04$ .<span class="sy0">/</span>it-s-a-trap.sh 
Still running . . . 
IT<span class="st_h">'s A TRAP!
Still running . . . 
IT'</span>s A TRAP<span class="sy0">!</span>
Still running . . . 
Still running . . . 
...</pre>
</td></tr></table>

<p>
S-ar părea că procesul nostru este imun la semnale. Să încercăm și cu semnalul <code>SIGKILL</code>. Trimiteți-i-l și pe acesta. Ce s-a întâmplat cu procesul nostru?
</p>

<p>
<p><div class="notetip">
Singurul semnal care nu poate fi interceptat și ignorat de către niciun proces este semnalul <code>SIGKILL</code>, așadar el garantându-ne terminarea procesului. Dezavantajul este însă că procesul va fi terminat brusc, fără a mai realiza nicio procedură de salvarea a stării curente, așa cum se întâmplă în cazul altor semnale precum <code>SIGTERM</code>.

</div></p>
</p>

<p>
<p><div class="notetip">
Putem trimite semnale unui proces și doar folosind indexul semnalui, nu neapărat numele lui. Astfel comanda <code>kill -9 $PID</code> este echivalentă cu comanda <code>kill -SIGKILL $PID</code>, de exemplu. 

</div></p>
</p>

<p>
<p><div class="noteimportant">Rețineți că la folosirea <code>kill -9</code> resursele ocupate de un proces (e.g.: fisiere) e foarte posibil să nu fie eliberate deloc sau să nu fie eliberate corect. 
</div></p>
</p>

</div>
<!-- EDIT32 SECTION "[6] Terminarea forțată a unui proces (1p)" [30935-34148] -->
<h3 class="sectionedit33" id="bonus_1_resurse_ocupate_de_un_proces_1_karma_wouso">[BONUS #1] Resurse ocupate de un proces [1 karma WoUSO]</h3>
<div class="level3">

<p>
Porniți instalarea următorului pachet (are în jur de <code>1.5 <abbr title="Gigabyte">GB</abbr></code>) și lăsați instalarea să curgă în terminal: 
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get</span> <span class="re5">-y</span> <span class="kw2">install</span> texlive-full</pre>

<p>
Deschideți un alt terminal. Încercați să instalați un singur pachet, spre exemplu:
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get</span> <span class="re5">-y</span> <span class="kw2">install</span> toilet</pre>

<p>
Ce eroare obținem? Am folosit drepturile privilegiate, iar pachetul există: 
</p>
<pre class="code bash">E: Could not get lock <span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dpkg<span class="sy0">/</span>lock - open <span class="br0">&#40;</span><span class="nu0">11</span>: Resource temporarily unavailable<span class="br0">&#41;</span>
E: Unable to lock the administration directory <span class="br0">&#40;</span><span class="sy0">/</span>var<span class="sy0">/</span>lib<span class="sy0">/</span>dpkg<span class="sy0">/</span><span class="br0">&#41;</span>, is another process using it?
W: Could not lock the cache <span class="kw2">file</span>; this usually means that <span class="kw2">dpkg</span> or another apt tool is already installing packages.  Opening <span class="kw1">in</span> read-only mode; any changes you <span class="kw2">make</span> to the states of packages will NOT be preserved<span class="sy0">!</span></pre>

<p>
Între timp am uitat de instalarea lungă pornită în fundal în celălalt terminal. Identificați PID-ul procesului care ține resursa <code>/var/lib/dpkg/lock</code> ocupată. 
</p>

<p>
<p><div class="notetip">În cazul de față, în Linux, o dată pornită o instalare se pune lock pe o resursă și alte procese care încearcă să pornească o instalare nu mai au voie până când resursa nu e eliberată. 
</p>

<p>
Pentru depanarea problemei noastre cel mai bun utilitar este folosirea <a href="http://linux.die.net/man/8/lsof" class="urlextern" title="http://linux.die.net/man/8/lsof"  rel="nofollow">lsof</a> (cu ajutorul lui putem identifica ce procese țin deschis un anumit fișier) sau o variantă simplificată, dedicată acestei sarcini: <a href="http://linux.die.net/man/1/fuser" class="urlextern" title="http://linux.die.net/man/1/fuser"  rel="nofollow">fuser</a>

</div></p>
</p>

<p>
După ce ați identificat PID-ul procesului care ține ocupată resursa <code>/var/lib/dpkg/lock</code> listați și celelalte fișiere deschise de acel proces folosind <a href="http://linux.die.net/man/5/proc" class="urlextern" title="http://linux.die.net/man/5/proc"  rel="nofollow">procfs</a>.
</p>

</div>
<!-- EDIT33 SECTION "[BONUS #1] Resurse ocupate de un proces [1 karma WoUSO]" [34149-35947] -->
<h3 class="sectionedit34" id="bonus_2_procese_detasate_de_terminal_1_karma_wouso">[BONUS #2] Procese detașate de terminal [1 Karma WoUSO]</h3>
<div class="level3">

<p>
<p><div class="notewarning">Pentru acest exercițiu avem nevoie de pachetul <code>transmission-cli</code>. Îl putem instala folosind comanda
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> transmission-cli</pre>

<p>

</div></p>
</p>

<p>
Folosiți <code>Transmission</code> în linie de comandă pentru a descărca mașina virtuală pentru tema de la USO, <a href="http://elf.cs.pub.ro/uso/res/teme/" class="urlextern" title="http://elf.cs.pub.ro/uso/res/teme/"  rel="nofollow">de aici</a>. Descărcați fișierul <code>.torrent</code> în <code>/home/student/Downloads</code>.
</p>
<pre class="code bash"><span class="co4">student@midgard:~$ </span>transmission-cli ~<span class="sy0">/</span>Downloads<span class="sy0">/</span>USO-Mint-VM.ova.torrent</pre>

<p>
Dintr-un alt terminal determinați PID-ul acestui proces. 
Închideți terminalul din interfața grafică (<code>X</code> din colțul din dreapta sus). Căutați din nou procesul după identificator. Ce s-a întâmplat cu procesul nostru <code>transmission-cli</code> tocmai creat? Care credeți că este cauza?
</p>

<p>
Deschideți din nou un terminal, dar de data folosiți-vă de comanda <code>nohup</code> (<code>man nohup</code>) pentru a lansa procesul <code>transmission-cli</code> pentru descărcarea temei de la USO. Închideți din nou terminalul din interfața grafică. Observați că procesul rămâne în viață. Determinați PID-ul acestui proces. 
</p>

<p>
Ce fel de semnal se generează atunci când închidem terminalul și pe care a doua oară procesul <code>transmission-gtk</code> îl ignoră?
</p>

</div>
<!-- EDIT34 SECTION "[BONUS #2] Procese detașate de terminal [1 Karma WoUSO]" [35948-37680] -->
<h3 class="sectionedit35" id="bonus_3_trimiterea_de_semnale_unui_proces_1_karma_wouso">[BONUS #3]  Trimiterea de semnale unui proces [1 karma WoUSO]</h3>
<div class="level3">

<p>
Mergeți în directorul <code>/home/student/uso/lab04</code> unde găsiți scriptul <code>batman.sh</code>. Rulați-l. Procesul interceptează toate semnalele cu indecși de la 1 la 13, mai puțin 9 (din motive evidente). De fiecare dată când primește un semnal cu indexul între 1 și 13 el afișează pe ecran un caracter. Mai jos aveți maparea dintre indecșii semnalelor și caracterul afișat:
</p>
<table class="columns-plugin" style="width:50%">
<tr><td class="columns-plugin first" style="width:50%;">
<div class="table sectionedit36"><table class="inline">
	<tr class="row0">
		<th class="col0">Index semnal </th><th class="col1"> Caracter </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 1           </td><td class="col1 centeralign">  o       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 2           </td><td class="col1 centeralign">  u       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 3           </td><td class="col1 centeralign">  c       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 4           </td><td class="col1 centeralign">  d       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 5           </td><td class="col1 centeralign">  e       </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 6           </td><td class="col1 centeralign">  z       </td>
	</tr>
</table></div>
<!-- EDIT36 TABLE [38161-38349] --></td><td class="columns-plugin last">
<div class="table sectionedit37"><table class="inline">
	<tr class="row0">
		<th class="col0">Index semnal </th><th class="col1"> Caracter </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 7           </td><td class="col1 centeralign">  s       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 8           </td><td class="col1 centeralign">  h       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 10          </td><td class="col1 rightalign">  (space) </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 11          </td><td class="col1 centeralign">  r       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 12          </td><td class="col1 centeralign">  k       </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 13          </td><td class="col1 centeralign">  l       </td>
	</tr>
</table></div>
<!-- EDIT37 TABLE [38364-38552] --></td></tr></table>

<p>
 Într-un alt terminal aflați pid-ul procesului și trimiteți-i semnale astfel încât procesul să afișeze pe ecran șirul de caractere <code>uso rullz</code>. 
</p>

</div>
<!-- EDIT35 SECTION "[BONUS #3]  Trimiterea de semnale unui proces [1 karma WoUSO]" [37681-40701] -->
<h2 class="sectionedit38" id="sumar_cuvinte_cheie">Sumar. Cuvinte cheie</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Utilizator (user): cont cu care ne putem autentifica pe un sistem. Sunt identificați printr-un UID <strong>U</strong>ser <strong>ID</strong></div>
</li>
<li class="level1"><div class="li"> UID-ul lui <code>root</code> este 0. PID-ul lui <code>init</code> este 1.</div>
</li>
<li class="level1"><div class="li"> Adăugare utilizatori: <code>adduser</code>, <code>deluser</code>. Mai generale: <code>useradd</code>, <code>userdel</code>.</div>
</li>
<li class="level1"><div class="li"> Modificarea proprietăților unui utilizator: <code>usermod</code></div>
</li>
<li class="level1"><div class="li"> Schimbă parola: <code>passwd</code></div>
</li>
<li class="level1"><div class="li"> Execută o comandă cu drepturi elevate: <code>sudo</code></div>
</li>
<li class="level1"><div class="li"> Proces: executabil care rulează în momentul de față. Mai multe rulări, mai multe procese (fiecare cu al său).</div>
</li>
<li class="level1"><div class="li"> PID: <strong>P</strong>rocess <strong>ID</strong></div>
</li>
<li class="level1"><div class="li"> PPID: <strong>P</strong>arent <strong>P</strong>rocess <strong>ID</strong></div>
</li>
<li class="level1"><div class="li"> Vizualizarea proceselor ce rulează la un moment dat: <code>ps</code>, <code>pstree</code></div>
</li>
<li class="level1"><div class="li"> Vizualizarea proceselor ce rulează la un moment dat într-un mod interactiv: <code>top</code>, <code>htop</code></div>
</li>
<li class="level1"><div class="li"> Trimiterea de semnale unui process: <code>kill</code>. <code>kill -9 $PID</code> pentru a fi siguri că procesul moare.</div>
</li>
<li class="level1"><div class="li"> Rularea de procese în background: <code>&amp;</code>. Spre exemplu <pre class="code bash"><span class="co4">student@midgard:~$ </span>firefox <span class="sy0">&amp;</span> </pre>
</div>
</li>
<li class="level1"><div class="li"> Terminarea tuturor proceselor pornite din același executabil: <code>killall</code>, <code>pkill</code></div>
</li>
</ul>

</div>
<!-- EDIT38 SECTION "Sumar. Cuvinte cheie" [40702-] --></div>
</body>
</html>
