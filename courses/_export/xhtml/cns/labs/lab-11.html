    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>cns:labs:lab-11</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-01-12T22:12:37+0200"/>
<meta name="keywords" content="cns,labs,lab-11"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=cns:labs"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="lab-11.html"/>
<link rel="canonical" href="../../../../cns/labs/lab-11.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='cns:labs';var JSINFO = {"id":"cns:labs:lab-11","namespace":"cns:labs","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="lab-11.html#lab_11_-_web_application_security_part_1">Lab 11 - Web Application Security (part 1)</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="lab-11.html#resources">Resources</a></div></li>
<li class="level2"><div class="li"><a href="lab-11.html#supporting_files">Supporting files</a></div></li>
<li class="level2"><div class="li"><a href="lab-11.html#introduction">Introduction</a></div></li>
<li class="level2"><div class="li"><a href="lab-11.html#p_0_feedback">[1p] 0. Feedback</a></div></li>
<li class="level2"><div class="li"><a href="lab-11.html#p_1_warm-up_tasksearching_for_public_data_and_getpost">[2p] 1. Warm-up task: searching for public data and GET/POST</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="lab-11.html#p_a_searching_for_public_data">[1p] a. Searching for public data</a></div></li>
<li class="level3"><div class="li"><a href="lab-11.html#p_b_talking_to_web_sites">[1p] b. Talking to web sites</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="lab-11.html#p_2_burp_tutorial">[3p] 2. Burp tutorial</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="lab-11.html#p_a_proxy">[1p] a. Proxy</a></div></li>
<li class="level3"><div class="li"><a href="lab-11.html#p_b_surface_mapping">[2p] b.  Surface Mapping</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="lab-11.html#p_3_cms_mini_security_analysis">[5p] 3. CMS Mini security analysis</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="lab-11.html#p_a_forceful_path_discovery">[1p] a. Forceful path discovery</a></div></li>
<li class="level3"><div class="li"><a href="lab-11.html#p_b_information_disclosure">[1p] b. Information disclosure</a></div></li>
<li class="level3"><div class="li"><a href="lab-11.html#p_c_local_file_inclusion">[3p] c. Local File Inclusion</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="lab_11_-_web_application_security_part_1">Lab 11 - Web Application Security (part 1)</h1>
<div class="level1">

</div>
<!-- EDIT1 SECTION "Lab 11 - Web Application Security (part 1)" [1-58] -->
<h2 class="sectionedit2" id="resources">Resources</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://en.wikipedia.org/wiki/Google_Search#Search_options" class="urlextern" title="http://en.wikipedia.org/wiki/Google_Search#Search_options"  rel="nofollow">Google search options</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://wapiti.sourceforge.net/" class="urlextern" title="http://wapiti.sourceforge.net/"  rel="nofollow">Wapiti</a>, <a href="https://code.google.com/p/skipfish/" class="urlextern" title="https://code.google.com/p/skipfish/"  rel="nofollow">Skipfish</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://portswigger.net/burp/" class="urlextern" title="http://portswigger.net/burp/"  rel="nofollow">Burp</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://www.w3schools.com/tags/ref_httpmethods.asp" class="urlextern" title="http://www.w3schools.com/tags/ref_httpmethods.asp"  rel="nofollow">HTTP methods: GET vs. POST</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://tools.ietf.org/html/rfc6265" class="urlextern" title="http://tools.ietf.org/html/rfc6265"  rel="nofollow">RFC 6265: HTTP State Management Mechanism</a></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Resources" [59-477] -->
<h2 class="sectionedit3" id="supporting_files">Supporting files</h2>
<div class="level2">

<p>
For this lab, install the <a href="http://portswigger.net/burp/" class="urlextern" title="http://portswigger.net/burp/"  rel="nofollow">Burp suite</a>. Download the <a href="http://portswigger.net/burp/downloadfree.html" class="urlextern" title="http://portswigger.net/burp/downloadfree.html"  rel="nofollow">free version</a>, copy it in the home directory and run it later using:
</p>
<pre class="code">$ java -jar ~/burpsuite_free_v1.6.jar</pre>

<p>
assuming that <code>burpsuite_free_v1.6.jar</code> is the name of the downloaded file.
</p>

<p>
We will use a <a href="http://elf.cs.pub.ro/oss/res/labs/cnsweb.ova" class="urlextern" title="http://elf.cs.pub.ro/oss/res/labs/cnsweb.ova"  rel="nofollow">vulnerable virtual machine</a> as a target for our attacks. <a href="http://elf.cs.pub.ro/oss/res/labs/cnsweb.ova" class="urlextern" title="http://elf.cs.pub.ro/oss/res/labs/cnsweb.ova"  rel="nofollow">Download</a> it (the file has about 250MB) and import it into VirtualBox by selecting <code>File</code> → <code>Import Appliance</code> and selecting <code>cnsweb.ova</code>.
</p>

<p>
Add a new network adapter (<code>Adapter 2</code>) of the type <code>Host-only Adapter</code>). This will be adapter you will use for connecting uring Burp. After booting up the virtual machine, you can find its IP by logging in directly from VirtualBox as <code>student</code> (password <code>student</code>); you will be shown a window with the IP address to use; you can not do anything more than that; you are just going to use the IP address to connect to the virtual machine using Burp.
</p>

<p>
<p><div class="notetip">
You can get out of the VirtualBox virtual machine console by using the right <code>Ctrl</code> key.

</div></p>
</p>

<p>
You can then test that the web server is working by issuing
</p>
<pre class="code">$ sudo apt-get update &amp;&amp; sudo apt-get install curl
$ curl $SERVER_IP</pre>

<p>
where <code>$SERVER_IP</code> is the Virtual Machine&#039;s IP address.
</p>

<p>
<p><div class="noteclassic">
You might get a warning saying that the <code>.ova</code> file doesn&#039;t respect the OVF specification. Everything should be ok if you press <code>Retry</code> and then check that the networking adapter is set to “bridged”.

</div></p>
</p>

<p>
<p><div class="notewarning">
Do not attempt to attack the machine by any means other than exploiting the web applications on it. While this is a normal thing to do at a security course and we encourage you to try it at home, it could possibly make the lab setup unusable.

</div></p>
</p>

</div>
<!-- EDIT3 SECTION "Supporting files" [478-2411] -->
<h2 class="sectionedit4" id="introduction">Introduction</h2>
<div class="level2">

<p>
As the World Wide Web&#039;s high-level topology consists mainly of personal computing devices (e.g. desktops, laptops, mobile devices) making HTTP requests to web servers, the general field of web security consists of three main sub-fields: client-side security (i.e. browser security), communications security and server-side security, or <strong>web application security</strong>. This lab and <a href="../../../../cns/labs/lab-12.html" class="wikilink1" title="cns:labs:lab-12">the following</a> will focus on the latter sub-field, although they might provide some general information on the former two.
</p>

<p>
The design of web applications, and their security in particular is influenced by the following characteristics:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Statelessness</strong>: by default HTTP is a simple request-response protocol maintaing no state between successive communications. This shortcoming led to the design of <strong>cookies</strong>, which are small pieces of information exchanged between the client and the web application. The type of information exchanged using cookies needs to be carefully chosen, as a malicious client could possibly attempt to send back a malformed or forged cookie; additionally, cookies most often (but not always) represent <em>confidential</em> data, which means that they should only be transferred over a secure channel (i.e. <a href="http://en.wikipedia.org/wiki/HTTP_Secure" class="urlextern" title="http://en.wikipedia.org/wiki/HTTP_Secure"  rel="nofollow">HTTPS</a>).</div>
</li>
<li class="level1"><div class="li"> <strong>Message format</strong>: HTTP requests have a specific format, namely they comprise plain-text header and data (although <a href="http://en.wikipedia.org/wiki/HTTP/2" class="urlextern" title="http://en.wikipedia.org/wiki/HTTP/2"  rel="nofollow">newer improvements</a> also implement a binary protocol). The header contains various information about the client or the server (e.g. a user-agent, page caching information, text encoding information), while the payload is very often (but not always) a <abbr title="HyperText Markup Language">HTML</abbr> page.</div>
</li>
<li class="level1"><div class="li"> <strong>Addressing</strong>: resources on the web are located using the <abbr title="Uniform Resource Identifier">URI</abbr>/<abbr title="Uniform Resource Locator">URL</abbr> addressing scheme. Possible vulnerabilities here include a misconfigured web server that allows viewing application-specific files, or worse, that allow accessing other files on the host machine. While this information leakage is not very dangerous by itself, it may be used as an intermediary stage for other attacks.</div>
</li>
<li class="level1"><div class="li"> <strong>Request methods</strong>: HTTP communication is most often done using the GET and POST methods. Both methods allow clients to define variables and transfer them as arguments to the server. The fundamental difference between the two is that GET encodes variables in the <abbr title="Uniform Resource Locator">URL</abbr>, while POST encodes them in the message body. w3schools gives a <a href="http://www.w3schools.com/tags/ref_httpmethods.asp" class="urlextern" title="http://www.w3schools.com/tags/ref_httpmethods.asp"  rel="nofollow">brief explanation</a> of how each of them is used.</div>
</li>
</ul>

<p>
<p><div class="noteclassic">While POST hides variables from the <abbr title="Uniform Resource Locator">URL</abbr>, it <strong>does not</strong> provide any communication security. HTTPS is still required to send confidential data (e.g. passwords) to the server.
</div></p>
</p>

<p>
<p><div class="noteclassic">While the client is provided with <abbr title="HyperText Markup Language">HTML</abbr>/JavaScript pages, modern web applications are implemented using general-purpose scripting or programming languages, e.g. PHP, Java, Python, Ruby, etc. and centralize their data using database systems such as MySQL. Faulty back-end code can in itself provide a more dangerous attack surface to potentially malicious clients, an aspect that we will study in <a href="../../../../cns/labs/lab-12.html" class="wikilink1" title="cns:labs:lab-12">the following lab</a>.
</div></p>
</p>

<p>
Note that even though web applications themselves might be hardened, security vulnerabilities can come from anywhere in the server&#039;s software stack! A now infamous example is the <a href="http://en.wikipedia.org/wiki/Shellshock_%28software_bug%29" class="urlextern" title="http://en.wikipedia.org/wiki/Shellshock_%28software_bug%29"  rel="nofollow">Shellshock bug</a> caused by a vulnerability in Bash, which comes as the default shell in most Linux distribution, but that can be very easily exploited by passing environment variables through CGI.
</p>

</div>
<!-- EDIT4 SECTION "Introduction" [2412-6050] -->
<h2 class="sectionedit5" id="p_0_feedback">[1p] 0. Feedback</h2>
<div class="level2">

<p>
Before getting into the lab itself, the CNS team would be <em>very</em> happy to receive your feedback. You can do this by accessing the CNS <a href="http://cs.curs.pub.ro/2015/course/view.php?id=176" class="urlextern" title="http://cs.curs.pub.ro/2015/course/view.php?id=176"  rel="nofollow">Moodle course page</a>, where on the right side you will find <a href="http://cs.curs.pub.ro/2015/blocks/simplehtml/view.php?courseid=176&amp;blockid=1468" class="urlextern" title="http://cs.curs.pub.ro/2015/blocks/simplehtml/view.php?courseid=176&amp;blockid=1468"  rel="nofollow">a block entitled &quot;Feedback&quot;</a> (make sure you are <em>enrolled</em> to the course). Despite the fact that you need to login with your <code>cs.curs.pub.ro</code> account, the feedback is 100% anonymous.
</p>

<p>
The course this year might have had some rough edges, so it&#039;s very important that you tell us what went wrong and what wasn&#039;t ok with the lectures, labs and homework; be polite, but succint; don&#039;t sugarcoat it, we can take the critique. We are particularly interested in:
</p>
<ul>
<li class="level1"><div class="li"> What didn&#039;t you like and what you consider didn&#039;t go well?</div>
</li>
<li class="level1"><div class="li"> Why didn&#039;t you like that and why you consider it didn&#039;t go well?</div>
</li>
<li class="level1"><div class="li"> What should we do to make things likable and going well?</div>
</li>
</ul>

<p>
This should take no more than ten minutes of your lab time. <img src="../../../../lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

</div>
<!-- EDIT5 SECTION "[1p] 0. Feedback" [6051-7130] -->
<h2 class="sectionedit6" id="p_1_warm-up_tasksearching_for_public_data_and_getpost">[2p] 1. Warm-up task: searching for public data and GET/POST</h2>
<div class="level2">

<p>
First let&#039;s do some wrap-up exercises to help us get a basic understanding of how web application security works and why it&#039;s important.
</p>

</div>
<!-- EDIT6 SECTION "[2p] 1. Warm-up task: searching for public data and GET/POST" [7131-7341] -->
<h3 class="sectionedit7" id="p_a_searching_for_public_data">[1p] a. Searching for public data</h3>
<div class="level3">

<p>
<p><div class="notewarning">Although this task is useful for educational purposes, abusing the methods used in this section remains immoral and in some cases outright <strong>illegal</strong>. We&#039;re not in any way responsible if you steal your neighbour&#039;s password using the methods presented here.
</div></p>
</p>

<p>
One rule of thumb is to <strong>never ever</strong> post public information on the Internet. Unfortunately most people do this, so let&#039;s study how to find it. Here&#039;s some interesting stuff you can do:
</p>
<ul>
<li class="level1"><div class="li"> Download the latest version of <a href="https://wordpress.org/download/" class="urlextern" title="https://wordpress.org/download/"  rel="nofollow">Wordpress</a> and study <code>wp-config-sample.php</code>. This file is normally used as a template for basic Wordpress configuration data (stored in <code>wp-config.php</code>), which includes private data such as the database password. Identify the PHP variable storing the database password. Use this variable name as a search on <a href="http://github.com" class="urlextern" title="http://github.com"  rel="nofollow">GitHub</a> and see if you can find any private data.</div>
</li>
<li class="level1"><div class="li"> Look through the <a href="http://en.wikipedia.org/wiki/Google_Search#Search_options" class="urlextern" title="http://en.wikipedia.org/wiki/Google_Search#Search_options"  rel="nofollow">Google search options</a> and think if you can use the fields there to find anything from private documents to password lists, etc. A common “Google search” attack involves searching for public, unsecured security cameras on Google; most security camera web applications consist of common web pages, see this <a href="http://www.wikihow.com/Watch-Security-Camera-Streams-on-the-Internet" class="urlextern" title="http://www.wikihow.com/Watch-Security-Camera-Streams-on-the-Internet"  rel="nofollow">Wikihow</a> page to find some examples.</div>
</li>
<li class="level1"><div class="li"> Search for all the URLs containing files of type <code>inc</code>, from the <code>ro</code> domain, including <code>password</code> as an additional search keyword. Identify configuration directives that show passwords, database names and other information that should be private.</div>
</li>
</ul>

</div>
<!-- EDIT7 SECTION "[1p] a. Searching for public data" [7342-9063] -->
<h3 class="sectionedit8" id="p_b_talking_to_web_sites">[1p] b. Talking to web sites</h3>
<div class="level3">

<p>
Let&#039;s go through the basics of how HTTP requests are made, using <code>telnet</code> to form requests. First, let&#039;s connect to the vulnerable web server described in <a href="lab-11.html#supporting_files" title="cns:labs:lab-11 ↵" class="wikilink1">Supporting files</a>, e.g.:
</p>
<pre class="code">$ telnet $SERVER_IP 80</pre>

<p>
Now let&#039;s issue a simple GET. The request is composed of:
</p>
<ul>
<li class="level1"><div class="li"> <code>GET &lt;path&gt; &lt;http-version&gt;</code>,</div>
</li>
<li class="level1"><div class="li"> followed by other header contents,</div>
</li>
<li class="level1"><div class="li"> followed by an <strong>additional newline</strong>, indicating the end of the request.</div>
</li>
</ul>

<p>
<p><div class="notewarning">
Please note the above bullet points and the fact that you need to provide an <strong>additional newline</strong> to indicate the end of the request.

</div></p>
</p>

<p>
For example: 
</p>
<pre class="code">GET / HTTP/1.0
 </pre>

<p>
will return
</p>
<pre class="code">HTTP/1.1 200 OK
Date: Sat, 10 Jan 2015 16:55:47 GMT
Server: Apache/2.4.7 (Ubuntu)
Last-Modified: Sat, 10 Jan 2015 11:20:21 GMT
ETag: &quot;2f-50c4a757fc29a&quot;
Accept-Ranges: bytes
Content-Length: 47
Connection: close
Content-Type: text/html

&lt;html&gt;
&lt;body&gt;
&lt;b&gt;It works!&lt;/b&gt;
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>
The server&#039;s response contains:
</p>
<ul>
<li class="level1"><div class="li"> A status code (<code>200 OK</code> in our case)</div>
</li>
<li class="level1"><div class="li"> Date information and information about the server</div>
</li>
<li class="level1"><div class="li"> Encoding and other info about the data, i.e. it&#039;s MIME-type</div>
</li>
<li class="level1"><div class="li"> The length of the data</div>
</li>
<li class="level1"><div class="li"> The actual data</div>
</li>
</ul>

<p>
<strong>[1p]</strong> Use the recipe above, aided by the <a href="http://www.w3schools.com/tags/ref_httpmethods.asp" class="urlextern" title="http://www.w3schools.com/tags/ref_httpmethods.asp"  rel="nofollow">w3schools tutorial</a> and <a href="http://stackoverflow.com/a/14551219" class="urlextern" title="http://stackoverflow.com/a/14551219"  rel="nofollow">some examples</a> (Google for more), to do the steps below.
</p>

<p>
Repeat the above for <code>www.facebook.com</code>. Note that you are getting a <code>HTTP/1.1 301 Moved Permanently</code> message. Try using
</p>
<pre class="code">GET / HTTP/1.1
Host: www.facebook.com
 </pre>

<p>
and check the new response. Note the redirection to HTTPS (<code>https://www.facebook.com</code>). And note that the connection uses <code>keep-alive</code> and you need to use <code>Ctrl+c</code> to close the connection.
</p>

<p>
Access <code>www.facebook.com</code> in the browser and look through the page source (<code>right click</code> → <code>view page source</code>). Search for the <abbr title="HyperText Markup Language">HTML</abbr> tag for the login form. Identify the page being queried when you press the <code>Log in</code> button.
</p>

<p>
<p><div class="notetip">
Search for the <code>submit</code> string and identify the page name.
</p>

<p>
Login forms are delimited by the <code>&lt;form&gt;</code> <abbr title="HyperText Markup Language">HTML</abbr> tag, so search for <code>&lt;form</code>. The queried page is specified by the <code>action</code> attribute; also note that there is a <code>method</code> attribute. Input fields are specified using the <code>&lt;input&gt;</code> <abbr title="HyperText Markup Language">HTML</abbr> tag, so look for that.

</div></p>
</p>

<p>
Identify the name, class and id for the e-mail and password fields inside the login form. This data is sent by a POST request. You could use it with the command line provided you did an HTTPS connection.
</p>

<p>
Access <code>http://$SERVER_IP/~student/post.php</code> using <code>telnet</code> and the HTTP <code>GET</code>. Access it again, but this time construct a POST request, comprising the variables <code>name</code>, <code>age</code> and <code>email</code>, containing your first name, age and some bogus e-mail address. You can try exploiting the PHP script (ask for bonus points if you find any vulnerabilities), but it really doesn&#039;t do too much.
</p>

<p>
<p><div class="notetip">
When using a <code>POST</code> request you have to fill:
</p>
<ul>
<li class="level1"><div class="li"> the <code>Content-Length</code> HTTP header variable with the length of the message you are trying to send</div>
</li>
<li class="level1"><div class="li"> the <code>Content-Type</code> HTTP header variable with the value <code>application/x-www-form-urlencoded</code></div>
</li>
</ul>

<p>

</div></p>
</p>

</div>
<!-- EDIT8 SECTION "[1p] b. Talking to web sites" [9064-12365] -->
<h2 class="sectionedit9" id="p_2_burp_tutorial">[3p] 2. Burp tutorial</h2>
<div class="level2">

<p>
Since web applications present such a wide attack surface a need arises for systematization in attack attempts. A tool that can help in this respect is Burp Suite, a collection of tools that can be regarded as the equivalent to a debugger for web applications.
</p>

</div>
<!-- EDIT9 SECTION "[3p] 2. Burp tutorial" [12366-12663] -->
<h3 class="sectionedit10" id="p_a_proxy">[1p] a. Proxy</h3>
<div class="level3">

<p>
In its most basic use, Burp acts as a proxy and logs all requests and responses. To install it as a proxy you need to check your browser settings:
</p>
<ul>
<li class="level1"><div class="li"> Firefox: Edit / Preferences / Advanced / Network / Settings / Manual Proxy Configuration. You should add 127.0.0.1:8080 for all protocols as you will need it both for HTTP and HTTPS.</div>
</li>
</ul>

<p>
<p><div class="noteimportant">
Since HTTPS requires server identity authentication browsers detect that something (Burp Proxy) is tampering with the communication so they will not display further. To overcome this you will need to export Burp&#039;s CA certificate by visiting <a href="http://burp" class="urlextern" title="http://burp"  rel="nofollow">http://burp</a> and importing it in your browser.
</p>

<p>
In Firefox you can do this by accessing <code>Settings</code>, the <code>Advanced</code> tab, the <code>Certificates</code> tab.

</div></p>
</p>

<p>
Test that proxy-ing works by visiting <a href="http://slashdot.org" class="urlextern" title="http://slashdot.org"  rel="nofollow">http://slashdot.org</a> in the browser. It will work and the browser will render the page. Burp can intercept the requests, but you have to turn on interception.
</p>

<p>
Initially Burp Proxy will try to intercept the requests from the browser and give you the opportunity to modify them. Go to the <strong>Proxy</strong> tab and the <strong>Intercept</strong> sub-tab and enable interception.
</p>

<p>
<p><div class="notetip">
To enable interception, click on the <strong>Intercept is off</strong> button to change it to <strong>Intercept is on</strong>.
To disable interception, click on the <strong>Intercept is on</strong> button to change it to <strong>Intercept is off</strong>.

</div></p>
</p>

<p>
After activating the interception, refresh you connection to <a href="http://slashdot.org" class="urlextern" title="http://slashdot.org"  rel="nofollow">http://slashdot.org</a> in the browser. Check out <strong>Proxy / HTTP History</strong>. It should look similar to this:
<a href="../../../../_media/cns/labs/2014-2015/http_history.png" class="media" title="cns:labs:2014-2015:http_history.png"><img src="../../../../_media/cns/labs/2014-2015/http_history.png%3Fw=600&amp;tok=377fc7" class="mediacenter" alt="" width="600" /></a>
</p>

<p>
The proxy allows you to modify both ways: the request and the response.
</p>

<p>
<strong>[1p]</strong> Activate response intercept and modify the first news story title into “Riemann Hypothesis solved. The answer was 42”.
</p>

<p>
<p><div class="notetip">
To activate response intercepting, go to the <code>Options</code> sub-tab in the <code>Proxy Tab</code> and enable the <code>Intercept responses based on the following rules</code> checkbox. You should also check the rules using the <code>Or</code> operator.

</div></p>
</p>

</div>
<!-- EDIT10 SECTION "[1p] a. Proxy" [12664-14738] -->
<h3 class="sectionedit11" id="p_b_surface_mapping">[2p] b.  Surface Mapping</h3>
<div class="level3">

<p>
Path discovery and spidering is another useful approach needed in assessing web app security. Using the previous task, check out what files were mapped inside the slashdot domain and which URLs it points to. You will use Burp Target for this and obtain this list:
<a href="../../../../_media/cns/labs/2014-2015/target.png" class="media" title="cns:labs:2014-2015:target.png"><img src="../../../../_media/cns/labs/2014-2015/target.png%3Fw=250&amp;tok=e63d5a" class="mediacenter" alt="" width="250" /></a>
</p>

<p>
<strong>[1p]</strong>  Discover some user home pages by investigating the paths within slashdot.org
</p>

<p>
<p><div class="notetip">
Home pages should start with <code>~</code>.

</div></p>
</p>

<p>
<strong>[1p]</strong> Our goal is to spider the Damn Vulnerable Web App (DVWA) start page at <code>$SERVER_IP/~dvwa</code>. For that, first you will need to go to Target and add it to the scope beforehand. The start the spidering process by clicking on the &quot;Spider is paused&quot; button.
</p>

<p>
Now, access the the Damn Vulnerable Web App (DVWA) start page at <code>$SERVER_IP/~dvwa</code> and log in to DVWA using the following credentials:
</p>
<ul>
<li class="level1"><div class="li"> User: <code>admin</code></div>
</li>
<li class="level1"><div class="li"> Password: <code>password</code></div>
</li>
</ul>

<p>
Make sure to also provide Burp with those credentials when it asks for them. We will cover most of the DVWA-related tasks in the <a href="../../../../cns/labs/lab-12.html" class="wikilink1" title="cns:labs:lab-12">following lab</a>.
</p>

<p>
By only looking at the mapped files identify the page that might contain a <a href="https://en.wikipedia.org/wiki/File_inclusion_vulnerability" class="urlextern" title="https://en.wikipedia.org/wiki/File_inclusion_vulnerability"  rel="nofollow">file inclusion vulnerability</a>.
</p>

<p>
<p><div class="notetip">
It should be of the form <code>?page=...</code> in the Sitemap view on the top-right higher window. It&#039;s in the <code>vulnerabilities/</code> subfolder in the site map.

</div></p>
</p>

</div>
<!-- EDIT11 SECTION "[2p] b.  Surface Mapping" [14739-16193] -->
<h2 class="sectionedit12" id="p_3_cms_mini_security_analysis">[5p] 3. CMS Mini security analysis</h2>
<div class="level2">

<p>
In this set of tasks you will deal with 2 important vulnerabilities:
</p>
<ul>
<li class="level1"><div class="li"> Information disclosure</div>
</li>
<li class="level1"><div class="li"> Local file inclusion</div>
</li>
</ul>

<p>
We will use a very insecure <abbr title="Content Management System">CMS</abbr> (without having access to the source code). Check out the <abbr title="Content Management System">CMS</abbr> mini start page at <code>$SERVER_IP/~cmsmini</code>.
</p>

<p>
What information can you gather from it strictly from the browser? Can you see any internal pages in Target?
</p>

</div>
<!-- EDIT12 SECTION "[5p] 3. CMS Mini security analysis" [16194-16611] -->
<h3 class="sectionedit13" id="p_a_forceful_path_discovery">[1p] a. Forceful path discovery</h3>
<div class="level3">

<p>
There is a directory that privileged users can access but the path to it is initially unknown to you as it doesn&#039;t appear in Target.
</p>

<p>
<strong> [1p] </strong> You need to do a brute force attack using <strong>Intruder</strong> to find out what it is.
</p>
<ul>
<li class="level1"><div class="li"> Select a request from HTTP History and right click to Send it to Intruder.</div>
</li>
<li class="level1"><div class="li"> In the Intruder tab add a payload position in the path. It should look similar to:<pre class="code">GET /~cmsmini/§ § HTTP/1.1</pre>
</div>
</li>
<li class="level1"><div class="li"> In payloads select <strong>Runtime file</strong> and use <a href="../../../../_media/cns/labs/2014-2015/cns_dirbust.txt" class="media mediafile mf_txt" title="cns:labs:2014-2015:cns_dirbust.txt (496 B)">cns_dirbust.txt</a></div>
</li>
<li class="level1"><div class="li"> When you&#039;re ready click Intruder (from the window menu not the tab) and <strong>Start Attack</strong>.</div>
</li>
<li class="level1"><div class="li"> Use the status code to distinguish between responses.</div>
</li>
</ul>

<p>
<p><div class="noteclassic">
The <code>§</code> sign is the payload marker sign in the <code>Intruder</code> menu in the <code>Positions</code> submenu. You click on the button dubbed <code>Add §</code> to the right of the page screen.

</div></p>
</p>

</div>
<!-- EDIT13 SECTION "[1p] a. Forceful path discovery" [16612-17519] -->
<h3 class="sectionedit14" id="p_b_information_disclosure">[1p] b. Information disclosure</h3>
<div class="level3">

<p>
Now go to the previously discovered subdirectory in the site and have a guess at the password. :) After a failed attempt what new information does the browser supply you with about the site? What about the info that Burp gathered in Target? Page information has been disclosed!
</p>

<p>
<strong>[1p]</strong> Find out how the page information was gathered. What did Burp see differently from the browser? Check out the requests in <strong>HTTP History</strong> one by one and look at the response in Raw form and then in the Render form.
</p>

<p>
Check out the juicy pages mapped under the admin subdirectory. What did you think about the security of this application under the browser and what do you think now that you&#039;re investigating it in a systematic approach?
</p>

</div>
<!-- EDIT14 SECTION "[1p] b. Information disclosure" [17520-18287] -->
<h3 class="sectionedit15" id="p_c_local_file_inclusion">[3p] c. Local File Inclusion</h3>
<div class="level3">

<p>
There are two potential file inclusion vectors:
</p>
<ul>
<li class="level1"><div class="li"> <code>/view/?path=&amp;p=…</code></div>
</li>
<li class="level1"><div class="li"> <code>/admin/edit.php?path=&amp;name=…</code></div>
</li>
</ul>

<p>
Find out which of these (if any) can be used. You will be using <strong>Repeater</strong> for this task. In Target right click on one of the above pages , click <code>Send to Repeater</code> and go to the Repeater tab. In the left window you can see the request that would be sent and you can modify it at will.
</p>

<p>
For starters, read <code>/etc/passwd</code>. You should use a <code>path</code> such as <code>../../../../etc</code> and a <code>name</code> for <code>passwd</code>, 
</p>

<p>
<strong>[2p]</strong> Find out what the password for the admin page is. You will need to browse the <a href="http://sourceforge.net/projects/cmsmini/" class="urlextern" title="http://sourceforge.net/projects/cmsmini/"  rel="nofollow">source code of CMS mini</a> and see where <code>config.php</code> is placed.
</p>

</div>
<!-- EDIT15 SECTION "[3p] c. Local File Inclusion" [18288-] --></div>
</body>
</html>
