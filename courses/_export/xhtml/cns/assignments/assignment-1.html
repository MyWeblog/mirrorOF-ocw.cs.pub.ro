    
    

<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8" />
  <title>cns:assignments:assignment-1</title>
<meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-11-16T10:20:38+0200"/>
<meta name="keywords" content="cns,assignments,assignment-1"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../../../feed.php%3Fmode=list&amp;ns=cns:assignments"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="assignment-1.html"/>
<link rel="canonical" href="../../../../cns/assignments/assignment-1.html"/>
<link rel="stylesheet" type="text/css" href="../../../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='cns:assignments';var JSINFO = {"id":"cns:assignments:assignment-1","namespace":"cns:assignments","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>
</head>
<body>
<div class="dokuwiki export">
<!-- TOC START -->
<div id="dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="assignment-1.html#assignment_1">Assignment 1</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="assignment-1.html#assignment_archive">Assignment Archive</a></div></li>
<li class="level2"><div class="li"><a href="assignment-1.html#gdb_15p">GDB (1.5p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#tips">Tips</a></div></li>
<li class="level3"><div class="li"><a href="assignment-1.html#bonus">Bonus</a></div></li>
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit">What to submit</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#call_me_20p">call_me (2.0p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit1">What to submit</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#call_main_20p">call_main (2.0p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit2">What to submit</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#link_me_15p">link_me (1.5p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit3">What to submit</a></div></li>
<li class="level3"><div class="li"><a href="assignment-1.html#hintworking_assumption">Hint/Working assumption</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#png-bof_30p">png-bof (3.0p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit4">What to submit</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#bonuspacker_25p">BONUS: packer (2.5p)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#what_to_submit5">What to submit</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#submission">Submission</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="assignment-1.html#archive_format">Archive format</a></div></li>
<li class="level3"><div class="li"><a href="assignment-1.html#readme">README</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="assignment-1.html#example">Example</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><div class="li"><a href="assignment-1.html#hints">Hints</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->

<h1 class="sectionedit1" id="assignment_1">Assignment 1</h1>
<div class="level1">

<p>
<p><div class="noteimportant">
Deadline: <strong>Sunday, November 20, 2016, 11pm (EET, Romania time)</strong>
</p>

<p>
The deadline is <strong>hard</strong>. No submissions will be accepted past the deadline.

</div></p>
</p>

</div>
<!-- EDIT1 SECTION "Assignment 1" [1-199] -->
<h2 class="sectionedit2" id="assignment_archive">Assignment Archive</h2>
<div class="level2">

<p>
<a href="http://elf.cs.pub.ro/oss/res/assignments/cns-assignment-1.end-2014-2015-30-g4edeedb.zip" class="urlextern" title="http://elf.cs.pub.ro/oss/res/assignments/cns-assignment-1.end-2014-2015-30-g4edeedb.zip"  rel="nofollow">Assignment Archive</a>, <strong>SHA1</strong>: 0aae4be7de387e1e6125715786e28f208d8db324
</p>

</div>
<!-- EDIT2 SECTION "Assignment Archive" [200-395] -->
<h2 class="sectionedit3" id="gdb_15p">GDB (1.5p)</h2>
<div class="level2">

<p>
The purpose of this task is to explore GDB, and automate a debugging session. You are encouraged to use the <a href="http://sourceware.org/gdb/current/onlinedocs/gdb/" class="urlextern" title="http://sourceware.org/gdb/current/onlinedocs/gdb/"  rel="nofollow">GDB User Manual</a>, and what you learned during the previous lab sessions. We recommend that you start solving each subtask in a live debugging session, and then assemble the final script.
</p>

<p>
<p><div class="noteclassic">
The purpose of this first task is to establish some initial basic knowledge of GDB&#039;s capabilities. If you find some of the requirements ambiguous, feel free to formulate assumptions, and document them in comments. Since solutions usually have high degree of variance, the task will be graded manually.

</div></p>
</p>

<p>
The given binary computes the SHA-1 hash of some input, but if you send him a signal at the right time, it will also compute a special hash. Write a GDB script/commands file that goes through the following steps:
</p>
<ol>
<li class="level1"><div class="li"> when data to be hashed is being requested, a <code>read()</code> syscall will be issued, catch it</div>
</li>
<li class="level1"><div class="li"> break execution right before <code>compute_hash()</code> is called (you should now be in <code>main()</code>&#039;s stack frame)</div>
</li>
<li class="level1"><div class="li"> print the 5 instructions before the current instruction pointer</div>
</li>
<li class="level1"><div class="li"> break on <code>malloc</code> calls</div>
<ul>
<li class="level2"><div class="li"> print the return value after <code>malloc</code> finishes</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> break in <code>alloc_hash()</code> after <code>malloc</code> call (just once, when it is called from <code>compute_hash()</code>)</div>
<ul>
<li class="level2"><div class="li"> print the stack, the registers and the last 3 frames</div>
</li>
<li class="level2"><div class="li"> move to the previous frame, and print registers</div>
</li>
<li class="level2"><div class="li"> move back, and print locals and arguments</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> remove all breakpoints, catchpoints and watchpoints</div>
</li>
<li class="level1"><div class="li"> add breakpoint after the normal hash is printed</div>
</li>
<li class="level1"><div class="li"> <em class="u">rerun</em></div>
</li>
<li class="level1"><div class="li"> you will discover there is a special, or “reversed hash” mode, break execution on <code>printf</code> calls while in this mode</div>
<ul>
<li class="level2"><div class="li"> print current frame and the EIP register each time this breakpoint triggers</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> add watchpoints for hash mode changes</div>
</li>
<li class="level1"><div class="li"> send the required signal</div>
</li>
<li class="level1"><div class="li"> leave the watchpoint and the 2 breakpoints</div>
</li>
<li class="level1"><div class="li"> <em class="u">rerun</em>, but this time, trigger the mode change without sending the signal</div>
</li>
<li class="level1"><div class="li"> delete watchpoints and breakpoints</div>
</li>
<li class="level1"><div class="li"> break in <code>main()</code> after <code>compute_hash()</code></div>
<ul>
<li class="level2"><div class="li"> print the heap section holding the hash in hex in 2 ways:</div>
<ul>
<li class="level3"><div class="li"> search for the hash in memory (you control the data being hashed)</div>
</li>
<li class="level3"><div class="li"> use the malloc return value</div>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <em class="u">rerun</em></div>
</li>
</ol>

</div>
<!-- EDIT3 SECTION "GDB (1.5p)" [396-2726] -->
<h3 class="sectionedit4" id="tips">Tips</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> <a href="http://darkdust.net/files/GDB%20Cheat%20Sheet.pdf" class="urlextern" title="http://darkdust.net/files/GDB%20Cheat%20Sheet.pdf"  rel="nofollow">GDB Cheat Sheet</a></div>
</li>
<li class="level1"><div class="li"> Use source code line numbers and/or addresses when you cannot use the symbols.</div>
</li>
<li class="level1"><div class="li"> You can redirect all GDB and the binary&#039;s outputs to files.</div>
</li>
<li class="level1"><div class="li"> On Ubuntu/Debian x86_64: You will need libssl-dev:i386. Installing that might uninstall the 64-bit libssl. Be sure to reinstall it after you finish. We tested with libssl-dev:i386 1.0.1c-4ubuntu8.1 on Ubuntu Raring.</div>
</li>
</ul>

</div>
<!-- EDIT4 SECTION "Tips" [2727-3184] -->
<h3 class="sectionedit5" id="bonus">Bonus</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> Write everything in Python, using the GDB <abbr title="Application Programming Interface">API</abbr>.</div>
</li>
</ul>

</div>
<!-- EDIT5 SECTION "Bonus" [3185-3253] -->
<h3 class="sectionedit6" id="what_to_submit">What to submit</h3>
<div class="level3">

<p>
The GDB script/commands file or the Python script (for bonus). Your submission will be run as follows, in the directory containing the <code>hasher</code> binary:
</p>
<ul>
<li class="level1"><div class="li"> normal: <code>gdb -q --command=gdb-sha1.gdb</code></div>
</li>
<li class="level1"><div class="li"> bonus: <code>gdb -q -x gdb-sha1.py</code></div>
</li>
</ul>

<p>
<p><div class="noteclassic">
This task will be checked and graded manually.

</div></p>
</p>

</div>
<!-- EDIT6 SECTION "What to submit" [3254-3596] -->
<h2 class="sectionedit7" id="call_me_20p">call_me (2.0p)</h2>
<div class="level2">

<p>
Someone has tampered with the executable file. Please fix this and call the <code>call_me</code> function!
</p>

</div>
<!-- EDIT7 SECTION "call_me (2.0p)" [3597-3723] -->
<h3 class="sectionedit8" id="what_to_submit1">What to submit</h3>
<div class="level3">

<p>
Provide solution in a script/executable  named <code>call-me.solver</code>. This script will have to properly <strong>update</strong> the <code>call_me</code> executable. You can assume that the <code>call_me</code> binary will exist in the same path as the <code>call-me.solver</code> script.
</p>

</div>
<!-- EDIT8 SECTION "What to submit" [3724-3995] -->
<h2 class="sectionedit9" id="call_main_20p">call_main (2.0p)</h2>
<div class="level2">

<p>
Someone has tampered with the executable file (again). Please fix this. There should be a flag message printed in case you solve it correctly.
</p>

</div>
<!-- EDIT9 SECTION "call_main (2.0p)" [3996-4168] -->
<h3 class="sectionedit10" id="what_to_submit2">What to submit</h3>
<div class="level3">

<p>
Provide solution in a script/executable  named <code>call-main.solver</code>. This script will have to properly <strong>update</strong> the <code>call_main</code> executable. You can assume that the <code>call_main</code> binary will exist in the same path as the <code>call-main.solver</code> script.
</p>

</div>
<!-- EDIT10 SECTION "What to submit" [4169-4448] -->
<h2 class="sectionedit11" id="link_me_15p">link_me (1.5p)</h2>
<div class="level2">

<p>
Link me to print out the flag.
</p>

</div>
<!-- EDIT11 SECTION "link_me (1.5p)" [4449-4508] -->
<h3 class="sectionedit12" id="what_to_submit3">What to submit</h3>
<div class="level3">

<p>
Provide solution in a script/executable named <code>link-me.solver</code>. This script has to generate all files required.
</p>

</div>
<!-- EDIT12 SECTION "What to submit" [4509-4649] -->
<h3 class="sectionedit13" id="hintworking_assumption">Hint/Working assumption</h3>
<div class="level3">

<p>
The current testing framework will do <code>export LD_LIBRARY_PATH=.</code> for you <img src="../../../../lib/images/smileys/icon_wink.gif" class="icon" alt=";-)" />.
</p>

</div>
<!-- EDIT13 SECTION "Hint/Working assumption" [4650-4765] -->
<h2 class="sectionedit14" id="png-bof_30p">png-bof (3.0p)</h2>
<div class="level2">

<p>
There is a buffer overflow in this program, can you trigger it? You&#039;ll have to understand a protocol, <code>*trace</code> is your friend.
</p>

<p>
<p><div class="noteclassic">
A failed assertion is <strong>not</strong> a buffer overflow. You should be able to trigger a <strong><code>SIGSEGV</code></strong>.

</div></p>
</p>

</div>
<!-- EDIT14 SECTION "png-bof (3.0p)" [4766-5038] -->
<h3 class="sectionedit15" id="what_to_submit4">What to submit</h3>
<div class="level3">

<p>
A Python script named <code>png-bof.py</code> that prints to stdout (in binary format, no newline) the <em>correct</em> string that has to be used as input by <code>png-parser</code> executable. A <em>correct</em> input will force the program to crash with a <strong><code>SIGSEGV</code></strong>.
</p>

<p>
<p><div class="noteclassic">
By <em>correct</em> string, we mean a string that is able to bypass the asserts inside the <code>png-parser</code> executable.

</div></p>
</p>

</div>
<!-- EDIT15 SECTION "What to submit" [5039-5442] -->
<h2 class="sectionedit16" id="bonuspacker_25p">BONUS: packer (2.5p)</h2>
<div class="level2">

<p>
A packed binary is hidden/compressed in another “shell” binary. This is
a common technique used by <a href="http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/wp_revealing_packed_malware_sep_2008.pdf" class="urlextern" title="http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-papers/wp_revealing_packed_malware_sep_2008.pdf"  rel="nofollow">malware</a> developers to hide the malicious software.
When running the packed binary (the “shell”), the original binary is unpacked/decompressed and it starts executing.
</p>

<p>
In the following <a href="../../../../_media/cns/assignments/packer.zip" class="media mediafile mf_zip" title="cns:assignments:packer.zip (592.3 KB)">archive</a> you can find:
</p>
<ul>
<li class="level1"><div class="li"> a packed binary.</div>
</li>
<li class="level1"><div class="li"> the original binary from which the ”.data” segment was removed.</div>
</li>
<li class="level1"><div class="li"> readelf info with information about the original binary&#039;s sections and segments.</div>
</li>
</ul>

<p>
You have to rebuild the original binary without using any specialized unpacking tool.
</p>

<p>
<p><div class="noteclassic">
</p>

<p>
You can use <strong>strace</strong> and <strong>GDB</strong> to analyse how the original binary is
unpacked and executed.
</p>

<p>
You can use the GDB <strong>dump memory</strong> command to dump at runtime the content of any memory
area to a file.
</p>

<p>
Note that the ”.data” segment gets populated with more data during the
execution of a binary, so you&#039;ll have to retrieve it as early as possible.
</p>

<p>

</div></p>
</p>

</div>
<!-- EDIT16 SECTION "BONUS: packer (2.5p)" [5443-6571] -->
<h3 class="sectionedit17" id="what_to_submit5">What to submit</h3>
<div class="level3">

<p>
The recovered(rebuilt) original binary (a file called <code>binary_unpacked</code>) and a readme/writeup where you describe
how you&#039;ve recovered the binary. Write the exact commands in the readme
or include any scripts that you&#039;ve used. 
</p>

</div>
<!-- EDIT17 SECTION "What to submit" [6572-6826] -->
<h2 class="sectionedit18" id="submission">Submission</h2>
<div class="level2">

<p>
The submission will made through <a href="https://vmchecker.cs.pub.ro/ui/#CNS" class="urlextern" title="https://vmchecker.cs.pub.ro/ui/#CNS"  rel="nofollow">vmchecker</a> interface. Choose the &quot;Computer and Network Security&quot; class and then &quot;Assignment 1&quot; and upload a <code>.zip</code> file that should consist of the files shown below.
</p>

<p>
<p><div class="noteclassic">
We will check the <a href="assignment-1.html#gdb_15p" title="cns:assignments:assignment-1 ↵" class="wikilink1">GDB</a> task by hand, it will not be included in the <a href="https://vmchecker.cs.pub.ro/ui/#CNS" class="urlextern" title="https://vmchecker.cs.pub.ro/ui/#CNS"  rel="nofollow">vmchecker</a> automated verification script.

</div></p>
</p>

</div>
<!-- EDIT18 SECTION "Submission" [6827-7275] -->
<h3 class="sectionedit19" id="archive_format">Archive format</h3>
<div class="level3">

<p>
The archive will contain <em>at least</em> the following files:
</p>
<ul>
<li class="level1"><div class="li"> <code>README</code></div>
</li>
<li class="level1"><div class="li"> <code>gdb-sha1.gdb</code></div>
</li>
<li class="level1"><div class="li"> <code>call-me.solver</code></div>
</li>
<li class="level1"><div class="li"> <code>call-main.solver</code></div>
</li>
<li class="level1"><div class="li"> <code>link-me.solver</code></div>
</li>
<li class="level1"><div class="li"> <code>png-bof.py</code></div>
</li>
</ul>

<p>
<p><div class="noteclassic">
The Python version from the machine is: 2.6.6. The machine is a 32bit Ubuntu based machine.

</div></p>
</p>

</div>
<!-- EDIT19 SECTION "Archive format" [7276-7595] -->
<h3 class="sectionedit20" id="readme">README</h3>
<div class="level3">

<p>
<strong>Shortly</strong> describe your approach for each task. If some details are not clear you can ask us or make some assumptions. Describe the assumptions in the <code>README</code> file.
</p>

</div>

<h4 id="example">Example</h4>
<div class="level4">
<pre class="code">
foo-bar
--------

objdump can be used to disassemble the binary. I found an overflow 
when reading into the input buffer (see snippet below). We can
generate an attack string with the following format: [FORMAT].

[assembly snippet showing the ovf]

I am not sure if the UNIVERSAL answer is 41 or 42, but I tried using
42 and seems to work. Further investigation into why this is the case
might be needed. Tests pass just fine.
</pre>

</div>
<!-- EDIT20 SECTION "README" [7596-8246] -->
<h2 class="sectionedit21" id="hints">Hints</h2>
<div class="level2">

<p>
If you are really stuck or think that there is a bug in the assignment feel free to ask the <a href="mailto:&#x6f;&#x73;&#x73;&#x2d;&#x73;&#x75;&#x70;&#x70;&#x6f;&#x72;&#x74;&#x40;&#x63;&#x75;&#x72;&#x73;&#x75;&#x72;&#x69;&#x2e;&#x63;&#x73;&#x2e;&#x70;&#x75;&#x62;&#x2e;&#x72;&#x6f;" class="mail" title="&#x6f;&#x73;&#x73;&#x2d;&#x73;&#x75;&#x70;&#x70;&#x6f;&#x72;&#x74;&#x40;&#x63;&#x75;&#x72;&#x73;&#x75;&#x72;&#x69;&#x2e;&#x63;&#x73;&#x2e;&#x70;&#x75;&#x62;&#x2e;&#x72;&#x6f;">OSS Team</a>. Keep in mind that we wont give solutions but rather hints. We will answer in <strong>less than one day</strong> and update this page accordingly.
</p>

</div>
<!-- EDIT21 SECTION "Hints" [8247-] --></div>
</body>
</html>
