    
    

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    Laborator 08: Interfața în linia de comandă, analiza statică și dinamică    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="noindex,nofollow"/>
<meta name="date" content="2016-11-23T10:33:15+0200"/>
<meta name="keywords" content="iocla,laboratoare,laborator-08"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../feed.php%3Fmode=list&amp;ns=iocla:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="http://ocw.cs.pub.ro/courses/_export/xhtml/iocla/laboratoare/laborator-08"/>
<link rel="canonical" href="laborator-08.html"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='iocla:laboratoare';var JSINFO = {"id":"iocla:laboratoare:laborator-08","namespace":"iocla:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="../../lib/tpl/arctic/images/favicon.ico" />

  
</head>
<body>
<div id="wrapper" class='show'>
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="http://ocw.cs.pub.ro/courses/iocla/"><img height="70" src="../../res/sigla_iocla.png"/> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="../../../courses.1.html"/>Open CourseWare</a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="http://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-08?do=recent"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="http://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-08?do=login&amp;sectok=f62420cf5b01253da4b50505d148181b"  class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h1 class="sectionedit1" id="laborator_08interfata_in_linia_de_comanda_analiza_statica_si_dinamica">Laborator 08: Interfața în linia de comandă, analiza statică și dinamică</h1>
<div class="level1">

<p>
După un scurt breviar care va explica noțiunile introduse în acest laborator, va urma o parte practică care alternează între secțiuni de tip tutorial, cu parcurgere pas cu pas și prezentarea soluției, și exerciții care trebuie să fie rezolvate.
</p>

</div>

<h2 class="sectionedit2" id="interfata_in_linia_de_comanda">Interfața în linia de comanda</h2>
<div class="level2">

<p>
Deși folosirea unui mediu grafic pentru programare poate părea mai atractivă, de multe ori folosirea liniei de comandă oferă mai multă putere și control asupra a ceea ce vrem să facem. În plus, folosirea utilitarelor din linia de comandă  în scripturi poate facilita automatizarea unor task-uri, lucru care ne va face viața mai ușoară în nenumărate cazuri.
</p>

<p>
În cadrul acestui laborator, vom folosi utilitare în linia de comandă atât pentru asamblarea și link-editarea fișierelor sursă, cât și pentru analiza statică și dinamică a programelor obținute din parcurgerea tutorialelor și a exercițiilor.
</p>

</div>

<h2 class="sectionedit3" id="analiza_statica">Analiza statică</h2>
<div class="level2">

<p>
Analiza statică a unui program constă în inspectarea diferitelor aspecte din fișierul obiect sau executabil.
</p>

<p>
Câteve din programele utile pentru analiza statică pe care le vom folosi și în cadrul tutorialelor/exercițiilor sunt:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nm</strong> - utilitar folosit pentru insepctarea simbolurilor și secțiunilor din executabile</div>
</li>
<li class="level1"><div class="li"> <strong>objdump</strong> - program folosit pentru dezasamblarea (traducerea din cod-mașină în limbaj de asamblare) programelor binare</div>
</li>
<li class="level1"><div class="li"> <strong>IDA</strong> - o unealtă foarte puternică pentru dezasamblarea și inspectarea fișierelor obiect și executabile</div>
</li>
</ul>

</div>

<h2 class="sectionedit4" id="analiza_dinamica">Analiza dinamică</h2>
<div class="level2">

<p>
Spre deosebire de analiza statică, analiza dinamică constă în inspectarea unui program aflat în execuție. Practic, analiza dinamică se face la <em>runtime</em>.
</p>

<p>
Unul dintre cele mai folosite programe pentru analiză dinamică este <strong>gdb</strong>. Acesta oferă o gamă largă de operații ce pot fi făcute, de la inspectarea memoriei, la schimbarea control flow-ului și până la modificarea registrelor de pe procesor, în timpul rulării unui program.
</p>

</div>

<h2 class="sectionedit5" id="tutoriale_si_exercitii">Tutoriale și exerciții</h2>
<div class="level2">

<p>
În cadrul exercițiilor vom folosi  <a href="http://elf.cs.pub.ro/asm/res/laboratoare/lab-08-tasks.zip" class="urlextern" title="http://elf.cs.pub.ro/asm/res/laboratoare/lab-08-tasks.zip"  rel="nofollow">arhiva de laborator</a>.
</p>

<p>
Descărcați arhiva, decomprimați-o și accesați directorul aferent.
</p>

<p>
<p><div class="notewarning">
Doar dacă se specifică altfel în cerință, toate utilitarele vor fi rulate din linia de comandă. Bineînțeles, puteți folosi orice editor text pentru a rezolva exercițiile (chiar și SASM), însă asamblarea, link-editarea etc. vor fi făcute din interfața în linia de comandă.

</div></p>
<p><div class="notetip">
Pentru a putea rula <code>python</code>, <code>gdb</code>, <code>nasm</code> și <code>objdump</code> de oriunde (în cadrul acelei console) recomandăm să faceți următorul setup în <code>Command Prompt</code>:
</p>
<pre class="code">set PATH=%PATH%;&quot;C:\Program Files (x86)\SASM\MinGW\bin&quot;;&quot;C:\Python27&quot;;&quot;C:\Program Files (x86)\SASM\NASM\&quot;</pre>

<p>

</div></p>
</p>

</div>

<h3 class="sectionedit6" id="p_1_tutorialasamblarea_din_linia_de_comanda">[0.5p] 1. Tutorial: Asamblarea din linia de comandă</h3>
<div class="level3">

<p>
Deschideți fișierul <code>hello-world.asm</code> din directorul <code>1-2-3-tutorial-and-cat</code> și înțelegeți codul.
</p>

<p>
<p><div class="noteclassic">
Observați că atât funcțiile externe cât și funcția <code>main</code> sunt precedate de <code>_</code> (underscore). Aceasta este utilizarea standard pe Windows.
</p>

<p>
Înainte funcționau <code>printf</code> și alte funcții externe deoarece erau de fapt doar macro-uri la funcțiile prefixate cu underscore, definite în <code>io.inc</code>. De asemenea, CMAIN era doar un macro la <code>_main</code>.

</div></p>
</p>

<p>
Primul pas este să pornim un shell (Command Prompt, PowerShell sau MSYS, dacă este instalat). După ce avem linia de comandă vom naviga în directorul cu task-urile acestui laborator.
</p>

<p>
Pentru a asambla fișierul <code>hello-world.asm</code>, vom folosi utilitarul <code>nasm.exe</code> (program care este folosit în spate și de către SASM). Acesta se află în subdirectorul NASM, unde este instalat SASM pe sistemul vostru.
</p>

<p>
Dacă folosim Command Prompt avem:
</p>
<pre class="code">&quot;C:\Program Files (x86)\SASM\NASM\nasm.exe&quot; -g -f win32 hello-world.asm -o hello-world.obj</pre>

<p>
<p><div class="noteclassic">
<code>-g</code> spune asamblorului să adauge simboluri de debug în fișierul obiect rezultat
</p>

<p>
<code>-f</code> menționează formatul executabilului (în cazul nostru <code>win32</code>)

</div></p>
</p>

<p>
Pentru a verifica “corectitudinea” asamblării, haideți să dezasamblăm fișierul <code>hello-world.obj</code> folosind utilitarul <code>objdump.exe</code>, astfel:
</p>
<pre class="code">&quot;C:\Program Files (x86)\SASM\MinGW\bin\objdump.exe&quot; -d hello-world.obj</pre>

<p>
Putem observa similaritatea dintre codul inițial și codul dezasamblat, mai puțin la instrucțiunea <code>call</code>, unde adresa pare greșită. Acest fapt se întâmplă din cauza faptului că fișierul obiect obținut nu “știe” cine este printf. Acest lucru se va afla la pasul de link-editare, iar adresa va fi modificată la cea corespunzătoare.
</p>

</div>

<h3 class="sectionedit7" id="p_2_tutoriallink-editarea_unui_fisier_obiect">[0.5p] 2. Tutorial: Link-editarea unui fișier obiect</h3>
<div class="level3">

<p>
Link-editarea unuia sau mai multor fișiere obiect constă în rezolvarea tuturor simbolurilor externe și crearea unui singur fișier executabil din toate fișiere primite la intrare.
</p>

<p>
Pentru link-editare vom folosi <code>gcc.exe</code>. De asemenea și gcc este folosit de SASM pentru link-editarea fișierelor obiect.
</p>
<pre class="code">&quot;C:\Program Files (x86)\SASM\MinGW\bin\gcc.exe&quot; -g -m32 hello-world.obj -o hello-world.exe</pre>

<p>
<p><div class="noteclassic">
<code>-g</code> este folosit cu același scop ca la nasm.exe, de a introduce simboluri de debug în executabil
</p>

<p>
<code>-m32</code> specifică arhitectura pentru care executabilul este generat (în cazul nostru, arhitectură pe 32 biți)

</div></p>
</p>

<p>
Acum puteți rula executabilul pentru a vedea că toți pașii au funcționat. Pentru lansarea în execuție din linie de comandă folosiți construcția
</p>
<pre class="code">.\hello-world.exe</pre>

<p>
Ar trebui să vi se afișeze pe ecran <code>Hello, World</code>.
</p>

</div>

<h3 class="sectionedit8" id="p_3_implementare_minimala_cat">[1.5p] 3. Implementare minimală &#039;&#039;cat&#039;&#039;</h3>
<div class="level3">

<p>
Pornind de la fișierul hello-world.asm, va trebui să implementați funcționalitatea de bază a utilitarului cat: citește o singură linie de la intrarea standard și o afișează la ieșirea standard.
</p>

<p>
<p><div class="noteclassic">
Folosiți funcțiile <code>gets</code> și <code>puts</code> pentru a nu mai adăuga șiruri de formatare pentru scanf și printf.

</div></p>
</p>

<p>
După ce ați terminat de implementat, asamblați fișierul sursă și link-editați fișierul obiect obținut din asamblare, pentru a obține un executabil. Pentru a primi punctajul aferent exercițiului, trebuie să prezentați atât codul cât și funcționalitatea programului când este în execuție.
</p>

</div>

<h3 class="sectionedit9" id="p_4_tutoriallink-editarea_mai_multor_fisiere_obiect">[0.5p] 4. Tutorial: Link-editarea mai multor fișiere obiect</h3>
<div class="level3">

<p>
Ce facem atunci când vrem să modularizăm programul și să avem mai multe fișiere sursă, fiecare cu un anume rol? Practic va trebui să creăm pentru fiecare fișier sursă, fișierul obiect corespunzător, iar apoi să link-edităm toate fișierele obiect obținute într-un singur executabil care să conțină tot codul.
</p>

<p>
În directorul <code>4-5-linking-multiple</code> avem două fișiere: <code>main.asm</code> și <code>helpers.asm</code>. Deschideți ambele fișiere și observați “legătura” dintre ele (cine apelează ce funcție și din ce fișier). După ce ați înțeles flow-ul programului asamblați fiecare fișier în parte, pentru a obține două fișiere obiect: <code>main.obj</code> și <code>helpers.obj</code>.
</p>

<p>
Pentru link-editarea multiplă se folosește aceeași comandă gcc, numai că se dau mai multe fișiere de intrare. Spre exemplu:
</p>
<pre class="code">&quot;C:\Program Files (x86)\SASM\MinGW\bin\gcc.exe&quot; -g -m32 main.obj helpers.obj -o palindrome.exe</pre>

</div>

<h3 class="sectionedit10" id="p_5_completarea_fisierului_cu_functii_ajutatoare">[1.5p] 5. Completarea fișierului cu funcții ajutătoare</h3>
<div class="level3">

<p>
După cum probabil ați observat, funcția <code>reverse</code> din <code>4-5-linking-multiple/helpers.asm</code> nu face nimic. În cadrul acestui exercițiu, va trebui să implementați corpul funcției, unde este comentariul TODO, astfel încât șirul de caractere care a fost trimis ca parametru să fie întors <em>in-place</em>.
</p>

<p>
Aveți (pseudo-)codul în C care ar face acest lucru:
</p>
<pre class="code C"><span class="kw4">void</span> reverse<span class="br0">&#40;</span><span class="kw4">char</span> <span class="sy0">*</span>s<span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="kw4">int</span> n <span class="sy0">=</span> <a href="http://www.opengroup.org/onlinepubs/009695399/functions/strlen.html"><span class="kw3">strlen</span></a><span class="br0">&#40;</span>s<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw4">int</span> i<span class="sy0">;</span>
  <span class="kw4">char</span> tmp<span class="sy0">;</span>
&nbsp;
  <span class="kw1">for</span> <span class="br0">&#40;</span>i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> n <span class="sy0">/</span> <span class="nu0">2</span><span class="sy0">;</span> <span class="sy0">++</span>i<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    tmp <span class="sy0">=</span> s<span class="br0">&#91;</span>i<span class="br0">&#93;</span><span class="sy0">;</span>
    s<span class="br0">&#91;</span>i<span class="br0">&#93;</span> <span class="sy0">=</span> s<span class="br0">&#91;</span>n <span class="sy0">-</span> i <span class="sy0">-</span> <span class="nu0">1</span><span class="br0">&#93;</span><span class="sy0">;</span>
    s<span class="br0">&#91;</span>n <span class="sy0">-</span> i <span class="sy0">-</span> <span class="nu0">1</span><span class="br0">&#93;</span> <span class="sy0">=</span> tmp<span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
După implementare va trebui să asamblați și link-editați programul.
</p>

</div>

<h3 class="sectionedit11" id="p_6_tutorialgdb">[1p] 6. Tutorial: GDB</h3>
<div class="level3">

<p>
GDB este o unealtă foarte utilă pentru analiza dinamică a programelor. Acesta este folosit foarte des pentru găsirea cauzelor care duc la erori într-un program. În continuare vă vom prezenta câteva dintre comenzile cele mai importante.
</p>

<p>
Primul pas este să urmăriți și să înțelegeți codul din <code>6-7-8-gdb/gdb-tutorial.asm</code>. Pe scurt, programul primește un parametru <code>index</code> și citește de la tastatură o linie. Programul afișează doar un caracter, mai exact al <code>index</code>-lea caracter din șirul dat la intrare.
</p>

<p>
După ce ați citit codul sursă, asamblați și link-editați fișierul. După ce ați obținut executabilul <code>gdb-tutorial.exe</code> (sau ce nume i-ați dat), vom porni GDB-ul cu acel fișier:
</p>
<pre class="code">&quot;C:\Program Files (x86)\SASM\MinGW\bin\gdb.exe&quot; gdb-tutorial.exe</pre>

<p>
După ce ați pornit programul gdb, toată interacțiunea cu acesta se face prin prompt-ul de gdb.
</p>

</div>

<h4 id="lansarea_in_executie_a_programului">Lansarea în execuție a programului</h4>
<div class="level4">

<p>
Pentru a lansa programul urmărit în execuție există două comenzi disponibile:
</p>
<ul>
<li class="level1"><div class="li"> <strong>run</strong> - această comandă va lansa în execuție programul</div>
</li>
<li class="level1"><div class="li"> <strong>start</strong> - spre deosebire de <code>run</code>, această comandă va începe execuția programului, însă se va opri imediat după intrarea în main</div>
</li>
</ul>

<p>
Aceste două comenzi mai pot fi folosite în două feluri:
</p>
<ol>
<li class="level1"><div class="li"> <pre class="code">start 1 2 3 4</pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code">start &lt; file.in</pre>
</div>
</li>
</ol>

<p>
Utilizarea aceasta este similară cu execuția programului direct din linia de comandă (fără GDB), prima variantă însemnând că se trimit 4 parametri (1, 2, 3 și 4) programului, iar a doua, că <code>file.in</code> se redirectează ca intrare standard pentru program.
</p>

<p>
Lansați programul în execuție folosind comanda GDB <code>run</code>. Ce observați? Rulați din nou programul, de data aceasta dând comenzii run parametrul corespunzător.
</p>

<p>
GDB se blochează la citirile de la input. Haideți să corectăm asta folosind un fișier de intrare. Creați un fișier (spre exemplu text.in) în directorul cu executabilul care să conțină textul “ana are mere”. Porniți din nou GDB și lansați în execuție programul cu parametrul de intrare <code>11</code> și cu fișierul <code>text.in</code>, redirectat.
</p>

<p>
Ce observați? Programul își termină execuția cu succes. Deoarece nu a existat niciun breakpoint setat în program, programul nu s-a oprit din execuție decât când a terminat treaba.
</p>

<p>
În cazul pornirii programului, puteți folosi instrucțiunea <code>start</code> care va opri execuția după intrarea în main.
</p>

</div>

<h4 id="breakpoints">Breakpoints</h4>
<div class="level4">

<p>
Elementul esențial al GDB-ului este <em>breakpoint-ul</em>. Practic, un <em>breakpoint</em> setat la o anumită instrucțiune face ca execuția programului să se oprească de fiecare dată când se ajunge la acest punct.
</p>

<p>
Adăugarea unui breakpoint se face cu construcția
</p>
<pre class="code">break [location]</pre>

<p>
, unde <code>location</code> poate fi numele unei funcții sau o adresă din zona .text. În cazul cel din urmă, adresa trebuie să fie precedată de <code>*</code> (star). Exemplu: <code>break *0x004013af</code>.
</p>

<p>
Pentru continuarea programului după eventuala sa oprire într-un breakpoint, puteți folosi comanda <code>continue</code>.
</p>

<p>
Un alt lucru interesant în GDB este comanda <code>commands</code>, care poate asocia unui breakpoint un bloc de comenzi GDB ce vor fi executate la fiecare oprire în breakpoint-ul respectiv.
</p>

<p>
Exemplu:
</p>
<pre class="code">(gdb) break *0x004013af
Breakpoint &lt;n&gt; at 0x4013af
(gdb) commands &lt;n&gt;
Type commands for breakpoint(s) &lt;n&gt;, one per line.
End with a line saying just &quot;end&quot;
&gt; print $eax
&gt; x/i $eip
&gt; end</pre>

<p>
Pentru a nu rămâne blocat în breakpoint (spre exemplu dacă scrieți un script de gdb), puteți adăuga în blocul de instrucțiuni și comanda <code>continue</code>.
</p>

<p>
Haideți să adăugăm un breakpoint la label-ul <code>ok</code>. Dacă dăm <code>continue</code>, vom observa că programul s-a oprit în breakpoint-ul tocmai creat.
<p><div class="noteclassic">
Variaţii:<br/>

<strong>break label</strong> - breakpoint la labelul <strong>label</strong><br/>

<strong>break *(label + &lt;offset&gt;)</strong> - breakpoint la <strong>label + offset</strong><br/>


</div></p>
</p>

</div>

<h4 id="parcurgerea_instructiunilor">Parcurgerea instrucțiunilor</h4>
<div class="level4">

<p>
Atunci când execuția programului este oprită (de exemplu la un breakpoint), putem da comenzi care continuă execuția “pas cu pas”. Pentru a face asta, cel mai des sunt folosite două comenzi:
</p>
<ul>
<li class="level1"><div class="li"> <strong>stepi</strong> - care practic trimite o instrucțiune spre execuție și după execuția acesteia întoarce control-ul la debugger (programul se oprește)</div>
</li>
<li class="level1"><div class="li"> <strong>nexti</strong> - comandă similară cu <code>stepi</code>, însă dacă instrucțiunea curentă este un apel de funcție, debugger-ul nu va intra în funcție (va chema funcția și se va opri la următoarea instrucțiune după <code>call</code>)</div>
</li>
</ul>

<p>
Dacă emitem comanda <code>stepi</code>, putem observa că se afișează instruction pointer-ul instrucțiunii următoare dupa cea la care am făcut break (prima de la label-ul <code>ok</code>).
</p>

</div>

<h4 id="dezasamblarea_programului">Dezasamblarea programului</h4>
<div class="level4">

<p>
Pentru a dezasambla o porțiune de executabil, se poate folosi comanda <code>disassemble</code> din GDB. Dacă aceasta nu primește niciun parametru, va afișa dezasamblarea funcției curente din cadrul execuției.
</p>

<p>
<p><div class="noteclassic">
Default, sintaxa folosită de GDB la dezasamblare este cea “AT&amp;T”. Pentru a folosi sintaxa cunoscută vouă (sintaxa intel), executați în GDB comanda <code>set disassembly-flavor intel</code>.

</div></p>
</p>

<p>
În cadrul exemplului nostru, dacă cerem dezasamblarea funcției curente (folosind <code>disassemble</code> fără parametri) putem observa că ne aflăm la label-ul <code>ok</code>. Observație: GDB iterpretează label-ul <code>ok</code> ca o funcție din cauza codului inițial, care este scris în limbaj de asamblare.
</p>

<p>
Pentru a vedea mai clar efectul <code>stepi</code>/<code>nexti</code> putem rula commanda <code>disassemble</code> înainte și după stepping.
</p>

<p>
<p><div class="noteclassic">
Dacă ați intrat într-o funcție lungă și nu vreți să dați de <code>nexti</code> de foarte multe ori, vă recomandăm instrucțiunea GDB <code>finish</code>, care “termină” o funcție. <strong>Atenție</strong> la funcțiile recursive.

</div></p>
<p><div class="noteclassic">
<strong>disassemble label, +&lt;length&gt;</strong> - afişează &lt;length&gt; bytes de cod dezasamblat începând de la labelul <strong>label</strong>.

</div></p>
</p>

</div>

<h4 id="inspectarea_memoriei_si_a_registrelor">Inspectarea memoriei și a registrelor</h4>
<div class="level4">

<p>
Pentru a afișa diferite valori accesibile GDB-ului se folosește comanda <code>print</code>. De exemplu, pentru a afișa  valoarea unui registru (de exemplu eax), vom folosi construcția <code>print $eax</code>.
</p>

<p>
Pentru inspectarea memoriei se folosește comanda <code>x</code> (examine). Modul de folosire al acestei comenzi este următorul:
</p>
<pre class="code">x/nfu address</pre>

<p>
, unde:
</p>
<ul>
<li class="level1"><div class="li"> <code>n</code> este numărul de elemente afișate</div>
</li>
<li class="level1"><div class="li"> <code>f</code> este formatul de afișare (x pentru hexa, d pentru zecimal, s pentru șir de caractere și i pentru instrucțiuni)</div>
</li>
<li class="level1"><div class="li"> <code>u</code> este dimensiunea unui element (b pentru 1 octet, h pentru 2, w pentru 4 și g pentru 8 octeți)</div>
</li>
</ul>

<p>
De exemplu, o funcționalitate similară cu <code>disassemble</code> o putem obține și folosind <code>x</code> unde formatul este instrucțiune. Astfel, putem afișa, de exemplu, 10 instrucțiuni începând de la instrucțiunea curentă cu construcția <code>x/10i $eip</code>.
</p>

</div>

<h3 class="sectionedit12" id="p_7_afisarea_unor_informatii_la_fiecare_trecere_printr-un_breakpoint">[0.5p] 7. Afișarea unor informații la fiecare trecere printr-un breakpoint</h3>
<div class="level3">

<p>
Folosind executabilul creat la exercițiul anterior (<code>gdb-tutorial.asm</code>), trebuie să setați un breakpoint la intrare în bucla din program (când se mută în subregistrul <code>al</code> un caracter din șirul input). În plus, trebuie să adăugați o serie de comenzi astfel încât la fiecare intrare în buclă, GDB să afișeze valoarea subregistrului <code>al</code> și valoarea counter-ului (în cazul nostru <code>ecx</code>). <strong>Hint!</strong> folosiți comanda <code>commands</code>.
</p>

</div>

<h3 class="sectionedit13" id="p_8_afisarea_adresei_de_retur_ale_unor_functii">[1p] 8. Afișarea adresei de retur ale unor funcții</h3>
<div class="level3">

<p>
Folosind tot executabilul de mai înainte, afișați adresele de return ale tuturor funcțiilor din program (gets, atoi, printf, usage). Pentru cazul funcției usage, trebuie să porniți programul fără parametri.
</p>

</div>

<h3 class="sectionedit14" id="p_9_tutorialdepanarea_unui_segfault_folosind_gdb">[0.5p] 9. Tutorial: Depanarea unui Segfault folosind GDB</h3>
<div class="level3">

<p>
Pentru acest tutorial pornim de la fișierul sursă <code>segfault-tutorial.asm</code> din directorul <code>9-segfault-tutorial</code>. Înainte de a începe tutorialul, citiți sursa, înțelegeți ce face și apoi asamblați și link-editați programul.
</p>

<p>
Dacă încercați să rulați programul fără parametri, se poate observa că progamul “crapă”. Dacă executăm programul sub gdb, putem observa că programul primește <code>SIGSEGV</code>. Pentru a putea determina problema, executăm comanda <code>backtrace</code>, care arată ultimele stack frame-uri prin care execuția programului a trecut. În cazut nostru, doar două:
</p>
<pre class="code">(gdb) backtrace
#0 0x7607d2c3 in strcat () ...
#1 0x00000000 in ?? ()</pre>

<p>
Ne dăm seama că frame-ul interesant pentru noi este <code>#0</code>. Pentru a schimba frame-ul curent folosim comana <code>frame &lt;nr. frame&gt;</code>. Odată ce suntem pe frame-ul ce ne interesează putem să încercăm dezasamblarea programului pentru a identifica problema.
</p>

<p>
După instrucțiunea <code>disassemble</code>, putem observa instruction pointer-ul (notat pe dezasamblarea din GDB cu <code>⇒</code> în dreptul unei instrucțiuni) că a rămas la instrucțiunea
</p>
<pre class="code">mov eax, DWORD PTR [ecx]</pre>

<p>
Deja putem bănui o posibilă cauză a segmentation fault-ului. Inspectați registrul ecx. Ce valoare are? Ce încearcă să facă instrucțiunea cu probleme?
</p>

</div>

<h3 class="sectionedit15" id="p_10_rezolvarea_unui_segfault">[1.5p] 10. Rezolvarea unui Segfault</h3>
<div class="level3">

<p>
Pornind de la executabilul <code>segfault.exe</code>, aflat in directorul <code>10-11-solve-segfault</code>, rulat sub gdb, analizați atât backtrace-ul cât și pas cu pas codul pentru a identifica cauza care duce la Segmentation Fault.
</p>

</div>

<h3 class="sectionedit16" id="p_11_tutorialida">[1p] 11. Tutorial: IDA</h3>
<div class="level3">

<p>
În această secțiune vom prezenta foarte pe scurt câteva dintre numeroasele aspecte ale programului IDA.
</p>

<p>
În primul rând va trebui să descărcați installer-ul de IDA de <a href="https://out7.hex-rays.com/files/idafree50.exe" class="urlextern" title="https://out7.hex-rays.com/files/idafree50.exe"  rel="nofollow">aici</a> și să-l instalați pe mașinile din laborator. După ce programul s-a instalat, porniți Ida Pro Free. La prompt-ul de welcome alegeți varianta <code>[GO] Work on your own</code>. Din meniul de sus dați “Open…” și deschideți fișierul de la exercițiul 10 (<code>segfault.exe</code>).
</p>

<p>
Dintre numeroasele view-uri posibile din IDA, cele mai importante sunt:
</p>
<ul>
<li class="level1"><div class="li"> Control-flow graph-ul ce conține pentru fiecare bloc dezasamblarea sa</div>
</li>
<li class="level1"><div class="li"> <strong>Names</strong> care este o tabelă cu simbolurile din executabil</div>
</li>
<li class="level1"><div class="li"> <strong>Functions</strong> care conține toate informațiile despre o funcție (dacă e statică sau dintr-o bibliotecă; tipul funcției etc.)</div>
</li>
</ul>

<p>
Deși pot fi multe de spus despre IDA, în cadrul acestui laborator ne vom limita doar la capabilitățile de analiză statică ale sale.
<p><div class="noteclassic">
IDA este destul de avansat încât are posibilitatea de a face tracking şi în Kernelul sistemului de operare. Motiv pentru care trebuie rulat cu drepturi de administrator pentru a putea avea dreptul la o resursă critică a sistemului.

</div></p>
</p>

</div>

<h3 class="sectionedit17" id="p_12_bonusmodificarea_control-flow-ului_unui_program_folosind_gdb">[2p] 12. Bonus: Modificarea control-flow-ului unui program folosind GDB</h3>
<div class="level3">

<p>
Pornind de la executabilul <code>control-flow.exe</code>, aflat in directorul <code>12-control-flow</code> rulat sub gdb, trebuie să găsiți o modalitate să se afișeze un flag. Până nu veți rezolva corect problema, se va afișa “No flag for you.”
</p>

</div>

<h3 class="sectionedit18" id="p_13_bonusdecompilarea_unui_program_folosind_ida">[2p] 13. Bonus: Decompilarea unui program folosind IDA</h3>
<div class="level3">

<p>
Pornind de la fișierul obiect <code>decompile.obj</code>, aflat in directorul <code>13-decompile</code>, treaba voastră este să reconstruiți codul sursa (scris în C) din care a provenit binarul. Puteți folosi orice utilitar de analiză statică, însă cel mai indicat pentru acest task este IDA, deoarece reprezintă foarte clar graful de control al execuției.
</p>

</div>

        </div>
        <div class="right_sidebar">
          <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">



<div><div id="nojs_indexmenu_54593473358355a6f004fd" data-jsajax="%26skipfile%3D%252B/iocla%253A%2528sidebar%257Cindex%2529/" class="indexmenu_nojs">

<ul class="idx">
<li class="level1"><div class="li"><a href="../anunturi.html" class="wikilink1" title="iocla:anunturi">Anunțuri</a></div></li>
<li class="level1"><div class="li"><a href="../bune-practici.html" class="wikilink1" title="iocla:bune-practici">Bune practici</a></div></li>
<li class="level1"><div class="li"><a href="../calendar.html" class="wikilink1" title="iocla:calendar">Calendar</a></div></li>
<li class="level1"><div class="li"><a href="../catalog.html" class="wikilink1" title="iocla:catalog">Catalog</a></div></li>
<li class="level1"><div class="li"><a href="../feed.html" class="wikilink1" title="iocla:feed">Feed RSS</a></div></li>
<li class="level1"><div class="li"><a href="../need-to-know.html" class="wikilink1" title="iocla:need-to-know">IOCLA Need to Know</a></div></li>
<li class="level1"><div class="li"><a href="../reguli-notare.html" class="wikilink1" title="iocla:reguli-notare">Reguli și notare</a></div></li>
<li class="level1"><div class="li"><a href="../utile.html" class="wikilink1" title="iocla:utile">Resurse utile</a></div></li>
</ul>
</div></div>

<h1 class="sectionedit1" id="cursuri">Cursuri</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-01.html" class="wikilink1" title="iocla:cursuri:capitol-01">Capitol 01: Introducere</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-02.html" class="wikilink1" title="iocla:cursuri:capitol-02">Capitol 02: Reprezentarea datelor în sistemele de calcul</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-03.html" class="wikilink1" title="iocla:cursuri:capitol-03">Capitol 03: Arhitectura unui sistem de calcul</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-04.html" class="wikilink1" title="iocla:cursuri:capitol-04">Capitol 04: Arhitectura x86</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-05.html" class="wikilink1" title="iocla:cursuri:capitol-05">Capitol 05: Moduri de adresare</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-06.html" class="wikilink1" title="iocla:cursuri:capitol-06">Capitol 06: Setul de instrucțiuni</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-07.html" class="wikilink1" title="iocla:cursuri:capitol-07">Capitol 07: Dezvoltarea în limbaj de asamblare pe x86</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-08.html" class="wikilink1" title="iocla:cursuri:capitol-08">Capitol 08: Inginerie inversă și exploatarea aplicațiilor</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-09.html" class="wikilink1" title="iocla:cursuri:capitol-09">Capitol 09: Operații și extensii dedicate</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/capitol-10.html" class="wikilink1" title="iocla:cursuri:capitol-10">Capitol 10: Programarea pentru medii specifice</a></div>
</li>
</ul>

</div>
<!-- EDIT1 SECTION "Cursuri" [166-529] -->
<h1 class="sectionedit2" id="laboratoare">Laboratoare</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="laborator-01.html" class="wikilink1" title="iocla:laboratoare:laborator-01">Laborator 01: Introducere</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-02.html" class="wikilink1" title="iocla:laboratoare:laborator-02">Laborator 02: Toolchain</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-03.html" class="wikilink1" title="iocla:laboratoare:laborator-03">Laborator 03: First baby steps</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-04.html" class="wikilink1" title="iocla:laboratoare:laborator-04">Laborator 04: Rolul registrelor, adresare directă și bazată</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-05.html" class="wikilink1" title="iocla:laboratoare:laborator-05">Laborator 05: Structuri, vectori, explorarea memoriei</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-06.html" class="wikilink1" title="iocla:laboratoare:laborator-06">Laborator 06: Apeluri de funcții</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-07.html" class="wikilink1" title="iocla:laboratoare:laborator-07">Laborator 07: Operații pe numere mari</a></div>
</li>
<li class="level1"><div class="li"> <span class="curid"><a href="laborator-08.html" class="wikilink1" title="iocla:laboratoare:laborator-08">Laborator 08: Interfața în linia de comandă, analiza statică și dinamică</a></span></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-09.html" class="wikilink1" title="iocla:laboratoare:laborator-09">Laborator 09: Gestiunea bufferelor. Buffer overflow</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-10.html" class="wikilink1" title="iocla:laboratoare:laborator-10">Laborator 10: Exploatarea memoriei. Shellcodes</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-11.html" class="wikilink1" title="iocla:laboratoare:laborator-11">Laborator 11: Interactiunea C-assembly</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-12.html" class="wikilink1" title="iocla:laboratoare:laborator-12">Laborator 12: Calcul în virgulă mobilă</a></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Laboratoare" [530-1037] -->
<h1 class="sectionedit3" id="teme">Teme</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../teme/tema-1.html" class="wikilink1" title="iocla:teme:tema-1">Tema 1</a></div>
</li>
<li class="level1"><div class="li"> <a href="../teme/tema-2.html" class="wikilink1" title="iocla:teme:tema-2">Tema 2</a></div>
</li>
<li class="level1"><div class="li"> <a href="../teme/tema-3.html" class="wikilink1" title="iocla:teme:tema-3">Tema 3</a></div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Teme" [1038-] -->
</div>
<div class="toc_sidebar sidebar_box">
<!-- TOC START -->
<div id="sb__right__dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-08.html#laborator_08interfata_in_linia_de_comanda_analiza_statica_si_dinamica">Laborator 08: Interfața în linia de comandă, analiza statică și dinamică</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-08.html#interfata_in_linia_de_comanda">Interfața în linia de comanda</a></div></li>
<li class="level2"><div class="li"><a href="laborator-08.html#analiza_statica">Analiza statică</a></div></li>
<li class="level2"><div class="li"><a href="laborator-08.html#analiza_dinamica">Analiza dinamică</a></div></li>
<li class="level2"><div class="li"><a href="laborator-08.html#tutoriale_si_exercitii">Tutoriale și exerciții</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-08.html#p_1_tutorialasamblarea_din_linia_de_comanda">[0.5p] 1. Tutorial: Asamblarea din linia de comandă</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_2_tutoriallink-editarea_unui_fisier_obiect">[0.5p] 2. Tutorial: Link-editarea unui fișier obiect</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_3_implementare_minimala_cat">[1.5p] 3. Implementare minimală &#039;&#039;cat&#039;&#039;</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_4_tutoriallink-editarea_mai_multor_fisiere_obiect">[0.5p] 4. Tutorial: Link-editarea mai multor fișiere obiect</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_5_completarea_fisierului_cu_functii_ajutatoare">[1.5p] 5. Completarea fișierului cu funcții ajutătoare</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_6_tutorialgdb">[1p] 6. Tutorial: GDB</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-08.html#lansarea_in_executie_a_programului">Lansarea în execuție a programului</a></div></li>
<li class="level4"><div class="li"><a href="laborator-08.html#breakpoints">Breakpoints</a></div></li>
<li class="level4"><div class="li"><a href="laborator-08.html#parcurgerea_instructiunilor">Parcurgerea instrucțiunilor</a></div></li>
<li class="level4"><div class="li"><a href="laborator-08.html#dezasamblarea_programului">Dezasamblarea programului</a></div></li>
<li class="level4"><div class="li"><a href="laborator-08.html#inspectarea_memoriei_si_a_registrelor">Inspectarea memoriei și a registrelor</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_7_afisarea_unor_informatii_la_fiecare_trecere_printr-un_breakpoint">[0.5p] 7. Afișarea unor informații la fiecare trecere printr-un breakpoint</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_8_afisarea_adresei_de_retur_ale_unor_functii">[1p] 8. Afișarea adresei de retur ale unor funcții</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_9_tutorialdepanarea_unui_segfault_folosind_gdb">[0.5p] 9. Tutorial: Depanarea unui Segfault folosind GDB</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_10_rezolvarea_unui_segfault">[1.5p] 10. Rezolvarea unui Segfault</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_11_tutorialida">[1p] 11. Tutorial: IDA</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_12_bonusmodificarea_control-flow-ului_unui_program_folosind_gdb">[2p] 12. Bonus: Modificarea control-flow-ului unui program folosind GDB</a></div></li>
<li class="level3"><div class="li"><a href="laborator-08.html#p_13_bonusdecompilarea_unui_program_folosind_ida">[2p] 13. Bonus: Decompilarea unui program folosind IDA</a></div></li>
</ul></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          iocla/laboratoare/laborator-08.txt · Last modified: 2016/11/23 10:33 by vladimir.diaconescu          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
              </div>
      <div class="bar-right">
        <a href="http://ocw.cs.pub.ro/courses/iocla/laboratoare/laborator-08?do=media&amp;ns=iocla%3Alaboratoare"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="laborator-08.html#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div align="center" class="footerinc">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported" /></a></div>
  <a target="_blank" href="http://www.chimeric.de" title="www.chimeric.de"><img src="../../lib/tpl/arctic/images/button-chimeric-de.png" width="80" height="15" alt="www.chimeric.de" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="../../lib/tpl/arctic/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="../../lib/tpl/arctic/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>

  <a target="_blank" href="http://www.firefox-browser.de" title="do yourself a favour and use a real browser - get firefox"><img src="../../lib/tpl/arctic/images/button-firefox.png" width="80" height="15" alt="do yourself a favour and use a real browser - get firefox!!" border="0" /></a>
  
  <a target="_blank" href="../../feed.php" title="Recent changes RSS feed"><img src="../../lib/tpl/arctic/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="../../lib/tpl/arctic/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>
</div>

  </div>
</div>

<div class="no"><img src="http://ocw.cs.pub.ro/courses/lib/exe/indexer.php?id=iocla%3Alaboratoare%3Alaborator-08&amp;1479891567" width="2" height="1" alt="" /></div>
</body>
</html>
