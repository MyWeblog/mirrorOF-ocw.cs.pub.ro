    
    

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    Laborator 03 - Dezvoltarea programelor în C sub mediul Linux    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-10-25T23:22:27+0300"/>
<meta name="keywords" content="uso-ac,laboratoare,laborator-03"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../feed.php%3Fmode=list&amp;ns=uso-ac:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/uso-ac/laboratoare/laborator-03.html"/>
<link rel="canonical" href="laborator-03.html"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php%3Ft=arctic&amp;tseed=1476798676.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='uso-ac:laboratoare';var JSINFO = {"id":"uso-ac:laboratoare:laborator-03","namespace":"uso-ac:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php%3Ftseed=1476798676"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="../../lib/tpl/arctic/images/favicon.ico" />

  
</head>
<body>
<div id="wrapper" class='show'>
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="../index.html"><img height="70" src="../../res/sigla_uso.png"/> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="../../systems/index.html"/><img height="70" src="../../res/systems.png" name="dokuwiki__top"/></a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="laborator-03%3Fdo=recent.html"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="laborator-03%3Fdo=login&amp;sectok=f62420cf5b01253da4b50505d148181b.html"  class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h1 class="sectionedit1" id="laborator_03_-_dezvoltarea_programelor_in_c_sub_mediul_linux">Laborator 03 - Dezvoltarea programelor în C sub mediul Linux</h1>
<div class="level1">

</div>

<h2 class="sectionedit2" id="obiective_laborator">Obiective laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> Familiarizarea cu etapele prin care trece codul sursa de la sursa la executabil</div>
</li>
<li class="level1"><div class="li"> Familiarizarea cu toolurile necesare acestui lucru (gcc)</div>
</li>
<li class="level1"><div class="li"> Automatizarea procesului de compilare (make &amp; Makefiles)</div>
</li>
<li class="level1"><div class="li"> Prezentarea unor principii de bază în scrierea/editarea de cod</div>
</li>
</ul>

</div>

<h2 class="sectionedit3" id="suport_laborator">Suport laborator</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA319" class="urlextern" title="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA319"  rel="nofollow">11. Compilare și linking</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA469" class="urlextern" title="http://books.google.com/books?id=_JFGzyRxQGcC&amp;pg=PA469"  rel="nofollow">14. Utilitare pentru dezvoltarea programelor</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://makefiletutorial.com" class="urlextern" title="http://makefiletutorial.com"  rel="nofollow">Makefile Tutorial by Example</a></div>
</li>
<li class="level1"><div class="li"> <a href="http://xkcd.com/303/" class="urlextern" title="http://xkcd.com/303/"  rel="nofollow">My code is compiling</a></div>
</li>
</ul>

</div>

<h3 class="sectionedit4" id="pachete_necesare">Pachete necesare</h3>
<div class="level3">

<p>
Pe unele sisteme este posibil ca aceste pachete necesare să lipsească:
</p>
<ul>
<li class="level1"><div class="li"> <code>build-essential</code></div>
</li>
<li class="level1"><div class="li"> <code>manpages-dev</code></div>
</li>
</ul>

<p>
În cazul în care nu sunt instalate implicit pe sistemul vostru, pe un sistem Ubuntu se poate folosi comanda
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span><span class="kw2">sudo</span> <span class="kw2">apt-get install</span> build-essential manpages-dev</pre>

</div>

<h1 class="sectionedit5" id="demo">Demo</h1>
<div class="level1">

<p>
Pentru demo deschidem un terminal (folosim combinația de taste <code><strong>Alt+Ctrl+t</strong></code>) și clonăm <a href="https://github.com/systems-cs-pub-ro/uso" class="urlextern" title="https://github.com/systems-cs-pub-ro/uso"  rel="nofollow">repository-ului oficial uso</a>. 
</p>

<p>
<p><div class="noteimportant">Ne asigurăm că suntem în <code>/home/student</code>
</div></p>
</p>

<p>
Folosim comanda: 
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span><span class="kw2">git clone</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>systems-cs-pub-ro<span class="sy0">/</span>uso </pre>

<p>
În directorul <code>/home/student/uso/lab03</code> găsim fișierele necesare pentru laboratorul 3.
</p>

</div>

<h2 class="sectionedit6" id="compilarea_unui_singur_fisier_sursa">Compilarea unui singur fișier sursă</h2>
<div class="level2">

<p>
În cele ce urmează, vom consideră ca verbul <strong>a compila</strong> înseamnă a obține dintr-unul sau mai multe fișiere sursă un fișier executabil.
</p>

<p>
Mergem în directorul <code>/home/student/uso/lab03/simple-gcc</code> unde găsim fișierul <code>simple_hello.c</code>. 
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw3">pwd</span>
<span class="sy0">/</span>home<span class="sy0">/</span>student<span class="sy0">/</span>
<span class="co4">student@midgard$ </span><span class="kw3">cd</span> uso<span class="sy0">/</span>lab03<span class="sy0">/</span>simple-gcc
<span class="co4">student@midgard$ </span><span class="kw2">ls</span>
Makefile  hello.c  simple_hello.c  utils.h
errors.c  help.c   utils.c         warnings.c
<span class="co4">student@midgard$ </span><span class="kw2">gcc</span> simple_hello.c                                 
<span class="co4">student@midgard$ </span><span class="kw2">ls</span>
Makefile  errors.c  help.c          utils.c  warnings.c
a.out     hello.c   simple_hello.c  utils.h
<span class="co4">student@midgard$ </span>.<span class="sy0">/</span>a.out
Hello world<span class="sy0">!</span></pre>

<p>
Anterior am folosit comanda <code>gcc</code> căreia i-am dat un singur parametru ca intrare. A generat un binar numit <code>a.out</code>. Mai jos putem vedea cum obținem un nume <em>custom</em> pentru binarul rezulat în urma comiplării fișierului <code>simple_hello.c</code>. 
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">ls</span>
Makefile  errors.c  help.c          utils.c  warnings.c
a.out     hello.c   simple_hello.c  utils.h
<span class="co4">student@midgard$ </span><span class="kw2">gcc</span> simple_hello.c <span class="re5">-o</span> hello                          
<span class="co4">student@midgard$ </span><span class="kw2">ls</span>                      
Makefile  errors.c  hello.c  simple_hello.c  utils.h
a.out     hello     help.c   utils.c         warnings.c
<span class="co4">student@midgard$ </span>.<span class="sy0">/</span>hello
Hello world<span class="sy0">!</span>
<span class="co4">student@midgard$ </span><span class="kw3">pwd</span>
<span class="sy0">/</span>home<span class="sy0">/</span>student<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>simple-gcc<span class="sy0">/</span></pre>

<p>
Observați că anterior am folosit o cale relativă la directorul curent pentru a executa fișierul <code>hello</code>, prin apelul <code>./hello</code>. Puteam folosi și o cale absolută: <code>/home/student/uso/lab03/simple-gcc/hello</code> pentru executare.
</p>

<p>
<p><div class="noteimportant">
Reamintiți-vă de la laboratorul trecut ce înseamnă <code>.</code> (punct, <em>dot</em>): <strong>directorul curent</strong>.

</div></p>
</p>

<p>
Pentru a vedea ce tip de fișier binar/executabil este <code>hello</code>, putem folosi comanda <code>file</code>: 
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">file</span> .<span class="sy0">/</span>hello
hello: ELF <span class="nu0">64</span>-bit LSB executable, x86-<span class="nu0">64</span>, version <span class="nu0">1</span> <span class="br0">&#40;</span>SYSV<span class="br0">&#41;</span>, dynamically linked <span class="br0">&#40;</span>uses shared libs<span class="br0">&#41;</span>, <span class="kw1">for</span> GNU<span class="sy0">/</span>Linux 2.6.32, BuildID<span class="br0">&#91;</span>sha1<span class="br0">&#93;</span>=0x92a8cd0efe5b5dd5587b5965d8bc6fa27fac32af, not stripped</pre>

<p>
Comanda <code>gcc simple_hello.c</code> a fost folosită pentru compilarea fișierului sursă <code>simple_hello.c</code>. Rezultatul a fost obținerea fișierului executabil <code>a.out</code> (nume implicit utilizat de <code>gcc</code>). Dacă se dorește obținerea unui executabil cu un alt nume se poate folosi opțiunea <code>-o</code>.
</p>

<p>
În mod similar se folosește <code>g++</code> pentru compilarea unui program sursă C++.
</p>

</div>

<h2 class="sectionedit7" id="alte_exemple_de_comenzi_folosind_compilatorul_gcc">Alte exemple de comenzi folosind compilatorul gcc</h2>
<div class="level2">

<p>
Pentru compilarea de programe C, respectiv C++ folosim în linie de comandă compilatoarele <code>gcc</code>, respectiv <code>g++</code>. O invocare tipică este pentru compilarea unui program dintr-un singur fișier sursă, în cazul nostru <code>simple_hello.c</code>. 
</p>

<p>
Pornim de la programul simplu din fișierul <code>simple_hello.c</code> pe care îl găsim în directorul <code>~/uso/lab03/simple-gcc</code> care tipărește la ieșirea standard un șir de caractere:
</p>
<dl class="code">
<dt><a href="../../_export/code/uso-ac/laboratoare/laborator-03%3Fcodeblock=5" title="Download Snippet" class="mediafile mf_c">simple_hello.c</a></dt>
<dd><pre class="code c"><span class="co2">#include &lt;stdio.h&gt;</span>
&nbsp;
<span class="kw4">int</span> main<span class="br0">&#40;</span><span class="kw4">void</span><span class="br0">&#41;</span> 
<span class="br0">&#123;</span>
      <a href="http://www.opengroup.org/onlinepubs/009695399/functions/printf.html"><span class="kw3">printf</span></a><span class="br0">&#40;</span><span class="st0">&quot;Hello world!<span class="es1">\n</span>&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">return</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

<p>
Formatul general al unei comenzi de compilare cu <code>gcc</code>: 
</p>
<pre class="code bash"><span class="kw2">gcc</span> fisiere.c <span class="re5">-o</span> nume_executabil COMPILING_FLAGS LINK_BIBLIOTECI</pre>
<ul>
<li class="level1"><div class="li"> <code>COMPILING_FLAGS</code> sunt opțiuni ale gcc (precum <code>-g</code>, <code>-w</code>, <code>-Wall</code>)</div>
</li>
<li class="level1"><div class="li"> <code>LINK_BIBLIOTECI</code> ține de opțiuni precum <code>-lm</code> sau <code>-L</code>.</div>
</li>
</ul>

<p>
<p><div class="notewarning">
După <code>-o</code> trebuie să se găsească numele fișierului de ieșire. Acesta suprascrie fișierele pe care le primește ca argument.

</div></p>
</p>

<p>
Comanda poate fi, la fel de bine, structurată și astfel:
</p>
<pre class="code bash"><span class="kw2">gcc</span> COMPILING_FLAGS <span class="re5">-o</span> nume_executabil fisiere.c LINK_BIBLIOTECI</pre>

<p>
<p><div class="notewarning">
După <code>-o</code> nu punem fișiere sursă sau alte fișiere. Dacă vom face asta, fișierele vor fi suprascrise și vom pierde conținutul acestora.

</div></p>
</p>

<p>
Exemple concrete: 
</p>

<p>
<strong>Intrați în directorul ~/uso/lab03/simple-gcc</strong>
</p>
<ol>
<li class="level1"><div class="li"> Compilarea unui program simplu: <pre class="code bash"> <span class="kw2">gcc</span> simple_hello.c <span class="re5">-o</span> simple_hello </pre>
</div>
</li>
<li class="level1"><div class="li"> Compilarea unui program simplu, și afișarea tuturor warning-urilor <pre class="code bash"> <span class="kw2">gcc</span> <span class="re5">-Wall</span> simple_hello.c <span class="re5">-o</span> simple_hello </pre>
</div>
</li>
<li class="level1"><div class="li"> Compilarea unui program, cu afisarea tuturor warning-urilor care are nevoie de legatura catre biblioteca matematica <pre class="code bash"> <span class="kw2">gcc</span> <span class="re5">-Wall</span> simple_hello.c <span class="re5">-o</span> math_hello <span class="re5">-lm</span> </pre>
</div>
</li>
<li class="level1"><div class="li"> Compilarea unui program, cu afișarea tuturor warning-urilor, din mai multe fișiere sursă <pre class="code bash"> <span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c utils.c help.c <span class="re5">-o</span> hello</pre>
</div>
</li>
</ol>

<p>
Paginile de ajutor ale <a href="http://linux.die.net/man/1/gcc" class="urlextern" title="http://linux.die.net/man/1/gcc"  rel="nofollow">GCC</a> (<code>man gcc</code>, <code>info gcc</code>) oferă o listă cu toate opțiunile posibile ale GCC.
</p>

</div>

<h2 class="sectionedit8" id="compilarea_si_link-editarea_programelor">Compilarea și link-editarea programelor</h2>
<div class="level2">

</div>

<h5 id="separarea_compilarii_de_link-editare_pentru_obtinerea_unui_fisier_obiect">Separarea compilării de link-editare pentru obținerea unui fișier obiect</h5>
<div class="level5">
<pre class="code bash"><span class="kw2">gcc</span> <span class="re5">-c</span> simple_hello.c <span class="re5">-o</span> hello-obj.o</pre>

<p>
La acest pas, obținem programul în limbaj <code>cod mașină</code>, cod care nu mai poate fi înțeles deloc de către oameni, fiind practic doar șiruri de biți 1/0. Acest tip de cod generat mai este cunoscut și sub numele de <code>cod obiect</code> și poate fi executat direct de către procesor. 
</p>

<p>
Fișierul intermediar produs are extensia <code>.o</code>.
</p>

</div>

<h5 id="editare_de_legaturi_linking_phase">Editare de legături(linking phase)</h5>
<div class="level5">
<pre class="code bash"> <span class="kw2">gcc</span> hello-obj.o <span class="re5">-o</span> hello </pre>

<p>
Odată ce fișierul obiect este generat în etapa de asamblare, toate simbolurile (funcții, variabile globale etc) trebuie <code>rezolvate</code>, adică, de exemplu pentru funcții, trebuie găsită implementarea efectivă (corpul funcției) care se poate afla în alt fișier obiect sau într-o bibliotecă a sistemului. De exemplu atunci când scriem <code>printf(…)</code>, pentru a afișa un șir de caractere pe ecran, codul aferent funcției de bibliotecă <code>printf()</code> trebuie efectiv copiat în programul nostru sau măcar făcută o legătură către el (de aici și numele de editare de legături). De asemenea, dacă programul nostru constă din mai multe fișiere <code>.c</code>, fiecare dintre ele va produce câte un fișier obiect separat, dar în final noi vom obține un singur fișier și anume programul executabil. De legătura dintre fișierele obiect mai sus menționate se ocupă, bineînțeles, linkerul.   
</p>

</div>

<h5 id="executarea_codului">Executarea codului</h5>
<div class="level5">

<p>
Se face apelând din Bash (Terminal) fișierul executabil, folosind calea către acesta: 
</p>
<ol>
<li class="level1"><div class="li"> Fie relativă la directorul curent <pre class="code bash">   student<span class="sy0">@</span>midgard$: <span class="kw3">pwd</span>
   <span class="sy0">/</span>home<span class="sy0">/</span>student<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>simple-gcc<span class="sy0">/</span>
   student<span class="sy0">@</span>midgard$: .<span class="sy0">/</span>hello </pre>
</div>
</li>
<li class="level1"><div class="li"> Fie absolută <pre class="code bash"> student<span class="sy0">@</span>midgard$: <span class="sy0">/</span>home<span class="sy0">/</span>student<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>simple-gcc<span class="sy0">/</span>hello </pre>
</div>
</li>
</ol>

<p>
Exemplu: Putem rula <code>ls</code> folosind binarul din sistemul Linux. Încercați să executați comanda <code>/bin/ls</code> <img src="../../lib/images/smileys/icon_smile.gif" class="icon" alt=":-)" />
</p>

</div>

<h5 id="link-editarea_mai_multor_fisiere_obiect">Link-editarea mai multor fișiere obiect</h5>
<div class="level5">

<p>
Intrăm în directorul <code>~/uso/lab03/simple-gcc</code>
</p>

<p>
Separăm compilarea fișierului <code>help.c</code> de link-editare pentru a obține fișierului obiect <code>help.o</code>. Pentru aceasta vom folosi comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">gcc</span> <span class="re5">-c</span> help.c
<span class="co4">student@midgard$</span>: <span class="kw2">ls</span>
errors.c  hello.c  help.c  help.o  Makefile  utils.c  utils.h  warnings.c simple_hello.c</pre>

<p>
Observați crearea fișierului <code>help.o</code>. Procedăm similar pentru <code>utils.c</code> și <code>hello.c</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">gcc</span> <span class="re5">-c</span> utils.c
<span class="co4">student@midgard$</span>: <span class="kw2">gcc</span> <span class="re5">-c</span> hello.c
<span class="co4">student@midgard$</span>: <span class="kw2">ls</span>
errors.c  hello.c  hello.o  help.c  help.o  Makefile  simple_hello.c  utils.c  utils.h  utils.o  warnings.c</pre>

<p>
Pentru a obține fișierul binar <code>hello</code>, care execută codul din corpul funcției <code>main</code> al fișierului sursă <code>hello.c</code> este nevoie să punem cap la cap toate cele 3 fișiere obiect, să le link-edităm: 
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">gcc</span> utils.o help.o hello.o <span class="re5">-o</span> hello
<span class="co4">student@midgard$</span>: <span class="kw2">ls</span>
errors.c  hello  hello.c  hello.o  help.c  help.o  Makefile  simple_hello.c  utils.c  utils.h  utils.o  warnings.c
<span class="co4">student@midgard$</span>: <span class="kw2">file</span> hello
hello: ELF <span class="nu0">64</span>-bit LSB  executable, x86-<span class="nu0">64</span>, version <span class="nu0">1</span> <span class="br0">&#40;</span>SYSV<span class="br0">&#41;</span>, dynamically linked <span class="br0">&#40;</span>uses shared libs<span class="br0">&#41;</span>, <span class="kw1">for</span> GNU<span class="sy0">/</span>Linux 2.6.24, BuildID<span class="br0">&#91;</span>sha1<span class="br0">&#93;</span>=54b686de038a29fed397f604403961f9d1086f76, not stripped
<span class="co4">student@midgard$</span>: .<span class="sy0">/</span>hello
<span class="nu0">30</span>
craaaaap</pre>

</div>

<h2 class="sectionedit9" id="makefiles">Makefiles</h2>
<div class="level2">

<p>
<strong>Make</strong> este un utilitar care permite automatizarea și eficientizarea sarcinilor. În mod particular este folosit pentru automatizarea compilării programelor. După cum s-a precizat, pentru obținerea unui executabil provenind din mai multe surse este ineficientă compilarea de fiecare dată a fiecărui fișier și apoi link-editarea. Se compilează fiecare fișier separat, iar la o modificare se va recompila doar fișierul modificat.
</p>

</div>

<h4 id="exemplu_simplu_de_makefile">Exemplu simplu de Makefile</h4>
<div class="level4">

<p>
Utilitarul <a href="http://linux.die.net/man/1/make" class="urlextern" title="http://linux.die.net/man/1/make"  rel="nofollow">make</a> folosește un fișier de configurare denumit <code>Makefile</code>. Un astfel de fișier conține reguli și comenzi de automatizare. 
</p>
<table class="columns-plugin" style="width:100%">
<tr><td class="columns-plugin first" style="width:50%;">
<dl class="code">
<dt><a href="../../_export/code/uso-ac/laboratoare/laborator-03%3Fcodeblock=24" title="Download Snippet" class="mediafile mf_">Makefile </a></dt>
<dd><pre class="code make">all<span class="sy0">:</span>
       gcc <span class="sy0">-</span>Wall hello<span class="sy0">.</span>c <span class="sy0">-</span>o hello
clean<span class="sy0">:</span>
       rm <span class="sy0">-</span>f hello</pre>
</dd></dl>
</td><td class="columns-plugin" style="width:50%;">
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">make</span>
<span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c <span class="re5">-o</span> hello
<span class="co4">student@midgard$ </span>.<span class="sy0">/</span>hello
Hello, World<span class="sy0">!</span></pre>
</td><td class="columns-plugin last">
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">make</span> clean
<span class="kw2">rm</span> <span class="re5">-f</span> hello
<span class="co4">student@midgard$ </span><span class="kw2">make</span> all
<span class="kw2">gcc</span> <span class="re5">-Wall</span> hello.c <span class="re5">-o</span> hello</pre>
</td></tr></table>

<p>
<p><div class="notewarning">
Aveți grijă la separatorul folosit în cadrul unui fișier <code>Makefile</code>. Liniile care conțin comenzi de compilare sunt indentate folosind <code>TAB</code>, nu <code>space</code>.
</p>
<dl class="code">
<dt><a href="../../_export/code/uso-ac/laboratoare/laborator-03%3Fcodeblock=27" title="Download Snippet" class="mediafile mf_">Makefile</a></dt>
<dd><pre class="code make">main<span class="sy0">.</span>o<span class="sy0">:</span> main<span class="sy0">.</span>c
<span class="sy0">&lt;</span>  TAB  <span class="sy0">&gt;</span>gcc <span class="sy0">-</span>Wall <span class="sy0">-</span>c main<span class="sy0">.</span>c</pre>
</dd></dl>

<p>

</div></p>
</p>

<p>
Exemplul prezentat mai sus conține două reguli: <code>all</code> și <code>clean</code>. La rularea comenzii <strong><code>make</code></strong> se execută prima regulă din Makefile (în cazul de față <code>all</code>, nu contează în mod special denumirea). Comanda executată este <code>gcc -Wall hello.c -o hello</code>. Se poate preciza explicit ce regulă să se execute prin transmiterea ca argument comenzii <code>make</code>. (comanda <strong><code>make clean</code></strong> pentru a șterge executabilul <code>hello</code> și comanda <strong><code>make all</code></strong> pentru a obține din nou acel executabil).
</p>

</div>

<h4 id="alt_exemplu_de_makefile">Alt exemplu de Makefile</h4>
<div class="level4">

<p>
Intrați în directorul <code>~/uso/lab03/simple-gcc</code>. Amintiți-vă cele 4 comenzi gcc pe care le-am dat pentru a obține 3 fișiere obiect din sursele <code>utils.c</code>, <code>hello.c</code> și <code>help.c</code> și cea de a patra comanda pentru a link-edita cele 3 obiecte spre obținerea binarului. 
</p>

<p>
Putem automatiza toți acești pași putem folosi fișierul <code>Makefile</code>:
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">make</span>
<span class="kw2">gcc</span> <span class="re5">-c</span> utils.c
<span class="kw2">gcc</span> <span class="re5">-c</span> hello.c
<span class="kw2">gcc</span> <span class="re5">-c</span> help.c
<span class="kw2">gcc</span> utils.o help.o hello.o <span class="re5">-o</span> hello
<span class="co4">student@midgard$</span>: <span class="kw2">ls</span>
errors.c  hello  hello.c  hello.o  help.c  help.o  Makefile  simple_hello.c  utils.c  utils.h  utils.o  warnings.c
<span class="co4">student@midgard$</span>: <span class="kw2">file</span> hello
hello: ELF <span class="nu0">64</span>-bit LSB  executable, x86-<span class="nu0">64</span>, version <span class="nu0">1</span> <span class="br0">&#40;</span>SYSV<span class="br0">&#41;</span>, dynamically linked <span class="br0">&#40;</span>uses shared libs<span class="br0">&#41;</span>, <span class="kw1">for</span> GNU<span class="sy0">/</span>Linux 2.6.24, BuildID<span class="br0">&#91;</span>sha1<span class="br0">&#93;</span>=54b686de038a29fed397f604403961f9d1086f76, not stripped
<span class="co4">student@midgard$</span>: .<span class="sy0">/</span>hello
<span class="nu0">30</span>
craaaaap</pre>

<p>
Urmăriți dependențele între reguli din fișierul <code>~/uso/lab03/simple-gcc/Makefile</code>:
</p>
<dl class="code">
<dt><a href="../../_export/code/uso-ac/laboratoare/laborator-03%3Fcodeblock=29" title="Download Snippet" class="mediafile mf_">Makefile</a></dt>
<dd><pre class="code make">build<span class="sy0">:</span> utils<span class="sy0">.</span>o hello<span class="sy0">.</span>o help<span class="sy0">.</span>o
        gcc utils<span class="sy0">.</span>o help<span class="sy0">.</span>o hello<span class="sy0">.</span>o <span class="sy0">-</span>o hello
&nbsp;
all<span class="sy0">:</span>
        gcc simple_hello<span class="sy0">.</span>c <span class="sy0">-</span>o simple
&nbsp;
utils<span class="sy0">.</span>o<span class="sy0">:</span> utils<span class="sy0">.</span>c
        gcc <span class="sy0">-</span>c utils<span class="sy0">.</span>c
&nbsp;
hello<span class="sy0">.</span>o<span class="sy0">:</span> hello<span class="sy0">.</span>c
        gcc <span class="sy0">-</span>c hello<span class="sy0">.</span>c
&nbsp;
help<span class="sy0">.</span>o<span class="sy0">:</span> help<span class="sy0">.</span>c
        gcc <span class="sy0">-</span>c help<span class="sy0">.</span>c
&nbsp;
clean<span class="sy0">:</span>
        rm <span class="sy0">-</span>f <span class="sy0">*.</span>o hello</pre>
</dd></dl>

</div>

<h1 class="sectionedit10" id="exercitii">Exerciții</h1>
<div class="level1">

</div>

<h3 class="sectionedit11" id="pregatire_setup_laborator_1p">0.0. Pregătire setup laborator (1p)</h3>
<div class="level3">

<p>
<p><div class="noteclassic">
Intrați în directorul <code>/home/student</code>. Dacă nu ați clonat deja la secțiunea demo <a href="https://github.com/systems-cs-pub-ro/uso" class="urlextern" title="https://github.com/systems-cs-pub-ro/uso"  rel="nofollow">repository-ului oficial uso</a>, atunci clonați-l acum folosind coamnda:
</p>
<pre class="code bash"><span class="co4">student@uso:~$ </span><span class="kw2">git clone</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>systems-cs-pub-ro<span class="sy0">/</span>uso </pre>

<p>
În directorul <code>~/uso/lab03</code> găsiți fișierele necesare pentru rezolvarea acestui laborator.

</div></p>
</p>

<p>
<p><div class="notetip">Recomandăm rezolvarea exercițiilor pe mașina virtuală USO pe care o veți avea și la teme și la testul practic. Informații pas cu pas despre importul și pornirea acesteia se află în secțiunea <a href="../../uso/resurse/mv.html" class="wikilink1" title="uso:resurse:mv">Mașina virtuală</a>.
</p>

<p>
Pentru acest laborator putem porni la lucru cu mașina cu interfață grafică, aceasta se află în <code>/mnt/unfrozen</code>. Drept urmare importăm fișierul <code>/mnt/unfrozen/uso_2016_2017_gnome.ova</code>
</p>

<p>

</div></p>
</p>

</div>

<h2 class="sectionedit12" id="compilarea_unui_fisier_sursa_c_2p">[1] Compilarea unui fișier sursă C (2p)</h2>
<div class="level2">

<p>
Pentru a rezolva următoarea serie de exerciții mergeți în directorul <code>/home/student/uso/lab03/simple-gcc</code>. Pentru aceasta
folosim următoarea comandă <code>cd ~/uso/lab03/simple-gcc</code>. În directorul <code>simple-gcc</code> găsiți fișierul sursă <code>simple_hello.c</code>. Compilați-l, folosind <code>gcc</code>, într-un fișier executabil denumit <code>hello</code>. Pentru aceasta folosim următoarea comandă:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> simple_hello.c <span class="re5">-o</span> hello</pre>

<p>
Rulați executabilul proaspăt obținut.
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span>.<span class="sy0">/</span>hello
Hello, World</pre>

<p>
Repetați procesul de mai sus, dar de data aceasta obțineți un executabil cu numele <code>salut</code>. Acum îl rulăm și observăm că am obținut exact același lucru ca mai sus. Cele două fișiere par identice, dar ca să ne asigurăm folosim comanda <code>cmp</code>.
</p>

<p>
<p><div class="notetip">
Folosiți cunoștințele din laboratorul precedent și căutați în pagina de manual a comenzii <code>cmp</code> folosind comanda:
</p>
<pre class="code bash"> <span class="kw2">man</span> <span class="kw2">cmp</span> </pre>

<p>
Dacă în urma rulării comenzii <code>cmp</code> cu parametrii corespunzător nu se va afișa nimic înseamnă că cele două fișiere sunt identice.

</div></p>
</p>

<p>
Observăm că cele două fișiere sunt într-adevăr identice, acest lucru datorându-se faptului că procesul de compilare este unul determinist (o bucată de cod sursă C se va <em>traduce</em> mereu în exact aceleași instrucțiuni în limbaj de asamblare și apoi în cod mașină - dacă se păstrează același grad de optimizare).
</p>

</div>

<h2 class="sectionedit13" id="detectarea_si_corectarea_warning-urilor_2p">[2] Detectarea și corectarea warning-urilor (2p)</h2>
<div class="level2">

<p>
În același director ca mai sus, <code>/home/student/uso/lab03/simple-gcc</code>, găsim fișierul <code>warnings.c</code>. Compilați-l folosind următoarea comandă:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> warnings.c <span class="re5">-o</span> warnings
<span class="co4">student@midgard$ </span>.<span class="sy0">/</span>warnings
a + b = <span class="nu0">5</span></pre>

<p>
Observăm că fișierul a fost compilat și rulat cu succes. Repetați comanda de mai sus, dar folosiți de această dată flagul <code>-Wall</code> pentru comanda <code>gcc</code>, ca mai jos:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> warnings.c <span class="re5">-o</span> warnings
warnings.c: In <span class="kw1">function</span> ‘main’:
warnings.c:<span class="nu0">8</span>: warning: unused variable ‘c’</pre>

<p>
Vedem totuși că de data aceasta a fost identificată o problemă cu fișierul <code>warnings.c</code> și anume că variabila <code>c</code> a fost declarată, inițializată, dar nefolosită. Acest fapt nu afectează comportamentul programului nostru, dar, în general, e bine să le evităm pe cât posibil. 
</p>

<p>
Inspectați fișierul sursă <code>warnings.c</code> și corectați warningul. Rulați din nou comanda <code>gcc -Wall warnings.c -o warnings</code> până când nu mai primiți niciun warning la compilare.
</p>

</div>

<h2 class="sectionedit14" id="compilarea_temei_folosind_makefile_3p">[3] Compilarea temei folosind Makefile (3p)</h2>
<div class="level2">

<p>
Intrați în directorul <code>/home/student/uso/lab03/tema-pc</code>. Dorim să compilăm tema la programare folosind fișierul <code>Makefile</code>. Rulați comanda <code>make</code>.
</p>

<p>
Rulați încă o dată comanda <code>make</code>. S-a mai executat vreo comandă?
</p>

<p>
Schimbați valoarea macro-ului <code>MIN_VAL</code> în fișierul <code>utils.h</code>. Rulați încă o dată comanda <code>make</code>. De ce nu se actualizează fișierul executabil? Modificați fișierul <code>Makefile</code> pentru ca obținerea fișierelor obiect (cu extensia <code>.o</code>) să țină cont și de fișierele header (cu extensia <code>.h</code>) de care acestea depind.
</p>

<p>
<p><div class="notetip">
Revedeți <a href="laborator-03.html#makefiles" title="uso-ac:laboratoare:laborator-03 ↵" class="wikilink1">secțiunea de Makefiles</a> din suportul laboratorului.

</div></p>
</p>

</div>

<h2 class="sectionedit15" id="detectarea_si_corectarea_erorilor_de_compilare_1p">[4] Detectarea și corectarea erorilor de compilare (1p)</h2>
<div class="level2">

<p>
În același director ca mai sus, <code>/home/student/uso/lab03/simple-gcc</code>, găsim fișierul <code>errors.c</code>. Compilați-l folosind următoarea comandă:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> errors.c <span class="re5">-o</span> errors
errors.c: In <span class="kw1">function</span> ‘main’:
errors.c:<span class="nu0">7</span>: error: expected ‘;’ before ‘<span class="kw3">return</span>’
<span class="co4">student@midgard$ </span><span class="kw2">ls</span> errors
ls: cannot access errors: No such <span class="kw2">file</span> or directory</pre>

<p>
Observăm că de această dată nu a mai fost obținut niciun fișier executabil, întrucât în fișierul <code>errors.c</code> au fost detectate <strong>erori de sintaxă</strong>. Cea identificată în cazul nostru este la linia 7 și anume că înaintea instrucțiunii <code>return</code> lipsește caracterul <code>;</code>. Modificați fișierul <code>errors.c</code> astfel încât acesta să fie compilat și rulat cu succes.
</p>

</div>

<h2 class="sectionedit16" id="detectarea_si_corectarea_erorilor_de_linkare_1p">[5] Detectarea și corectarea erorilor de linkare (1p)</h2>
<div class="level2">

<p>
Mergeți în directorul <code>/home/student/uso/lab03/tema-pc</code>, unde găsim 4 fișiere. Pentru acest exercițiu ignorați fișierul <code>Makefile</code>, ne interesează numai <code>tema.c</code>, <code>utils.c</code> și <code>utils.h</code>.
</p>

<p>
Inspectăm fișierul <code>tema.c</code> folosind un editor sau comanda <code>cat tema.c</code> și vedem că folosește două funcții (<code>vect_gt</code> și <code>vect_lt</code>) care nu apar definite nicăieri. Observăm totuși că este inclus fișierul <code>utils.h</code>, iar dacă ne uităm în acesta vom vedea că cele două funcții sunt declarate totuși acolo.
</p>

<p>
Încercăm să compilăm fișierul <code>tema.c</code> așa cum am învățat până acum:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> tema.c
<span class="sy0">/</span>tmp<span class="sy0">/</span>cc7oBohY.o: In <span class="kw1">function</span> <span class="sy0">`</span>main<span class="st_h">':
tema.c:(.text+0xac): undefined reference to `vect_gt'</span>
tema.c:<span class="br0">&#40;</span>.text+0xdb<span class="br0">&#41;</span>: undefined reference to <span class="sy0">`</span>vect_lt<span class="st_h">'
collect2: ld returned 1 exit status</span></pre>

<p>
Din păcate, procesul de compilare eșuează în etapa de linking, chiar dacă noi avem cele două funcții declarate în fișierul <code>utils.h</code>, iar acesta este inclus în fișierul principal <code>tema.c</code>.
</p>

<p>
Compilați fișierul <code>tema.c</code> numai până la codul obiect (până la etapa de linkare), folosind flagul <code>-c</code>. Comanda necesară pentru acest lucru este:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> <span class="re5">-c</span> tema.c</pre>

<p>
Repetați același lucru pentru fișierul <code>utils.c</code> și obțineți fișierul obiect <code>utils.o</code>. Putem obține acum fără probleme executabilul nostru, dacă <em>linkăm</em> cele două fișiere obiect. Facem asta cu comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> tema.o utils.o <span class="re5">-o</span> tema
<span class="co4">student@midgard$ </span>.<span class="sy0">/</span>tema
Values: <span class="nu0">10</span> <span class="re5">-20</span> <span class="nu0">30</span> <span class="nu0">9</span> <span class="nu0">7</span> <span class="nu0">8</span> <span class="nu0">11</span> <span class="nu0">5</span> <span class="re5">-2</span> <span class="nu0">100</span> 
Values greater than <span class="nu0">5</span>: <span class="nu0">7</span>
Values <span class="kw2">less</span> than <span class="nu0">3</span>: <span class="nu0">2</span></pre>

<p>
<p><div class="notetip">
Puteam realiza același lucru de la început folosind direct comanda:
</p>
<pre class="code bash"><span class="co4">student@midgard$ </span><span class="kw2">gcc</span> <span class="re5">-Wall</span> tema.c utils.c <span class="re5">-o</span> tema</pre>

<p>

</div></p>
</p>

<p>
Deschideți în editorul preferat fișierul <code>tema.c</code> și realizați o modificare minoră, de exemplu modificați valoarea lui <code>N</code> din 9 în 5. Compilați din nou fișierul <code>tema.c</code> pentru a obține fișierul obiect <code>tema.o</code>. La fel ca mai sus, <em>linkați</em> fișierele obiect <code>tema.o</code> și <code>utils.o</code> pentru a obține executabilul <code>tema</code>, după care rulați-l. Observăm că nu a mai fost nevoie de recompilarea fișierului <code>utils.c</code>, am folosit fișierul obiect obținut anterior.
</p>

<p>
<p><div class="notetip">Un mare avantaj al opririi procesului de compilare înainte de <strong>etapa de linkare</strong> este faptul că putem <em>refolosi</em> fișiele obiect. Dacă avem un proiect mare cu numeroase fișiere sursă și realizăm o modificare într-un singur fișier sursă, nu este nevoie sa compilăm de fiecare dată toate fișierele, ci numai cel modificat, fiind astfel suficient doar să le relinkăm la final. Cum putem exploata acest lucru vom observa în exercițiile următoare.

</div></p>
</p>

</div>

<h2 class="sectionedit17" id="bonus_1_makefile_pentru_un_proiect_1_karma_wouso">[Bonus #1] Makefile pentru un proiect (1 Karma WoUSO)</h2>
<div class="level2">

<p>
În directorul <code>/home/student/uso/lab03/large-project</code> găsiți o structură de fișiere și directoare care simulează un proiect software mai mare (mai multe fișiere sursă, împărțit pe funcționalități etc). Structura proiectului nostru este următoarea:
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">tree</span>
.
├── Makefile
├── main.c
├── <span class="kw2">sum</span>
│   ├── add
│   │   ├── add.c
│   │   └── add.h
│   ├── sum.c
│   └── sum.h
└── utils
    ├── utils.c
    └── utils.h
&nbsp;
<span class="nu0">3</span> directories, <span class="nu0">8</span> files</pre>

<p>
Practic, modulul <strong>main</strong> depinde de modulele <strong>sum</strong> și <strong>utils</strong>, iar modulul <strong>sum</strong> depinde și el la rândul lui de modulul <strong>add</strong>.
</p>

<p>
Completați fișierul <code>Makefile</code> din rădăcina proiectului astfel încât la rularea comenzii <code>make all</code> toate fișierele sursă <code>.c</code> vor fi compilate și va fi obținut executabilul <code>main</code>. Înlocuiți liniile care conțin <code>#TODO</code> cu comenzile necesare pentru compilare.
</p>

<p>
<p><div class="noteclassic">
Urmăriți ca model și fișierul <code>Makefile</code> de la <a href="laborator-03.html#compilarea_temei_folosind_makefile_2p" title="uso-ac:laboratoare:laborator-03 ↵" class="wikilink1">exercițiul 5</a>.

</div></p>
</p>

</div>

<h2 class="sectionedit18" id="bonus_2_scrierea_unui_makefile_1_karma_wouso">[Bonus #2] Scrierea unui Makefile (1 Karma WoUSO)</h2>
<div class="level2">

<p>
În directorul <code>/home/student/uso/lab03/project</code> se află două fișiere sursă, <code>project.c</code> și <code>functions.c</code>. Fișierul project.c conține funcția <code>main</code> ce apelează o funcție denumită <code>f</code> și definită în fișierul <code>functions.c</code>. Observăm că la rularea unei comenzi simple de compilare se obține un warning:
</p>
<pre class="code bash">student<span class="sy0">@</span>uso:~<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>project$ <span class="kw2">gcc</span> <span class="re5">-Wall</span> functions.c project.c 
project.c: In <span class="kw1">function</span> ‘main’:
project.c:<span class="nu0">6</span>:<span class="nu0">5</span>: warning: implicit declaration of <span class="kw1">function</span> ‘f’ <span class="br0">&#91;</span>-Wimplicit-function-declaration<span class="br0">&#93;</span>
     f<span class="br0">&#40;</span><span class="br0">&#41;</span>;
     ^</pre>

<p>
Acest lucru se datorează faptului că funcția <code>f</code> este chemată fără a fi declarată. Pentru a evita această problemă trebuie să-i <em>promitem</em> compilatorului că funcția <code>f</code> va exista la un moment ulterior definită (cu același nume, același tip de retur, același număr de parametri).
</p>

<p>
Creați un fișier header <code>functions.h</code> în care să <strong>declarați</strong> funcția <code>f</code> după care includeți fișierul <code>functions.h</code> în <code>project.c</code>. Observați că warningul de mai sus a dispărut.
</p>
<pre class="code bash">student<span class="sy0">@</span>uso:~<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>project$ <span class="kw2">gcc</span> <span class="re5">-Wall</span> functions.c project.c
student<span class="sy0">@</span>uso:~<span class="sy0">/</span>uso<span class="sy0">/</span>lab03<span class="sy0">/</span>project$</pre>

<p>
În continuare, creați un fișier <code>Makefile</code> folosind editorul <code>vim</code>, în același folder, care să conțină, cel puțin, câte o regulă de compilare până la fișiere obiect pentru fiecare fișier <code>.c</code>, o regulă pentru obținerea executabilului (executată când rulăm comanda <code>make</code>) și o regulă <code>clean</code> care șterge fișierele obiect și executabilul obținut în urma comenzii <code>make</code>. De asemenea, scrieți <code>Makefileul</code> astfel încât la rularea mai multor comenzi <code>make</code> consecutive, proiectul să nu fie recompilat de fiecare dată.
</p>

</div>

<h2 class="sectionedit19" id="bonus_3_variabile_in_makefile_2_karma_wouso">[BONUS #3] Variabile în Makefile (2 Karma WoUSO)</h2>
<div class="level2">

<p>
Un fișier <code>Makefile</code> permite folosirea de variabile. Astfel, un exemplu uzual de fișier <code>Makefile</code> este:
</p>
<dl class="code">
<dt><a href="../../_export/code/uso-ac/laboratoare/laborator-03%3Fcodeblock=59" title="Download Snippet" class="mediafile mf_">Makefile</a></dt>
<dd><pre class="code make">CC <span class="sy0">=</span> gcc
CFLAGS <span class="sy0">=</span> <span class="sy0">-</span>Wall <span class="sy0">-</span>g
&nbsp;
all<span class="sy0">:</span> hello
&nbsp;
hello<span class="sy0">:</span> hello<span class="sy0">.</span>o
        <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CC</span><span class="br0">&#41;</span> hello<span class="sy0">.</span>o <span class="sy0">-</span>o hello
&nbsp;
hello<span class="sy0">.</span>o<span class="sy0">:</span> hello<span class="sy0">.</span>c
        <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CC</span><span class="br0">&#41;</span> <span class="sy0">$</span><span class="br0">&#40;</span><span class="re2">CFLAGS</span><span class="br0">&#41;</span> <span class="sy0">-</span>c hello<span class="sy0">.</span>c
&nbsp;
clean<span class="sy0">:</span>
        rm <span class="sy0">*.</span>o hello</pre>
</dd></dl>

<p>
În exemplul de mai sus au fost definite variabilele <code>CC</code> și <code>CFLAGS</code>. Variabila <code>CC</code> reprezintă compilatorul folosit, iar variabila <code>CFLAGS</code> reprezintă opțiunile (flag-urile) de compilare utilizate; în cazul de față sunt afișarea avertismentelor și compilarea cu suport de depanare. Referirea unei variabile se realizează prin intermediul construcției $(VAR_NAME). Astfel, <code>$(CC)</code> se înlocuiește cu <code>gcc</code>, iar <code>$(CFLAGS)</code> se înlocuiește cu <code>-Wall -g</code>.
</p>

<p>
Observăm că șirurile <code>hello</code>, <code>gcc</code>, precum și flagurile date la compilare apar în foarte multe locuri. Modificați fișierul <code>Makefile</code> astfel încât să avem de schimbat o singură linie în cazul în care dorim să schimbăm numele executabilului, compilatorului sau să mai adăugăm un alt flag.
</p>

<p>
Modificați fișierul <code>Makefile</code> din directorul <code>/home/student/uso/lab03/tema-pc</code> astfel încât să folosiți în cadrul fiecărei reguli variabilele predefite:
</p>
<ul>
<li class="level1"><div class="li"> <strong> $@ </strong> se expandează la numele target-ului. </div>
</li>
<li class="level1"><div class="li"> <strong> $^ </strong> se expandează la lista de cerințe.</div>
</li>
<li class="level1"><div class="li"> <strong> $&lt; </strong> se expandează la prima cerință. </div>
</li>
</ul>

<p>
<p><div class="notetip">
Motivul utilizării acestora nu este pentru a reduce dimensiunea Makefile sau pentru a îl <em>obfusca</em>, ci pentru a evita cât mai mult posibil repetițiile, minimizând în acest fel și potențialele erori ce pot apărea în viitor. Spre exemplu, dacă în cadrul unei reguli se adaugă ca dependență un fișier sursă <code>.c</code> nou, nu mai este nevoie să fie trecut și pe linia următoare corespunzătoare comenzii de compilare. El va fi automat expandat din variabila $^.

</div></p>
</p>

</div>

<h2 class="sectionedit20" id="bonus_4_investigarea_bibliotecilor_externe_folosite_1_karma_wouso">[BONUS #4] Investigarea bibliotecilor externe folosite (1 Karma WoUSO)</h2>
<div class="level2">

<p>
În directorul <code>/home/student/uso/lab03/static-lib</code> aveți fișierele <code>simple_math.c</code> și <code>Makefile</code>. Rulăm comanda <code>make</code> și observăm că primim o eroare <strong>de linking</strong> (în etapa de link-editare)
</p>
<pre class="code bash"><span class="co4">student@midgard$</span>: <span class="kw2">make</span>
<span class="kw2">gcc</span> <span class="re5">-Wall</span> simple_math.o <span class="re5">-o</span> simple_math 
simple_math.o: In <span class="kw1">function</span> <span class="sy0">`</span>main<span class="st_h">':
simple_math.c:(.text+0x1e): undefined reference to `sqrtq'</span>
simple_math.c:<span class="br0">&#40;</span>.text+0x3c<span class="br0">&#41;</span>: undefined reference to <span class="sy0">`</span>quadmath_snprintf<span class="st_h">'
collect2: error: ld returned 1 exit status
make: *** [simple_math] Error 1</span></pre>

<p>
Eroarea provine de la faptul că două simboluri, și anume <code>sqrtq</code> și <code>quadmath_snprintf</code> au fost utilizate, declarate, dar nu au fost și definite. Pentru a rezolva problema avem nevoie să legăm biblioteca statică <code>libquadmath</code> la codul nostru.
</p>

<p>
Modificați linia din <code>Makefile</code> care obține fișierul executabil <code>simple_math</code> astfel încât să legați biblioteca statică <code>libquadmath</code>.
</p>

<p>
<p><div class="notetip">
Revedeți <a href="../../uso/laboratoare/laborator-03.html#biblioteci" class="urlextern" title="http://ocw.cs.pub.ro/courses/uso/laboratoare/laborator-03#biblioteci"  rel="nofollow">secțiunea de biblioteci</a> din cadrul demo-ului. Mai multe informații despre biblioteca <code>quadmath</code> puteți afla de <a href="https://gcc.gnu.org/onlinedocs/libquadmath/" class="urlextern" title="https://gcc.gnu.org/onlinedocs/libquadmath/"  rel="nofollow">aici</a>.

</div></p>
</p>

</div>

<h2 class="sectionedit21" id="bonus_5_instalarea_si_compilarea_din_surse_2_karma_wouso">[Bonus #5] Instalarea și compilarea din surse (2 Karma WoUSO)</h2>
<div class="level2">

<p>
Vrem să compilăm și să instalăm un program din cod sursă (adică nu dintr-un pachet).
</p>

<p>
Descărcați Python 2.7.8 de <a href="http://python.org/download/releases/2.7.8/" class="urlextern" title="http://python.org/download/releases/2.7.8/"  rel="nofollow">aici</a>. Alegeți formatul corespunzător sistemului pe care lucrați.
</p>

<p>
Următorii pași se aplică, în general, la compilarea din surse:
</p>
<pre class="code bash">student<span class="sy0">@</span>midgard ~ $ .<span class="sy0">/</span>configure 
student<span class="sy0">@</span>midgard ~ $ <span class="kw2">make</span>
student<span class="sy0">@</span>midgard ~ $ <span class="kw2">make</span> <span class="kw2">install</span></pre>

<p>
Etapa de configurare dispune de un parametru special
</p>
<pre class="code bash">.<span class="sy0">/</span>configure <span class="re5">--prefix</span>=<span class="sy0">/</span>path<span class="sy0">/</span>to<span class="sy0">/</span>my<span class="sy0">/</span>custom<span class="sy0">/</span>folder</pre>

<p>
 în care putem specifica directorul de instalare. Folosiți această opţiune deoarece dorim să nu afectăm versiunea de Python a sistemului. Folosiți o cale absolută către un director din <code>/home/student</code>. 
</p>

<p>
<p><div class="notewarning">
Dacă doriți instalare ca utilizator neprivilegiat (fără a prefixa comanda cu <code>sudo</code>, vom învăța amănunte într-unul din laboratoarele viitoare), trebuie să folosiți opțiunea <code>--prefix</code> a comenzii <code>./configure</code> și să transmiteți un director la care utilizatorul are acces. În absența acestei opțiuni instalarea se face, în general, în directoare precum <code>/usr/bin/</code> și <code>/usr/lib/</code>, unde doar utilizatorul privilegiat (<code>root</code>) are acces.

</div></p>
</p>

</div>

<h2 class="sectionedit22" id="bonus_6_good_code_practices_1-5_karma_wouso">[Bonus #6] Good code practices (1-5 Karma WoUSO)</h2>
<div class="level2">

<p>
E bine ca atunci când scriem cod să fie cât mai organizat, aerisit, cât mai ușor de înțeles de către altcineva. În directorul <code>/home/student/uso/lab03/ugly</code> găsiți fișierul <code>ugly.c</code> care este scris intenționat într-un mod foarte confuz și alambicat. Citiți articolul de la acest <a href="http://programmer.97things.oreilly.com/wiki/index.php/Write_Code_for_Humans_not_Machines" class="urlextern" title="http://programmer.97things.oreilly.com/wiki/index.php/Write_Code_for_Humans_not_Machines"  rel="nofollow">link</a> după care modificați fișierul <code>ugly.c</code> conform principiilor prezentate, păstrând însă exact aceeași funcționalitate.
</p>

</div>

        </div>
        <div class="right_sidebar">
          <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">
<ul>
<li class="level1"><div class="li"> <a href="../anunturi.html" class="wikilink1" title="uso-ac:anunturi">Anunțuri</a></div>
</li>
<li class="level1"><div class="li"> <a href="../need-to-know.html" class="wikilink1" title="uso-ac:need-to-know">USO Need to Know</a></div>
</li>
<li class="level1"><div class="li"> <a href="../calendar.html" class="wikilink1" title="uso-ac:calendar">Calendar</a></div>
</li>
<li class="level1"><div class="li"> <a href="../regulament.html" class="wikilink1" title="uso-ac:regulament">Reguli generale și notare</a></div>
<ul>
<li class="level2"><div class="li"> <a href="../punctaj.html" class="wikilink1" title="uso-ac:punctaj">Notare</a></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <a href="../orar.html" class="wikilink1" title="uso-ac:orar">Orar</a></div>
</li>
<li class="level1"><div class="li"> <a href="../catalog.html" class="wikilink1" title="uso-ac:catalog">Catalog</a></div>
</li>
<li class="level1"><div class="li"> <a href="../echipa.1.html" class="wikilink1" title="uso-ac:echipa">Echipă</a></div>
</li>
</ul>

<h2 class="sectionedit1" id="resurse">Resurse</h2>
<div class="level2">

</div>
<!-- EDIT2 PLUGIN_INCLUDE_START "uso-ac:resurse" [0-] --><div class="plugin_include_content plugin_include__uso-ac:resurse">
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="../resurse/email.html" class="wikilink1" title="uso-ac:resurse:email">Configurare mail @stud.acs.upb.ro</a></div>
</li>
<li class="level1"><div class="li"> <a href="../resurse/folosire-vim.html" class="wikilink1" title="uso-ac:resurse:folosire-vim">Folosire vim</a></div>
</li>
<li class="level1"><div class="li"> <a href="../resurse/cheatsheet.html" class="wikilink1" title="uso-ac:resurse:cheatsheet">Cheatsheet</a></div>
</li>
<li class="level1"><div class="li"> <a href="../resurse/bashcheatsheet.html" class="wikilink1" title="uso-ac:resurse:bashcheatsheet">Linux Bash Shell Cheatsheet</a></div>
</li>
<li class="level1"><div class="li"> <a href="../resurse/mv.html" class="wikilink1" title="uso-ac:resurse:mv">Mașină virtuală</a></div>
</li>
</ul>
<!-- EDIT4 PLUGIN_INCLUDE_EDITBTN "uso-ac:resurse" [0-] -->
</div>
<!-- EDIT3 PLUGIN_INCLUDE_END "uso-ac:resurse" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT1 SECTION "Resurse" [256-322] -->
<h2 class="sectionedit5" id="cursuri">Cursuri</h2>
<div class="level2">

</div>
<!-- EDIT6 PLUGIN_INCLUDE_START "uso-ac:cursuri" [0-] --><div class="plugin_include_content plugin_include__uso-ac:cursuri">
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="../cursuri/curs-00.html" class="wikilink1" title="uso-ac:cursuri:curs-00">00. Bine ați venit!</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-01.html" class="wikilink1" title="uso-ac:cursuri:curs-01">01. Introducere în sisteme de operare</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-02.html" class="wikilink1" title="uso-ac:cursuri:curs-02">02. Utilizarea sistemului de fișiere</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-03.html" class="wikilink1" title="uso-ac:cursuri:curs-03">03. Dezvoltarea programelor</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-04.html" class="wikilink1" title="uso-ac:cursuri:curs-04">04. Procese și utilizatori</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-05.html" class="wikilink1" title="uso-ac:cursuri:curs-05">05. Administrarea sistemului de fișiere</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-06.html" class="wikilink1" title="uso-ac:cursuri:curs-06">06. Interfața în linia de comandă</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-07.html" class="wikilink1" title="uso-ac:cursuri:curs-07">07. Servicii de rețea</a></div>
</li>
<li class="level1"><div class="li"> <a href="../cursuri/curs-08.html" class="wikilink1" title="uso-ac:cursuri:curs-08">08. Configurări de rețea</a></div>
</li>
</ul>

</div>
<!-- EDIT8 PLUGIN_INCLUDE_EDITBTN "uso-ac:cursuri" [0-] --><!-- EDIT7 PLUGIN_INCLUDE_END "uso-ac:cursuri" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT5 SECTION "Cursuri" [323-389] -->
<h2 class="sectionedit9" id="laboratoare">Laboratoare</h2>
<div class="level2">

</div>
<!-- EDIT10 PLUGIN_INCLUDE_START "uso-ac:laboratoare" [0-] --><div class="plugin_include_content plugin_include__uso-ac:laboratoare">
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="laborator-01.html" class="wikilink1" title="uso-ac:laboratoare:laborator-01">01. Introducere</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-02.html" class="wikilink1" title="uso-ac:laboratoare:laborator-02">02. Utilizarea sistemului de fișiere</a></div>
</li>
<li class="level1"><div class="li"> <span class="curid"><a href="laborator-03.html" class="wikilink1" title="uso-ac:laboratoare:laborator-03">03. Dezvoltarea programelor C sub Linux</a></span></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-04.html" class="wikilink1" title="uso-ac:laboratoare:laborator-04">04. Utilizatori și procese</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-05.html" class="wikilink1" title="uso-ac:laboratoare:laborator-05">05. Gestiunea sistemului de fișiere</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-06.html" class="wikilink1" title="uso-ac:laboratoare:laborator-06">06. Interfața în linia de comandă</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator-07.html" class="wikilink1" title="uso-ac:laboratoare:laborator-07">07. Servicii de rețea</a></div>
</li>
</ul>

</div>
<!-- EDIT12 PLUGIN_INCLUDE_EDITBTN "uso-ac:laboratoare" [0-] --><!-- EDIT11 PLUGIN_INCLUDE_END "uso-ac:laboratoare" [0-] --></div>
<div class="level2">

</div>
<!-- EDIT9 SECTION "Laboratoare" [390-464] -->
<h2 class="sectionedit13" id="teme">Teme</h2>
<div class="level2">
<ul>
<li class="level1"><div class="li"> <a href="../teme.html" class="wikilink1" title="uso-ac:teme">Teme</a></div>
</li>
<li class="level1"><div class="li"> <a href="../instructiuni-checker.html" class="wikilink1" title="uso-ac:instructiuni-checker">Instrucțiuni de folosire a checkerului</a></div>
</li>
<li class="level1"><div class="li"> <a href="../teme/tema-0.html" class="wikilink1" title="uso-ac:teme:tema-0">Tema 0</a></div>
</li>
<li class="level1"><div class="li"> <a href="../teme/tema-1.html" class="wikilink1" title="uso-ac:teme:tema-1">Tema 1</a></div>
</li>
<li class="level1"><div class="li"> <a href="../teme/tema-2.html" class="wikilink1" title="uso-ac:teme:tema-2">Tema 2</a></div>
</li>
</ul>

</div>
<!-- EDIT13 SECTION "Teme" [465-] -->
</div>
<div class="toc_sidebar sidebar_box">
<!-- TOC START -->
<div id="sb__right__dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator-03.html#laborator_03_-_dezvoltarea_programelor_in_c_sub_mediul_linux">Laborator 03 - Dezvoltarea programelor în C sub mediul Linux</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-03.html#obiective_laborator">Obiective laborator</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#suport_laborator">Suport laborator</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-03.html#pachete_necesare">Pachete necesare</a></div></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-03.html#demo">Demo</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator-03.html#compilarea_unui_singur_fisier_sursa">Compilarea unui singur fișier sursă</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#alte_exemple_de_comenzi_folosind_compilatorul_gcc">Alte exemple de comenzi folosind compilatorul gcc</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#compilarea_si_link-editarea_programelor">Compilarea și link-editarea programelor</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#makefiles">Makefiles</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator-03.html#exemplu_simplu_de_makefile">Exemplu simplu de Makefile</a></div></li>
<li class="level4"><div class="li"><a href="laborator-03.html#alt_exemplu_de_makefile">Alt exemplu de Makefile</a></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="level1"><div class="li"><a href="laborator-03.html#exercitii">Exerciții</a></div>
<ul class="toc">
<li class="clear">
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator-03.html#pregatire_setup_laborator_1p">0.0. Pregătire setup laborator (1p)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator-03.html#compilarea_unui_fisier_sursa_c_2p">[1] Compilarea unui fișier sursă C (2p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#detectarea_si_corectarea_warning-urilor_2p">[2] Detectarea și corectarea warning-urilor (2p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#compilarea_temei_folosind_makefile_3p">[3] Compilarea temei folosind Makefile (3p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#detectarea_si_corectarea_erorilor_de_compilare_1p">[4] Detectarea și corectarea erorilor de compilare (1p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#detectarea_si_corectarea_erorilor_de_linkare_1p">[5] Detectarea și corectarea erorilor de linkare (1p)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_1_makefile_pentru_un_proiect_1_karma_wouso">[Bonus #1] Makefile pentru un proiect (1 Karma WoUSO)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_2_scrierea_unui_makefile_1_karma_wouso">[Bonus #2] Scrierea unui Makefile (1 Karma WoUSO)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_3_variabile_in_makefile_2_karma_wouso">[BONUS #3] Variabile în Makefile (2 Karma WoUSO)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_4_investigarea_bibliotecilor_externe_folosite_1_karma_wouso">[BONUS #4] Investigarea bibliotecilor externe folosite (1 Karma WoUSO)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_5_instalarea_si_compilarea_din_surse_2_karma_wouso">[Bonus #5] Instalarea și compilarea din surse (2 Karma WoUSO)</a></div></li>
<li class="level2"><div class="li"><a href="laborator-03.html#bonus_6_good_code_practices_1-5_karma_wouso">[Bonus #6] Good code practices (1-5 Karma WoUSO)</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          uso-ac/laboratoare/laborator-03.txt · Last modified: 2016/10/25 23:22 by giorgiana.vlasceanu          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
              </div>
      <div class="bar-right">
        <a href="laborator-03%3Fdo=media&amp;ns=uso-ac%253Alaboratoare.html"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="laborator-03.html#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div align="center" class="footerinc">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported" /></a></div>
  <a target="_blank" href="http://www.chimeric.de" title="www.chimeric.de"><img src="../../lib/tpl/arctic/images/button-chimeric-de.png" width="80" height="15" alt="www.chimeric.de" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="../../lib/tpl/arctic/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="../../lib/tpl/arctic/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>

  <a target="_blank" href="http://www.firefox-browser.de" title="do yourself a favour and use a real browser - get firefox"><img src="../../lib/tpl/arctic/images/button-firefox.png" width="80" height="15" alt="do yourself a favour and use a real browser - get firefox!!" border="0" /></a>
  
  <a target="_blank" href="../../feed.php" title="Recent changes RSS feed"><img src="../../lib/tpl/arctic/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="../../lib/tpl/arctic/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>
</div>

  </div>
</div>

<div class="no"><img src="../../lib/exe/indexer.php%3Fid=uso-ac%253Alaboratoare%253Alaborator-03&amp;1479891531" width="2" height="1" alt="" /></div>
</body>
</html>
