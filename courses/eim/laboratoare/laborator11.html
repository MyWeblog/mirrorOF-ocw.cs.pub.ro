    
    

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
 lang="en" dir="ltr">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    Laborator 11. Transmiterea de Notificări folosind Serviciul Google Cloud Messaging    [CS Open CourseWare]
  </title>

  <meta name="generator" content="DokuWiki"/>
<meta name="robots" content="index,follow"/>
<meta name="date" content="2016-04-18T14:41:49+0300"/>
<meta name="keywords" content="eim,laboratoare,laborator11"/>
<link rel="search" type="application/opensearchdescription+xml" href="../../lib/exe/opensearch.php" title="CS Open CourseWare"/>
<link rel="start" href="../../../courses.1.html"/>
<link rel="alternate" type="application/rss+xml" title="Recent Changes" href="../../feed.php"/>
<link rel="alternate" type="application/rss+xml" title="Current Namespace" href="../../feed.php%3Fmode=list&amp;ns=eim:laboratoare"/>
<link rel="alternate" type="text/html" title="Plain HTML" href="../../_export/xhtml/eim/laboratoare/laborator11.html"/>
<link rel="canonical" href="laborator11.html"/>
<link rel="stylesheet" type="text/css" href="../../lib/exe/css.php%3Ft=arctic&amp;tseed=1479898000.css"/>
<script type="text/javascript">/*<![CDATA[*/var NS='eim:laboratoare';var JSINFO = {"id":"eim:laboratoare:laborator11","namespace":"eim:laboratoare","isadmin":0,"isauth":0};
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="../../lib/exe/js.php%3Ftseed=1479898000"></script>
<script type="text/x-mathjax-config">/*<![CDATA[*/MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ["$","$"], ["\\(","\\)"] ],
        displayMath: [ ["$$","$$"], ["\\[","\\]"] ],
        processEscapes: true
    }
});
/*!]]>*/</script>
<script type="text/javascript" charset="utf-8" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
<script type="text/javascript">/*<![CDATA[*/
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
		  
/*!]]>*/</script>
<script type="text/javascript">/*<![CDATA[*/
var pageTracker = _gat._getTracker("UA-38383934-1");
pageTracker._initData();
pageTracker._trackPageview();
		  
/*!]]>*/</script>

  <link rel="shortcut icon" href="../../lib/tpl/arctic/images/favicon.ico" />

  
</head>
<body>
<div id="wrapper" class='show'>
  <div class="dokuwiki">

    
    <div class="stylehead">
      <div class="header">
        <div class="pagename">
          <a href="../index.html"><img height="70" src="../../res/sigla_cs.png"/> </a>        </div>
        <div class="logo">
          <a style="color: #AAA !important;" href="../../../courses.1.html"/>Open CourseWare</a>        </div>
      </div>
    
       
      <div class="breadcrumbs">
              </div>
      
            </div>

                  <div class="bar" id="bar__top">
        <div class="bar-left">
                  </div>
        <div class="bar-right">
          <a href="laborator11%3Fdo=recent.html"  class="action recent" accesskey="r" rel="nofollow" title="Recent changes [R]">Recent changes</a><a href="laborator11%3Fdo=login&amp;sectok=f62420cf5b01253da4b50505d148181b.html"  class="action login" rel="nofollow" title="Login">Login</a>        </div>
    </div>
        
    
    
    
              <div class="left_page">
          
<h1 class="sectionedit1" id="laborator_11_transmiterea_de_notificari_folosind_serviciul_google_cloud_messaging">Laborator 11. Transmiterea de Notificări folosind Serviciul Google Cloud Messaging</h1>
<div class="level1">

<p>
<strong>Google Cloud Messaging for Android (GCM)</strong> este un serviciu gratuit prin intermediul căruia programatorii pot transmite informații între un server de aplicații și un dispozitiv mobil (pe care rulează sistemul de operare Android), implementând toate aspectele legate de gestiunea mesajelor, asigurând livrarea acestora. Nu există nici un fel de limite în privința resurselor implicate pentru transmiterea acestor informații.
</p>

<p>
Necesitatea unui astfel de serviciu este impusă de optimizările specifice aplicațiilor pentru dispozitive mobile:
</p>
<ul>
<li class="level1"><div class="li"> pentru serverul de aplicații: detecția disponibilității dispozitivului mobil și a momentului în care se poate realiza transmisia de date (în funcție de tipul de conexiune), gestiunea mesajelor (implementarea unor cozi de așteptare), implementarea mesajelor cu mai mulți destinatari (reutilizarea unei conexiuni), transmiterea mai multor mesaje către un singur dispozitiv mobil, aspecte legate de compresie și detecția erorilor;</div>
</li>
<li class="level1"><div class="li"> pentru dispozitivul mobil: limitări în privința consumului de energie și al transferului de date (în cazul unor anumite tipuri de conexiuni costurile sau viteza implicate fiind semnificative).</div>
</li>
</ul>

<p>
Serviciile precum Google Cloud Messaging for Android implementează cele mai bune practici în domeniu pentru tratarea acestor aspecte, astfel încât programatorul se poate concentra exclusiv asupra funcționalității aplicației.
</p>

<p>
Comunicația dintre cele două entități se poate realiza în ambele sensuri:
</p>
<ul>
<li class="level1"><div class="li"> server de aplicații → dispozitiv mobil prin intermediul Google Cloud Messaging, nefiind necesar ca aplicația Android să ruleze la momentul în care este transmis mesajul, ea fiind pornită prin intermediul unei intenții (cu condiția ca aplicația să poată primi mesajele cu difuzare și să aibă permisiunile necesare specificate);</div>
</li>
<li class="level1"><div class="li"> dispozitiv mobil → server de aplicații prin intermediul Cloud Connection Server.</div>
</li>
</ul>

<p>
Google Cloud Messaging for Android nu pune la dispoziție un <abbr title="Application Programming Interface">API</abbr> pentru procesarea mesajelor, acestea fiind trimise exact în forma în care au fost primite.
</p>

<p>
Un mesaj transmis prin intermediul Google Cloud Messaging poate:
</p>
<ul>
<li class="level1"><div class="li"> indica aplicației Android faptul că trebuie să se sincronizeze cu serverul de aplicații (util mai ales pentru aplicațiile de poștă electronică);</div>
</li>
<li class="level1"><div class="li"> conține informații utile (de până la 4kb), care sunt interpretate de aplicația Android (folosite în special pentru aplicațiile de mesagerie instantanee).</div>
</li>
</ul>

<p>
Pentru dispozitivele mobile cu o versiune a sistemului de operare Android mai mică decât 3.0 este necesară crearea unui cont de utilizator Google. Această cerință nu este obligatorie pentru versiuni mai mari decât 4.0.4.
</p>

<p>
<p><div class="notewarning">Google Cloud Messaging for Android nu poate fi utilizat pe platforme care au instalată o versiune a sistemului de operare Android anterioară 2.2.
</div></p>
</p>

</div>

<h2 class="sectionedit2" id="arhitectura_google_cloud_messaging_for_android">Arhitectura Google Cloud Messaging for Android</h2>
<div class="level2">

<p>
Un sistem informatic folosind infrastructura de comunicații Google Cloud Messaging for Android implică dezvoltarea următoarelor componente:
</p>
<ul>
<li class="level1"><div class="li"> <strong>un server de aplicații</strong> responsabil cu transmiterea de informații către dispozitivul mobil prin intermediul serviciului Google Cloud Messaging for Android; de asemenea, serverul va putea procesa anumite mesaje transmise de către client (de exemplu, identificatorul prin care dispozitivul mobil este înregistrat în mod unic în cadrul serverului Google Cloud Messaging);</div>
</li>
<li class="level1"><div class="li"> <strong>o aplicație Android</strong> rulând pe un dispozitiv mobil cu un sistem de operare Android având o versiune mai mare de 2.2, pe care este instalat Google Play Services.</div>
</li>
</ul>

<p>
<img src="../../_media/eim/laboratoare/laborator08/arhitectura_google_cloud_messaging.png%3Fw=700&amp;tok=da3af3" class="mediacenter" alt="" width="700" />
</p>

<p>
De regulă, procesul de proiectare și dezvoltare a sistemului informatic implică următorul flux de lucru:
</p>

<p>
<strong>1.</strong> se obține un număr de proiect prin intermediul Google Developers Console, prin care un dezvoltator este identificat în mod unic; de asemenea, se activează serviciul Google Cloud Messaging;<br/>

<strong>2.</strong> se implementează aplicația Android care va rula pe client:
</p>
<ul>
<li class="level1"><div class="li"> se realizează înregistrarea dispozitivului mobil (printr-un apel al metodei <code>register</code> a clasei <code>GoogleCloudMessaging</code>, care primește ca parametru numărul de proiect) în cadrul serverului Google Cloud Messaging (<strong>etapa 1</strong>), generându-se un identificator care va fi utilizat pentru a desemna mesajele care trebuie transmise către acesta (<strong>etapa 2</strong>); valoarea sa este generată astfel încât să identifice în mod unic:</div>
<ul>
<li class="level2"><div class="li"> numărul de proiect al dezvoltatorului de la al cărui server de aplicații vor fi transmise mesajele;</div>
</li>
<li class="level2"><div class="li"> dispozitivul mobil către care se transmite mesajul (prin intermediul contului Google asociat acestuia);</div>
</li>
<li class="level2"><div class="li"> aplicația care va procesa mesajul respectiv (pe baza informațiilor din <code>AndroidManifest.xml</code> - denumirea pachetului care identifică în mod unic o aplicație de pe un dispozitiv mobil și versiunea).</div>
</li>
</ul>
</li>
</ul>

<p>
<p><div class="noteimportant">Generarea unui identificator de înregistrare se realizează o singură dată, urmând ca această valoare să fie stocată pentru a fi utilizată ulteror. În situația în care nu se mai dorește ca mesajele să fie primite, se poate realiza și procesul invers, de anulare a înregistrării realizate anterior.
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> se transmite identificatorul de înregistrare către serverul de aplicații (<strong>etapa 3</strong>) astfel încât acesta să îl poată utiliza pentru a indica Google Cloud Messaging locația către care va livra mesajele;</div>
</li>
<li class="level1"><div class="li"> se tratează mecanismul de primire a unui mesaj (<strong>etapa 6</strong>); acesta va fi livrat aplicației corespunzătoare prin intermediul unei intenții de difuzare (de tip <code>com.google.android.c2dm.intent.RECEIVE</code>), după ce perechile (atribut, valoare) au fost extrase din conținutul mesajului și atașate acesteia; nu este necesar ca aplicația Android să ruleze la momentul primirii mesajului, aceasta fiind lansată în execuție în mod automat, dacă nu se găsește în această stare.</div>
</li>
</ul>

<p>
<p><div class="noteimportant">În situația în care prelucrarea unui mesaj implică un volum de procesare semnificativ, se recomandă ca acesta să fie realizat prin intermediul unui serviciu, după ce s-a obținut un mutex (de tip <code>PowerManager.WakeLock</code>) care să prevină trecerea dispozitivului mobil într-o stare latentă.
</div></p>
</p>

<p>
<strong>3.</strong> se obține o cheie publică pentru serverul de aplicații ce va fi utilizată în procesul de autentificare pentru a obține drepturi de accesare a serverului Google Cloud Messaging prin intermediul căruia vor fi transmise mesajele;<br/>

<strong>4.</strong> se implementează serverul de aplicații:
</p>
<ul>
<li class="level1"><div class="li"> se vor procesa cererile venite din partea clientului de transmitere a identificatorului de înregistrare prin stocarea lor într-o bază de date locală (<strong>etapa 4</strong>);</div>
</li>
<li class="level1"><div class="li"> se va transmite un mesaj către serverul Google Cloud Messaging (<strong>etapa 5</strong>) care va include:</div>
<ul>
<li class="level2"><div class="li"> cheia publică a serverului de aplicații, utilizată în procesul de autentificare, inclusă în antetul mesajului;</div>
</li>
<li class="level2"><div class="li"> identificatorul de înregistrare a dispozitivului mobil, astfel încât serverul Google Cloud Messaging să cunoască locația către care se transmite mesajul.</div>
</li>
<li class="level2"><div class="li"> datele propriu-zise (dacă este cazul).</div>
</li>
</ul>
</li>
</ul>

<p>
<p><div class="noteclassic">Un mesaj transmis de pe serverul de aplicații va fi stocat într-o coadă de așteptare pe serverul Google Cloud Messaging și livrat în momentul în care dispozitivul mobil este disponibil.
</div></p>
</p>

</div>

<h2 class="sectionedit3" id="configurare">Configurare</h2>
<div class="level2">

<p>
<strong>1.</strong> Prin intermediul <a href="https://code.google.com/apis/console/" class="urlextern" title="https://code.google.com/apis/console/"  rel="nofollow">Consolei Google API</a>, se obțin <strong>numărul de proiect</strong> și <strong>cheia publică</strong> ce vor fi utilizate de dispozitivul mobil, respectiv de serverul de aplicații pentru a se autentifica în cadrul Google Cloud Messaging for Android.
</p>

<p>
<p><div class="noteimportant">Trebuie să fiți autentificați folosind numele de utilizator și parola contului Google, altfel va trebui să vă creați un astfel de cont.
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> În situația în care nu a fost creat un proiect Google <abbr title="Application Programming Interface">API</abbr> anterior, se va afișa o fereastră prin care se poate realiza acest lucru, accesându-se opțiunea <em>Create Project…</em>:</div>
</li>
</ul>

<p>
<img src="../../_media/eim/laboratoare/laborator08/start_using_google_apis_console.png" class="mediacenter" alt="" />
</p>
<ul>
<li class="level1"><div class="li"> Ulterior, vor trebui acceptate <a href="https://console.developers.google.com/tos?id=UDS" class="urlextern" title="https://console.developers.google.com/tos?id=UDS"  rel="nofollow">termenii și condițiile utilizării Google API</a>:</div>
</li>
</ul>

<p>
<img src="../../_media/eim/laboratoare/laborator08/terms_of_service.png" class="mediacenter" alt="" />
</p>
<ul>
<li class="level1"><div class="li"> Se identifică <strong>numărul de proiect</strong> care va fi utilizat de dispozitivul mobil pentru a se înregistra la serverul Google Cloud Messaging for Android (<code>SENDER_ID</code>), acesta putând fi preluat din:</div>
<ul>
<li class="level2"><div class="li"> bara de adrese a aplicației de navigare <img src="../../_media/eim/laboratoare/laborator08/project_number01.png" class="mediacenter" alt="" /></div>
</li>
<li class="level2"><div class="li"> secțiunea <em>Overview</em> a consolei Google <abbr title="Application Programming Interface">API</abbr> <img src="../../_media/eim/laboratoare/laborator08/project_number02.png%3Fw=1000&amp;tok=993b01" class="mediacenter" alt="" width="1000" /></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Se activează <abbr title="Application Programming Interface">API</abbr>-ul <em>Cloud Messaging for Android</em> din secțiunea <em>Mobile APIs</em>, ce poate fi accesată din <em>APIs &amp; auth</em> → <em>APIs</em> a consolei Google <abbr title="Application Programming Interface">API</abbr>.</div>
</li>
</ul>

<p>
<img src="../../_media/eim/laboratoare/laborator08/enable_google_cloud_messaging_for_android01.png%3Fw=400&amp;tok=07d78f" class="mediacenter" alt="" width="400" />
</p>
<ul>
<li class="level1"><div class="li"> Ulterior, vor putea fi vizualizate statistici cu privire la gradul de utilizare al acestui serviciu (număr de cereri realizate, distribuția codurilor de răspuns), precum și informații legate de monetizare.</div>
</li>
</ul>

<p>
<img src="../../_media/eim/laboratoare/laborator08/enable_google_cloud_messaging_for_android02.png%3Fw=400&amp;tok=eeff71" class="mediacenter" alt="" width="400" />
</p>
<ul>
<li class="level1"><div class="li"> În secțiunea <em>APIs &amp; auth</em> → <em>Credentials</em> se creează o <strong>cheie publică</strong> ce va fi utilizată pentru a transmite notificări de la serverul de aplicații la serverul Google Cloud Messaging for Android.</div>
<ul>
<li class="level2"><div class="li"> Se selectează butonul <em>Create New Key</em> din secțiunea <em>Public <abbr title="Application Programming Interface">API</abbr> access</em>. <img src="../../_media/eim/laboratoare/laborator08/create_new_key.png" class="mediacenter" alt="" /></div>
</li>
<li class="level2"><div class="li"> Se specifică <strong>proprietățile cheii publice</strong> ce se dorește a fi generată în funcție de aplicația prin intermediul căreia se vor transmite notificări către dispozitivul Android prin intermediul Google Cloud Messaging.</div>
<ul>
<li class="level3"><div class="li"> <strong>tipul cheii publice</strong> (variante disponibile: <em>Server Key</em>, <em>Browser Key</em>, <em>Android Key</em>, <em>iOS Key</em>) - se va selecta cel mai general tip, <em>Server Key</em>. <img src="../../_media/eim/laboratoare/laborator08/key_types.png" class="mediacenter" alt="" /></div>
</li>
<li class="level3"><div class="li"> <strong>adresele Internet de la care pot fi acceptate solicitări</strong> (câte o adresă Internet pe un rând): acest câmp poate fi lăsat vid, dacă vor fi acceptate cereri de la mai multe aplicații web, disponibile la diferite locații, sau se poate folosi adresa IP <code>0.0.0.0/0</code>, în scop de testare. <img src="../../_media/eim/laboratoare/laborator08/server_key_allowed_ips.png" class="mediacenter" alt="" /></div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> Se identifică valoarea cheii publice care va fi utilizată <img src="../../_media/eim/laboratoare/laborator08/key_for_server_applications.png" class="mediacenter" alt="" /></div>
</li>
</ul>
</li>
</ul>

</div>

<h3 class="sectionedit4" id="configurare_client">Configurare client</h3>
<div class="level3">

<p>
<strong>2.</strong> Se instalează SDK-ul Google Play Services, necesară autentificării / deautentificării la Google Cloud Messaging for Android din cadrul aplicației instalată pe dispozitivul mobil.
</p>
<ul>
<li class="level1"><div class="li"> În Eclipse Luna, se accesează <em>Android SDK Manager</em></div>
<ul>
<li class="level2"><div class="li"> din bara de unelte<br/>
<img src="../../_media/eim/laboratoare/laborator08/eclipse_toolbar.png%3Fw=900&amp;tok=957f54" class="mediacenter" alt="" width="900" /></div>
</li>
<li class="level2"><div class="li"> din meniul principal, <em>Window</em> → <em>Android SDK Manager</em></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Se selectează următoarele pachete:<br/>
<img src="../../_media/eim/laboratoare/laborator08/android_sdk_manager.png%3Fw=600&amp;tok=8445ea" class="mediacenter" alt="" width="600" /></div>
<ul>
<li class="level2"><div class="li"> din secțiunea <code>Android 4.1.2 (<abbr title="Application Programming Interface">API</abbr> 16)</code>, pachetul <code>Google APIs</code></div>
</li>
<li class="level2"><div class="li"> din sețiunea <em>Extras</em>, pachetul <em>Google Play Services</em></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Biblioteca pentru accesarea Google Cloud Messaging va fi instalată la <code>&lt;android-sdk&gt;/extras/google/google_play_services/libproject/google-play-services_lib</code>.</div>
</li>
</ul>

<p>
<strong>3.</strong> Se configurează emulatorul astfel încât să poată fi rulată aplicația Android ce folosește Google Cloud Messaging.
</p>

<p>
<p><div class="notetip">Pentru aplicațiile ce rulează pe dispozitivul fizic (având o versiune a sistemului de operare Android ulterioară 2.2) nu este necesară nici o configurare suplimentară (cu excepția asocierii unui cont Google, prin specificarea parametrilor acestuia - nume de utilizator și parolă).
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> <strong>AVD</strong></div>
<ul>
<li class="level2"><div class="li"> se creează un dispozitiv virtual pentru care va specifica la secțiunea <em>Target</em> valoarea <em>Google APIs (Google Inc.)</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/android_virtual_device01.png%3Fw=400&amp;tok=d62b54" class="mediacenter" alt="" width="400" /></div>
</li>
<li class="level2"><div class="li"> se asociază datele unui cont Google (nume de utilizator, parola) din <em>Settings</em> → <em>Accounts</em>, selectându-se opțiunea <em>Add account</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/android_virtual_device02.png" class="mediacenter" alt="" /></div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>Genymotion</strong> - vor trebui instalate manual <code>ARM Transalation</code> și <code>Google Apps for Android</code> întrucât suportul pentru acestea nu mai este asigurat începând cu versiunea 2.0</div>
<ul>
<li class="level2"><div class="li"> în <em>Settings</em> → <em>ADB</em> → <em>ADB Connection Settings</em> se indică locația unde se găsește instalat SDK-ul de Android<br/>
<img src="../../_media/eim/laboratoare/laborator08/genymotion_settings.png%3Fw=400&amp;tok=e49a0a" class="mediacenter" alt="" width="400" /></div>
</li>
<li class="level2"><div class="li"> se instalează <a href="http://pdsd2014.andreirosucojocaru.ro/Genymotion-ARM-Translation_v1.1.zip" class="urlextern" title="http://pdsd2014.andreirosucojocaru.ro/Genymotion-ARM-Translation_v1.1.zip"  rel="nofollow">ARM Translation 1.1</a> printr-o operație de tip drag-and-drop în ecranul principal al emulatorului</div>
<ul>
<li class="level3"><div class="li"> se afișează o fereastră de dialog ce va conține mesajul <code>File transfer in progress…</code><br/>
<img src="../../_media/eim/laboratoare/laborator08/file_transfer_in_progress.png" class="mediacenter" alt="" /></div>
</li>
<li class="level3"><div class="li"> odată realizat transferul, se afișează o fereastră de dialog prin care utilizatorul este atenționat de faptul că arhiva ar putea corupe dispozitivul virtual, solicitându-i-se acordul pentru a continua instalarea<br/>
<img src="../../_media/eim/laboratoare/laborator08/arm_translation_warning.png" class="mediacenter" alt="" /></div>
</li>
<li class="level3"><div class="li"> odată realizată instalarea, se afișează o fereastră de dialog ce conține rezultatul operației<br/>
<img src="../../_media/eim/laboratoare/laborator08/arm_translation_result.png" class="mediacenter" alt="" /> </div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> se repornește emulatorul prin comanda<br/>
<pre class="code">adb -s 192.168.56.101:5555 reboot</pre>

<p>
 (sau <code>adb reboot&lt;</code> dacă există un sigur dispozitiv conectat la un moment dat)
</p>
</div>
</li>
<li class="level2"><div class="li"> se instalează <code>Google Apps for Android</code> corespunzătoare versiunii sistemului de operare existentă pe dispozitivul virtual, printr-o operație de tip drag-and-drop în ecranul principal al emulatorului (sunt parcurse aceleași etape ca anterior)<br/>
<img src="../../_media/eim/laboratoare/laborator08/google_play_services_warning.png" class="mediacenter" alt="" /> <br/>
<img src="../../_media/eim/laboratoare/laborator08/google_play_services_result.png" class="mediacenter" alt="" /> </div>
<ul>
<li class="level3"><div class="li"> <a href="http://pdsd2014.andreirosucojocaru.ro/gapps-kk-20140105-signed.zip" class="urlextern" title="http://pdsd2014.andreirosucojocaru.ro/gapps-kk-20140105-signed.zip"  rel="nofollow">Google Apps for Android 4.4</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20130813-signed.zip" class="urlextern" title="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20130813-signed.zip"  rel="nofollow">Google Apps for Android 4.3</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20130812-signed.zip" class="urlextern" title="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20130812-signed.zip"  rel="nofollow">Google Apps for Android 4.2</a></div>
</li>
<li class="level3"><div class="li"> <a href="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20121011-signed.zip" class="urlextern" title="http://pdsd2014.andreirosucojocaru.ro/gapps-jb-20121011-signed.zip"  rel="nofollow">Google Apps for Android 4.1</a></div>
</li>
</ul>
</li>
<li class="level2"><div class="li"> indiferent de rezultat, se repornește emulatorul prin comanda<br/>
<pre class="code">adb -s 192.168.56.101:5555 reboot</pre>

<p>
 (respectiv <code>adb reboot</code>)
</p>
</div>
</li>
<li class="level2"><div class="li"> se asociază datele unui cont Google (nume de utilizator, parola) din <em>Settings</em> → <em>Accounts</em>, selectându-se opțiunea <em>Add account</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup01.png%3Fw=400&amp;tok=9ea025" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup02.png%3Fw=400&amp;tok=045035" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup03.png%3Fw=400&amp;tok=b0ecb7" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup04.png%3Fw=400&amp;tok=0b9ca7" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup05.png%3Fw=400&amp;tok=b72b90" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup06.png%3Fw=400&amp;tok=48650b" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup07.png%3Fw=400&amp;tok=b0abb0" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup08.png%3Fw=400&amp;tok=c8023e" class="mediacenter" alt="" width="400" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup09.png%3Fw=400&amp;tok=5f6537" class="mediacenter" alt="" width="400" /> </div>
</li>
<li class="level2"><div class="li"> se actualizează <em>Play Store</em> prin accesarea opțiunii <em>Settings</em> de mai multe ori (procesul de actualizare va fi pornit în fundal, în mod automat)<br/>
<img src="../../_media/eim/laboratoare/laborator08/google_account_setup10.png%3Fw=400&amp;tok=f8b7dc" class="mediacenter" alt="" width="400" /></div>
</li>
</ul>
</li>
</ul>

<p>
<strong>4.</strong> În situația în care se va folosi un server CCS (XMPP), în prezent, nu mai este necesară o înregistrare suplimentară pentru a se obține acceptul Google de a utiliza serviciul de transmitere a mesajelor de pe dispozitivul mobil. Anterior, o astfel de solicitare trebuia transmisă la <a href="https://services.google.com/fb/forms/gcm/" class="urlextern" title="https://services.google.com/fb/forms/gcm/"  rel="nofollow">Upstream Google Cloud Messaging and User Notifications Sign-up</a>.
</p>

</div>

<h3 class="sectionedit5" id="configurare_server_optional">Configurare server (opțional)</h3>
<div class="level3">

<p>
<p><div class="noteclassic">Pot exista mai multe variante de implementare a unui server de aplicații, în acest caz fiind aleasă o soluție care implică un efort redus de configurare și de implementare propriu-zisă.<br/>
Ca atare, se va proiecta un server de aplicații care va trimite mesaje către serverul Google Cloud Messaging, respectiv va primi mesaje de la un client Android folosind protocolul HTTP. Pentru dezvoltarea acestei funcționalități, soluția aleasă se bazează pe pagini Internet generate cu <strong>Java Servlets</strong> și utilizând un motor pentru gestiunea bazelor de date <strong>MySQL</strong>, serverul web folosit fiind <strong>Apache Tomcat</strong>.
</div></p>
</p>

<p>
<strong>5.</strong> Se descarcă cea mai recentă versiune stabilă a serverului web Apache Tomcat (<a href="http://mirrors.hostingromania.ro/apache.org/tomcat/tomcat-8/v8.0.21/bin/apache-tomcat-8.0.21.zip" class="urlextern" title="http://mirrors.hostingromania.ro/apache.org/tomcat/tomcat-8/v8.0.21/bin/apache-tomcat-8.0.21.zip"  rel="nofollow">zip</a>|<a href="http://mirrors.hostingromania.ro/apache.org/tomcat/tomcat-8/v8.0.21/bin/apache-tomcat-8.0.21.tar.gz" class="urlextern" title="http://mirrors.hostingromania.ro/apache.org/tomcat/tomcat-8/v8.0.21/bin/apache-tomcat-8.0.21.tar.gz"  rel="nofollow">tar.gz</a>) și se dezarhivează.
</p>

<p>
<strong>6</strong>. Se descarcă cea mai recentă versiune stabilă a mediului de dezvoltare Eclipse IDE for Java EE Developers (Windows: <a href="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-win32.zip" class="urlextern" title="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-win32.zip"  rel="nofollow">32-bit</a>|<a href="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-win32-x86_64.zip" class="urlextern" title="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-win32-x86_64.zip"  rel="nofollow">64-bit</a>, Linux: <a href="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-linux-gtk.tar.gz" class="urlextern" title="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-linux-gtk.tar.gz"  rel="nofollow">32-bit</a>|<a href="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-linux-gtk-x86_64.tar.gz" class="urlextern" title="http://www.eclipse.org/downloads/download.php?file=/technology/epp/downloads/release/luna/SR2/eclipse-jee-luna-SR2-linux-gtk-x86_64.tar.gz"  rel="nofollow">64-bit</a>) și se integrează cu serverul web Apache Tomcat.
</p>
<ul>
<li class="level1"><div class="li"> <em>Window</em> → <em>Preferences</em> → <em>Server</em> → <em>Runtime Environments</em> și se accesează butonul <em>Add…</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration01.png%3Fw=500&amp;tok=80e164" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level1"><div class="li"> se specifică tipul serverului web (<code>Apache Tomcat v8.0</code>)<br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration02.png%3Fw=500&amp;tok=28584e" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level1"><div class="li"> se precizează locația la care se găsește serverul web (directorul în care a fost dezarhivat, fără alte configurări) și versiunea de Java Runtime Environment<br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration03.png%3Fw=500&amp;tok=309060" class="mediacenter" alt="" width="500" /></div>
</li>
</ul>

<p>
<p><div class="notetip">Se oferă și posibilitatea descărcării și instalării unei instanțe a serverului web Apache Tomcat, însă de regulă aceasta nu referă cea mai recentă versiune.
</div></p>
</p>

<p>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration04.png%3Fw=500&amp;tok=76d1fe" class="mediacenter" alt="" width="500" />
</p>
<ul>
<li class="level1"><div class="li"> <em>Window</em> → <em>Show View</em> → <em>Other…</em> → <em>Servers</em> → <em>Server</em> și se accesează legătura <em>No servers are available. Click this link to create a new server…</em> sau click pe butonul drept al mouse-ului în spațiul de lucru <em>Server</em> → <em>New</em> → <em>Server</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration05.png" class="mediacenter" alt="" /><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration06.png%3Fw=800&amp;tok=27c22b" class="mediacenter" alt="" width="800" /></div>
</li>
<li class="level1"><div class="li"> se selectează serverul web definit anterior și se accesează butonul <em>Finish</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration07.png%3Fw=500&amp;tok=7e6880" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level1"><div class="li"> se asociază proiectului un server web pe care va rula: click pe butonul drept al mouse-ului pe denumirea proiectului → <em>Properties</em> → <em>Server</em> și se selectează serverul web definit anterior<br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration08.png%3Fw=500&amp;tok=abbe36" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level1"><div class="li"> se realizează o referință către biblioteca serverului web, aceasta fiind trecută în classpath: click pe butonul drept al mouse-ului pe denumirea proiectului → <em>Build Path</em> → <em>Add Library</em></div>
<ul>
<li class="level2"><div class="li"> se alege <em>Server Runtime</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration09.png%3Fw=500&amp;tok=8d14c3" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level2"><div class="li"> se indică serverul web definit anterior și se accesează butonul <code>Finish</code><br/>
<img src="../../_media/eim/laboratoare/laborator08/server_configuration10.png%3Fw=500&amp;tok=ccaee5" class="mediacenter" alt="" width="500" /></div>
</li>
</ul>
</li>
</ul>

<p>
<strong>7.</strong> Se descarcă și se instalează cea mai recentă versiune stabilă a motorului pentru baze de date MySQL.
</p>
<ul>
<li class="level1"><div class="li"> Windows: se poate folosi <a href="https://dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.7.0-rc.msi" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLInstaller/mysql-installer-community-5.7.7.0-rc.msi"  rel="nofollow">MySQL Community Server</a>.</div>
</li>
<li class="level1"><div class="li"> Linux: se poate utiliza comanda <pre class="code">student@pdsd2015:~$ sudo apt-get install mysql-server</pre>
</div>
</li>
</ul>

<p>
<p><div class="noteclassic">Configurarea propriu-zisă nu presupune decât specificarea unei parole de administrare.
</div></p>
</p>

<p>
Pentru gestiunea propriu-zisă a bazelor de date, poate fi utiliza MySQL Workbench <a href="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-win32.msi" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-win32.msi"  rel="nofollow">Windows</a>|<a href="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1ubu1410-amd64.deb" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1ubu1410-amd64.deb"  rel="nofollow">Ubuntu</a>|<a href="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1.el7.x86_64.rpm" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1.el7.x86_64.rpm"  rel="nofollow">Fedora Core</a>|<a href="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1.fc21.x86_64.rpm" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-1.fc21.x86_64.rpm"  rel="nofollow">Red Hat</a>, <a href="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-osx-x86_64.dmg" class="urlextern" title="https://dev.mysql.com/get/Downloads/MySQLGUITools/mysql-workbench-community-6.3.3-osx-x86_64.dmg"  rel="nofollow">Mac OS X</a>.
</p>

<p>
De asemenea, se poate accesa consola MySQL folosind comanda 
</p>
<pre class="code">student@pdsd2015:~$ mysql -u root -p</pre>

<p>
Va trebui indicată parola, atunci când aceasta este solicitată.
</p>

</div>

<h2 class="sectionedit6" id="proiectarea_si_dezvoltarea_clientului">Proiectarea și dezvoltarea clientului</h2>
<div class="level2">

</div>

<h3 class="sectionedit7" id="proiectul_eclipse">Proiectul Eclipse</h3>
<div class="level3">

<p>
<p><div class="notewarning">Există posibilitatea ca rularea proiectului Eclipse să necesite mai multă memorie ce trebuie alocată mașinii virtuale Java, aceasta realizându-se prin intermediul valorilor furnizate în cadrul fișierului de configurare <code>eclipse.ini</code>:<br/>

</p>
<pre class="code">--launcher.XXMaxPermSize
1024M
--launcher.XXMaxPermSize
1024m
--launcher.appendVmargs
-vmargs
-Dosgi.requiredJavaVersion=1.7
-Xms1024m
-Xmx1024m</pre>

<p>

</div></p>
</p>

<p>
Se realizează o referință către biblioteca pentru accesarea Google Cloud Messaging care este localizată în <code>&lt;android-sdk&gt;/extras/google/google_play_services/libproject/google-play-services_lib</code>
</p>
<ul>
<li class="level1"><div class="li"> se accesează <em>File</em> → <em>Import</em> → <em>Android</em> → <em>Existing Android Code Into Workspace</em><br/>
<img src="../../_media/eim/laboratoare/laborator08/google_cloud_messaging_library_import01.png%3Fw=500&amp;tok=ea67e4" class="mediacenter" alt="" width="500" /></div>
</li>
<li class="level1"><div class="li"> se indică locația unde se găsește instalată biblioteca pentru accesarea Google Cloud Messaging, creându-se o copie a acestuia în spațiul de lucru (se bifează opțiunea <em>Copy projects into workspace</em>)<br/>
<img src="../../_media/eim/laboratoare/laborator08/google_cloud_messaging_library_import02.png%3Fw=800&amp;tok=3090d1" class="mediacenter" alt="" width="800" /></div>
</li>
<li class="level1"><div class="li"> în fereastra corespunzătoare proiectului aferent aplicației Android (click dreapta pe denumirea proiectului în <em>Package Explorer</em> → <em>Properties</em>), se accesează opțiunea <em>Android</em> și se specifică referința către biblioteca respectivă în secțiunea <em>Library</em> (accesând butonul <em>Add</em>)<br/>
<img src="../../_media/eim/laboratoare/laborator08/google_cloud_messaging_library_import03.png%3Fw=800&amp;tok=8506fa" class="mediacenter" alt="" width="800" /></div>
</li>
</ul>

</div>

<h3 class="sectionedit8" id="structura_proiectului">Structura Proiectului</h3>
<div class="level3">

<p>
Aplicația Android care va rula pe dispozitivul mobil va consta din:
</p>
<ol>
<li class="level1"><div class="li"> o <strong>activitate</strong> (<code>GoogleCloudMessagingActivity</code>) care:</div>
<ol>
<li class="level2"><div class="li"> verifică dacă pe dispozitivul mobil este instalat Google Play Services și dacă această aplicație este actualizată;</div>
</li>
<li class="level2"><div class="li"> permite înregistrarea dispozitivului mobil la serverul Google Cloud Messaging dacă această operație nu a fost realizată în prealabil (o astfel de informație ar trebui stocată în <code>SharedPreferences</code> astfel încât operația să fie realizată o singură dată);</div>
</li>
<li class="level2"><div class="li"> transmite identificatorul de înregistrare obținut către serverul de aplicații (împreună cu alte informații prin care să poată fi recunoscut dispozitivul mobil - de exemplu, un nume de utilizator sau o adresă de posță electronică);</div>
</li>
</ol>
</li>
<li class="level1"><div class="li"> un <strong>ascultător</strong> pentru mesajele cu difuzare (<code>GoogleCloudMessagingBroadcastReceiver</code>) către care este livrat un mesaj transmis de serverul Google Cloud Messaging, prin intermediul unei intenții;</div>
</li>
<li class="level1"><div class="li"> (opțional) un <strong>serviciu</strong> (<code>GoogleCloudMessagingIntentService</code>) lansat în execuție în momentul în care este livrat mesajul (de către ascultător) în cadrul căruia acesta este procesat propriu-zis; utilizarea unui serviciu este necesară doar în situația în care prelucrarea mesajului se realizează într-un interval de timp mai mare, fiind necesar să se asigure faptul că dispozitivul mobil nu devine inactiv între timp.</div>
</li>
</ol>

<p>
<img src="../../_media/eim/laboratoare/laborator08/package_explorer.png%3Fw=500&amp;tok=d1d59a" class="mediacenter" alt="" width="500" />
</p>

</div>

<h4 id="activitatea_googlecloudmessagingactivity">Activitatea GoogleCloudMessagingActivity</h4>
<div class="level4">

<p>
Pe lângă implementarea interfeței grafice prin care se asigură interacțiunea cu utilizatorul, activitatea <code>GoogleCloudMessagingActivity</code> este responsabilă pentru:
</p>

<p>
<strong>1.</strong> verificarea compatibilității dispozitivului mobil pe care rulează aplicația cu Google Play Services, SDK pe care se bazează Google Cloud Messaging; această operație trebuie să se realizeze în momentul în care aplicația devine vizibilă (deci pe metoda <code>onResume()</code>), astfel încât și în situația în care activitatea a fost întreruptă, să se identifice situația în care aceasta a fost instalată sau actualizată:
</p>
<pre class="code java"><span class="kw1">private</span> <span class="kw4">boolean</span> checkPlayServices<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw4">int</span> resultCode <span class="sy0">=</span> GooglePlayServicesUtil.<span class="me1">isGooglePlayServicesAvailable</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>resultCode <span class="sy0">!=</span> ConnectionResult.<span class="me1">SUCCESS</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>GooglePlayServicesUtil.<span class="me1">isUserRecoverableError</span><span class="br0">&#40;</span>resultCode<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      GooglePlayServicesUtil.<span class="me1">getErrorDialog</span><span class="br0">&#40;</span>resultCode, <span class="kw1">this</span>, Configuration.<span class="me1">PLAY_SERVICES_RESOLUTION_REQUEST</span><span class="br0">&#41;</span>.<span class="me1">show</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
      Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">GOOGLE_PLAY_SERVICES_ERROR_MESSAGE2</span><span class="br0">&#41;</span><span class="sy0">;</span>
      finish<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
    <span class="kw1">return</span> <span class="kw2">false</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">return</span> <span class="kw2">true</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
În situația în care dispozitivul mobil este compatibil cu Google Play Services (rulează un sistem de operare Android cu o versiune mai mare decât 2.2), se lasă utilizatorului posibilitatea de a-l instala (sau actualiza, după caz) prin afișarea unei ferestre de dialog, altfel aplicația este terminată.
</p>

<p>
<strong>2.</strong> înregistrarea dispozitivului mobil la Google Cloud Messaging, în situația în care această operație nu s-a realizat în prealabil (nu există o astfel de valoare stocată ca preferință a utilizatorului):
</p>
<pre class="code java"><span class="kw1">private</span> <span class="kw4">void</span> registerInBackground<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">new</span> AsyncTask<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span class="kw3">Object</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>, String<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    @Override
    <span class="kw1">protected</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> doInBackground<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span class="kw3">Object</span></a>... <span class="me1">params</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="kw1">try</span> <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>googleCloudMessaging <span class="sy0">==</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          googleCloudMessaging <span class="sy0">=</span> GoogleCloudMessaging.<span class="me1">getInstance</span><span class="br0">&#40;</span>context<span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
        registrationId <span class="sy0">=</span> googleCloudMessaging.<span class="me1">register</span><span class="br0">&#40;</span>Configuration.<span class="me1">PROJECT_NUMBER</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="co1">// store the registration ID into the SharedPreferences</span>
        <span class="co1">// the ID is not yet registered with the application server</span>
        <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">setInformationIntoSharedPreferences</span><span class="br0">&#40;</span>GoogleCloudMessagingActivity.<span class="kw1">this</span>, registrationId, Constants.<span class="me1">FAILURE</span><span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
	registrationId <span class="sy0">=</span> <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
      <span class="br0">&#125;</span>
      <span class="kw1">return</span> registrationId<span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    @Override
    <span class="kw1">protected</span> <span class="kw4">void</span> onPostExecute<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> registrationId<span class="br0">&#41;</span> <span class="br0">&#123;</span>
      Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">REGISTRATION_ID_INFORMATION_MESSAGE</span> <span class="sy0">+</span> registrationId<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>unregisteredFragment <span class="sy0">!=</span> <span class="kw2">null</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        unregisteredFragment.<span class="me1">setRegistrationIdTextView</span><span class="br0">&#40;</span>registrationId<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>.<span class="me1">execute</span><span class="br0">&#40;</span><span class="kw2">null</span>, <span class="kw2">null</span>, <span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
<p><div class="notewarning">Întrucât procesul de înregistrare la Google Cloud Messaging implică comunicație prin rețea, este necesar ca acesta să se realizeze asincron, pe un fir de execuție separat, motiv pentru care procesarea a fost realizată în cadrul metodei <code>doInBackground()</code> a unui obiect de tip <code>AsyncTask</code>.
</div></p>
</p>

<p>
Testarea existenței unei valori corespunzătoare identificatorului de înregistrare în preferințele utilizatorului se face foarte ușor, acesta având o structură de tip asociere între o cheie și o valoare.
</p>
<pre class="code java"><span class="kw1">public</span> <span class="kw1">static</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> getRegistrationIdFromSharedPreferences<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context<span class="br0">&#41;</span> <span class="br0">&#123;</span>
  <span class="kw1">final</span> SharedPreferences sharedPreferences <span class="sy0">=</span> getSharedPreferences<span class="br0">&#40;</span>context<span class="br0">&#41;</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> registrationId <span class="sy0">=</span> sharedPreferences.<span class="me1">getString</span><span class="br0">&#40;</span>Constants.<span class="me1">REGISTRATION_ID_PROPERTY</span>, <span class="st0">&quot;&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>registrationId.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">REGISTRATION_ID_ERROR_MESSAGE</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> Constants.<span class="me1">EMPTY_STRING</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="co1">// check whether the application was updated </span>
  <span class="co1">// if it is the case, the registration ID previously supplied must be cleared</span>
  <span class="co1">// as it is not guaranteed to work with the current version</span>
  <span class="kw4">int</span> registeredApplicationVersion <span class="sy0">=</span> sharedPreferences.<span class="me1">getInt</span><span class="br0">&#40;</span>Constants.<span class="me1">APPLICATION_VERSION_PROPERTY</span>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>.<span class="me1">MIN_VALUE</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw4">int</span> currentVersion <span class="sy0">=</span> getApplicationVersion<span class="br0">&#40;</span>context<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="kw1">if</span> <span class="br0">&#40;</span>registeredApplicationVersion <span class="sy0">!=</span> currentVersion<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">APPLICATION_VERSION_ERROR_MESSAGE</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">return</span> Constants.<span class="me1">EMPTY_STRING</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
  <span class="kw1">return</span> registrationId<span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

<p>
De remarcat este faptul că în preferințele utilizatorului va fi stocată și versiunea aplicației Android pentru care a fost generat identificatorul de înregistrare, iar în situația în care aceasta este actualizată, se va realiza o nouă înregistrare la serverul Google Cloud Messaging, de vreme ce o astfel de valoare identifică în mod unic o aplicație caracterizată prin denumirea pachetului și versiunea acesteia.
</p>

<p>
<strong>3.</strong> transmiterea identificatorului de înregistrare către serverul de aplicații printr-o cerere HTTP de tip POST care va conține și alte informații prin care să poată fi referit utilizatorul respectiv (de exemplu, numele de utilizator sau adresa de poștă electronică):
</p>
<pre class="code java"><span class="kw1">protected</span> <span class="kw1">class</span> SendRegistrationIdButtonClickListener <span class="kw1">implements</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+button"><span class="kw3">Button</span></a>.<span class="me1">OnClickListener</span> <span class="br0">&#123;</span>
&nbsp;
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onClick<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+view"><span class="kw3">View</span></a> view<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">new</span> AsyncTask<span class="sy0">&lt;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span class="kw3">Object</span></a>, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a>, Integer<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      @Override
      <span class="kw1">protected</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a> doInBackground<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span class="kw3">Object</span></a>... <span class="me1">params</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp;
        <span class="kw1">try</span> <span class="br0">&#123;</span>
          HttpClient httpClient <span class="sy0">=</span> <span class="kw1">new</span> DefaultHttpClient<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>        
&nbsp;
          HttpPost httpPost <span class="sy0">=</span> <span class="kw1">new</span> HttpPost<span class="br0">&#40;</span>Constants.<span class="me1">DEVICE_REGISTRATION_SERVICE_ADDRESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
          <span class="co1">// send the user name, email and registration ID as fields of the HTTP body to the application server</span>
          List<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span> requestParameters <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>NameValuePair<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          requestParameters.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">USERNAME</span>, usernameEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          requestParameters.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">EMAIL</span>, emailEditText.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          requestParameters.<span class="me1">add</span><span class="br0">&#40;</span><span class="kw1">new</span> BasicNameValuePair<span class="br0">&#40;</span>Constants.<span class="me1">REGISTRATION_ID</span>, registrationIdTextView.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
          UrlEncodedFormEntity urlEncodedFormEntity <span class="sy0">=</span> <span class="kw1">new</span> UrlEncodedFormEntity<span class="br0">&#40;</span>requestParameters, HTTP.<span class="me1">UTF_8</span><span class="br0">&#41;</span><span class="sy0">;</span>
          httpPost.<span class="me1">setEntity</span><span class="br0">&#40;</span>urlEncodedFormEntity<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
          HttpResponse httpPostResponse <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpPost<span class="br0">&#41;</span><span class="sy0">;</span> 
&nbsp;
          <span class="co1">// transmission of information to the application server was successful</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>httpPostResponse.<span class="me1">getStatusLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getStatusCode</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">==</span> <span class="nu0">200</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">return</span> Constants.<span class="me1">SUCCESS</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
	<span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> ioException<span class="br0">&#41;</span> <span class="br0">&#123;</span>
          Log.<span class="me1">e</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, <span class="st0">&quot;An exception has occurred: &quot;</span> <span class="sy0">+</span> ioException.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            ioException.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
          <span class="br0">&#125;</span>
        <span class="br0">&#125;</span>
	<span class="co1">// transmission of information to the application server was not successful</span>
	<span class="kw1">return</span> Constants.<span class="me1">FAILURE</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
&nbsp;
      @Override
      <span class="kw1">protected</span> <span class="kw4">void</span> onPostExecute<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+integer"><span class="kw3">Integer</span></a> result<span class="br0">&#41;</span> <span class="br0">&#123;</span>
        <span class="kw1">switch</span><span class="br0">&#40;</span>result.<span class="me1">intValue</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
          <span class="kw1">case</span> Constants.<span class="me1">SUCCESS</span><span class="sy0">:</span>
            <span class="co1">// store the registration ID into the SharedPreferences</span>
            <span class="co1">// the ID is registered with the application server</span>
            <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+utilities"><span class="kw3">Utilities</span></a>.<span class="me1">setInformationIntoSharedPreferences</span><span class="br0">&#40;</span>getActivity<span class="br0">&#40;</span><span class="br0">&#41;</span>, registrationIdTextView.<span class="me1">getText</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">toString</span><span class="br0">&#40;</span><span class="br0">&#41;</span>, Constants.<span class="me1">SUCCESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
            <span class="co1">// replace the existing fragment in order to forbid the user to register its ID to the registration server</span>
            RegisteredFragment registeredFragment <span class="sy0">=</span> <span class="kw1">new</span> RegisteredFragment<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            FragmentManager fragmentManager <span class="sy0">=</span> getActivity<span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getFragmentManager</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            FragmentTransaction fragmentTransaction <span class="sy0">=</span> fragmentManager.<span class="me1">beginTransaction</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            fragmentTransaction.<span class="me1">replace</span><span class="br0">&#40;</span>R.<span class="me1">id</span>.<span class="me1">container</span>, registeredFragment<span class="br0">&#41;</span><span class="sy0">;</span>
            fragmentTransaction.<span class="me1">commit</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
            Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">REGISTRATION_PROCESS_SUCCESS</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">break</span><span class="sy0">;</span>
&nbsp;
          <span class="kw1">case</span> Constants.<span class="me1">FAILURE</span><span class="sy0">:</span>
            Log.<span class="me1">i</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span>, Constants.<span class="me1">REGISTRATION_PROCESS_FAILURE</span><span class="br0">&#41;</span><span class="sy0">;</span>
            <span class="kw1">break</span><span class="sy0">;</span>
	<span class="br0">&#125;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>.<span class="me1">execute</span><span class="br0">&#40;</span><span class="kw2">null</span>, <span class="kw2">null</span>, <span class="kw2">null</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
În cadrul serverului de aplicații va trebui procesată o astfel de cerere prin stocarea informațiilor transmise în cadrul unei baze de date și transmiterea unui răspuns corespunzător prin care se indică rezultatul operației, pentru a fi marcat și la nivelul clientului (în preferințele utilizatorului).
</p>

<p>
<p><div class="noteimportant">Transmiterea identificatorului de înregistrare către serverul de aplicații se realizează o singură dată, astfel încât să nu se înregistreze duplicate în baza de date.
</div></p>
</p>

</div>

<h4 id="ascultatorul_googlecloudmessagingbroadcastreceiver">Ascultătorul GoogleCloudMessagingBroadcastReceiver</h4>
<div class="level4">

<p>
Implementarea unui ascultător pentru mesaje cu difuzare poate fi realizată în două variante:
</p>
<ol>
<li class="level1"><div class="li"> în cazul în care procesarea mesajului implică operații triviale (ce pot fi realizate într-un interval de timp rezonabil), se poate defini un ascultător <code>BroadcastReceiver</code>, prelucrarea propriu-zisă realizându-se în cadrul metodei <code>onReceive()</code> (ce primește ca parametri contextul și intenția care a apelat-o, cu informațiile din corpul mesajului atașate într-un obiect de tip <code>Bundle</code>), apelată în mod automat în momentul în care mesajul este livrat.</div>
</li>
<li class="level1"><div class="li"> în situația în care procesarea mesajului presupune mai multe operații realizate într-un interval de timp semnificativ, prelucrarea se va realiza în cadrul unui serviciu dedicat (de tip <code>IntentService</code>), ce va rula în fundal, în timp ce se obține accesul la un tip de mutex ce împiedică dispozitivul mobil să intre într-o stare de inactivitate care ar suspenda tratarea evenimentului de livrare a unui mesaj, dacă aceasta nu este încă completată: <dl class="file">
<dt><a href="../../_export/code/eim/laboratoare/laborator11%3Fcodeblock=9" title="Download Snippet" class="mediafile mf_java">GoogleCloudMessagingBroadcastReceiver.java</a></dt>
<dd><pre class="code file java"><span class="kw1">public</span> <span class="kw1">class</span> GoogleCloudMessagingBroadcastReceiver <span class="kw1">extends</span> WakefulBroadcastReceiver <span class="br0">&#123;</span>
&nbsp;
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> onReceive<span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a> context, Intent intent<span class="br0">&#41;</span> <span class="br0">&#123;</span>
&nbsp;
    <span class="co1">// create a component associated to the service that will handle the intent</span>
    ComponentName component <span class="sy0">=</span> <span class="kw1">new</span> ComponentName<span class="br0">&#40;</span>
      context.<span class="me1">getPackageName</span><span class="br0">&#40;</span><span class="br0">&#41;</span>,
      GoogleCloudMessagingIntentService.<span class="kw1">class</span>.<span class="me1">getName</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// start the service</span>
    <span class="co1">// maintain the mobile device awake</span>
    startWakefulService<span class="br0">&#40;</span>context, <span class="br0">&#40;</span>intent.<span class="me1">setComponent</span><span class="br0">&#40;</span>component<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    setResultCode<span class="br0">&#40;</span>Activity.<span class="me1">RESULT_OK</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>
</div>
</li>
</ol>

<p>
Așa cum se poate observa, a fost utilizat un ascultător de tip <code>WakefulBroadcastReceiver</code>, delegarea procesării mesajului către serviciul dedicat făcându-se prin metoda <code>startWakefulService</code> ce asigură și obținerea accesului la mutexul care împiedică intrarea dispozitivului mobil într-o stare de inactivitate.
</p>

</div>

<h4 id="serviciul_googlecloudmessagingintentservice">Serviciul GoogleCloudMessagingIntentService</h4>
<div class="level4">

<p>
În cadrul serviciului pentru tratarea evenimentului (de tip <code>IntentService</code>) are loc procesarea propriu-zisă a mesajului, aceasta fiind realizată în cadrul metodei <code>onHandleIntent()</code> care primește ca parametru aceeași intenție care a fost transmisă ascultătorului, și pentru care a fost obținut mutextul care împiedică intrarea dispozitivului mobil într-o stare de inactivitate.
</p>

<p>
Prelucrarea unui mesaj se face în funcție de tipul acestuia, furnizat de metoda <code>getMessageType()</code> a obiectului de tip <code>GoogleCloudMessaging</code>, pe baza informațiilor din intenție. Odată cunoscut tipul mesajului și datele asociate prin <code>Bundle</code>, utilizatorul poate realiza orice acțiune, de la transmiterea unei notificări la modificarea conținutului unor controale grafice din cadrul activității.
</p>

<p>
<p><div class="noteimportant">Ulterior analizei mesajului, trebuie să se asigure și eliberarea mutexului ce împiedică intrarea dispozitivului mobil într-o stare de inactivitate, prin apelul metodei <code>completeWakefulIntent()</code> căreia i se transmite ca parametru aceeași intenție pentru care a fost obținută această resursă.
</div></p>
</p>
<dl class="file">
<dt><a href="../../_export/code/eim/laboratoare/laborator11%3Fcodeblock=10" title="Download Snippet" class="mediafile mf_java">GoogleCloudMessagingIntentService.java</a></dt>
<dd><pre class="code file java"><span class="kw1">public</span> <span class="kw1">class</span> GoogleCloudMessagingIntentService <span class="kw1">extends</span> IntentService <span class="br0">&#123;</span>
&nbsp;
  <span class="kw1">public</span> GoogleCloudMessagingIntentService<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="kw1">super</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  @Override
  <span class="kw1">protected</span> <span class="kw4">void</span> onHandleIntent<span class="br0">&#40;</span>Intent intent<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <span class="co1">// the intent is supplied via the BroadcastReceiver</span>
&nbsp;
    GoogleCloudMessaging googleCloudMessaging <span class="sy0">=</span> GoogleCloudMessaging.<span class="me1">getInstance</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> messageType <span class="sy0">=</span> googleCloudMessaging.<span class="me1">getMessageType</span><span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    Bundle extras <span class="sy0">=</span> intent.<span class="me1">getExtras</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="sy0">!</span>extras.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      <span class="co1">// filter the message according to its type</span>
      <span class="kw1">if</span> <span class="br0">&#40;</span>GoogleCloudMessaging.<span class="me1">MESSAGE_TYPE_SEND_ERROR</span>.<span class="me1">equals</span><span class="br0">&#40;</span>messageType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        sendNotification<span class="br0">&#40;</span>extras<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>GoogleCloudMessaging.<span class="me1">MESSAGE_TYPE_DELETED</span>.<span class="me1">equals</span><span class="br0">&#40;</span>messageType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        sendNotification<span class="br0">&#40;</span>extras<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="kw1">if</span> <span class="br0">&#40;</span>GoogleCloudMessaging.<span class="me1">MESSAGE_TYPE_MESSAGE</span>.<span class="me1">equals</span><span class="br0">&#40;</span>messageType<span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
        sendNotification<span class="br0">&#40;</span>extras<span class="br0">&#41;</span><span class="sy0">;</span>
      <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co1">// release the wake lock provided by the WakefulBroadcastReceiver.</span>
    GoogleCloudMessagingBroadcastReceiver.<span class="me1">completeWakefulIntent</span><span class="br0">&#40;</span>intent<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// create a notification containing the message and post it</span>
  <span class="kw1">private</span> <span class="kw4">void</span> sendNotification<span class="br0">&#40;</span>Bundle bundle<span class="br0">&#41;</span> <span class="br0">&#123;</span>
    Intent notificationHandlerIntent <span class="sy0">=</span> <span class="kw1">new</span> Intent<span class="br0">&#40;</span><span class="kw1">this</span>, NotificationHandlerActivity.<span class="kw1">class</span><span class="br0">&#41;</span><span class="sy0">;</span>
    notificationHandlerIntent.<span class="me1">putExtras</span><span class="br0">&#40;</span>bundle<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    TaskStackBuilder taskStackBuilder <span class="sy0">=</span> TaskStackBuilder.<span class="me1">create</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span><span class="sy0">;</span>
    taskStackBuilder.<span class="me1">addParentStack</span><span class="br0">&#40;</span>NotificationHandlerActivity.<span class="kw1">class</span><span class="br0">&#41;</span><span class="sy0">;</span>
    taskStackBuilder.<span class="me1">addNextIntent</span><span class="br0">&#40;</span>notificationHandlerIntent<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    PendingIntent notificationHandlerPendingIntent <span class="sy0">=</span> taskStackBuilder.<span class="me1">getPendingIntent</span><span class="br0">&#40;</span>
      <span class="nu0">0</span>,
      PendingIntent.<span class="me1">FLAG_UPDATE_CURRENT</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    NotificationCompat.<span class="me1">Builder</span> builder <span class="sy0">=</span> <span class="kw1">new</span> NotificationCompat.<span class="me1">Builder</span><span class="br0">&#40;</span><span class="kw1">this</span><span class="br0">&#41;</span>
      .<span class="me1">setSmallIcon</span><span class="br0">&#40;</span>R.<span class="me1">drawable</span>.<span class="me1">ic_launcher</span><span class="br0">&#41;</span>
      .<span class="me1">setContentTitle</span><span class="br0">&#40;</span>Constants.<span class="me1">TAG</span><span class="br0">&#41;</span>
      .<span class="me1">setStyle</span><span class="br0">&#40;</span><span class="kw1">new</span> NotificationCompat.<span class="me1">BigTextStyle</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">bigText</span><span class="br0">&#40;</span>Constants.<span class="me1">NOTIFICATION_MESSAGE</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
      .<span class="me1">setContentText</span><span class="br0">&#40;</span>Constants.<span class="me1">NOTIFICATION_MESSAGE</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    builder.<span class="me1">setContentIntent</span><span class="br0">&#40;</span>notificationHandlerPendingIntent<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    NotificationManager notificationManager <span class="sy0">=</span> <span class="br0">&#40;</span>NotificationManager<span class="br0">&#41;</span><span class="kw1">this</span>.<span class="me1">getSystemService</span><span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+context"><span class="kw3">Context</span></a>.<span class="me1">NOTIFICATION_SERVICE</span><span class="br0">&#41;</span><span class="sy0">;</span>
    notificationManager.<span class="me1">notify</span><span class="br0">&#40;</span>Constants.<span class="me1">NOTIFICATION_ID</span>, builder.<span class="me1">build</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</dd></dl>

</div>

<h3 class="sectionedit9" id="permisiuni_androidmanifestxml">Permisiuni AndroidManifest.xml</h3>
<div class="level3">
<ul>
<li class="level1"><div class="li"> în fișierul <code>AndroidManifest.xml</code> se indică versiunea Google Cloud Messaging în cadrul elementului <code>&lt;application&gt;</code>:<br/>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;meta-data</span> <span class="re0">android:name</span>=<span class="st0">&quot;com.google.android.gms.version&quot;</span></span>
<span class="sc3">           <span class="re0">android:value</span>=<span class="st0">&quot;@integer/google_play_services_version&quot;</span> <span class="re2">/&gt;</span></span></pre>
</div>
</li>
<li class="level1"><div class="li"> în fișierul <code>AndroidManifest.xml</code> se precizează permisiunile necesare pentru ca aplicația să poată utiliza funcționalitățile oferite de Google Cloud Messaging<br/>
<pre class="code xml"><span class="sc3"><span class="re1">&lt;manifest</span> <span class="re0">package</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging&quot;</span> ...<span class="re2">&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;uses-permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;android.permission.INTERNET&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;uses-permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;android.permission.GET_ACCOUNTS&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;uses-permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;android.permission.WAKE_LOCK&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;uses-permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;com.google.android.c2dm.permission.RECEIVE&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.systems.pdsd.lab08.googlecloudmessaging.permission.C2D_MESSAGE&quot;</span></span>
<span class="sc3">    <span class="re0">android:protectionLevel</span>=<span class="st0">&quot;signature&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;uses-permission</span> </span>
<span class="sc3">    <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.systems.pdsd.lab08.googlecloudmessaging.permission.C2D_MESSAGE&quot;</span> <span class="re2">/&gt;</span></span>
&nbsp;
  <span class="sc3"><span class="re1">&lt;application</span> ...<span class="re2">&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;meta-data</span></span>
<span class="sc3">      <span class="re0">android:name</span>=<span class="st0">&quot;com.google.android.gms.version&quot;</span></span>
<span class="sc3">      <span class="re0">android:value</span>=<span class="st0">&quot;@integer/google_play_services_version&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;activity</span></span>
<span class="sc3">      <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.view.GoogleCloudMessagingActivity&quot;</span></span>
<span class="sc3">      <span class="re0">android:label</span>=<span class="st0">&quot;@string/app_name&quot;</span> <span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;intent-filter<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">android:name</span>=<span class="st0">&quot;android.intent.action.MAIN&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;category</span> <span class="re0">android:name</span>=<span class="st0">&quot;android.intent.category.LAUNCHER&quot;</span> <span class="re2">/&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;/intent-filter<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/activity<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;activity</span></span>
<span class="sc3">      <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.view.NotificationHandlerActivity&quot;</span></span>
<span class="sc3">      <span class="re0">android:parentActivityName</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.view.GoogleCloudMessagingActivity&quot;</span><span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;meta-data</span></span>
<span class="sc3">        <span class="re0">android:name</span>=<span class="st0">&quot;android.support.PARENT_ACTIVITY&quot;</span></span>
<span class="sc3">        <span class="re0">android:value</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.view.GoogleCloudMessagingActivity&quot;</span> <span class="re2">/&gt;</span></span>
    <span class="sc3"><span class="re1">&lt;/activity<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;receiver</span></span>
<span class="sc3">      <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.controller.GoogleCloudMessagingBroadcastReceiver&quot;</span></span>
<span class="sc3">      <span class="re0">android:permission</span>=<span class="st0">&quot;com.google.android.c2dm.permission.SEND&quot;</span> <span class="re2">&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;intent-filter<span class="re2">&gt;</span></span></span>
        <span class="sc3"><span class="re1">&lt;action</span> <span class="re0">android:name</span>=<span class="st0">&quot;com.google.android.c2dm.intent.RECEIVE&quot;</span> <span class="re2">/&gt;</span></span>
        <span class="sc3"><span class="re1">&lt;category</span> <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.controller.GoogleCloudMessagingBroadcastReceiver&quot;</span> <span class="re2">/&gt;</span></span>
      <span class="sc3"><span class="re1">&lt;/intent-filter<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;/receiver<span class="re2">&gt;</span></span></span>
    <span class="sc3"><span class="re1">&lt;service</span> <span class="re0">android:name</span>=<span class="st0">&quot;ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.controller.GoogleCloudMessagingIntentService&quot;</span> <span class="re2">/&gt;</span></span>
  <span class="sc3"><span class="re1">&lt;/application<span class="re2">&gt;</span></span></span>
<span class="sc3"><span class="re1">&lt;/manifest<span class="re2">&gt;</span></span></span></pre>
</div>
</li>
</ul>

<p>
<p><div class="noteimportant">Pentru a se asigura faptul că aplicația Android va rula corespunzător, ținând cont de faptul că Google Cloud Messaging nu poate fi folosit pe dispozitive mobile rulând un sistem de operare Android anterior versiunii 2.3, proprietatea <code>android:minSdkVersion</code> va avea o valoare egală sau mai mare cu 8.
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> permisiunea <code>android.permission.INTERNET</code> este necesară pentru ca aplicația să poate transmite identificatorul său serverului de aplicații, prin intermediul căruia se realizează înregistrarea sa;</div>
</li>
<li class="level2"><div class="li"> permisiunea <code>android.permission.GET_ACCOUNTS</code> este necesară întrucât Google Cloud Messaging solicită (pentru sisteme de operare Android anterioare versiunii 4.0.4) un cont Google;</div>
</li>
<li class="level2"><div class="li"> permisiunea <code>android.permission.WAKE_LOCK</code> (opțională) este necesară pentru a se preveni întreruperea activității în momentul în care este primit un mesaj;</div>
</li>
<li class="level2"><div class="li"> permisiunea <code>android.permission.RECEIVE</code> este necesară pentru ca aplicația să se poată înregistra (în cadrul serverului de aplicații) și pentru a putea primi mesaje;</div>
</li>
<li class="level2"><div class="li"> permisiunea de tip <code>permission.C2D_MESSAGE</code> (prefixată de denumirea pachetului care identifică în mod unic aplicația) pentru a preveni altă aplicație Android să se înregistreze (în cadrul serverului de aplicații) și să primească mesajele care îi sunt destinate;</div>
</li>
</ul>

<p>
<p><div class="notewarning">Este necesar ca acest tip de permisiune să utilizeze această sintaxă, în caz contrar mesajele nefiind transmise aplicației Android.
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> un <strong>ascultător</strong> (de tipul <code>com.google.android.c2dm.intent.RECEIVE</code>) având permisiunea <code>com.google.android.c2dm.SEND</code> astfel încât doar motorul Google Cloud Messaging să îi poată transmite mesaje</div>
</li>
</ul>

<p>
<p><div class="noteclassic">Proprietatea <code>category</code> a ascultătorului trebuie să aibă ca valoare denumirea pachetului aplicației Android.
</div></p>
<p><div class="notetip">În cazul în care este asociat și un serviciu (șablon de proiectare frecvent utilizat, însă nu obligatoriu), ascultătorul va fi un obiect de tipul <code>WakefulBroadcastReceiver</code>, creând un mutex parțial pentru a se asigura faptul că dispozitivul mobil rulează.
</div></p>
</p>
<ul>
<li class="level1"><div class="li"> un <strong>serviciu</strong> (de obicei, un obiect de tip <code>IntentService</code>) - opțional - căruia i se transmite mesajul Google Cloud Messaging (de către obiectul de tip <code>WakefulBroadcastReceiver</code>) având sarcina procesării sale și asigurând faptul că dispozitivul nu își întrerupe activitatea în timpul acestui proces</div>
</li>
</ul>

<p>
<p><div class="notetip">În situația în care nu se dorește să se utilizeze un serviciu, procesarea mesajului poate fi realizată în ascultător (în acest caz, un obiect de tipul <code>BroadcastReceiver</code>).
</div></p>
</p>

</div>

<h3 class="sectionedit10" id="reguli_proguard">Reguli Proguard</h3>
<div class="level3">

<p>
Se precizează regulile pentru obfuscatorul Proguard (în fișierul <code>proguard-project.txt</code> din rădăcina proiectului), astfel încât acesta să nu elimine clasele necesare:<br/>

</p>
<pre class="code java"><span class="sy0">-</span>keep <span class="kw1">class</span> <span class="sy0">*</span> <span class="kw1">extends</span> java.<span class="me1">util</span>.<a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+listresourcebundle"><span class="kw3">ListResourceBundle</span></a> <span class="br0">&#123;</span>
  <span class="kw1">protected</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+object"><span class="kw3">Object</span></a><span class="br0">&#91;</span><span class="br0">&#93;</span><span class="br0">&#91;</span><span class="br0">&#93;</span> getContents<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="sy0">-</span>keep <span class="kw1">public</span> <span class="kw1">class</span> com.<span class="me1">google</span>.<span class="me1">android</span>.<span class="me1">gms</span>.<span class="me1">common</span>.<span class="me1">internal</span>.<span class="me1">safeparcel</span>.<span class="me1">SafeParcelable</span> <span class="br0">&#123;</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">final</span> <span class="sy0">***</span> <span class="kw2">NULL</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="sy0">-</span>keepnames @com.<span class="me1">google</span>.<span class="me1">android</span>.<span class="me1">gms</span>.<span class="me1">common</span>.<span class="me1">annotation</span>.<span class="me1">KeepName</span> <span class="kw1">class</span> <span class="sy0">*</span>
<span class="sy0">-</span>keepclassmembernames <span class="kw1">class</span> <span class="sy0">*</span> <span class="br0">&#123;</span>
  @com.<span class="me1">google</span>.<span class="me1">android</span>.<span class="me1">gms</span>.<span class="me1">common</span>.<span class="me1">annotation</span>.<span class="me1">KeepName</span> <span class="sy0">*;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="sy0">-</span>keepnames <span class="kw1">class</span> <span class="sy0">*</span> <span class="kw1">implements</span> android.<span class="me1">os</span>.<span class="me1">Parcelable</span> <span class="br0">&#123;</span>
  <span class="kw1">public</span> <span class="kw1">static</span> <span class="kw1">final</span> <span class="sy0">**</span> CREATOR<span class="sy0">;</span>
<span class="br0">&#125;</span></pre>

</div>

<h2 class="sectionedit11" id="proiectarea_si_dezvoltarea_serverului_optional">Proiectarea și dezvoltarea serverului (opțional)</h2>
<div class="level2">

<p>
Arhitectura Google Cloud Messaging implică existența a două servere:
</p>

<p>
<strong>1.</strong> un <strong>server de conexiune</strong> furnizat de serviciul Google Cloud Messaging, prin intermediul căruia pot fi livrate mesaje către un client Android, transmise anterior de la un server de aplicații; la rândul său, acesta este disponibil în două variante:
</p>
<ul>
<li class="level1"><div class="li"> <a href="http://developer.android.com/google/gcm/http.html" class="urlextern" title="http://developer.android.com/google/gcm/http.html"  rel="nofollow">HTTP (Hyper Text Transfer Protocol)</a>    </div>
</li>
<li class="level1"><div class="li"> <a href="http://developer.android.com/google/gcm/ccs.html" class="urlextern" title="http://developer.android.com/google/gcm/ccs.html"  rel="nofollow">CCS (Cloud Connection Server) / XMPP (eXtensible Messaging and Presence Protocol)</a> </div>
</li>
</ul>

<p>
În alegerea uneia dintre cele două variante ale serverului de conexiune, trebuie să se țină cont de funcționalitățile puse la dispoziție de acestea:
</p>
<div class="table sectionedit12"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>FUNCȚIONALITATE</strong>  </th><th class="col1 centeralign">  <strong>HTTP</strong>  </th><th class="col2 centeralign">  <strong>CCS/XMPP</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> sens conexiune </td><td class="col1"> server GCM → client Android (unidirecțional) </td><td class="col2"> server GCM ↔ client Android (bidirecțional) </td>
	</tr>
	<tr class="row2">
		<td class="col0"> tip comunicație </td><td class="col1"> sincron<br/>
expeditorul se conectează la destinatar printr-o conexine HTTP nepersistentă, transmite o cerere POST și se blochează în așteptarea unui răspuns </td><td class="col2 leftalign"> asincron<br/>
expeditorul se conectează la destinatar printr-o conexiune XMPP persistentă, putând trimite/primi mesaje la viteză maximă (rezultatul fiind transmis sub forma unor notificări codificate utilizând același protocol)  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> corp mesaj </td><td class="col1"> text sau JSON transmise prin intermediul unei cereri HTTP POST </td><td class="col2"> JSON încapsulat într-un mesaj XMPP </td>
	</tr>
	<tr class="row4">
		<td class="col0"> destinatar multiplu </td><td class="col1"> NU (pentru mesaje text)<br/>
DA (pentru mesaje JSON) </td><td class="col2"> NU </td>
	</tr>
	<tr class="row5">
		<td class="col0"> înregistrare anterioară </td><td class="col1"> NU </td><td class="col2"> DA </td>
	</tr>
</table></div>

<p>
<p><div class="notetip">Cele două soluții pentru serverul de conexiune la serviciul Google Cloud Messaging pot fi utilizate concomitent, în funcție de specificațiile aplicației respective.
</div></p>
</p>

<p>
<strong>2.</strong> un <strong>server de aplicații</strong>, implementat de programator, pentru a transmite mesaje către serverul de conexiune Google Cloud Messaging ce vor fi livrate ulterior clientului Android (atunci când acesta devine disponibil); acesta trebuie să îndeplinească mai multe condiții:
</p>
<ul>
<li class="level1"><div class="li"> să poată comunica cu clientul Android (să fie disponibil la o adresă publică în Internet sau să facă parte din cadrul aceleiași rețele, în caz contrar);</div>
</li>
<li class="level1"><div class="li"> să construiască mesaje către serverul de conexiune Google Cloud Messaging într-un format acceptat de acesta;</div>
</li>
<li class="level1"><div class="li"> să poată stoca o cheie publică prin intermediul căreia să se autentifice în cadrul serverului de conexiune Google Cloud Messaging precum și identificatorii de identificare a clienților Android pentru a specifica locația la care trebuie livrate mesajele;</div>
</li>
<li class="level1"><div class="li"> să poată primi mesaje și să își adapteze rata de transmisie în funcție de informațiile furnizate cu privire la rezultatul acestora;</div>
</li>
<li class="level1"><div class="li"> să genereze identificatori unici pentru mesajele pe care le trimite.</div>
</li>
</ul>

<p>
<p><div class="noteclassic">În continuare, va fi prezentată structura unui mesaj folosind un server de conexiune HTTP.
</div></p>
</p>

</div>

<h3 class="sectionedit13" id="structura_unui_mesaj">Structura unui mesaj</h3>
<div class="level3">

<p>
Mesajele interschimbate între serverul de aplicații și serverul de conexiune Google Cloud Messaging de tip HTTP pot fi:
</p>
<ul>
<li class="level1"><div class="li"> o cerere de tip POST transmisă către <a href="https://android.googleapis.com/gcm/send" class="urlextern" title="https://android.googleapis.com/gcm/send"  rel="nofollow">https://android.googleapis.com/gcm/send</a> și formată din:</div>
<ul>
<li class="level2"><div class="li"> un <strong>antet</strong> care specifică informațiile necesare autentificării în cadrul serviciului Google Cloud Messaging, precum și formatul mesajului;</div>
</li>
<li class="level2"><div class="li"> un <strong>corp</strong> (în format text sau JSON) în care informațiile propriu-zise sunt conținute în perechi de tip (atribut, valoare).</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> un răspuns care conține rezultatul operației precum și alte informații suplimentare.</div>
</li>
</ul>

</div>

<h4 id="cerereserver_de_aplicatii_server_de_conexiune_gcm">Cerere: server de aplicații → server de conexiune GCM</h4>
<div class="level4">

<p>
Un mesaj transmis de serverul de aplicații către serverul de conexiune Google Cloud Messaging de tip HTTP este o cerere de tip POST ce conține informațiile ce trebuie livrate către unul sau mai multe dispozitive mobile (în momentul în care acestea vor deveni disponibile).
</p>
<pre class="code java"><span class="co1">// the address of the Google Cloud Messaging HTTP connection server </span>
<span class="co1">// to which the application server sends a POST request in order to be further transmitted to the mobile device</span>
&nbsp;
<span class="kw1">final</span> <span class="kw1">public</span> <span class="kw1">static</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> GCM_SERVER_ADDRESS <span class="sy0">=</span> <span class="st0">&quot;https://android.googleapis.com/gcm/send&quot;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// ...</span>
&nbsp;
HttpPost httpRequest <span class="sy0">=</span> <span class="kw1">new</span> HttpPost<span class="br0">&#40;</span>GCM_SERVER_ADDRESS<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Un astfel de mesaj va trebui să conțină:
</p>
<ul>
<li class="level1"><div class="li"> în antet:</div>
<ul>
<li class="level2"><div class="li"> informațiile de autentificare în cadrul serverului Google Cloud Messaging - cheia publică obținută prin intermediul Google Developer&#039;s Console, certificându-se faptul că există drepturile necesare pentru realizarea unei conexiuni de acest tip;</div>
</li>
<li class="level2"><div class="li"> informații referitoare la tipul de mesaj (text sau JSON);</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> în corp: datele propriu-zise.</div>
</li>
</ul>

</div>

<h5 id="antet">Antet</h5>
<div class="level5">

<p>
În cadrul antetului cererii de tip POST trebuie să fie incluse câmpurile:
</p>
<ul>
<li class="level1"><div class="li"> <code>Authorization</code> - conține informațiile necesare procesului de autentificare în cadrul serverului Google Cloud Messaging, având forma <code>key=</code>, urmată de cheia publică furnizată prin intermediul Google Developer&#039;s Console.</div>
</li>
<li class="level1"><div class="li"> <code>Content-Type</code> - indică tipul pe care îl are corpul mesajului, acesta putând fi text (<code>application/x-www-form-urlencoded;charset=UTF-8</code>) sau JSON (<code>application/json</code>).</div>
</li>
</ul>

<p>
<p><div class="notetip">În situația în care nu este inclus câmpul <code>Content-Type</code>, se așteaptă ca mesajul să aibă un corp de tip text.
</div></p>
</p>
<pre class="code java"><span class="co3">/**
 * HTTP headers
 * 
 * Authorization: key=API key provided from Google Developer Console
 * Content-Type: the format of the HTTP body (may be omitted for plain text)
 *   - application/x-www-form-urlencoded;charset=UTF-8 for plain text
 *   - application/json for JSON
 *
 */</span>
httpRequest.<span class="me1">setHeader</span><span class="br0">&#40;</span><span class="st0">&quot;Authorization&quot;</span>, <span class="st0">&quot;key=&quot;</span> <span class="sy0">+</span> Constants.<span class="me1">API_KEY</span><span class="br0">&#41;</span><span class="sy0">;</span>
httpRequest.<span class="me1">setHeader</span><span class="br0">&#40;</span><span class="st0">&quot;Content-Type&quot;</span>, <span class="st0">&quot;application/json&quot;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>

<h5 id="corp">Corp</h5>
<div class="level5">

<p>
Informațiile conținute de corpul unei cereri de tip POST au forma unor perechi (cheie, valoare), fiind definită o serie de parametrii standard, în funcție de formatul în care este transmis mesajul.
</p>
<div class="table sectionedit14"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>PARAMETRU</strong>  </th><th class="col1 centeralign">  <strong>DESCRIERE</strong>  </th><th class="col2 centeralign">  <strong>text</strong>  </th><th class="col3 centeralign">  <strong>JSON</strong>  </th><th class="col4 centeralign">  <strong>obligativitate</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>registration_id</code> </td><td class="col1"> un identificator de înregistrare descriind dispozitivul mobil către care se dorește să se livreze mesajul respectiv </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✘  </td><td class="col4 centeralign">  ✔  </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>registration_ids</code> </td><td class="col1"> o listă conținând 1-1000 identificatori de înregistrare indicând dispozitivele mobile către care se dorește să se livreze mesajul respectiv </td><td class="col2 centeralign">  ✘  </td><td class="col3 centeralign">  ✔  </td><td class="col4 centeralign">  ✔  </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>notification_key</code> </td><td class="col1"> șir de caractere asociat mai multor dispozitive mobile (1-10) ce aparțin aceluiași utilizator </td><td class="col2 leftalign">  </td><td class="col3 leftalign">  </td><td class="col4 centeralign">  ✔  </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>collapse_key</code> </td><td class="col1"> șir de caractere (aleator, definit de utilizator) folosit pentru a identifica mesajele de același tip, astfel încât, pe serverul Google Cloud Messaging să se stocheze doar cea mai recentă valoare asociată, în scopul optimizării traficului de mesaje către dispozitivul mobil (dacă acesta nu este disponibil la un moment dat și au fost transmise mai multe mesaje, va fi stocat doar cel mai recent); se  permite stocarea a maximum 4 chei de acest tip pe serverul Google Cloud Messaging </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✔  </td><td class="col4 leftalign">  </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>data</code> </td><td class="col1"> obiect JSON format din perechi (atribut, valoare) reprezentând conținutul propriu-zis al mesajului, acestea fiind incluse în cadrul intenției sub forma unui obiect <code>Bundle</code> (ca <code>extras</code>), având aceeași structură;<br/>
atributul poate avea orice valoare, cu excepția unor cuvinte rezervate (<code>from</code>, <code>google.*</code>), evitându-se pe cât posibil folosirea denumirilor de parametri, întrucât aceștia vor fi suprascriși;<br/>
pentru valoare poate fi utilizat orice tip de obiect JSON, însă la nivelul serverului Google Cloud Messaging se face conversia la șiruri de caractere;<br/>
<br/>
dimensiunea obiectului este limitată la 4kb;<br/>
nu există limitări în privința numărului de perechi (atribut, valoare); </td><td class="col2 centeralign">   ✔ <code>data.&lt;atribut&gt;</code>  </td><td class="col3 centeralign">   ✔   </td><td class="col4 leftalign">  </td>
	</tr>
	<tr class="row6">
		<td class="col0"> <code>delay_while_idle</code> </td><td class="col1"> indică faptul că mesajul nu trebuie transmis imediat dacă dispozitivul se află într-o stare de inactivitate, urmând a fi livrat în momentul în care acesta devine activ; valoarea implicită este <code>false</code> </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✔  </td><td class="col4 leftalign">  </td>
	</tr>
	<tr class="row7">
		<td class="col0"> <code>time_to_live</code> </td><td class="col1"> durata de stocare a mesajului pe serverul Google Cloud Messaging (exprimată în secunde) în situația în care dispozitivul mobil nu este disponibil; valoarea implicită este de 4 săptămâni </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✔  </td><td class="col4 leftalign">  </td>
	</tr>
	<tr class="row8">
		<td class="col0"> <code>restricted_package_name</code> </td><td class="col1"> șir de caractere referind denumirea pachetului corespunzător unei aplicații Android, astfel încât mesajul să fie livrat doar acelor identificatori de înregistrare care au fost generați pentru acesta </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✔  </td><td class="col4 leftalign">  </td>
	</tr>
	<tr class="row9">
		<td class="col0"> <code>dry_run</code> </td><td class="col1"> utilizat în scop de testare, pentru a verifica funcționalitatea cererii de tip POST fără a transmite propriu-zis un mesaj către dispozitivul mobil; valoarea implicită este <code>false</code> </td><td class="col2 centeralign">  ✔  </td><td class="col3 centeralign">  ✔  </td><td class="col4 leftalign">  </td>
	</tr>
</table></div>

<p>
<p><div class="notetip">Locația (dispozitivul mobil) către care va fi livrat un mesaj trebuie să fie specificată fie prin parametrul <code>registration_id</code> / <code>registration_ids</code>, fie prin parametrul <code>notification_key</code>.
</div></p>
</p>

<p>
<p><div class="noteimportant">Pentru mesajele de tip text, se va defini câte un parametru <code>data.&lt;atribut&gt;</code> pentru fiecare informație, asociindu-i-se valoarea respectivă. În această situație, se mențin restricțiile din cazul mesajelor de tip JSON.
</div></p>
</p>
<pre class="code java"><span class="co3">/**
 * HTTP body
 * 
 * -&gt; registration_id/registration_ids indicates the recipient/recipients
 * (for each mobile device to which the message is to be transmitted the message must specify
 * the id provided by the GCM server during the registration process)
 *
 * -&gt; data contains the payload to be transmitted; the developer may define its own keys
 * 
 * -&gt; other fields: collapse_key, delay_while_idle, time_to_live, restricted_package_name, dry_run
 * 
 * The complete list of the message parameters can be found out at: 
 * http://developer.android.com/google/gcm/server.html#params
 */</span>
&nbsp;
JSONObject requestBody <span class="sy0">=</span> <span class="kw1">new</span> JSONObject<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
JSONArray registrationIds <span class="sy0">=</span> <span class="kw1">new</span> JSONArray<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
registrationIds.<span class="me1">add</span><span class="br0">&#40;</span>registrationId<span class="br0">&#41;</span><span class="sy0">;</span>
requestBody.<span class="me1">put</span><span class="br0">&#40;</span>Constants.<span class="me1">REGISTRATION_IDS</span>, registrationIds<span class="br0">&#41;</span><span class="sy0">;</span>
JSONObject payload <span class="sy0">=</span> <span class="kw1">new</span> JSONObject<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
payload.<span class="me1">put</span><span class="br0">&#40;</span>Constants.<span class="me1">MESSAGE</span>, message<span class="br0">&#41;</span><span class="sy0">;</span>
requestBody.<span class="me1">put</span><span class="br0">&#40;</span>Constants.<span class="me1">DATA</span>, payload<span class="br0">&#41;</span><span class="sy0">;</span></pre>

</div>
<div class="level4">

<p>
O astfel de cerere va avea forma:
</p>
<pre class="code">Authorization:key=...
Content-Type:application/json
{
 &quot;registration_ids&quot;: [&quot;...&quot;],
 &quot;data&quot;: {
   &quot;message&quot;: &quot;...&quot;
 }
}</pre>

<p>
Ulterior construirii cererii, aceasta va trebui transmisă, operația fiind realizată sincron, producând blocarea metodei în așteptarea răspunsului de la server:
</p>
<pre class="code java">CloseableHttpClient httpClient <span class="sy0">=</span> HttpClients.<span class="me1">custom</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">setSSLHostnameVerifier</span><span class="br0">&#40;</span><span class="kw1">new</span> NoopHostnameVerifier<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>.<span class="me1">build</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// ...</span>
&nbsp;
httpRequest.<span class="me1">setEntity</span><span class="br0">&#40;</span><span class="kw1">new</span> StringEntity<span class="br0">&#40;</span>JSONValue.<span class="me1">toJSONString</span><span class="br0">&#40;</span>requestBody<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// send the request</span>
HttpResponse httpResponse <span class="sy0">=</span> httpClient.<span class="me1">execute</span><span class="br0">&#40;</span>httpRequest<span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
<p><div class="notewarning">În situația în care comunicația dintre serverul de aplicații și serverul Google Cloud Messaging nu poate fi realizată, ar trebui investigată posibilitatea blocării porturilor pe care se realizează transmisia de mesaje (de obicei 5228, dar și 5529, respectiv 5530).
</div></p>
</p>

</div>

<h4 id="raspunsserver_de_conexiune_gcm_server_de_aplicatii">Răspuns: server de conexiune GCM → server de aplicații</h4>
<div class="level4">

<p>
Răspunsul transmis de serverul de conexiune la Google Cloud Messaging către serverul de aplicații conține rezultatul operației solicitate, acesta putând fi investigat prin intermediul codului de stare:
</p>
<pre class="code java"><span class="kw4">int</span> responseCode <span class="sy0">=</span> httpResponse.<span class="me1">getStatusLine</span><span class="br0">&#40;</span><span class="br0">&#41;</span>.<span class="me1">getStatusCode</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Aceasta poate avea valorile:
</p>
<ul>
<li class="level1"><div class="li"> <code>200</code> - dacă mesajul a fost procesat cu succes;</div>
</li>
<li class="level1"><div class="li"> o valoare diferită de <code>200</code> - în situația în care mesajul a fost respins de serverul Google Cloud Messaging.</div>
</li>
</ul>

</div>

<h5 id="mesaj_procesat_cu_succes">Mesaj procesat cu succes</h5>
<div class="level5">

<p>
În situația în care mesajul a fost procesat cu succes, codul de stare returnat este 200, iar corpul răspunsului conține informații suplimentare, reprezentate sub forma unor perechi de tip (atribut, valoare) în care există un set de parametri predefiniți.
</p>

<p>
<strong> text </strong>
</p>

<p>
Există două variante de răspunsuri:
</p>
<ol>
<li class="level1"><div class="li"> mesaj care a fost procesat cu succes <pre class="code">1: id=identificatorul mesajului care a fost transmis
2(opțional): registration_id=identificator de înregistrare canonic al dispozitivului mobil stocat pe serverul Google Cloud Messaging</pre>
</div>
</li>
<li class="level1"><div class="li"> mesaj care nu a fost procesat cu succes <pre class="code">1: Error=cod de eroare furnizat de serverul Google Cloud Messaging</pre>
</div>
</li>
</ol>

<p>
Algoritmul de procesare a unui răspuns este următorul:
</p>
<pre class="code">if (firstLine.startsWith(&quot;id&quot;)) {
  if (secondLine.equals(&quot;registration_id&quot;)) {
    old_registration_id = get registration_id from the request field
    replace old_registration_id with new registration_id in the request / application server database
  }
} else {
  switch(Error) {
    case &quot;NotRegistered&quot;:
      // the application was uninstalled from the device
      // or it does not have a broadcast receiver in order to process com.google.android.c2dm.intent.RECEIVE intents
      remove the registration ID from the application server database
      break;
    default:
      // non-recoverable error regarding the registration ID
      remove the registration ID from the application server database
      break;
  }
}</pre>

<p>
<strong> JSON </strong>
</p>
<div class="table sectionedit15"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>PARAMETRU</strong>  </th><th class="col1 centeralign">  <strong>DESCRIERE</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>multicast_id</code> </td><td class="col1"> identificator unic ce reprezintă un mesaj transmis către mai multe dispozitive mobile </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>success</code> </td><td class="col1"> numărul de mesaje care au fost procesate cu succes </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>failure</code> </td><td class="col1"> numărul de mesaje care nu au fost procesate cu succes </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>canonical_ids</code> </td><td class="col1"> număr de rezultate care conțin un identificator de înregistrare canonic </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>results</code> </td><td class="col1"> listă de obiecte conținând starea mesajelor procesate, în ordinea în care au fost incluse în cadrul solicitării (pe baza identificatorului de înregistrare):<br/>
♦ <code>message_id</code>: șir de caractere reprezentând mesajul respectiv, în situația în care a fost procesat cu succes<br/>
♦ <code>registration_id</code>: în situația în care este inclus, specifică faptul că mesajul a fost procesat, dar serverul Google Cloud Messaging deține un alt identificator de înregistrare canonic pentru dispozitivul mobil, astfel încât solicitările ulterioare ar trebui să îl utilizeze pentru a nu fi respinse; nu este inclus dacă s-a produs o eroare<br/>
♦ <code>error</code>: șir de caractere indicând eroarea ce s-a produs în timpul procesării mesajului; valoarea <code>Unavailable</code> indică faptul că serverul Google Cloud Messaging nu era disponibil la momentul transmiterii solicitării, astfel încât aceasta trebuie retransmisă </td>
	</tr>
</table></div>

<p>
Algoritmul de procesare a unui răspuns este următorul:
</p>
<pre class="code">if (failure != 0 &amp;&amp; canonical_ids != 0) {
  for-each (result ∈ results) {
    if (result.registration_id) {
      // the old registration ID is not included within the response
      old_registration_id = get registration_id from the request field registration_ids, having the same index
            
      replace old_registration_id with new result.registration_id in the request
    } else {
      switch(error) {
        case &quot;Unavailable&quot;:
          retry sending the request
          break;
        case &quot;NotRegistered&quot;:
          // the application was uninstalled from the device
          // or it does not have a broadcast receiver in order to process com.google.android.c2dm.intent.RECEIVE intents
          remove the registration ID from the application server database
          break;
        default:
          // non-recoverable error regarding the registration ID
          remove the registration ID from the application server database
          break;
      }
    }
  }
}</pre>

</div>

<h5 id="mesaj_respins_de_serverul_google_cloud_messaging">Mesaj respins de serverul Google Cloud Messaging</h5>
<div class="level5">

<p>
În situația în care mesajul a fost respins de serverul Google Cloud Messaging, pot fi returnate mai multe coduri de stare:
</p>
<div class="table sectionedit16"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  <strong>COD DE STARE</strong>  </th><th class="col1 centeralign">  <strong>DESCRIERE</strong>  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 400 </td><td class="col1"> (doar pentru mesaje JSON) eroare ce indică faptul că mesajul nu a putut fi parsat ca JSON sau conține câmpuri invalide (fie atribute - denumire, fie valoare), detalii suplimentare fiind incluse în corpul mesajului pentru a remedia problema înainte de retransmisie </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 401 </td><td class="col1"> eroare privind procesul de autentificare a serverului de aplicații în cadrul serverului Google Cloud Messaging </td>
	</tr>
	<tr class="row3">
		<td class="col0"> 5xx </td><td class="col1"> eroare în cadrul serverului Google Cloud Messaging (în timpul procesării mesajului) sau indisponibilitate temporară a acestuia; mesajul trebuie transmis potrivit informațiilor furnizate de antetul <code>Retry-After</code> </td>
	</tr>
</table></div>

<p>
Cele mai frecvente tipuri de erori sunt:
</p>
<ul>
<li class="level1"><div class="li"> <code>MissingRegistration</code> - cauzată de faptul că nu se include câmpul <code>registration_id</code> (text) / <code>registration_ids</code> (JSON) în corpul mesajului;</div>
</li>
<li class="level1"><div class="li"> <code>InvalidRegistration</code> - valoarea identificatorului de înregistrare trimisă prin mesaj este diferită de valoarea primită de telefon prin intenția <code>com.google.android.c2dm.intent.REGISTRATION</code>;</div>
</li>
<li class="level1"><div class="li"> <code>MismatchSenderId</code> - utilizatorul care a transmis mesajul nu are permisiunea de a o face (în cadrul procesului de înregistrare a dispozitivului mobil se precizează care sunt utilizatorii care pot transmite mesaje);</div>
</li>
<li class="level1"><div class="li"> <code>NotRegistered</code> - identificatorul de înregistrare nu mai este valid, în următoarele cazuri:</div>
<ul>
<li class="level2"><div class="li"> aplicația Android anulează înregistrarea la serverul Google Cloud Messaging folosind o intenție de tip <code>com.google.android.c2dm.intent.UNREGISTER</code>;</div>
</li>
<li class="level2"><div class="li"> aplicația Android a fost actualizată astfel încât să nu mai prelucreze intenții de tip <code>com.google.android.c2dm.intent.RECEIVE</code>.</div>
</li>
<li class="level2"><div class="li"> aplicația Android a fost dezinstalată de pe dispozitivul mobil (în acest caz, nu se garantează că procesul de anulare a înregistrării la Google Cloud Messaging va fi realizată automat);</div>
</li>
<li class="level2"><div class="li"> identificatorul de înregistrare a expirat;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>MessageTooBig</code> - dimensiunea mesajului propriu-zis (atât a valorilor, cât și a atributelor) depășește 4096 octeți</div>
</li>
<li class="level1"><div class="li"> <code>InvalidDataKey</code> - mesajul propriu-zis include parametrii care sunt rezervați (<code>from</code>, <code>google.*</code>) spre a fi utilizați de intenția <code>com.google.android.c2dm.intent.RECEIVE</code>;</div>
</li>
<li class="level1"><div class="li"> <code>InvalidTtl</code> - valoarea parametrului <code>time_to_live</code> nu este o valoare întreagă (exprimând o durată de timp, în secunde) cuprinsă între 0 și 2419200 (4 săptămâni);</div>
</li>
<li class="level1"><div class="li"> cod de stare 401 - utilizatorul care a transmis un mesaj către serverul Google Cloud Messaging nu a putut fi autentificat datorită uneia dintre următoarele cauze:</div>
<ul>
<li class="level2"><div class="li"> lipsește câmpul <code>Authorization</code> din antetul mesajului sau a fost folosită o sintaxă incorectă;</div>
</li>
<li class="level2"><div class="li"> este folosit un număr de proiect invalid drept cheie publică;</div>
</li>
<li class="level2"><div class="li"> cheia publică este validă, însă serviciul Google Cloud Messaging este dezactivat pentru contul care a transmis mesajul respectiv;</div>
</li>
<li class="level2"><div class="li"> mesajul a fost transmis de pe un server de aplicații de la o adresă Internet care nu a fost precizată la momentul în care a fost generată cheia publică.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>InternalServerError</code> / cod de stare 500 - s-a produs o eroare pe serverul Google Cloud Messaging la procesarea mesajului, acesta trebuind retransmis; în cazul în care problema persistă, aceasta trebuie raportată la <a href="https://groups.google.com/forum/?fromgroups#!forum/android-gcm" class="urlextern" title="https://groups.google.com/forum/?fromgroups#!forum/android-gcm"  rel="nofollow">https://groups.google.com/forum/?fromgroups#!forum/android-gcm</a>;</div>
</li>
<li class="level1"><div class="li"> <code>Unavailable</code> / cod de stare 501-599 - mesajul nu a putut fi procesat de serverul Google Cloud Messaging în timp util și trebuie retransmis ținând cont de următoarele recomandări:</div>
<ul>
<li class="level2"><div class="li"> dacă este inclus antetul <code>Retry-After</code>, trebuie respectată valoarea indicată;</div>
</li>
<li class="level2"><div class="li"> trebuie implementat un mecanism de adaptare a transmisiei (<em>eng.</em> exponential back-off), astfel încât perioada după care se retransmite un mesaj să fie modificată în mod exponențial după o încercare eșuată; în cazul în care se transmit mai multe mesaje, acestea trebuie tratate independent; utilizatorilor care transmit prea multe mesaje către serverul Google Cloud Messaging li se refuză accesul ulterior;</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <code>InvalidPackageName</code> - mesajul a fost transmis folosind un identificator de înregistrare</div>
</li>
</ul>

</div>

<h3 class="sectionedit17" id="tratarea_cererilor_de_inregistrare">Tratarea cererilor de înregistrare</h3>
<div class="level3">

<p>
Un server de aplicații trebuie să trateze și mesajele provenite de la clientul Android (cereri de înregistrare), stocând informațiile referitoare la identificatorii de înregistrare în baza de date locală, pentru a fi utilizate ulterior, când se dorește precizarea unei locații către care să fie livrat un mesaj.
</p>

<p>
Comunicația dintre clientul Android și serverul de aplicații poate folosi un protocol de comunicație definit de utilizator, folosind propriile reguli pentru definirea mesajelor schimbate între aceste entități.
</p>
<pre class="code java">@Override
<span class="kw1">public</span> <span class="kw4">void</span> doPost<span class="br0">&#40;</span>HttpServletRequest request, HttpServletResponse response<span class="br0">&#41;</span> <span class="kw1">throws</span> ServletException, <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+ioexception"><span class="kw3">IOException</span></a> <span class="br0">&#123;</span>
  Enumeration<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> parameters <span class="sy0">=</span> request.<span class="me1">getParameterNames</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> registrationId <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> username <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
  <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> email <span class="sy0">=</span> <span class="kw2">null</span><span class="sy0">;</span>
&nbsp;
  <span class="kw1">while</span> <span class="br0">&#40;</span>parameters.<span class="me1">hasMoreElements</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a> parameter <span class="sy0">=</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+string"><span class="kw3">String</span></a><span class="br0">&#41;</span>parameters.<span class="me1">nextElement</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw1">if</span> <span class="br0">&#40;</span>parameter.<span class="me1">equals</span><span class="br0">&#40;</span>Constants.<span class="me1">REGISTRATION_ID</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
      registrationId <span class="sy0">=</span> request.<span class="me1">getParameter</span><span class="br0">&#40;</span>parameter<span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
     <span class="kw1">if</span> <span class="br0">&#40;</span>parameter.<span class="me1">equals</span><span class="br0">&#40;</span>Constants.<span class="me1">USERNAME</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       username <span class="sy0">=</span> request.<span class="me1">getParameter</span><span class="br0">&#40;</span>parameter<span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
     <span class="kw1">if</span> <span class="br0">&#40;</span>parameter.<span class="me1">equals</span><span class="br0">&#40;</span>Constants.<span class="me1">EMAIL</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
       email <span class="sy0">=</span> request.<span class="me1">getParameter</span><span class="br0">&#40;</span>parameter<span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span>
   <span class="br0">&#125;</span>
&nbsp;
   <span class="kw1">if</span> <span class="br0">&#40;</span>registrationId <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>registrationId.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span>
       username <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>username.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="sy0">&amp;&amp;</span>
       email <span class="sy0">!=</span> <span class="kw2">null</span> <span class="sy0">&amp;&amp;</span> <span class="sy0">!</span>email.<span class="me1">isEmpty</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
     ArrayList<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> columnNames <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
     columnNames.<span class="me1">add</span><span class="br0">&#40;</span>Constants.<span class="me1">REGISTRATION_ID</span><span class="br0">&#41;</span><span class="sy0">;</span>
     columnNames.<span class="me1">add</span><span class="br0">&#40;</span>Constants.<span class="me1">USERNAME</span><span class="br0">&#41;</span><span class="sy0">;</span>
     columnNames.<span class="me1">add</span><span class="br0">&#40;</span>Constants.<span class="me1">EMAIL</span><span class="br0">&#41;</span><span class="sy0">;</span>
     ArrayList<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span> values <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>String<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
     values.<span class="me1">add</span><span class="br0">&#40;</span>registrationId<span class="br0">&#41;</span><span class="sy0">;</span>
     values.<span class="me1">add</span><span class="br0">&#40;</span>username<span class="br0">&#41;</span><span class="sy0">;</span>
     values.<span class="me1">add</span><span class="br0">&#40;</span>email<span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
     <span class="kw1">try</span> <span class="br0">&#123;</span>
       dataBaseWrapper.<span class="me1">insertValuesIntoTable</span><span class="br0">&#40;</span>Constants.<span class="me1">TABLE_NAME</span>, columnNames, values, <span class="kw2">false</span><span class="br0">&#41;</span><span class="sy0">;</span>
     <span class="br0">&#125;</span> <span class="kw1">catch</span> <span class="br0">&#40;</span><a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+sqlexception"><span class="kw3">SQLException</span></a> <span class="sy0">|</span> DataBaseException exception<span class="br0">&#41;</span> <span class="br0">&#123;</span>
       <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+system"><span class="kw3">System</span></a>.<span class="me1">out</span>.<span class="me1">println</span><span class="br0">&#40;</span><span class="st0">&quot;An exception has occurred: &quot;</span><span class="sy0">+</span>exception.<span class="me1">getMessage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="kw1">if</span> <span class="br0">&#40;</span>Constants.<span class="me1">DEBUG</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
         exception.<span class="me1">printStackTrace</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
       <span class="br0">&#125;</span>
     <span class="br0">&#125;</span> 
     response.<span class="me1">setStatus</span><span class="br0">&#40;</span>HttpServletResponse.<span class="me1">SC_OK</span><span class="br0">&#41;</span><span class="sy0">;</span> 
   <span class="br0">&#125;</span> <span class="kw1">else</span> <span class="br0">&#123;</span>
     response.<span class="me1">setStatus</span><span class="br0">&#40;</span>HttpServletResponse.<span class="me1">SC_BAD_REQUEST</span><span class="br0">&#41;</span><span class="sy0">;</span>
   <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>

<p>
Se observă faptul că se prelucrează cererea de tip POST, iterându-se pe toți parametrii incluși în scopul identificării valorilor asociate atributelor denumite nume de utilizator, adresă de poștă electronică și identificator de înregistrare (conform protocolului de comunicație definit de utilizator), aceștia fiind stocați în baza de date locală pentru a fi utilizați în transmiterea ulterioară a unui mesaj.
</p>

<p>
<p><div class="noteimportant">Este foarte important să fie specificată o stare în cadrul răspunsului (prin apelul metodei <code>setStatus()</code> a obiectului <code>HttpServletResponse</code>) desemnând rezultatul procesării mesajului, în caz contrar clientul Android blocându-se până la expirarea perioadei de timp pentru așteptare (<em>eng.</em> timeout).
</div></p>
</p>

</div>

<h2 class="sectionedit18" id="activitate_de_laborator">Activitate de Laborator</h2>
<div class="level2">

<p>
<strong>1.</strong> Să se acceseze <a href="https://code.google.com/apis/console/" class="urlextern" title="https://code.google.com/apis/console/"  rel="nofollow">Google Developer&#039;s Console</a>, după ce a fost realizată autentificarea cu datele contului Google (nume de utilizator, parolă):
</p>
<ul>
<li class="level1"><div class="li"> se generează un număr de proiect;</div>
</li>
<li class="level1"><div class="li"> se activează serviciul Google Cloud Messaging;</div>
</li>
<li class="level1"><div class="li"> se generează o cheie publică pentru transmiterea de mesaje provenind de la un server, indiferent de adresa Internet la care se găsește acesta.</div>
</li>
</ul>

<p>
Mai multe detalii pot fi obținute în secțiunea <a href="laborator08.html#configurare" class="wikilink1" title="eim:laboratoare:laborator08">Configurare</a>.
</p>

<p>
<p><div class="noteclassic">În cazul în care nu dispuneți de un cont Google, acesta va trebui creat înainte de a implementa aceste cerințe.
</div></p>
</p>

<p>
<p><div class="noteimportant">Aceste valori nu vor fi utilizate decât împreună, altfel se vor genera erori de tipul <code>MismatchSenderId</code>.
</div></p>
</p>

</div>

<h3 class="sectionedit19" id="clientul_android">Clientul Android</h3>
<div class="level3">

<p>
<strong>2.</strong> În contul Github personal, să se creeze un depozit denumit &#039;Laborator08-Client&#039;. Inițial, acesta trebuie să fie gol (nu trebuie să bifați nici adăugarea unui fișier <code>README.md</code>, nici a fișierului <code>.gitignore</code> sau a a fișierului <code>LICENSE</code>).
</p>

<p>
<strong>3.</strong> Să se cloneze în directorul de pe discul local conținutul depozitului la distanță de la <a href="https://www.github.com/pdsd2015/Laborator08-Client" class="urlextern" title="https://www.github.com/pdsd2015/Laborator08-Client"  rel="nofollow">https://www.github.com/pdsd2015/Laborator08-Client</a>. 
</p>

<p>
În urma acestei operații, directorul Laborator08-Client va trebui să se conțină directoarele <code>labtasks</code> și <code>solutions</code>. 
</p>
<pre class="code">student@pdsd2015:~$ git clone https://www.github.com/pdsd2015/Laborator08-Client</pre>

<p>
<strong>4.</strong> Să se încarce conținutul descărcat în cadrul depozitului &#039;Laborator08-Client&#039; de pe contul Github personal. 
</p>
<pre class="code">student@pdsd2015:~$ cd Laborator08-Client
student@pdsd2015:~/Laborator08-Client$ git remote add Laborator08-Client_perfectstudent https://github.com/perfectstudent/Laborator08-Client
student@pdsd2015:~/Laborator08-Client$ git push Laborator08-Client_perfectstudent master</pre>

<p>
<strong>5.</strong> Să se importe în mediul integrat de dezvoltare Eclipse Luna SR1a (4.4.1) proiectele <code>google-play-service_lib</code> și <code>GoogleCloudMessagingClient</code> din directorul <code>labtasks</code> (în această ordine).
</p>

<p>
Să se configureaze mașina pe care va rula aplicația:
</p>
<ul>
<li class="level1"><div class="li"> în cazul în care se utilizează un emulator, se configurează astfel încât acesta să aibă instalat Google Play Services;</div>
</li>
<li class="level1"><div class="li"> în cazul în care se utilizează un dispozitiv fizic, acesta trebuie să ruleze un sistem de operare Android cu o versiune ulterioară 2.2, având asociat un cont Google.</div>
</li>
</ul>

<p>
<p><div class="noteclassic">În situația în care nu se reușește configurarea unui dispozitiv virtual, se poate folosi <a href="http://pdsd2015.andreirosucojocaru.ro/resources/Genymobile.tar.gz" class="urlextern" title="http://pdsd2015.andreirosucojocaru.ro/resources/Genymobile.tar.gz"  rel="nofollow">o imagine Nexus S (API 16)</a> care trebuie plasată în directorul <code>$HOME</code>.
</div></p>
</p>

<p>
Mai multe detalii pot fi obținute în secțiunea <a href="laborator08.html#configurare_client" class="wikilink1" title="eim:laboratoare:laborator08">Configurare client</a>
</p>

<p>
<strong>6.</strong> În interfața <code>ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.general.Constants</code>, trebuie modificate următoarele valori, <em class="u"><strong>numai în situația în care se folosește un server web Apache Tomcat</strong></em>:
</p>
<ul>
<li class="level1"><div class="li"> <code>PROJECT_NUMBER</code> - cu numărul de proiect generat de consola Google <abbr title="Application Programming Interface">API</abbr>;</div>
</li>
<li class="level1"><div class="li"> adresele Internet pentru serviciile care expun funcționalități către dispozitivul mobil:</div>
<ul>
<li class="level2"><div class="li"> dispozitiv mobil - adresa Internet indicată ca default gateway a rețelei de calculatoare din care fac parte dispozitivul mobil și mașina pe care se găsește serverul de aplicații;</div>
</li>
<li class="level2"><div class="li"> AVD - 10.0.2.1;</div>
</li>
<li class="level2"><div class="li"> Genymotion - 192.168.56.1.</div>
</li>
</ul>
</li>
</ul>

<p>
<p><div class="notetip">Portul pe care rulează serverul web Apache Tomcat este de regulă 8080 (dacă nu s-au realizat alte modificări în fișierul de configurare <code>server.xml</code>). În situația în care, în momentul în care se încearcă să se realizeze conexiunea la serverul de aplicații, se obține o excepție de tip <em>Timeout</em> / <em>Connection Refused</em>, investigați dacă este permisă comunicația pe portul respectiv.
</div></p>
</p>

<p>
<strong>7.</strong> Să se ruleze aplicația Android și să se genereze identificatorul de înregistrare, care va fi transmis către serverul de aplicații prin accesarea butonului <code>Send Registration ID</code>.
</p>

<p>
<img src="../../_media/eim/laboratoare/laborator08/mobile_device_application01.png%3Fw=400&amp;tok=c0e11a" class="mediacenter" alt="" width="400" />
</p>

<p>
<img src="../../_media/eim/laboratoare/laborator08/mobile_device_application02.png%3Fw=400&amp;tok=8d3426" class="mediacenter" alt="" width="400" />
</p>

<p>
În fragmentul <code>UnregisteredFragment</code> din pachetul <code>ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.view</code>, pe clasa ascultător asociată butonului, să se transmită o cerere HTTP de tip POST către componenta din serverul de aplicații, responsbilă cu înregistrarea dispozitivelor mobile (disponibilă la <code>Constants.DEVICE_REGISTRATION_SERVICE_ADDRESS</code>).
</p>

<p>
Aceasta va conține următorii parametrii:
</p>
<ul>
<li class="level1"><div class="li"> <code>Constants.USERNAME</code> - numele de utilizator din câmpul text;</div>
</li>
<li class="level1"><div class="li"> <code>Constants.EMAIL</code> - adresa de poștă electronică din câmpul text;</div>
</li>
<li class="level1"><div class="li"> <code>Constants.REGISTRATION_ID</code> - identificatorul de înregistrare furnizat de serviciul Google Cloud Messaging.</div>
</li>
</ul>

<p>
Codificarea utilizată pentru această comunicație este UTF-8.
</p>

<p>
În situația în care codul întors pe linia de stare în răspuns este 200, se va întoarce rezultatul <code>Constants.SUCCESS</code>.
</p>

<p>
<strong>8.</strong> În situația în care înregistrarea a fost realizată cu succes, interfața grafică a aplicației este modificată în sensul în care se dorește afișarea unei liste cu utilizatorii care au fost înregistrați deja, către care se dorește transmiterea unui mesaj de notificare.
</p>

<p>
<img src="../../_media/eim/laboratoare/laborator08/mobile_device_application03.png%3Fw=400&amp;tok=6bb3dd" class="mediacenter" alt="" width="400" />
</p>

<p>
<strong>a)</strong> Pe firul de execuție <code>RegisteredDevicesFetcher</code> din fragmentul <code>RegisteredFragment</code>, să se transmită o cerere HTTP de tip GET către către componenta din serverul de aplicații, responsbilă cu furnizarea listei dispozitivelor mobile înregistrate, în format JSON (disponibilă la <code>Constants.REGISTERED_DEVICES_SERVICE_ADDRESS</code>).
</p>

<p>
Să se prelucreze documentul JSON obținut, astfel încât prin intermediul acestuia să se populeze un tablou de obiecte <code>RegisteredDevice</code>, transmis ca parametru adaptorului obiectului de tip <code>Spinner</code> în care pot fi vizualizate astfel de informații.
</p>
<pre class="code java"><span class="kw1">final</span> ArrayList<span class="sy0">&lt;</span>RegisteredDevice<span class="sy0">&gt;</span> registeredDevices <span class="sy0">=</span> <span class="kw1">new</span> ArrayList<span class="sy0">&lt;</span>RegisteredDevice<span class="sy0">&gt;</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="co1">// ...</span>
registeredDevicesSpinner.<span class="me1">post</span><span class="br0">&#40;</span><span class="kw1">new</span> <a href="http://www.google.com/search?hl=en&amp;q=allinurl%3Adocs.oracle.com+javase+docs+api+runnable"><span class="kw3">Runnable</span></a><span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
  @Override
  <span class="kw1">public</span> <span class="kw4">void</span> run<span class="br0">&#40;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
    RegisteredDevicesAdapter registeredDevicesAdapter <span class="sy0">=</span> <span class="kw1">new</span> RegisteredDevicesAdapter<span class="br0">&#40;</span>getActivity<span class="br0">&#40;</span><span class="br0">&#41;</span>, registeredDevices<span class="br0">&#41;</span><span class="sy0">;</span>
    registeredDevicesSpinner.<span class="me1">setAdapter</span><span class="br0">&#40;</span>registeredDevicesAdapter<span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>

<p>
Documentul JSON conține informații despre identificatorul din baza de date, identificatorul de înregistrare furnizat de serverul GoogleCloudMessaging, numele de utilizator, adresa de poștă electronică și momentul de timp la care a fost realizată înregistratrea.
</p>
<pre class="code json">[
  {
    &quot;id&quot;: ...,
    &quot;registration_id&quot;: &quot;...&quot;,
    &quot;username&quot;: &quot;...&quot;,
    &quot;email&quot;: &quot;...&quot;,
    &quot;timestamp&quot;: &quot;...&quot;,
  },
  ...
]</pre>
<div class="table sectionedit20"><table class="inline">
	<tr class="row0">
		<th class="col0 centeralign">  atribut JSON  </th><th class="col1 centeralign">  tip de date  </th><th class="col2 centeralign">  detaliu  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> <code>Constants.ID</code> </td><td class="col1"> <code>int</code> </td><td class="col2"> identificator în baza de date </td>
	</tr>
	<tr class="row2">
		<td class="col0"> <code>Constants.REGISTRATION_ID</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> identificator de înregistrare furnizat de serverul Google Cloud Messaging </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <code>Constants.USERNAME</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> numele de utilizator </td>
	</tr>
	<tr class="row4">
		<td class="col0"> <code>Constants.EMAIL</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> adresa de poștă electonică </td>
	</tr>
	<tr class="row5">
		<td class="col0"> <code>Constants.TIMESTAMP</code> </td><td class="col1"> <code>String</code> </td><td class="col2"> momentul de timp la care a fost realizată înregistrarea </td>
	</tr>
</table></div>

<p>
<strong>b)</strong> Pe firul de execuție <code>MessagePushExecutor</code> din fragmentul <code>RegisteredFragment</code>, să se transmită o cerere HTTP de tip POST către către componenta din serverul de aplicații, responsbilă cu transmiterea unui mesaj sub forma unei notificări (disponibilă la <code>Constants.MESSAGE_PUSH_SERVICE_ADDRESS</code>).
</p>

<p>
Aceasta va conține următorii parametrii (instanțiați ca membrii ai clasei):
</p>
<ul>
<li class="level1"><div class="li"> <code>Constants.REGISTRATION_ID</code> - identificatorul de înregistrare furnizat de serverul Google Cloud Messaging;</div>
</li>
<li class="level1"><div class="li"> <code>Constants.MESSAGE</code> - mesajul propriu-zis care se dorește a fi transmis.</div>
</li>
</ul>

<p>
Codificarea utilizată pentru această comunicație este UTF-8.
</p>

<p>
În această situație, nu este necesară prelucrarea rezultatului obținut.
</p>

<p>
<strong>9.</strong> În momentul în care este transmis un mesaj de către expeditor, să se observe notificarea destinatarului și activitatea în care pot fi vizualizați parametrii pachetului furnizat de serverul Google Cloud Messaging.
</p>

<p>
<img src="../../_media/eim/laboratoare/laborator08/mobile_device_application04.png%3Fw=400&amp;tok=6b5578" class="mediacenter" alt="" width="400" />
</p>

<p>
<strong>10.</strong>  Să se încarce modificările realizate în cadrul depozitului &#039;Laborator08-Client&#039; de pe contul Github personal, folosind un mesaj sugestiv. 
</p>
<pre class="code">student@pdsd2015:~/Laborator08-Client$ git add *
student@pdsd2015:~/Laborator08-Client$ git commit -m &quot;implemented taks for laboratory 08-Client&quot;
student@pdsd2015:~/Laborator08-Client$ git push Laborator08-Client_perfectstudent master</pre>

</div>

<h3 class="sectionedit21" id="serverul_de_aplicatii_optional">Serverul de Aplicații (Opțional)</h3>
<div class="level3">

<p>
<p><div class="notetip">Informații referitoare la configurarea serverului de aplicații pot fi obținute la <a href="laborator08.html#configurare_server_optional" class="wikilink1" title="eim:laboratoare:laborator08">Configurare Server</a>.
</div></p>
</p>

<p>
Funcționalitatea corespunzătoare serverului de aplicații este disponibilă în două variante:
</p>
<ul>
<li class="level1"><div class="li"> PHP &amp; MySQL, găzduită la o adresă Internet publică;</div>
</li>
<li class="level1"><div class="li"> JavaServlets / JSP &amp; MySQL (folosind un server web Apache Tomcat 8.0.21 - integrat în structura proiectului, fără a necesita configurare), care poate fi rulat pe mașina fizică (local), comunicând cu dispozitivul mobil numai în situația în care acestea se găsesc în aceeași rețea și portul 8080 nu este blocat - de aceea, toate operațiile de configurare ce urmează se referă la această aplicație.</div>
</li>
</ul>

<p>
Pe serverul de aplicații sunt disponibile următoarele funcționalități, în cadrul unor componente diferite:
</p>
<ul>
<li class="level1"><div class="li"> înregistrarea unui dispozitiv mobil în cadrul unei baze de date locale, pe baza unui identificator de înregistrare furnizat de serverul Google Cloud Messaging;</div>
</li>
<li class="level1"><div class="li"> listarea tuturor dispozitivelor mobile înregistrate sub forma unui document JSON;</div>
</li>
<li class="level1"><div class="li"> transmiterea unui mesaj sub forma unui notificări către un dispozitiv mobil, prin intermediul serverului Google Cloud Messaging.</div>
</li>
</ul>

<p>
<strong>11.</strong> În contul Github personal, să se creeze un depozit denumit &#039;Laborator08-Server&#039;. Inițial, acesta trebuie să fie gol (nu trebuie să bifați nici adăugarea unui fișier <code>README.md</code>, nici a fișierului <code>.gitignore</code> sau a a fișierului <code>LICENSE</code>).
</p>

<p>
<strong>12.</strong> Să se cloneze în directorul de pe discul local conținutul depozitului la distanță de la <a href="https://www.github.com/pdsd2015/Laborator08-Server" class="urlextern" title="https://www.github.com/pdsd2015/Laborator08-Server"  rel="nofollow">https://www.github.com/pdsd2015/Laborator08-Server</a>. 
</p>

<p>
În urma acestei operații, directorul Laborator08-Server va trebui să se conțină directoarele <code>PHP</code> și <code>ServletsJSP</code>. 
</p>
<pre class="code">student@pdsd2015:~$ git clone https://www.github.com/pdsd2015/Laborator08-Server</pre>

<p>
<strong>13.</strong> Să se încarce conținutul descărcat în cadrul depozitului &#039;Laborator08-Server&#039; de pe contul Github personal. 
</p>
<pre class="code">student@pdsd2015:~$ cd Laborator08-Server
student@pdsd2015:~/Laborator08-Server$ git remote add Laborator08-Server_perfectstudent https://github.com/perfectstudent/Laborator08-Server
student@pdsd2015:~/Laborator08-Server$ git push Laborator08-Server_perfectstudent master</pre>

<p>
<strong>14.</strong> Să se descarce cea mai recentă versiune stabilă a mediului de dezvoltare Eclipse IDE for Java EE Developers, integrându-se cu serverul web Apache Tomcat.
</p>

<p>
<strong>15.</strong> Să se instaleze motorul pentru gestiunea bazelor de date MySQL și să se ruleze script-ul <code>googlecloudmessaging.sql</code> din cadrul directorului <code>ServletsJSP</code> care creează o bază de date cu o tabelă în care vor fi stocate informațiile referitoare la identificatorii de înregistrare transmiși de clienții Android.
</p>
<pre class="code">CREATE DATABASE googlecloudmessaging;

USE googlecloudmessaging;

CREATE TABLE registered_devices (
  id              INT(10) UNSIGNED AUTO_INCREMENT PRIMARY KEY NOT NULL,
  registration_id TEXT NOT NULL,
  username        VARCHAR(255),			
  email           VARCHAR(255),
  timestamp       TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);</pre>

<p>
Rularea acestuia se poate realiza folosind una dintre următoarele variante, presupunând că vă aflați în directorul în care se găsește acest fișier:
</p>
<ol>
<li class="level1"><div class="li"> <pre class="code">student@pdsd2015:~/Laborator08-Server/JSPServlets$ mysql -u root -p &lt;googlecloudmessaging.sql</pre>
</div>
</li>
<li class="level1"><div class="li"> <pre class="code">student@pdsd2015:~/Laborator08-Server/JSPServlets$ mysql -u root -p
Enter password:</pre>
</div>
<ol>
<li class="level2"><div class="li"> <pre class="code">mysql&gt; source googlecloudmessaging.sql;</pre>

<p>
 sau
</p>
</div>
</li>
<li class="level2"><div class="li"> <pre class="code">mysql&gt; \. googlecloudmessaging.sql;</pre>
</div>
</li>
</ol>
</li>
</ol>

<p>
<strong>16.</strong> Să se importe proiectul <code>GoogleCloudMessagingServer</code> în mediul de dezvoltare Eclipse IDE for Java EE Developers.
</p>

<p>
<strong>17.</strong> În interfața <code>Constants</code> din pachetul <code>ro.pub.cs.systems.pdsd.lab08.googlecloudmessaging.general</code>, trebuie modificate următoarele valori:
</p>
<ul>
<li class="level1"><div class="li"> <code>DATABASE_PASSWORD</code> - parola de administrare a motorului pentru gestiunea bazei de date MySQL, care a fost introdusă la instalarea acestui produs;</div>
</li>
<li class="level1"><div class="li"> <code><abbr title="Application Programming Interface">API</abbr>_KEY</code> - cheia publică de acces a serverului Google Cloud Messaging de către serverul de aplicații, așa cum a fost generată de Consola Google <abbr title="Application Programming Interface">API</abbr>.</div>
</li>
</ul>

<p>
<strong>18.</strong> În acest moment, se poate realiza comunicația client Android ↔ server de aplicații prin intermediul serviciului Google Cloud Messaging:
</p>
<ul>
<li class="level1"><div class="li"> clientul Android trimite identificatorul de înregistrare către serverul de aplicații;</div>
</li>
<li class="level1"><div class="li"> se accesează componenta pentru transmiterea unui mesaj prin intermediul unei notificări în aplicația curentă de navigare (<em>eng.</em> browser)<br/>
<img src="http://ocw.cs.pub.ro/courses/_media/pdsd/laboratoare/laborator08/message_push.png?w=800&amp;tok=8a4e69" class="mediacenter" alt="" width="800" /></div>
<ul>
<li class="level2"><div class="li"> PHP: <a href="http://pdsd2015.andreirosucojocaru.ro/exemple/laboratoare/laborator08/googlecloudmessaging/message_push.php" class="urlextern" title="http://pdsd2015.andreirosucojocaru.ro/exemple/laboratoare/laborator08/googlecloudmessaging/message_push.php"  rel="nofollow">http://pdsd2015.andreirosucojocaru.ro/exemple/laboratoare/laborator08/googlecloudmessaging/message_push.php</a>;</div>
</li>
<li class="level2"><div class="li"> JavaServlets / JSP (local): <a href="http://192.168.56.1:8080/GoogleCloudMessagingServer/MessagePushServlet" class="urlextern" title="http://192.168.56.1:8080/GoogleCloudMessagingServer/MessagePushServlet"  rel="nofollow">http://192.168.56.1:8080/GoogleCloudMessagingServer/MessagePushServlet</a>.</div>
</li>
</ul>
</li>
</ul>

</div>

<h2 class="sectionedit22" id="resurse_utile">Resurse Utile</h2>
<div class="level2">

<p>
<a href="http://tomcat.apache.org/download-70.cgi" class="urlextern" title="http://tomcat.apache.org/download-70.cgi"  rel="nofollow">Apache Tomcat 7 Downloads</a><br/>

<a href="http://www.eclipse.org/downloads/packages/eclipse-ide-java-ee-developers/keplersr2" class="urlextern" title="http://www.eclipse.org/downloads/packages/eclipse-ide-java-ee-developers/keplersr2"  rel="nofollow">Eclipse IDE for Java EE Developers</a><br/>

<a href="http://dev.mysql.com/downloads/" class="urlextern" title="http://dev.mysql.com/downloads/"  rel="nofollow">MySQL Downloads</a>
</p>

<p>
<a href="http://androidexample.com/Android_Push_Notifications_using_Google_Cloud_Messaging_%28GCM%29_-_PART_1/index.php?view=article_discription&amp;aid=119&amp;aaid=139" class="urlextern" title="http://androidexample.com/Android_Push_Notifications_using_Google_Cloud_Messaging_%28GCM%29_-_PART_1/index.php?view=article_discription&amp;aid=119&amp;aaid=139"  rel="nofollow">Android Push Notifications using Google Cloud Messaging</a><br/>

<a href="http://developer.android.com/google/gcm/index.html" class="urlextern" title="http://developer.android.com/google/gcm/index.html"  rel="nofollow">Google Cloud Messaging for Android</a><br/>

<a href="http://developer.android.com/reference/com/google/android/gms/gcm/GoogleCloudMessaging.html" class="urlextern" title="http://developer.android.com/reference/com/google/android/gms/gcm/GoogleCloudMessaging.html"  rel="nofollow">Google Cloud Messaging API</a><br/>

<a href="http://stackoverflow.com/questions/20121883/how-to-install-google-play-services-in-a-genymotion-vm-with-no-drag-and-drop-su" class="urlextern" title="http://stackoverflow.com/questions/20121883/how-to-install-google-play-services-in-a-genymotion-vm-with-no-drag-and-drop-su"  rel="nofollow">How to install Google Play Services in a Genymotion VM (with no drag and drop support)?</a><br/>

<a href="http://forum.xda-developers.com/showthread.php?t=2528952" class="urlextern" title="http://forum.xda-developers.com/showthread.php?t=2528952"  rel="nofollow">Installing ARM Translation and GApps</a><br/>

<a href="http://developer.android.com/guide/topics/ui/notifiers/notifications.html" class="urlextern" title="http://developer.android.com/guide/topics/ui/notifiers/notifications.html"  rel="nofollow">Android Notifications</a>
</p>

</div>

        </div>
        <div class="right_sidebar">
          <form action="../../start.html" accept-charset="utf-8" class="search" id="dw__search" method="get"><div class="no"><input type="hidden" name="do" value="search" /><input type="text" id="qsearch__in" accesskey="f" name="id" class="edit" title="[F]" /><input type="submit" value="Search" class="button" title="Search" /><div id="qsearch__out" class="ajax_qsearch JSpopup"></div></div></form>          <div class="namespace_sidebar sidebar_box">

<h1 class="sectionedit1" id="informatii_administrative">Informaţii Administrative</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../informatii/regulament.html" class="wikilink1" title="eim:informatii:regulament">Regulament</a></div>
</li>
<li class="level1"><div class="li"> <a href="../informatii/anunturi.html" class="wikilink1" title="eim:informatii:anunturi">Anunțuri</a></div>
</li>
<li class="level1"><div class="li"> <a href="../informatii/calendar.html" class="wikilink1" title="eim:informatii:calendar">Calendar</a></div>
</li>
<li class="level1"><div class="li"> <a href="../informatii/catalog.html" class="wikilink1" title="eim:informatii:catalog">Catalog</a></div>
</li>
<li class="level1"><div class="li"> <a href="../informatii/impartirea_pe_semigrupe.html" class="wikilink1" title="eim:informatii:impartirea_pe_semigrupe">Împărțirea pe Semigrupe</a></div>
</li>
</ul>

</div>
<!-- EDIT1 SECTION "Informaţii Administrative" [1-222] -->
<h1 class="sectionedit2" id="cursuri">Cursuri</h1>
<div class="level1">


<ul>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/01.intro-eim.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/01.intro-eim.pdf"  rel="nofollow"> 01.intro-eim.pdf </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/02.03.media_access.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/02.03.media_access.pdf"  rel="nofollow"> 02.03.media_access.pdf  </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/04.05.telecom_systems.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/04.05.telecom_systems.pdf"  rel="nofollow"> 04.05.telecom_systems.pdf  </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/06.07.wlan.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/06.07.wlan.pdf"  rel="nofollow"> 06.07.wlan.pdf  </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/08.net.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/08.net.pdf"  rel="nofollow"> 08.net.pdf  </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/09.voip.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/09.voip.pdf"  rel="nofollow"> 09.voip.pdf  </a></div>
</li>
<li class="level1"><div class="li"> <a href="../../_media/eim/curs/10.location.pdf" class="urlextern" title="http://ocw.cs.pub.ro/courses/_media/eim/curs/10.location.pdf"  rel="nofollow"> 10.location.pdf  </a></div>
</li>
</ul>

</div>
<!-- EDIT2 SECTION "Cursuri" [223-1025] -->
<h1 class="sectionedit3" id="laboratoare">Laboratoare</h1>
<div class="level1">


<ul>
<li class="level1"><div class="li"> <a href="laborator01.html" class="wikilink1" title="eim:laboratoare:laborator01">Laborator 01. Introducere in Programarea Android</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator02.html" class="wikilink1" title="eim:laboratoare:laborator02">Laborator 02. Structura unei Aplicații (I) - Activități</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator03.html" class="wikilink1" title="eim:laboratoare:laborator03">Laborator 03. Proiectarea Interfețelor Grafice</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator04.html" class="wikilink1" title="eim:laboratoare:laborator04">Laborator 04. Structura unei Aplicații (II) - Intenții &amp; Fragmente</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator05.html" class="wikilink1" title="eim:laboratoare:laborator05">Laborator 05. Structura unei Aplicații (III) - Servicii</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator06.html" class="wikilink1" title="eim:laboratoare:laborator06">Laborator 06. Comunicația prin Sockeți TCP</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator07.html" class="wikilink1" title="eim:laboratoare:laborator07">Laborator 07. Invocarea de Servicii Web prin Protocolul HTTP</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator08.html" class="wikilink1" title="eim:laboratoare:laborator08">Laborator 08. Implementarea Serviciilor de Rețea</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator09.html" class="wikilink1" title="eim:laboratoare:laborator09">Laborator 09. Gestiunea Apelurilor Telefonice folosind SIP &amp; VoIP</a></div>
</li>
<li class="level1"><div class="li"> <a href="laborator10.html" class="wikilink1" title="eim:laboratoare:laborator10">Laborator 10. Utilizarea Serviciilor de Localizare</a></div>
</li>
<li class="level1"><div class="li"> <span class="curid"><a href="laborator11.html" class="wikilink1" title="eim:laboratoare:laborator11">Laborator 11. (OPȚIONAL) Transmiterea de Notificări folosind Serviciul Google Cloud Messaging</a></span></div>
</li>
</ul>

</div>
<!-- EDIT3 SECTION "Laboratoare" [1026-2133] -->
<h1 class="sectionedit4" id="colocvii">Colocvii</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../colocvii/colocviu01.html" class="wikilink1" title="eim:colocvii:colocviu01">Colocviu 1</a></div>
</li>
<li class="level1"><div class="li"> <a href="../colocvii/colocviu02.html" class="wikilink1" title="eim:colocvii:colocviu02">Colocviu 2</a></div>
</li>
</ul>

</div>
<!-- EDIT4 SECTION "Colocvii" [2134-2244] -->
<h1 class="sectionedit5" id="resurse">Resurse</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../reading.html" class="wikilink1" title="eim:reading">Documentație Examen</a></div>
</li>
</ul>

</div>
<!-- EDIT5 SECTION "Resurse" [2245-2309] -->
<h1 class="sectionedit6" id="tutoriale">Tutoriale</h1>
<div class="level1">
<ul>
<li class="level1"><div class="li"> <a href="../tutoriale/java.html" class="wikilink1" title="eim:tutoriale:java">Java</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/sdk_android.html" class="wikilink1" title="eim:tutoriale:sdk_android">SDK Android</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/eclipse.html" class="wikilink1" title="eim:tutoriale:eclipse">Eclipse</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/android_studio.html" class="wikilink1" title="eim:tutoriale:android_studio">Android Studio</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/genymotion.html" class="wikilink1" title="eim:tutoriale:genymotion">Genymotion</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/android_virtual_device.html" class="wikilink1" title="eim:tutoriale:android_virtual_device">Android Virtual Device</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/git.html" class="wikilink1" title="eim:tutoriale:git">Git</a></div>
</li>
<li class="level1"><div class="li"> <a href="../tutoriale/google_play_services.html" class="wikilink1" title="eim:tutoriale:google_play_services">Google Play Services în Genymotion</a></div>
</li>
</ul>

</div>
<!-- EDIT6 SECTION "Tutoriale" [2310-] -->
</div>
<div class="toc_sidebar sidebar_box">
<!-- TOC START -->
<div id="sb__right__dw__toc">
<h3 class="toggle">Table of Contents</h3>
<div>

<ul class="toc">
<li class="level1"><div class="li"><a href="laborator11.html#laborator_11_transmiterea_de_notificari_folosind_serviciul_google_cloud_messaging">Laborator 11. Transmiterea de Notificări folosind Serviciul Google Cloud Messaging</a></div>
<ul class="toc">
<li class="level2"><div class="li"><a href="laborator11.html#arhitectura_google_cloud_messaging_for_android">Arhitectura Google Cloud Messaging for Android</a></div></li>
<li class="level2"><div class="li"><a href="laborator11.html#configurare">Configurare</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator11.html#configurare_client">Configurare client</a></div></li>
<li class="level3"><div class="li"><a href="laborator11.html#configurare_server_optional">Configurare server (opțional)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator11.html#proiectarea_si_dezvoltarea_clientului">Proiectarea și dezvoltarea clientului</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator11.html#proiectul_eclipse">Proiectul Eclipse</a></div></li>
<li class="level3"><div class="li"><a href="laborator11.html#structura_proiectului">Structura Proiectului</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator11.html#activitatea_googlecloudmessagingactivity">Activitatea GoogleCloudMessagingActivity</a></div></li>
<li class="level4"><div class="li"><a href="laborator11.html#ascultatorul_googlecloudmessagingbroadcastreceiver">Ascultătorul GoogleCloudMessagingBroadcastReceiver</a></div></li>
<li class="level4"><div class="li"><a href="laborator11.html#serviciul_googlecloudmessagingintentservice">Serviciul GoogleCloudMessagingIntentService</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator11.html#permisiuni_androidmanifestxml">Permisiuni AndroidManifest.xml</a></div></li>
<li class="level3"><div class="li"><a href="laborator11.html#reguli_proguard">Reguli Proguard</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator11.html#proiectarea_si_dezvoltarea_serverului_optional">Proiectarea și dezvoltarea serverului (opțional)</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator11.html#structura_unui_mesaj">Structura unui mesaj</a></div>
<ul class="toc">
<li class="level4"><div class="li"><a href="laborator11.html#cerereserver_de_aplicatii_server_de_conexiune_gcm">Cerere: server de aplicații → server de conexiune GCM</a></div></li>
<li class="level4"><div class="li"><a href="laborator11.html#raspunsserver_de_conexiune_gcm_server_de_aplicatii">Răspuns: server de conexiune GCM → server de aplicații</a></div></li>
</ul>
</li>
<li class="level3"><div class="li"><a href="laborator11.html#tratarea_cererilor_de_inregistrare">Tratarea cererilor de înregistrare</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator11.html#activitate_de_laborator">Activitate de Laborator</a></div>
<ul class="toc">
<li class="level3"><div class="li"><a href="laborator11.html#clientul_android">Clientul Android</a></div></li>
<li class="level3"><div class="li"><a href="laborator11.html#serverul_de_aplicatii_optional">Serverul de Aplicații (Opțional)</a></div></li>
</ul>
</li>
<li class="level2"><div class="li"><a href="laborator11.html#resurse_utile">Resurse Utile</a></div></li>
</ul></li>
</ul>
</div>
</div>
<!-- TOC END -->
</div>
        </div>
      
    
      <div class="stylefoot">
        <div class="meta">
          <div class="user">
                    </div>
          <div class="doc">
          eim/laboratoare/laborator11.txt · Last modified: 2016/04/18 14:41 by dragos.niculescu          </div>
        </div>
      </div>

    <div class="clearer"></div>

    
                <div class="bar" id="bar__bottom">
      <div class="bar-left">
        <a href="laborator11%3Fdo=revisions.html"  class="action revs" accesskey="o" rel="nofollow" title="Old revisions [O]">Old revisions</a>      </div>
      <div class="bar-right">
        <a href="laborator11%3Fdo=media&amp;ns=eim%253Alaboratoare.html"  class="action media" rel="nofollow" title="Media Manager">Media Manager</a><a href="laborator11.html#dokuwiki__top"  class="action top" accesskey="t" rel="nofollow" title="Back to top [T]">Back to top</a>      </div>
    </div>
    <div class="clearer"></div>
            
    <div align="center" class="footerinc">
  <div class="license"><a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="../../lib/images/license/button/cc-by-sa.png" alt="CC Attribution-Share Alike 3.0 Unported" /></a></div>
  <a target="_blank" href="http://www.chimeric.de" title="www.chimeric.de"><img src="../../lib/tpl/arctic/images/button-chimeric-de.png" width="80" height="15" alt="www.chimeric.de" border="0" /></a>

  <a target="_blank" href="http://jigsaw.w3.org/css-validator/check/referer" title="Valid CSS"><img src="../../lib/tpl/arctic/images/button-css.png" width="80" height="15" alt="Valid CSS" border="0" /></a>

  <a target="_blank" href="http://wiki.splitbrain.org/wiki:dokuwiki" title="Driven by DokuWiki"><img src="../../lib/tpl/arctic/images/button-dw.png" width="80" height="15" alt="Driven by DokuWiki" border="0" /></a>

  <a target="_blank" href="http://www.firefox-browser.de" title="do yourself a favour and use a real browser - get firefox"><img src="../../lib/tpl/arctic/images/button-firefox.png" width="80" height="15" alt="do yourself a favour and use a real browser - get firefox!!" border="0" /></a>
  
  <a target="_blank" href="../../feed.php" title="Recent changes RSS feed"><img src="../../lib/tpl/arctic/images/button-rss.png" width="80" height="15" alt="Recent changes RSS feed" border="0" /></a>

  <a target="_blank" href="http://validator.w3.org/check/referer" title="Valid XHTML 1.0"><img src="../../lib/tpl/arctic/images/button-xhtml.png" width="80" height="15" alt="Valid XHTML 1.0" border="0" /></a>
</div>

  </div>
</div>

<div class="no"><img src="../../lib/exe/indexer.php%3Fid=eim%253Alaboratoare%253Alaborator11&amp;1479899472" width="2" height="1" alt="" /></div>
</body>
</html>
